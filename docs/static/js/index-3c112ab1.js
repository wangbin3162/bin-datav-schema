import{M as S,a as Q}from"./chunk-bin-ui-next-d0a25e35.js";import{h as de,t as x,m as ce,r as re,i as pe,w as I,j as R,k as he,l as ue,s as _e,p as me,n as be}from"./index-624f4eaf.js";import{B as V,E as ge,aw as X,aL as ne,l as Y,G as y,o as m,e as J,w,c as _,b as e,f as N,t as u,a as f,O as z,a1 as te,F as j,m as M,aH as Z,aI as ee,A as ve,j as oe,g as G,v as W,L as se,N as fe}from"./vendor-b7d265ee.js";import{_ as we}from"./logo-39114ead.js";import{d as ye,s as $e}from"./database.api-ce580dc4.js";import{g as ke,r as Ce}from"./template.api-b85853a8.js";import"./chunk-brace-b4ee70be.js";const P={pid:"1",name:"\u7F3A\u7701\u76EE\u5F55",directory:"Y"};function xe(){const s=V({selectedPid:P.pid,selectedName:P.name,folderList:[],adding:!1}),b=({id:n,name:a})=>{s.selectedPid=n,s.selectedName=a},D=n=>{if(!s.adding)return;(n.target.value||"").trim()||(s.adding=!1)},$=async n=>{if(!s.adding)return;const a=(n.target.value||"").trim();if(a)try{await de({...P,name:a}),s.adding=!1,p(),S.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(v){x("useModelFolder/addGroup",v)}else s.adding=!1},t=(n,a)=>{if(!a.editing)return;const v=(n.target.value||"").trim();(!v||a.name===v)&&(a.editing=!1)},c=async(n,a)=>{if(!a.editing)return;const v=(n.target.value||"").trim();if(v&&a.name!==v){try{await ce({id:a.id,name:v}),a.name=v,b({id:a.id,name:v}),S.success("\u4FEE\u6539\u6210\u529F\uFF01")}catch(L){x("useModelFolder/editGroup",L)}a.editing=!1}else a.editing=!1},h=({id:n,name:a})=>{Q.confirm({type:"error",title:`\u786E\u5B9A\u8981\u5220\u9664 [ ${a} ] \u5417\uFF1F`}).then(async()=>{try{await re(n),b({id:P.pid,name:P.name}),p(),S.success("\u5220\u9664\u6210\u529F\uFF01")}catch(v){x("useModelFolder/confirmDeleteGroup",v)}}).catch(()=>{})},p=()=>{pe().then(n=>{s.folderList=(n.children||[]).map(a=>({id:a.id,name:a.text}))})};return p(),{...ge(s),toggleProject:b,confirmDeleteGroup:h,onAddInputBlur:D,onEditInputBlur:t,editGroup:c,addGroup:$}}var Ve="/bin-datav-schema/static/png/new-project-b5c06121.png";const k=s=>(Z("data-v-5bde0b16"),s=s(),ee(),s),De=k(()=>e("h2",{class:"title-bar"},"\u9884\u8BBE",-1)),Ie={class:"preset-wp"},Se=k(()=>e("i",{class:"b-iconfont b-icon-laptop"},null,-1)),je={class:"label-title"},Be={class:"h2"},Ne={class:"h4"},Le={flex:"main:justify",style:{width:"180px"}},Ke=k(()=>e("i",{class:"b-iconfont b-icon-mobile"},null,-1)),Pe={class:"label-title"},ze={class:"h2"},Ge={class:"h4"},Me={flex:"main:justify",style:{width:"180px"}},Fe=k(()=>e("i",{class:"b-iconfont b-icon-gateway"},null,-1)),Te=k(()=>e("p",{class:"mb-5"},"\u81EA\u5B9A\u4E49\u5927\u5C0F",-1)),Oe={class:"custom-input"},Ee=k(()=>e("span",{class:"mr-5"},"W:",-1)),Ae=k(()=>e("span",{class:"ml-5 mr-5"},"H:",-1)),Re=k(()=>e("div",{style:{width:"24px"}},null,-1)),Ue=k(()=>e("h2",{class:"title-bar"},"\u6A21\u677F",-1)),qe={class:"template-list"},He=["onClick"],Je={class:"template-image"},We={class:"preview-image"},Ye=["src"],Qe={class:"tpl-remove"},Xe={class:"template-info"},Ze={class:"template-name"},et={class:"template-size"},tt=k(()=>e("p",null,"\u753B\u5E03\u5C3A\u5BF8",-1)),st=M("\u53D6\u6D88"),nt=M("\u5F00\u59CB\u521B\u4F5C"),ot={__name:"create-kanban",setup(s,{expose:b}){const D=ne(),$=Y(!1),t=V({...ye}),c=V({label:I[0].label,width:I[0].width,height:I[0].height}),h=V({label:R[0].label,width:R[0].width,height:R[0].height}),p=V({width:1920,height:1080}),n=Y([]),a=()=>{$.value=!1},v=()=>{t.label=I[0].label,t.width=I[0].width,t.height=I[0].height,t.type="web",t.tpl="",T(),$.value=!0},L=o=>{t.type="tpl",t.tpl=o.id},F=({width:o,height:d})=>{t.label="\u81EA\u5B9A\u4E49",t.width=o,t.height=d,t.tpl=""},U=o=>{c.label=o.label,c.width=o.width,c.height=o.height,t.label=o.label,t.type=o.type,t.width=o.width,t.height=o.height,t.tpl=""},q=o=>{h.label=o.label,h.width=o.width,h.height=o.height,t.label=o.label,t.type=o.type,t.width=o.width,t.height=o.height,t.tpl=""},T=()=>{ke().then(o=>{n.value=(o.rows||[]).map(d=>{let C={};try{C=JSON.parse(d.content)}catch{C={pageConfig:{}}}return{id:d.id,name:d.name,pageConfig:C.pageConfig}})})},H=o=>{Q.confirm({type:"error",title:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u6A21\u677F\u5417\uFF1F"}).then(async()=>{try{await Ce(o.id),T(),S.success("\u79FB\u9664\u6A21\u677F\u6210\u529F\uFF01")}catch(d){x("create-screen/removeTpl",d)}}).catch(()=>{})},l=o=>{o==="web"?(t.label=c.label,t.width=c.width,t.height=c.height):o==="mobile"?(t.label=h.label,t.width=h.width,t.height=h.height):o==="custom"&&(t.label="\u81EA\u5B9A\u4E49",t.width=p.width,t.height=p.height),t.type=o,t.tpl=""},r=async()=>{a(),await $e(t),await D.push({path:"/schema/screen"})};return b({openCreate:v}),(o,d)=>{const C=y("b-icon"),K=y("b-dropdown-item"),O=y("b-dropdown-menu"),E=y("b-dropdown"),A=y("b-input-number"),g=y("b-button"),B=y("b-modal");return m(),J(B,{modelValue:$.value,"onUpdate:modelValue":d[7]||(d[7]=i=>$.value=i),title:"\u521B\u5EFA\u770B\u677F",width:"1000px","custom-class":"schema-modal","destroy-on-close":""},{footer:w(()=>[_(g,{onClick:a},{default:w(()=>[st]),_:1}),_(g,{type:"primary",onClick:r},{default:w(()=>[nt]),_:1})]),default:w(()=>[e("div",null,[De,e("div",Ie,[e("div",{class:N(["preset-item web-box",{selected:t.type==="web"}]),onClick:d[0]||(d[0]=i=>l("web"))},[Se,e("div",je,[e("div",Be,u(c.label),1),e("div",Ne,u(c.width)+"x"+u(c.height),1)]),_(E,{trigger:"click",placement:"bottom-end",style:{width:"24px",height:"46px","line-height":"46px"},onCommand:U},{dropdown:w(()=>[_(O,null,{default:w(()=>[(m(!0),f(j,null,z(te(I),i=>(m(),J(K,{key:i.label,name:i},{default:w(()=>[e("div",Le,[e("span",null,u(i.label),1),e("span",null,u(i.width)+"x"+u(i.height),1)])]),_:2},1032,["name"]))),128))]),_:1})]),default:w(()=>[_(C,{name:"down",type:"button"})]),_:1})],2),e("div",{class:N(["preset-item mobile-box",{selected:t.type==="mobile"}]),onClick:d[1]||(d[1]=i=>l("mobile"))},[Ke,e("div",Pe,[e("div",ze,u(h.label),1),e("div",Ge,u(h.width)+"x"+u(h.height),1)]),_(E,{trigger:"click",placement:"bottom-end",style:{width:"24px",height:"46px","line-height":"46px"},onCommand:q},{dropdown:w(()=>[_(O,null,{default:w(()=>[(m(!0),f(j,null,z(te(R),i=>(m(),J(K,{key:i.label,name:i},{default:w(()=>[e("div",Me,[e("span",null,u(i.label),1),e("span",null,u(i.width)+"x"+u(i.height),1)])]),_:2},1032,["name"]))),128))]),_:1})]),default:w(()=>[_(C,{name:"down",type:"button"})]),_:1})],2),e("div",{class:N(["preset-item custom-box",{selected:t.type==="custom"}]),onClick:d[6]||(d[6]=i=>l("custom"))},[Fe,e("div",null,[Te,e("p",Oe,[Ee,_(A,{modelValue:p.width,"onUpdate:modelValue":d[2]||(d[2]=i=>p.width=i),min:100,step:1,precision:0,size:"mini",onChange:d[3]||(d[3]=i=>F(p))},null,8,["modelValue"]),Ae,_(A,{modelValue:p.height,"onUpdate:modelValue":d[4]||(d[4]=i=>p.height=i),min:100,step:1,precision:0,size:"mini",onChange:d[5]||(d[5]=i=>F(p))},null,8,["modelValue"])])]),Re],2)]),Ue,e("div",qe,[(m(!0),f(j,null,z(n.value,i=>(m(),f("div",{class:"template-grid",key:i.id},[e("div",{class:N(["template-item",{selected:t.type==="tpl"&&t.tpl===i.id}]),onClick:le=>L(i)},[e("div",Je,[e("div",We,[e("img",{src:i.pageConfig.bgImage,alt:""},null,8,Ye)]),e("div",Qe,[_(g,{type:"text","text-color":"#f5222d",title:"\u79FB\u9664\u6A21\u677F",icon:"delete",onClick:le=>H(i)},null,8,["onClick"])])]),e("div",Xe,[e("div",Ze,u(i.name),1),e("div",et,[tt,e("p",null,u(i.pageConfig.width)+"x"+u(i.pageConfig.height)+"px",1)])])],10,He)]))),128))])])]),_:1},8,["modelValue"])}}};var at=X(ot,[["__scopeId","data-v-5bde0b16"]]);const ae=s=>(Z("data-v-3752c0b1"),s=s(),ee(),s),it={class:"kanban-list-wp"},lt=ae(()=>e("img",{src:Ve},null,-1)),dt=ae(()=>e("span",{class:"text-title ellipsis"},"\u65B0\u5EFA\u770B\u677F",-1)),ct=[lt,dt],rt={class:"list-header"},pt={class:"title"},ht={class:"header-manager"},ut={key:0,class:"list-wrap"},_t={class:"list-item-inner"},mt={class:"list-item-img"},bt={class:"preview-image"},gt=["src"],vt={key:1,src:we,alt:"default",style:{width:"147px",height:"147px"}},ft={class:"list-item-mask"},wt={class:"action"},yt=M("\u7F16\u8F91\u770B\u677F"),$t={class:"icon-ctrl pt-10"},kt=["onClick"],Ct=["onClick"],xt={class:"icon-box"},Vt=["onClick"],Dt=["onClick"],It={class:"list-item-info"},St={class:"item-title","t-ellipsis":""},jt={style:{height:"200px"},flex:"main:center cross:center"},Bt=M("\u8BE5\u5206\u7EC4\u4E0B\u6CA1\u6709\u770B\u677F"),Nt={class:"t-center pb-24"},Lt={__name:"kanban-list",props:{group:{type:Object,default:()=>({})}},setup(s){const b=s,D=ne(),$=Y(null),t=V({name:"",page:1,size:20}),c=V({rows:[],total:0,loading:!1}),h=V({id:"",pid:"",name:"",directory:"N"}),p=async()=>{try{c.loading=!0;const l=await he({pid:b.group.pid,...t});c.rows=(l.rows||[]).map(r=>{let o={};try{o=JSON.parse(r.layout)}catch{o={}}return{id:r.id,name:r.name,status:r.status,pageConfig:o}}),c.total=l.total}catch(l){x("kanban-list/getSearchList",l)}c.loading=!1},n=async l=>{t.page=l,await p()},a=l=>{let r=D.resolve({path:`/screen/${l.id}`});window.open(r.href,"_blank")},v=()=>{h.pid="",h.name="",h.directory="N"},L=l=>{let r=D.resolve({path:"/schema/screen",query:{id:l}});window.open(r.href,"_blank")},F=()=>{$.value&&$.value.openCreate()},U=l=>{v(),h.id=l.id,h.pid=l.pid,h.name=l.name,h.directory=l.directory,L(l.id)},q=async l=>{try{const r=await ue(l.id);r.name=`${r.name}_copy`,delete r.id,await _e(r),await p(),S.success("\u590D\u5236\u6210\u529F\uFF01")}catch(r){x("kanban-list/handleCopy",r)}},T=async l=>{if(l.status!=="audited")try{await me(l.id),await p(),S.success("\u53D1\u5E03\u6210\u529F\uFF01")}catch(r){x("kanban-list/handlePublish",r)}},H=l=>{Q.confirm({type:"error",title:"\u5220\u9664\u540E\u65E0\u6CD5\u6062\u590D\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F"}).then(async()=>{try{await be(l),await p(),S.success("\u5220\u9664\u6210\u529F\uFF01")}catch(r){x("kanban-list/removeDashboard",r)}}).catch(()=>{})};return ve(()=>b.group,()=>{t.page=1,p()},{immediate:!0,deep:!0}),(l,r)=>{const o=y("b-input"),d=y("b-button"),C=y("iconfont"),K=y("b-tag"),O=y("svg-loading"),E=y("b-empty"),A=y("b-page");return m(),f(j,null,[e("div",it,[e("div",{class:"new-box",onClick:F},ct),e("div",rt,[e("div",pt,[e("h2",null,u(s.group?s.group.name:"")+" ("+u(c.total)+")",1)]),e("div",ht,[_(o,{modelValue:t.name,"onUpdate:modelValue":r[0]||(r[0]=g=>t.name=g),size:"small",placeholder:"\u641C\u7D22",search:"",onSearch:p},null,8,["modelValue"])])]),c.loading?oe("",!0):(m(),f("ul",ut,[(m(!0),f(j,null,z(c.rows,g=>(m(),f("li",{key:g.id,class:"base-list-item"},[e("div",_t,[e("div",mt,[e("div",bt,[g.pageConfig.bgImage?(m(),f("img",{key:0,src:g.pageConfig.bgImage,alt:""},null,8,gt)):(m(),f("img",vt))]),e("div",ft,[e("div",wt,[_(d,{type:"primary",icon:"edit-square",onClick:B=>U(g)},{default:w(()=>[yt]),_:2},1032,["onClick"]),e("div",$t,[e("i",{class:"b-iconfont b-icon-file-copy",onClick:B=>q(g),title:"\u590D\u5236"},null,8,kt),e("i",{class:"b-iconfont b-icon-delete",onClick:B=>H(g.id),title:"\u5220\u9664"},null,8,Ct)])]),e("div",xt,[e("i",{class:"b-iconfont b-icon-View",onClick:B=>a(g),title:"\u9884\u89C8"},null,8,Vt),e("i",{class:"b-iconfont b-icon-send",onClick:B=>T(g),title:"\u53D1\u5E03"},null,8,Dt)])])]),e("div",It,[e("div",St,[_(C,{icon:"linechart"}),e("span",null,u(g.name),1)]),_(K,{type:g.status==="audited"?"success":"primary",dot:"","tag-style":{color:"#999"}},{default:w(()=>[M(u(g.status==="audited"?"\u5DF2\u53D1\u5E03":"\u5F85\u53D1\u5E03"),1)]),_:2},1032,["type"])])])]))),128))])),G(e("div",jt,[_(O,{name:"loading02",width:100})],512),[[W,c.loading]]),G(_(E,null,{default:w(()=>[Bt]),_:1},512),[[W,!c.loading&&c.rows.length===0]]),G(e("div",Nt,[_(A,{total:c.total,current:t.page,"page-size":t.size,onChange:n},null,8,["total","current","page-size"])],512),[[W,!c.loading&&c.total>t.size]])]),_(at,{ref_key:"createRef",ref:$},null,512)],64)}}};var Kt=X(Lt,[["__scopeId","data-v-3752c0b1"]]);const Pt={name:"AnalysisDashboard",components:{KanbanList:Kt},setup(){return{...xe()}}},ie=s=>(Z("data-v-abf4d4dc"),s=s(),ee(),s),zt={class:"kanban-wrapper"},Gt={class:"kanban-main"},Mt={class:"folder-manage"},Ft={class:"folder-manage-group"},Tt=ie(()=>e("span",null,"\u770B\u677F\u5206\u7EC4",-1)),Ot={class:"folder-manage-main"},Et=ie(()=>e("span",null,"\u7F3A\u7701\u76EE\u5F55",-1)),At=[Et],Rt={key:0,class:"folder-item new-group"},Ut=["onClick"],qt=["default-value","onBlur","onKeyup"],Ht={class:"folder-name"},Jt={class:"group-btns"},Wt=["onClick"],Yt=["onClick"],Qt={class:"right-list"};function Xt(s,b,D,$,t,c){const h=y("kanban-list"),p=fe("focus");return m(),f("div",zt,[e("div",Gt,[e("div",Mt,[e("div",Ft,[Tt,e("i",{class:"b-iconfont b-icon-plus btn-add-icon",title:"\u65B0\u589E\u6587\u4EF6\u5939",onClick:b[0]||(b[0]=n=>s.adding=!0)})]),e("div",Ot,[e("div",{class:N(["folder-item folder-all",{"folder-item-checked-color":s.selectedPid==="1"}]),onClick:b[1]||(b[1]=n=>s.toggleProject({id:"1",name:"\u7F3A\u7701\u76EE\u5F55"}))},At,2),s.adding?(m(),f("div",Rt,[G(e("input",{class:"edit-input",onBlur:b[2]||(b[2]=(...n)=>s.onAddInputBlur&&s.onAddInputBlur(...n)),onKeyup:b[3]||(b[3]=se((...n)=>s.addGroup&&s.addGroup(...n),["enter"]))},null,544),[[p]])])):oe("",!0),(m(!0),f(j,null,z(s.folderList,n=>(m(),f("div",{key:n.id,class:N(["folder-item",{"folder-item-checked-color":s.selectedPid===n.id}]),onClick:a=>s.toggleProject(n)},[n.editing?G((m(),f("input",{key:0,"default-value":n.name,class:"edit-input",onBlur:a=>s.onEditInputBlur(a,n),onKeyup:se(a=>s.editGroup(a,n),["enter"])},null,40,qt)),[[p]]):(m(),f(j,{key:1},[e("span",Ht,u(n.name),1),e("span",Jt,[e("i",{class:"b-iconfont b-icon-edit",title:"\u7F16\u8F91",onClick:a=>n.editing=!0},null,8,Wt),e("i",{class:"b-iconfont b-icon-delete",title:"\u5220\u9664",onClick:a=>s.confirmDeleteGroup(n)},null,8,Yt)])],64))],10,Ut))),128))])]),e("div",Qt,[_(h,{group:{pid:s.selectedPid,name:s.selectedName}},null,8,["group"])])])])}var is=X(Pt,[["render",Xt],["__scopeId","data-v-abf4d4dc"]]);export{is as default};
