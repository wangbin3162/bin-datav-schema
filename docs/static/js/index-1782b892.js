import{aw as Y,k,o as h,a as w,f as L,a5 as xe,aL as He,l as T,A as re,n as ve,G as C,e as R,w as b,c as u,F as H,j as X,b as n,m as B,t as Z,B as Ve,g as de,Y as $e,h as A,O as te,L as Pe,N as Ye,$ as nt,C as fe,U as at,aH as pe,aI as _e,D as Ce,v as je,d as Xe,q as le,X as lt,a1 as x,M as We,a0 as st,aN as it,a6 as ct,a3 as rt,T as dt}from"./vendor-b7d265ee.js";import{u as z,z as we,A as Me,s as ut,t as De,i as mt,B as Te,o as be,C as q,D as G,M as se,E as U,F as Ke,G as vt,H as Ne,I as Ie,J as ce,f as ft,K as pt,w as _t,j as ht,L as gt,N as bt,O as yt,P as xt,q as Ct,l as wt}from"./index-624f4eaf.js";import{M as Q,a as Fe}from"./chunk-bin-ui-next-d0a25e35.js";import{a as St,g as Je,b as kt}from"./database.api-ce580dc4.js";import{d as Vt,a as $t}from"./file-helper-94af9014.js";import{s as Mt,l as Dt}from"./template.api-b85853a8.js";import{r as Tt,p as Bt,m as Lt}from"./select-options-50e8fac2.js";import"./chunk-brace-b4ee70be.js";const Rt={name:"HeadLoading",setup(){const{schemaStore:o,storeToRefs:t}=z(),{toolbar:a}=t(o);return{loading:k(()=>a.value.loading)}}};function Nt(o,t,a,e,d,l){return h(),w("div",{class:L(["loading-indicator",{loading:e.loading}])},null,2)}var It=Y(Rt,[["render",Nt],["__scopeId","data-v-5475ad30"]]);function Be(){const o=xe(),{schemaStore:t,storeToRefs:a}=z(),{pageInfo:e,pageConfig:d,comps:l}=a(t);async function c(s="edit"){const r={id:e.value.id||o.query.id,name:e.value.name,pid:e.value.pid,status:s,layout:JSON.stringify(d.value),components:l.value.map(f=>we(f.apiData)?{name:f.alias,componentType:f.componentType,componentContent:JSON.stringify(f),componentDataType:Me.static,modelId:"",x:[],y:[],drill:[],filters:[]}:{name:f.alias,componentType:f.componentType,componentDataType:f.apiData.type,modelId:f.apiData.config.modelId,componentContent:JSON.stringify(f),x:f.apiData.config.x,y:f.apiData.config.y,drill:[],filters:[]})};try{return await ut(r)}catch(f){De("userSchemaStore/saveScreenData",f)}return""}async function i(){let s={};try{t.setGlobalLoading(!0);const r={pageInfo:{id:e.value.id,name:e.value.name||"\u770B\u677F\u9884\u89C8",pid:e.value.pid||"1"},pageConfig:d.value,comps:l.value};s=await St(r)}catch{s={}}return t.setGlobalLoading(!1),s}return{saveScreenData:c,previewScreen:i}}const zt={name:"save-screen",props:{modelValue:{type:Boolean},status:{type:String,default:"edit",validator:o=>["edit","audited"].includes(o)}},emits:["update:modelValue"],setup(o,t){const a=k({get:()=>o.modelValue,set:g=>t.emit("update:modelValue",g)}),{schemaStore:e,storeToRefs:d}=z(),{pageInfo:l}=d(e),{saveScreenData:c}=Be(),i=He(),s=xe(),r=T([]),f=T(null),_=T(!1),m=k(()=>`${window.location.origin}/#/screen/${s.query.id}`);mt().then(g=>{r.value=g.data?[g.data]:[]});const v=k(()=>o.status==="edit"?"\u4FDD\u5B58\u770B\u677F":"\u53D1\u5E03\u770B\u677F"),p=()=>{f.value&&f.value.validate(async g=>{if(g){let V="";try{_.value=!0,V=await c(o.status)}catch(S){De("save-screes/saveKanban",S)}_.value=!1,a.value=!1,Q.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0}),setTimeout(()=>{if(V&&!l.value.id){let D=i.resolve({path:"/schema/screen",query:{id:V}});window.location.replace(D.href)}},300)}})},y=()=>{ve(()=>{Te(m.value)&&Q.success("\u590D\u5236\u53D1\u5E03\u5730\u5740\u6210\u529F!")})};return re(()=>o.modelValue,g=>{g&&ve(()=>{f.value&&f.value.resetFields()})}),{formRef:f,pageInfo:l,dirTree:r,loading:_,visible:a,saveKanban:p,btnText:v,shareUrl:m,copyUrl:y}}},Ut=B("\u590D\u5236\u9884\u89C8\u5730\u5740"),Et={class:"t-center"};function At(o,t,a,e,d,l){const c=C("b-input"),i=C("b-form-item"),s=C("g-input"),r=C("b-button"),f=C("b-form"),_=C("b-modal");return h(),R(_,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=m=>e.visible=m),"append-to-body":"",title:e.btnText,top:"200px","custom-class":"schema-modal",onClose:t[3]||(t[3]=m=>e.visible=!1)},{default:b(()=>[u(f,{"label-width":"80px",ref:"formRef",model:e.pageInfo,"label-suffix":":"},{default:b(()=>[u(i,{label:"\u770B\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u770B\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:b(()=>[u(c,{modelValue:e.pageInfo.name,"onUpdate:modelValue":t[0]||(t[0]=m=>e.pageInfo.name=m)},null,8,["modelValue"])]),_:1}),a.status==="audited"&&o.$route.query.id?(h(),w(H,{key:0},[u(i,{label:"\u9884\u89C8\u5730\u5740"},{default:b(()=>[u(s,{modelValue:e.shareUrl,"onUpdate:modelValue":t[1]||(t[1]=m=>e.shareUrl=m),readonly:"",type:"textarea",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),u(i,null,{default:b(()=>[u(r,{type:"text",onClick:e.copyUrl},{default:b(()=>[Ut]),_:1},8,["onClick"])]),_:1})],64)):X("",!0)]),_:1},8,["model"]),n("div",Et,[u(r,{type:"primary",onClick:e.saveKanban,loading:e.loading,style:{width:"200px"}},{default:b(()=>[B(Z(e.btnText),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["modelValue","title"])}var Ot=Y(zt,[["render",At]]);const Ht={name:"save-template",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,t){const{schemaStore:a,storeToRefs:e}=z(),{pageConfig:d,comps:l}=e(a),c=T(null),i=Ve({loading:!1,id:`temp_${be()}`,name:""}),s=k({get:()=>o.modelValue,set:m=>t.emit("update:modelValue",m)}),r=k(()=>({template:{id:i.id,name:i.name},pageConfig:d.value,comps:l.value})),f=()=>{c.value&&c.value.validate(async m=>{if(m){const v=r.value,p=JSON.stringify(v);Vt(p,`${v.template.id}.json`),Q.success({message:"\u6A21\u677F\u6587\u4EF6\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})},_=async()=>{c.value&&c.value.validate(async m=>{if(m){try{i.loading=!0;const v=r.value,p=v.template.name,y=JSON.stringify(v);await Mt({name:p,content:y})}catch(v){De("save-template/saveAsTemplate",v)}i.loading=!1,s.value=!1,Q.success({message:"\u6A21\u677F\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})};return re(()=>o.modelValue,m=>{m&&(c.value&&c.value.resetFields(),i.id=`temp_${be()}`)}),{formRef:c,formStatus:i,visible:s,downloadCfg:f,saveAsTemplate:_}}},Pt={class:"t-center"},Yt=B(" \u914D\u7F6E\u6587\u4EF6 "),jt=B(" \u4FDD\u5B58\u6A21\u677F ");function Xt(o,t,a,e,d,l){const c=C("b-input"),i=C("b-form-item"),s=C("b-form"),r=C("b-button"),f=C("b-modal");return h(),R(f,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=_=>e.visible=_),"append-to-body":"",title:"\u4FDD\u5B58\u4E3A\u6A21\u677F",top:"200px","custom-class":"schema-modal",onClose:t[2]||(t[2]=_=>e.visible=!1)},{default:b(()=>[u(s,{"label-width":"80px",ref:"formRef",model:e.formStatus,"label-suffix":":"},{default:b(()=>[u(i,{label:"\u6A21\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:b(()=>[u(c,{modelValue:e.formStatus.name,"onUpdate:modelValue":t[0]||(t[0]=_=>e.formStatus.name=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),n("div",Pt,[u(r,{type:"primary",icon:"vertical-align-botto",transparent:"",style:{width:"120px"},onClick:e.downloadCfg},{default:b(()=>[Yt]),_:1},8,["onClick"]),u(r,{type:"primary",icon:"save",style:{width:"120px"},loading:e.formStatus.loading,onClick:e.saveAsTemplate},{default:b(()=>[jt]),_:1},8,["loading","onClick"])])]),_:1},8,["modelValue"])}var Wt=Y(Ht,[["render",Xt]]);const Kt={name:"header-bar",components:{SaveTemplate:Wt,SaveScreen:Ot,HeadLoading:It},props:{backUrl:{type:String},backTarget:{type:String,default:"_blank",validator:o=>["_self","_blank"].includes(o)},pageStatus:{type:Object,default:()=>({})}},setup(o){const t=He(),{schemaStore:a,storeToRefs:e}=z(),{pageInfo:d,toolbar:l}=e(a),{previewScreen:c}=Be(),i=T(!1),s=T("edit"),r=T(!1);return{schemaStore:a,pageInfo:d,toolbar:l,saveVisible:i,saveStatus:s,tempVisible:r,handleBack:()=>{const y=o.backUrl||"/";if(o.backTarget==="_blank"){const g=t.resolve(y);window.open(g.href,o.backTarget)}else t.push(y)},handleSaveScreen:()=>{s.value="edit",i.value=!0},handPreview:async()=>{const y=await c();let g=t.resolve({path:`/screen/preview/${y.pageInfo.id}`});window.open(g.href,"_blank")},handlePublish:()=>{s.value="audited",i.value=!0},handleUpload:y=>y.type!=="application/json"?(Q.warning("\u8BF7\u9009\u62E9\u6B63\u786E\u7684json\u914D\u7F6E\u6587\u4EF6"),!1):($t(y).then(g=>{try{const V=JSON.parse(g),{comps:S,pageConfig:D}=V;a.loadScreenData({comps:S,pageConfig:D})}catch{console.warn("The imported file could not be converted to the correct JSON!")}}),!1)}}},Ft={class:"header-container"},Jt={class:"left-actions"},qt={class:"screen-info"},Gt=n("span",null,"\u5206\u6790\u770B\u677F",-1),Zt=n("span",{style:{padding:"0 6px 0 12px"}},"-",-1),Qt={class:"global-actions"},eo={class:"head-btn"};function to(o,t,a,e,d,l){const c=C("b-icon"),i=C("b-tooltip"),s=C("b-space"),r=C("b-upload"),f=C("head-loading"),_=C("save-screen"),m=C("save-template");return h(),w(H,null,[n("div",Ft,[n("div",Jt,[u(s,{size:"mini"},{default:b(()=>[u(i,{content:"\u7EC4\u4EF6","open-delay":500},{default:b(()=>[n("div",{class:L(["head-btn",{active:e.toolbar.components}]),onClick:t[0]||(t[0]=v=>e.schemaStore.toggleCompsPanel())},[u(c,{name:"hourglass",class:L(["com-list-icon",{"is-rotate":!e.toolbar.components}])},null,8,["class"])],2)]),_:1}),u(i,{content:"\u56FE\u5C42","open-delay":500},{default:b(()=>[n("div",{class:L(["head-btn",{active:e.toolbar.layer}]),onClick:t[1]||(t[1]=v=>e.schemaStore.toggleLayerPanel())},[u(c,{name:"container"})],2)]),_:1}),u(i,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:b(()=>[n("div",{class:L(["head-btn",{active:e.toolbar.config}]),onClick:t[2]||(t[2]=v=>e.schemaStore.toggleConfigPanel())},[u(c,{name:"control"})],2)]),_:1}),u(i,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:b(()=>[n("div",{class:L(["head-btn",{active:e.toolbar.toolbox}]),onClick:t[3]||(t[3]=v=>e.schemaStore.toggleToolbox())},[u(c,{name:"shopping"})],2)]),_:1})]),_:1})]),n("div",qt,[u(i,{content:"\u8FD4\u56DE","open-delay":500},{default:b(()=>[u(c,{name:"laptop",type:"button",onClick:e.handleBack},null,8,["onClick"])]),_:1}),Gt,Zt,de(n("input",{class:"header-input",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",maxlength:"50",type:"text","onUpdate:modelValue":t[4]||(t[4]=v=>e.pageInfo.name=v)},null,512),[[$e,e.pageInfo.name]])]),n("div",Qt,[u(s,{size:"mini"},{default:b(()=>[u(i,{content:"\u5BFC\u5165json (\u4F1A\u8986\u76D6\u6240\u6709\u5185\u5BB9\uFF01)","open-delay":500},{default:b(()=>[u(r,{action:"/","show-upload-list":!1,"before-upload":e.handleUpload},{default:b(()=>[n("div",eo,[u(c,{name:"Import"})])]),_:1},8,["before-upload"])]),_:1}),u(i,{content:"\u4FDD\u5B58\u6A21\u677F","open-delay":500},{default:b(()=>[n("div",{class:"head-btn",onClick:t[5]||(t[5]=v=>e.tempVisible=!0)},[u(c,{name:"Storedprocedure"})])]),_:1}),u(i,{content:"\u4FDD\u5B58","open-delay":500},{default:b(()=>[n("div",{class:"head-btn",onClick:t[6]||(t[6]=(...v)=>e.handleSaveScreen&&e.handleSaveScreen(...v))},[u(c,{name:"save"})])]),_:1}),u(i,{content:"\u53D1\u5E03","open-delay":500},{default:b(()=>[n("div",{class:"head-btn",onClick:t[7]||(t[7]=(...v)=>e.handlePublish&&e.handlePublish(...v))},[u(c,{name:"send"})])]),_:1}),u(i,{content:"\u9884\u89C8","open-delay":500},{default:b(()=>[n("div",{class:"head-btn",onClick:t[8]||(t[8]=(...v)=>e.handPreview&&e.handPreview(...v))},[u(c,{name:"View"})])]),_:1})]),_:1})])]),u(f),u(_,{modelValue:e.saveVisible,"onUpdate:modelValue":t[9]||(t[9]=v=>e.saveVisible=v),status:e.saveStatus},null,8,["modelValue","status"]),u(m,{modelValue:e.tempVisible,"onUpdate:modelValue":t[10]||(t[10]=v=>e.tempVisible=v)},null,8,["modelValue"])],64)}var oo=Y(Kt,[["render",to]]);const me=Ve({x:0,y:0});function Le(o={}){const{schemaStore:t,storeToRefs:a}=z(),{contextMenu:e,selectedCom:d}=a(t),l=k(()=>{var f;return(f=d.value)==null?void 0:f.locked}),c=k(()=>{var f;return(f=d.value)==null?void 0:f.hided}),i=k(()=>({display:e.value.show?"block":"none",left:`${me.x+10}px`,top:`${me.y+10}px`,transform:document.documentElement.clientHeight-me.y<250?"translate(0px, -100%)":""})),s=f=>{f.preventDefault(),d.value&&(me.x=f.clientX,me.y=f.clientY,e.value.show=!0,q(document,"click",r))},r=()=>{G(document,"click",r),o&&o.beforeClose&&o.beforeClose(),e.value.show=!1};return{showMenu:s,isLocked:l,isHided:c,contextMenu:e,contextMenuStyle:i}}const no={name:"layer-panel",setup(){const{schemaStore:o,storeToRefs:t}=z(),{comps:a,toolbar:e,hoveredComId:d,selectedCom:l,renamingComId:c,multiSelect:i,multipleComs:s}=t(o),{showMenu:r}=Le(),f=k(()=>!!l.value),_=k(()=>({opacity:l.value?1:.3})),m=k(()=>{var N;return{enable:!!l.value,checked:(N=l.value)==null?void 0:N.locked}}),v=k(()=>{var N;return{enable:!!l.value,checked:(N=l.value)==null?void 0:N.hided}});function p(N){return i.value?s.value.map($=>$.id).includes(N.id):!we(l.value)&&l.value.id===N.id}const y=k(()=>[...a.value].reverse()),g=N=>{l.value&&o.moveCom({id:l.value.id,moveType:N})};return{schemaStore:o,comps:a,toolbar:e,enableBtnClass:f,enableBtnStyle:_,moveUp:()=>g(se.up),moveDown:()=>g(se.down),moveTop:()=>g(se.top),moveBottom:()=>g(se.bottom),descComs:y,enableLockBtnClass:m,enableHideBtnClass:v,onEnter:N=>o.hoverCom(N),onLeave:()=>o.hoverCom(""),selectCom:N=>{const $=a.value.find(E=>E.id===N);$&&o.selectCom($)},hoveredComId:d,selectedCom:l,renamingComId:c,showMenu:r,cancelSelectCom:()=>o.selectCom(),isSelected:p}}},ao={class:"layer-panel"},lo={class:"layer-top"},so=n("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),io=n("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),co=[io],ro={class:"layer-toolbar layer-toolbar-top"},uo={class:"layer-manager-wrap"},mo=["title","onMousedown","onMouseenter","onDblclick"],vo=["onUpdate:modelValue"],fo={key:1,class:"layer-item-span"},po={class:"layer-item-text"},_o=["title","onClick"],ho=["title","onClick"];function go(o,t,a,e,d,l){const c=C("b-icon"),i=Ye("focus");return h(),w("div",{class:L(["layer-panel-wp",{"is-hide":!e.toolbar.layer}])},[n("div",ao,[n("div",lo,[so,n("div",{class:"layer-action",onClick:t[0]||(t[0]=s=>e.schemaStore.toggleLayerPanel(!1))},co)]),n("div",ro,[n("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:L(["b-iconfont b-icon-arrowup toolbar-icon standard",e.enableBtnClass]),style:A(e.enableBtnStyle),onClick:t[1]||(t[1]=(...s)=>e.moveUp&&e.moveUp(...s))},null,6),n("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:L(["b-iconfont b-icon-arrowdown toolbar-icon standard",e.enableBtnClass]),style:A(e.enableBtnStyle),onClick:t[2]||(t[2]=(...s)=>e.moveDown&&e.moveDown(...s))},null,6),n("i",{title:"\u7F6E\u9876",class:L(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:A({transform:"rotate(180deg)",...e.enableBtnStyle}),onClick:t[3]||(t[3]=(...s)=>e.moveTop&&e.moveTop(...s))},null,6),n("i",{title:"\u7F6E\u5E95",class:L(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:A(e.enableBtnStyle),onClick:t[4]||(t[4]=(...s)=>e.moveBottom&&e.moveBottom(...s))},null,6)]),n("div",uo,[(h(!0),w(H,null,te(e.descComs,s=>(h(),w("div",{key:s.id,title:s.alias,class:L(["layer-manager-item",[{hided:s.hided,locked:s.locked,hovered:s.id===e.hoveredComId,selected:e.isSelected(s)}]]),onMousedown:r=>e.selectCom(s.id),onMouseenter:r=>e.onEnter(s.id),onMouseleave:t[7]||(t[7]=(...r)=>e.onLeave&&e.onLeave(...r)),onDblclick:r=>e.schemaStore.renamingCom(s.id),onContextmenu:t[8]||(t[8]=r=>e.showMenu(r))},[u(c,{name:s.icon,size:"18"},null,8,["name"]),s.id===e.renamingComId?de((h(),w("input",{key:0,"onUpdate:modelValue":r=>s.alias=r,class:"layer-item-input",onBlur:t[5]||(t[5]=r=>e.schemaStore.renamingCom("")),onKeydown:t[6]||(t[6]=Pe(r=>e.schemaStore.renamingCom(""),["enter"]))},null,40,vo)),[[$e,s.alias,void 0,{trim:!0}],[i]]):(h(),w("span",fo,[n("span",po,Z(s.alias),1)])),n("i",{class:L(["b-iconfont",`b-icon-${s.hided?"eye-close":"eye"}`,"show-toggle-btn"]),title:s.hided?"\u663E\u793A":"\u9690\u85CF",onClick:r=>s.hided=!s.hided},null,10,_o),n("i",{class:L(["b-iconfont",`b-icon-${s.locked?"lock":"unlock"}`,"show-toggle-btn"]),title:s.locked?"\u89E3\u9501":"\u9501\u5B9A",onClick:r=>s.locked=!s.locked},null,10,ho)],42,mo))),128)),n("div",{class:"last-flex-item",onClick:t[9]||(t[9]=(...s)=>e.cancelSelectCom&&e.cancelSelectCom(...s))})])])],2)}var bo=Y(no,[["render",go]]);const yo={name:"VBasicBar",alias:"\u57FA\u672C\u67F1\u56FE",img:U("basic-bar.svg"),type:"bar",used:!0},xo={name:"VHorizontalBar",alias:"\u57FA\u672C\u6761\u5F62\u56FE",img:U("hori-basic-bar.svg"),type:"bar",used:!0},Co={name:"VCapsuleBar",alias:"\u80F6\u56CA\u67F1\u56FE",img:U("capsule-bar.svg"),type:"bar",used:!0},wo={name:"VBasicLine",alias:"\u57FA\u672C\u6298\u7EBF\u56FE",img:U("basic-line.svg"),type:"line",used:!0},So={name:"VBasicArea",alias:"\u57FA\u672C\u533A\u57DF\u56FE",img:U("basic-area.svg"),type:"line",used:!0},ko={name:"VBasicPie",alias:"\u57FA\u672C\u997C\u56FE",img:U("basic-pie.svg"),type:"pie",used:!0},Vo={name:"VBasicRing",alias:"\u57FA\u672C\u73AF\u56FE",img:U("basic-ring.svg"),type:"pie",used:!0},$o={name:"VBasicRadar",alias:"\u57FA\u672C\u96F7\u8FBE\u56FE",img:U("basic-radar.svg"),type:"radar",used:!0},Mo={name:"VBasicMap",alias:"\u57FA\u672C\u5730\u56FE",img:U("2d-china.svg"),type:"map",used:!0},Do={name:"VBasicMapEvo",alias:"\u7701\u4EFD\u5730\u56FE",img:U("basic-map-evo.svg"),type:"map",used:!0},To={name:"VBasicScatter",alias:"\u57FA\u672C\u6563\u70B9\u56FE",img:U("basic-scatter.svg"),type:"scatter",used:!0},Bo={name:"VLineBasicScatter",alias:"\u6563\u70B9\u7EBF\u56FE",img:U("line-basic-scatter.svg"),type:"scatter",used:!0},Lo={name:"VBasicBoxplot",alias:"\u76D2\u987B\u56FE",img:U("basic-boxplot.svg"),type:"boxplot",used:!0},Ro={name:"VBasicFunnel",alias:"\u57FA\u672C\u68AF\u5EA6\u56FE",img:U("basic-funnel.svg"),type:"funnel",used:!0},No={name:"VBasicWordCloud",alias:"\u57FA\u672C\u8BCD\u4E91\u56FE",img:U("basic-wordcloud.svg"),type:"wordcloud",used:!0},Io={name:"VBasicGauge",alias:"\u57FA\u672C\u4EEA\u8868\u76D8",img:U("basic-gauge.svg"),type:"gauge",used:!0},zo={name:"VProgressCircle",alias:"\u8FDB\u5EA6\u73AF",img:U("pie-one-value.svg"),type:"circle",used:!0},Uo={name:"VMainTitle",alias:"\u901A\u7528\u6807\u9898",img:U("main-title.svg"),type:"info",used:!0},Eo={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:U("number-title-flop.svg"),type:"info",used:!0},Ao={name:"VTimer",alias:"\u65F6\u95F4\u5668",img:U("timer.svg"),type:"info",used:!0},Oo={name:"VSelect",alias:"\u4E0B\u62C9\u63A7\u4EF6",img:U("select.svg"),type:"control",used:!0},Ho={name:"VBgBox",alias:"\u80CC\u666F\u5757",img:U("bg-box.svg"),type:"media",used:!0},Po={name:"VBorderBox",alias:"\u8FB9\u6846",img:U("border-box.svg"),type:"media",used:!0},Yo={name:"VDecoration",alias:"\u88C5\u9970\u5668",img:U("decoration.svg"),type:"media",used:!0},jo={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:U("img.svg"),type:"media",used:!0},Xo={name:"VScrollTable",alias:"\u57FA\u7840\u8868\u683C",img:U("scroll-table.svg"),type:"table",used:!0},ye=[{type:"bar",name:"\u67F1\u56FE",icon:"barchart",data:[yo,xo,Co]},{type:"line",name:"\u7EBF\u56FE",icon:"linechart",data:[wo,So]},{type:"pie",name:"\u997C\u56FE",icon:"piechart",data:[ko,Vo]},{type:"radar",name:"\u96F7\u8FBE\u56FE",icon:"radarchart",data:[$o]},{type:"scatter",name:"\u6563\u70B9\u56FE",icon:"pointmap",data:[To,Bo]},{type:"map",name:"\u5730\u56FE",icon:"location",data:[Mo,Do]},{type:"other",name:"\u5176\u4ED6\u56FE\u8868",icon:"ungroup",data:[Lo,Ro,No,Io,zo]},{type:"table",name:"\u8868\u683C",icon:"table",data:[Xo]},{type:"info",name:"\u4FE1\u606F",icon:"info-circle",data:[Uo,Eo,Ao,Oo]},{type:"media",name:"\u5A92\u4F53",icon:"Youtube",data:[Ho,Po,Yo,jo]}];function Wo(o){for(let t=0;t<ye.length;t++){const a=ye[t];for(let e=0;e<a.data.length;e++){const d=a.data[e];if(d.name===o)return{classification:a,com:d}}}return null}const Ko={name:"components-panel",setup(){const{schemaStore:o,storeToRefs:t}=z(),{pageConfig:a,toolbar:e,selectedCom:d}=t(o),l=T(0),c=k(()=>ye[l.value].data);return{toolbar:e,activeIndex:l,componentsList:ye,comps:c,changeComp:m=>{o.toggleCompsPanel(!0),l.value=m},dragStart:(m,v)=>{m.dataTransfer.setData("text",v)},toAddCom:async(m,v)=>{if(v){const p=Ke(m);if(p.attr.x=Math.floor((a.value.width-p.attr.w)/2),p.attr.y=Math.floor((a.value.height-p.attr.h)/2),o.addCom({component:p}),o.selectCom(p),p.apiData&&p.apiData.type===Me.static&&p.apiData.staticPath){const{data:y}=await Je(p.id,p.apiData.staticPath);d.value.apiData.config.data=JSON.stringify(y)}}else console.log("\u6B63\u5728\u5F00\u53D1\u4E2D\u3002\u3002\u3002")},dragOver:m=>{m.preventDefault(),m.stopPropagation(),m.dataTransfer.dropEffect="none"},closePanel:()=>{e.value.components&&o.toggleCompsPanel(!1)}}}},Fo={class:"components-panel-wp"},Jo={class:"components-panel"},qo=n("div",{class:"panel-title"},[n("span",{class:"panel-text"},"\u7EC4\u4EF6")],-1),Go={class:"components-type"},Zo=["onClick"],Qo={class:"com-tab-title"},en={class:"p10"},tn=["title","draggable","onDragstart","onClick"],on={class:"comp-item-text"};function nn(o,t,a,e,d,l){const c=C("b-icon"),i=C("b-scrollbar"),s=Ye("click-outside");return h(),w("div",Fo,[n("div",Jo,[qo,n("div",{class:"components-panel-content",onDragover:t[0]||(t[0]=(...r)=>e.dragOver&&e.dragOver(...r))},[n("div",Go,[u(i,{native:""},{default:b(()=>[(h(!0),w(H,null,te(e.componentsList,(r,f)=>(h(),w("div",{class:L(["components-item",{active:e.activeIndex===f}]),key:f,onClick:_=>e.changeComp(f)},[u(c,{class:"com-tab-icon",name:r.icon},null,8,["name"]),n("span",Qo,Z(r.name),1)],10,Zo))),128))]),_:1})]),de((h(),w("div",{class:L(["components-list",{"is-hide":!e.toolbar.components}])},[u(i,{native:""},{default:b(()=>[n("div",en,[(h(!0),w(H,null,te(e.comps,(r,f)=>(h(),w("div",{class:"comp-item",key:f,title:r.alias,draggable:r.used,onDragstart:_=>e.dragStart(_,r.name),onClick:_=>e.toAddCom(r.name,r.used)},[n("div",on,Z(r.alias),1),n("div",{class:"comp-item-img",style:A(`background-image: url(${r.img});`)},null,4)],40,tn))),128))])]),_:1})],2)),[[s,e.closePanel]])],32)])])}var an=Y(Ko,[["render",nn]]);const ze=o=>`${o}px`,Ue=(o,t,a,e)=>{const d=o!=null?o:document.createElement("canvas");d.width=t*e,d.height=a*e,d.style.width=ze(t),d.style.height=ze(a);const l=d.getContext("2d");return l&&l.setTransform(e,0,0,e,0,0),d};class Ee{constructor(t,a){this.el=t,this.options={direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2,...a},this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:a}=this,{direction:e,width:d,height:l,ratio:c}=a,i=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,d),s=l;this.ruler.width=i,this.ruler.height=s;const r=Ue(null,i,s,c);vt(r,"canvas-ruler"),t.appendChild(r),this.canvas=r,this.ctx=r.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:a,ruler:e}=this,{width:d,height:l}=e;t.beginPath(),t.fillStyle=a.bgColor,t.fillRect(0,0,d,l),t.closePath(),t.beginPath(),t.font=`${a.fontSize} ${a.fontFamily}`,t.textAlign="left",t.fillStyle=a.fontColor,t.strokeStyle=a.strokeStyle,t.lineWidth=a.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:a,ruler:e}=this,{width:d,height:l}=e,{offset:c,scale:i}=a,s=0,r=l/1.5,f=l/1.2;for(let _=0;_<=d;_+=1){const m=_-c;if(m<0)continue;let v=-1,p=-1;m%50===0?(v=Math.floor(m/i),p=s):m%25===0?p=r:m%5===0&&(p=f),p>=0&&(t.moveTo(_+.5,l+.5),t.lineTo(_+.5,p),v>-1&&t.fillText(`${v}`,_+2.5,l/1.5))}}setSize(t,a,e){const{el:d,options:l}=this;l.width=t,l.height=a,l.scale=e;const{direction:c,width:i,height:s,ratio:r}=l,f=Math.max(c==="TB"?d.offsetWidth:d.offsetHeight,i),_=s;this.ruler.width=f,this.ruler.height=_,Ue(this.canvas,f,_,r),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const ln={name:"ruler",setup(){const{schemaStore:o,storeToRefs:t}=z(),{canvas:a}=t(o),e=T(null),d=T(null),l=T(null),c=T(null),i=T(!0),s=T(0),r=T(0),f=document.documentElement.clientWidth;nt(()=>{if(e.value&&d.value){const m=Math.max(a.value.width,f);l.value?l.value.setSize(m,18,a.value.scale):l.value=new Ee(e.value,{direction:"TB",width:m,scale:a.value.scale}),c.value?c.value.setSize(a.value.height,18,a.value.scale):c.value=new Ee(d.value,{direction:"LR",width:a.value.height,scale:a.value.scale})}});const _=m=>{const v=m.target;s.value=v.scrollLeft,r.value=v.scrollTop};return fe(()=>{const m=document.getElementById("canvas-wp");m==null||m.addEventListener("scroll",_)}),at(()=>{const m=document.getElementById("canvas-wp");m==null||m.removeEventListener("scroll",_)}),{visible:i,hRulerWpRef:e,vRulerWpRef:d,vScroll:r,hScroll:s}}},sn=o=>(pe("data-v-5f454e16"),o=o(),_e(),o),cn={class:"canvas-ruler-wp"},rn=sn(()=>n("div",{class:"ruler-corner"},null,-1));function dn(o,t,a,e,d,l){return h(),w("div",cn,[n("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:A(`transform: translateX(-${e.hScroll}px);`)},null,4),n("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:A(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),rn])}var un=Y(ln,[["render",dn],["__scopeId","data-v-5f454e16"]]);function Ae(o){if(o={...o},o.rotate!==0){const t=o.width*Ne(o.rotate)+o.height*Ie(o.rotate),a=(o.width-t)/2;o.left+=a,o.right=o.left+t;const e=o.height*Ne(o.rotate)+o.width*Ie(o.rotate),d=(e-o.height)/2;o.top-=d,o.bottom=o.top+e,o.width=t,o.height=e}else o.bottom=o.top+o.height,o.right=o.left+o.width;return o}const mn=5,vn={name:"mark-line",setup(){const{schemaStore:o,storeToRefs:t}=z(),{comps:a,selectedCom:e,canvas:d,toolbox:l}=t(o),c=T([]),i=T(["xt","xc","xb","yl","yc","yr"]),s=T({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),r=()=>{Object.keys(s.value).forEach(g=>{s.value[g]=!1})};function f({key:g,value:V}){const S={left:"x",top:"y"};o.setShapeSingleStyle({key:S[g],value:V})}const _=(g,V)=>{const S=c.value,D=e.value,ee=a.value.filter(N=>!N.hided),K=d.value.scale,O=Ae(p(D.attr)),F=O.width/2,oe=O.height/2;r(),ee.forEach(N=>{if(N.id===D.id||N.locked||N.hided)return;const{top:$,left:E,bottom:M,right:j,width:J,height:ne}=Ae(p(N.attr)),I=J/2,W=ne/2,he={top:[{isNearly:y(O.top,$),lineNode:S.xt,line:"xt",dragShift:$,lineShift:$},{isNearly:y(O.bottom,$),lineNode:S.xt,line:"xt",dragShift:$-O.height,lineShift:$},{isNearly:y(O.top+oe,$+W),lineNode:S.xc,line:"xc",dragShift:$+W-oe,lineShift:$+W},{isNearly:y(O.top,M),lineNode:S.xb,line:"xb",dragShift:M,lineShift:M},{isNearly:y(O.bottom,M),lineNode:S.xb,line:"xb",dragShift:M-O.height,lineShift:M}],left:[{isNearly:y(O.left,E),lineNode:S.yl,line:"yl",dragShift:E,lineShift:E},{isNearly:y(O.right,E),lineNode:S.yl,line:"yl",dragShift:E-O.width,lineShift:E},{isNearly:y(O.left+F,E+I),lineNode:S.yc,line:"yc",dragShift:E+I-F,lineShift:E+I},{isNearly:y(O.left,j),lineNode:S.yr,line:"yr",dragShift:j,lineShift:j},{isNearly:y(O.right,j),lineNode:S.yr,line:"yr",dragShift:j-O.width,lineShift:j}]},ue=[],{rotate:ke}=O;Object.keys(he).forEach(ie=>{he[ie].forEach(ae=>{if(!ae.isNearly)return;const ge=ke!==0?m(ie,ae,O):ae.dragShift;f({key:ie,value:ge}),ae.lineNode.style[ie]=`${ae.lineShift*K+60}px`,ue.push(ae.line)})}),ue.length&&v(ue,g,V)})},m=(g,V,S)=>{const{w:D,h:ee}=e.value.attr;return Math.round(g==="top"?V.dragShift-(ee-S.height)/2:V.dragShift-(D-S.width)/2)},v=(g,V,S)=>{S?g.includes("yr")?s.value.yr=!0:g.includes("yc")?s.value.yc=!0:g.includes("yl")&&(s.value.yl=!0):g.includes("yl")?s.value.yl=!0:g.includes("yc")?s.value.yc=!0:g.includes("yr")&&(s.value.yr=!0),V?g.includes("xb")?s.value.xb=!0:g.includes("xc")?s.value.xc=!0:g.includes("xt")&&(s.value.xt=!0):g.includes("xt")?s.value.xt=!0:g.includes("xc")?s.value.xc=!0:g.includes("xb")&&(s.value.xb=!0)},p=g=>({left:g.x,top:g.y,width:g.w,height:g.h,rotate:g.rotate}),y=(g,V)=>Math.abs(g-V)<=mn;return fe(()=>{ce.on("move",({isDownward:g,isRightward:V})=>{l.value.markLine&&_(g,V)}),ce.on("unmove",()=>{r()})}),Ce(()=>{ce.off("move"),ce.off("unmove")}),{lineRefs:c,lines:i,lineStatus:s}}},fn={class:"mark-line"};function pn(o,t,a,e,d,l){return h(),w("div",fn,[(h(!0),w(H,null,te(e.lines,c=>de((h(),w("div",{key:c,class:L(["line",[c.includes("x")?"xline":"yline",c]]),ref_for:!0,ref:i=>{e.lineRefs[c]=i}},null,2)),[[je,e.lineStatus[c]||!1]])),128))])}var _n=Y(vn,[["render",pn],["__scopeId","data-v-00d4450a"]]);const{schemaStore:qe}=z(),hn=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],Oe=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],gn=o=>{const t=(o+360)%360,a={};let e=-1;return hn.forEach(d=>{const l=(d.angle+t)%360,c=Oe.length,i=0;for(;i<c;){e=(e+1)%c;const s=Oe[e];if(l<23||l>=338){a[d.direction]="nwse-resize";break}if(s.start<=l&&l<s.end){a[d.direction]=s.cursor;break}}}),a};function bn(o,t,a,e,d,l){o==="t"?(l.h=Math.round(t.h+(a.y-e.y)/d),l.y=Math.round(t.y+(e.y-a.y)/d),l.h=Math.max(l.h,20)):o==="rt"?(l.h=Math.round(t.h+(a.y-e.y)/d),l.w=Math.round(t.w+(e.x-a.x)/d),l.y=Math.round(t.y+(e.y-a.y)/d),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):o==="r"?(l.w=Math.round(t.w+(e.x-a.x)/d),l.w=Math.max(l.w,20)):o==="rb"?(l.h=Math.round(t.h+(e.y-a.y)/d),l.w=Math.round(t.w+(e.x-a.x)/d),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):o==="b"?(l.h=Math.round(t.h+(e.y-a.y)/d),l.h=Math.max(l.h,20)):o==="lb"?(l.h=Math.round(t.h+(e.y-a.y)/d),l.w=Math.round(t.w+(a.x-e.x)/d),l.x=Math.round(t.x+(e.x-a.x)/d),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):o==="l"?(l.w=Math.round(t.w+(a.x-e.x)/d),l.x=Math.round(t.x+(e.x-a.x)/d),l.w=Math.max(l.w,20)):o==="lt"&&(l.h=Math.round(t.h+(a.y-e.y)/d),l.w=Math.round(t.w+(a.x-e.x)/d),l.x=Math.round(t.x+(e.x-a.x)/d),l.y=Math.round(t.y+(e.y-a.y)/d),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20))}const Ge=(o,t,a,e,d)=>{const l={...a.attr},c=Object.create(null),i=o.clientX,s=o.clientY;let r=!1;const f=m=>{r=!0;const v=m.clientX,p=m.clientY;t?bn(t,l,{x:i,y:s},{x:v,y:p},e,c):(c.x=l.x+Math.round((v-i)/e/d)*d,c.y=l.y+Math.round((p-s)/e/d)*d),a.attr={...a.attr,...c},ve().then(()=>{ce.emit("move",{isDownward:p-s>0,isRightward:v-i>0})})},_=()=>{ce.emit("unmove"),r&&qe.recordSnapshot(),G(document,"mousemove",f),G(document,"mouseup",_)};q(document,"mousemove",f),q(document,"mouseup",_)},yn=(o,t,a,e)=>{Ge(o,null,t,a,e)},xn=(o,t,a,e)=>{Ge(o,t,a,e)},Cn=(o,t,a)=>{const e=t.getBoundingClientRect(),d=e.left+e.width/2,l=e.top+e.height/2,c=Math.atan2(l-o.clientY,d-o.clientX)*180/Math.PI-a.attr.rotate;let i=!1;const s=f=>{i=!0;const _=Math.atan2(l-f.clientY,d-f.clientX)*180/Math.PI-c,m=Math.round(_%360);a.attr.rotate=m<0?m+360:m},r=()=>{i&&qe.recordSnapshot(),G(document,"mousemove",s),G(document,"mouseup",r)};q(document,"mousemove",s),q(document,"mouseup",r)},wn={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(o){const t=k(()=>({height:`${o.attr.y+60/o.scale}px`,borderLeftWidth:`${.9/o.scale}px`})),a=k(()=>({width:`${o.attr.x+60/o.scale}px`,borderTopWidth:`${.9/o.scale}px`})),e=k(()=>({fontSize:`${12/o.scale}px`,top:`-${6/o.scale}px`,left:`-${6/o.scale}px`}));return{topLineStyle:t,leftLineStyle:a,accountStyle:e}}},Sn={class:"nav-line"};function kn(o,t,a,e,d,l){return h(),w("div",Sn,[n("div",{class:"nav-line-top",style:A(e.topLineStyle)},null,4),n("div",{class:"nav-line-left",style:A(e.leftLineStyle)},null,4),n("div",{class:"nav-line-account",style:A(e.accountStyle)},Z(a.attr.x)+", "+Z(a.attr.y),5)])}var Vn=Y(wn,[["render",kn]]);const $n={name:"dv-transform",components:{ReferLine:Vn},props:{data:{type:Object,required:!0}},setup(o){const t=lt(),{showMenu:a}=Le(),{schemaStore:e,storeToRefs:d}=z(),{canvas:l,comps:c,pageConfig:i,selectedCom:s,hoveredComId:r,toolbox:f,spaceDown:_,multiSelect:m,multipleComs:v}=d(e),p=k(()=>r.value===o.data.id),y=k(()=>m.value?!1:!we(s.value)&&s.value.id===o.data.id),g=k(()=>m.value?v.value.map(I=>I.id).includes(o.data.id):!1),V=k(()=>({locked:o.data.locked,selected:y.value})),S=k(()=>({top:0,left:0,width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`,transform:`translate(${o.data.attr.x}px, ${o.data.attr.y}px)`})),D=k(()=>({"is-hide":!y.value||o.data.locked})),ee=k(()=>({cursor:"move",transform:`rotate(${o.data.attr.rotate}deg)`})),K=k(()=>({width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`})),O=k(()=>({display:o.data.hided?"none":"block"})),F=k(()=>gn(o.data.attr.rotate)),oe=k(()=>l.value.scale),N=k(()=>{const I=`scale(${1/oe.value}, ${1/oe.value})`;return{t:{name:"top",style:{cursor:F.value.t,transform:I}},rt:{name:"top-right",style:{cursor:F.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:I}},r:{name:"right",style:{cursor:F.value.r,transform:I}},rb:{name:"bottom-right",style:{cursor:F.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:I}},b:{name:"bottom",style:{cursor:F.value.b,transform:I}},lb:{name:"bottom-left",style:{cursor:F.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:I}},l:{name:"left",style:{cursor:F.value.l,transform:I}},lt:{name:"top-left",style:{cursor:F.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:I}}}}),$=()=>e.hoverCom(o.data.id),E=()=>e.hoverCom(""),M=()=>{e.selectCom(o.data)};return{comps:c,selectedCom:s,hoveredComId:r,toolbox:f,isHovered:p,isSelected:y,isMultiSelted:g,hideStyle:O,transformClass:V,transformStyle:S,handlerClass:D,handlerStyle:ee,wrapperStyle:K,onEnter:$,onLeave:E,onMove:I=>{_.value||(I.stopPropagation(),I.preventDefault(),M(),!o.data.locked&&yn(I,o.data,oe.value,i.value.grid))},onZoom:(I,W)=>{M(),xn(I,W,o.data,oe.value)},onRotate:I=>{Cn(I,t.vnode.el,o.data)},points:N,scale:oe,showMenu:a}}},Mn={class:"dv-com"},Dn=["onMousedown"],Tn=["onMousedown"],Bn=n("div",{class:"transform-bg"},null,-1),Ln={key:1,class:"b-iconfont b-icon-lock",title:"\u89E3\u9501"};function Rn(o,t,a,e,d,l){const c=C("refer-line");return h(),w("div",{class:L(["dv-transform",e.transformClass]),style:A(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(h(),R(c,{key:0,attr:a.data.attr,scale:e.scale},null,8,["attr","scale"])):X("",!0),n("div",{class:L(["dv-scale",{hovered:e.isHovered}]),style:A(e.hideStyle),onMouseenter:t[2]||(t[2]=(...i)=>e.onEnter&&e.onEnter(...i)),onMouseleave:t[3]||(t[3]=(...i)=>e.onLeave&&e.onLeave(...i)),onMousedown:t[4]||(t[4]=(...i)=>e.onMove&&e.onMove(...i))},[n("div",{class:L(["transform-handler",e.handlerClass]),style:A(e.handlerStyle)},[n("div",Mn,[Xe(o.$slots,"default"),n("div",{class:"dv-event-disable",style:A(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...i)=>e.showMenu&&e.showMenu(...i))},null,36)]),(h(!0),w(H,null,te(e.points,(i,s)=>(h(),w(H,{key:s},[i.rotateStyle?(h(),w("i",{key:0,class:L(`${i.name}-handler`),"data-html2canvas-ignore":""},[n("span",{class:"rotate-handler",style:A(i.rotateStyle),onMousedown:t[1]||(t[1]=le((...r)=>e.onRotate&&e.onRotate(...r),["prevent","stop"]))},[n("span",{class:"control-point",style:A(i.style),onMousedown:le(r=>e.onZoom(r,s),["prevent","stop"])},null,44,Dn)],36)],2)):(h(),w("i",{key:1,class:L(`${i.name}-handler`),"data-html2canvas-ignore":""},[n("span",{class:"control-point",style:A(i.style),onMousedown:le(r=>e.onZoom(r,s),["prevent","stop"])},null,44,Tn)],2))],64))),128)),Bn],6)],38),a.data.locked?(h(),w("i",Ln)):X("",!0)],6)}var Nn=Y($n,[["render",Rn]]);const In=["onClick"],zn=["onClick"],Un={__name:"index",setup(o){const{schemaStore:t}=z(),a=k(()=>t.toolbar.config?{right:"332px"}:{right:0}),e=()=>t.undo(),d=()=>t.redo();return(l,c)=>(h(),w("div",{class:"action-bar-wrap",style:A(x(a))},[n("i",{class:"action-btn b-iconfont b-icon-aim",title:"\u6700\u4F73\u753B\u5E03\u6BD4\u4F8B",onClick:c[0]||(c[0]=le(i=>x(t).autoCanvasScale(),["stop"]))}),n("i",{class:"action-btn b-iconfont b-icon-icon-test",title:"1:1\u753B\u5E03\u5927\u5C0F",onClick:c[1]||(c[1]=le(i=>x(t).setCanvasScale(100),["stop"]))}),n("i",{class:"action-btn b-iconfont b-icon-rollback",title:"\u64A4\u9500",onClick:le(e,["stop"])},null,8,In),n("i",{class:"action-btn b-iconfont b-icon-rollback",title:"\u91CD\u505A",onClick:le(d,["stop"]),style:{transform:"rotateY(180deg)"}},null,8,zn)],4))}};var En=Y(Un,[["__scopeId","data-v-1c712a36"]]);const An={__name:"index",props:{x:Number,y:Number,width:Number,height:Number,showArea:Boolean},setup(o){return(t,a)=>de((h(),w("div",{style:A({left:o.x+"px",top:o.y+"px",width:o.width+"px",height:o.height+"px"}),class:"area"},null,4)),[[je,o.showArea]])}};var On=Y(An,[["__scopeId","data-v-0a9d9fbb"]]);const Hn={class:"canvas-main"},Pn=["onMousedown"],Yn={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=z(),{pageConfig:e,spaceDown:d,canvas:l,selectedCom:c,comps:i,toolbox:s,getPanelOffsetLeft:r,getPanelOffsetTop:f,editorEL:_,areaData:m}=a(t),v=T(null),p=Ve({drag:!1,startX:0,startY:0});let y=0,g=0;const V=k(()=>({width:`${l.value.width}px`,height:`${l.value.height}px`})),S=k(()=>({position:"absolute",width:`${e.value.width}px`,height:`${e.value.height}px`,transform:`scale(${l.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${e.value.bgImage})`,backgroundColor:e.value.bgColor})),D=ft(t.autoCanvasScale,50),ee=async $=>{$.preventDefault();try{const E=$.dataTransfer.getData("text");if(E){const M=Ke(E),{scale:j}=l.value,J=($.clientX-r.value+v.value.scrollLeft)/j,ne=($.clientY-f.value+v.value.scrollTop)/j;if(M.attr.x=Math.round(J-M.attr.w/2),M.attr.y=Math.round(ne-M.attr.h/2),t.addCom({component:M}),t.selectCom(M),M.apiData&&M.apiData.type===Me.static&&M.apiData.staticPath){const{data:I}=await Je(M.id,M.apiData.staticPath);c.value.apiData.config.data=JSON.stringify(I)}}}catch(E){console.warn(E)}},K=$=>{$.preventDefault(),$.stopPropagation(),$.dataTransfer.dropEffect="copy"};function O($){d.value||t.selectCom(),p.drag=!0;const E=$.clientX,M=$.clientY,j=l.value.scale,{scrollLeft:J,scrollTop:ne,clientWidth:I,scrollWidth:W,clientHeight:he,scrollHeight:ue}=v.value,ke=I<W||he<ue,ie={left:J,top:ne},ae=Re=>{if(!d.value||!p.drag||!ke)return;const Qe=Re.clientX,et=Re.clientY,tt=Math.round((Qe-E)/j),ot=Math.round((et-M)/j);v.value.scrollLeft=ie.left-tt,v.value.scrollTop=ie.top-ot},ge=()=>{p.drag=!1,G(document,"mousemove",ae),G(document,"mouseup",ge)};q(document,"mousemove",ae),q(document,"mouseup",ge)}function F($){if(c.value||$.preventDefault(),N(),d.value)return;const E=_.value.getBoundingClientRect();y=E.x,g=E.y;const M=$.clientX,j=$.clientY;m.value.showArea=!0;const J=l.value.scale;m.value.x=(M-y)/J,m.value.y=(j-g)/J;const ne=W=>{m.value.width=Math.abs((W.clientX-M)/J),m.value.height=Math.abs((W.clientY-j)/J),W.clientX<M&&(m.value.x=(W.clientX-y)/J),W.clientY<j&&(m.value.y=(W.clientY-g)/J)},I=W=>{if(G(document,"mousemove",ne),G(document,"mouseup",I),W.clientX===M&&W.clientY===j){N();return}oe()};q(document,"mousemove",ne),q(document,"mouseup",I)}function oe(){const $=pt(m.value,i.value);if($.length===0){N();return}if($.length===1){t.selectCom($[0]),N();return}t.multiSelectComs($)}function N(){m.value.showArea=!1,m.value.width=0,m.value.height=0}return fe(()=>{q(window,"resize",D),ce.on("hideArea",N),t.getEditor(),D()}),Ce(()=>{G(window,"resize",D)}),($,E)=>(h(),w("div",Hn,[n("div",{id:"canvas-wp",ref_key:"canvasWpRef",ref:v,class:"canvas-panel-wrap",onMousedown:le(O,["stop"])},[n("div",{class:"screen-shot",style:A(x(V))},[x(s).markLine?(h(),R(_n,{key:0,style:A(x(V))},null,8,["style"])):X("",!0),u(En),u(un),n("div",{id:"canvas-components",class:"canvas-panel",style:A(x(S)),onDragover:K,onDrop:ee,onMousedown:F},[(h(!0),w(H,null,te(x(i),M=>(h(),R(Nn,{key:M.id,data:M},{default:b(()=>[(h(),R(We(M.name),{data:M,style:A({width:M.attr.w+"px",height:M.attr.h+"px",opacity:M.attr.opacity,transform:"translateZ(0px)"}),id:`component_${M.id}`},null,8,["data","style","id"]))]),_:2},1032,["data"]))),128)),u(On,st(it(x(m))),null,16)],36)],4)],40,Pn)]))}};const jn={name:"page-config",setup(){const{schemaStore:o,storeToRefs:t}=z(),{pageConfig:a}=t(o),e=T(""),d=()=>{a.value.bgColor="#0d2a42",a.value.bgImage=""},l=()=>o.autoCanvasScale(),c=i=>{if(i!=="custom"){const s=i.split("x"),r=+s[0],f=+s[1];o.setScreenSize({width:r,height:f})}};return re([()=>a.value.width,()=>a.value.height],()=>{const{width:i,height:s}=a.value;i===1920&&s===1080||i===2560&&s===1080||i===3440&&s===1080||i===3440&&s===1440||i===414&&s===736||i===375&&s===667||i===375&&s===812?e.value=`${i}x${s}`:e.value="custom"},{immediate:!0}),{screenLabel:e,onSizeChange:l,resetBGImage:d,pageConfig:a,pageMap:[{group:"web\u7AEF",data:_t.map(i=>({value:`${i.width}x${i.height}`,label:i.label}))},{group:"\u79FB\u52A8\u8BBE\u5907",data:ht.map(i=>({value:`${i.width}x${i.height}`,label:i.label}))},{group:"\u5176\u4ED6",data:[{value:"custom",label:"\u81EA\u5B9A\u4E49"}]}],sizeChange:c}}},Xn=o=>(pe("data-v-75712752"),o=o(),_e(),o),Wn={class:"page-config-panel"},Kn=Xn(()=>n("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),Fn={class:"page-config-content"},Jn={class:"page-config-wp"},qn=B("\u6062\u590D\u9ED8\u8BA4\u80CC\u666F"),Gn={class:"page-config-wp"};function Zn(o,t,a,e,d,l){const c=C("g-group-select"),i=C("g-field"),s=C("g-input-number"),r=C("g-color-picker"),f=C("g-upload-img"),_=C("g-images-select"),m=C("b-button");return h(),w("div",Wn,[Kn,n("div",Fn,[n("div",Jn,[u(i,{label:"\u5C4F\u5E55\u8BBE\u7F6E",flat:""},{default:b(()=>[u(c,{modelValue:e.screenLabel,"onUpdate:modelValue":t[0]||(t[0]=v=>e.screenLabel=v),data:e.pageMap,onChange:e.sizeChange},null,8,["modelValue","data","onChange"])]),_:1}),u(i,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:b(()=>[u(s,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[1]||(t[1]=v=>e.pageConfig.width=v),label:"\u5BBD\u5EA6",min:375,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),u(s,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[2]||(t[2]=v=>e.pageConfig.height=v),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),u(i,{label:"\u80CC\u666F\u989C\u8272"},{default:b(()=>[u(r,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[3]||(t[3]=v=>e.pageConfig.bgColor=v)},null,8,["modelValue"])]),_:1}),u(i,{label:"\u80CC\u666F\u56FE",tooltip:"\u652F\u6301\u56FE\u7247\u5730\u5740\u3001\u9759\u6001\u8DEF\u5F84\u3001base64\u5B58\u50A8"},{default:b(()=>[u(f,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[4]||(t[4]=v=>e.pageConfig.bgImage=v)},null,8,["modelValue"])]),_:1}),u(i,{label:"\u80CC\u666F\u9884\u8BBE",tooltip:"\u53EF\u4EE5\u52A0\u8F7D\u5BF9\u5E94\u9884\u8BBE\u7684\u56FE\u7247\u80CC\u666F"},{default:b(()=>[u(_,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[5]||(t[5]=v=>e.pageConfig.bgImage=v),images:["bg"],"value-key":"src"},null,8,["modelValue"])]),_:1}),u(i,{label:"\u91CD\u7F6E"},{default:b(()=>[u(m,{type:"primary",size:"small",onClick:e.resetBGImage},{default:b(()=>[qn]),_:1},8,["onClick"])]),_:1})]),n("div",Gn,[u(i,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:b(()=>[u(s,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[6]||(t[6]=v=>e.pageConfig.grid=v),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})])])])}var Qn=Y(jn,[["render",Zn],["__scopeId","data-v-75712752"]]);const ea={name:"config-title",props:{comName:{type:String},comAlias:{type:String},com:{type:Object,default:()=>({})}},setup(o){const t=T(!1),a=k(()=>{const l=Wo(o.comName);return l?l.com.name:o.comName});return{openDetail:()=>{t.value=!0},comTitle:a,copyCom:()=>{Te(JSON.stringify(o.com)),Q.success("\u5DF2\u590D\u5236\u914D\u7F6E\u9879\u81F3\u526A\u5207\u677F")},detailVisible:t}}},ta=o=>(pe("data-v-3284dfac"),o=o(),_e(),o),oa={class:"com-title-wp"},na={class:"com-title"},aa={class:"title-name"},la={class:"alias-name"},sa={class:"version-tag"},ia=ta(()=>n("span",null,"\u914D\u7F6E\u9879",-1)),ca={class:"data-editor",style:{margin:"0"}},ra={class:"t-right pt-8"},da=B(" \u590D\u5236\u914D\u7F6E\u9879 ");function ua(o,t,a,e,d,l){const c=C("b-icon"),i=C("b-ace-editor"),s=C("b-button"),r=C("b-modal");return h(),w("div",oa,[n("div",na,[n("div",aa,[n("span",la,Z(a.comAlias),1)]),n("div",sa,[n("span",null,Z(e.comTitle),1)])]),Xe(o.$slots,"default",{},()=>[n("div",{class:"search-config",onClick:t[0]||(t[0]=(...f)=>e.openDetail&&e.openDetail(...f)),title:"\u67E5\u770B\u914D\u7F6E\u9879"},[u(c,{name:"filesearch",size:"14"}),ia])],!0),u(r,{modelValue:e.detailVisible,"onUpdate:modelValue":t[1]||(t[1]=f=>e.detailVisible=f),title:`[${a.comAlias}] \u914D\u7F6E\u9879 `,"append-to-body":"","custom-class":"schema-modal"},{default:b(()=>[n("div",ca,[u(i,{"model-value":JSON.stringify(a.com,null,2),readonly:"",theme:"tomorrow_night",wrap:"",styles:{border:"none"},height:"500"},null,8,["model-value"])]),n("div",ra,[u(s,{size:"small",type:"primary",icon:"file-copy",onClick:e.copyCom},{default:b(()=>[da]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"])])}var Se=Y(ea,[["render",ua],["__scopeId","data-v-3284dfac"]]);const ma={name:"data-center-panel",components:{ConfigTitle:Se,SourcePanel:gt(()=>ct(()=>import("./source-panel-861d7efb.js"),["static/js/source-panel-861d7efb.js","static/css/source-panel-9456a5cd.css","static/js/vendor-b7d265ee.js","static/css/vendor-2b79d43b.css","static/js/chunk-brace-b4ee70be.js","static/js/index-624f4eaf.js","static/css/index-ec9740d6.css","static/js/chunk-bin-ui-next-d0a25e35.js","static/css/chunk-bin-ui-next-233b4550.css"]))},setup(){const{schemaStore:o,storeToRefs:t}=z(),{selectedCom:a}=t(o),e=k(()=>Object.keys(a.value.apiData));return{selectedCom:a,dataKeys:e}}},va={class:"data-center-panel"},fa={class:"scroll-container"},pa={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"},_a=B("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E");function ha(o,t,a,e,d,l){const c=C("config-title"),i=C("source-panel"),s=C("b-empty"),r=C("b-scrollbar");return h(),w("div",va,[u(c,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),n("div",fa,[u(r,{native:""},{default:b(()=>[e.dataKeys.length>0?(h(),R(i,{key:0})):(h(),w("div",pa,[u(s,null,{default:b(()=>[_a]),_:1})]))]),_:1})])])}var ga=Y(ma,[["render",ha]]);const ba={class:"basic-setting-wp"},ya={style:{width:"50%"}},xa=B(" \u7EC4\u5408 "),Ca=B(" \u62C6\u5206 "),Ze={__name:"basic-setting",props:{attr:{type:Object,required:!0},readonly:{type:Boolean,default:!1}},emits:["update:attr"],setup(o,{emit:t}){const a=o,e=k({get:()=>a.attr,set:s=>t("update:attr",s)}),{schemaStore:d,storeToRefs:l}=z(),{curComIsGroup:c,multiSelect:i}=l(d);return(s,r)=>{const f=C("g-input-number"),_=C("g-field"),m=C("b-button"),v=C("b-button-group"),p=C("g-slider");return h(),w("div",ba,[u(_,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{default:b(()=>[u(f,{modelValue:x(e).w,"onUpdate:modelValue":r[0]||(r[0]=y=>x(e).w=y),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(f,{modelValue:x(e).h,"onUpdate:modelValue":r[1]||(r[1]=y=>x(e).h=y),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),u(_,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:b(()=>[u(f,{modelValue:x(e).x,"onUpdate:modelValue":r[2]||(r[2]=y=>x(e).x=y),label:"X",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(f,{modelValue:x(e).y,"onUpdate:modelValue":r[3]||(r[3]=y=>x(e).y=y),label:"Y",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),x(i)?X("",!0):(h(),R(_,{key:0,label:"\u65CB\u8F6C\u89D2\u5EA6",flat:""},{default:b(()=>[u(f,{modelValue:x(e).rotate,"onUpdate:modelValue":r[4]||(r[4]=y=>x(e).rotate=y),min:0,max:360,step:1,inline:""},null,8,["modelValue"]),n("div",ya,[u(v,null,{default:b(()=>[(h(!0),w(H,null,te(x(Tt),y=>(h(),R(m,{key:y.value,size:"mini",title:y.label,onClick:g=>x(d).doRotate(y.value)},{default:b(()=>[n("i",{class:L(`b-iconfont b-icon-${y.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})])]),_:1})),x(i)||x(c)?X("",!0):(h(),R(_,{key:1,label:"\u900F\u660E\u5EA6"},{default:b(()=>[u(p,{modelValue:x(e).opacity,"onUpdate:modelValue":r[5]||(r[5]=y=>x(e).opacity=y),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})),x(i)?X("",!0):(h(),R(_,{key:2,label:"\u4F4D\u7F6E"},{default:b(()=>[u(v,null,{default:b(()=>[(h(!0),w(H,null,te(x(Bt),y=>(h(),R(m,{key:y.value,size:"mini",title:y.label,onClick:g=>x(d).doAdsorption(y.value)},{default:b(()=>[n("i",{class:L(`iconfont-align b-icon-${y.value}-vs`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})),x(i)?(h(),R(_,{key:3,label:"\u5BF9\u9F50"},{default:b(()=>[u(v,null,{default:b(()=>[(h(!0),w(H,null,te(x(Lt),y=>(h(),R(m,{key:y.value,size:"mini",title:y.label,onClick:g=>x(d).doAlign(y.value)},{default:b(()=>[n("i",{class:L(`iconfont-align b-icon-${y.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})):X("",!0),x(i)||x(c)?(h(),R(_,{key:4,label:"\u7EC4\u5408\u62C6\u5206"},{default:b(()=>[u(v,null,{default:b(()=>[u(m,{size:"mini",icon:"group",disabled:!x(i),onClick:r[6]||(r[6]=y=>x(d).group())},{default:b(()=>[xa]),_:1},8,["disabled"]),u(m,{size:"mini",icon:"ungroup",disabled:!x(c),onClick:r[7]||(r[7]=y=>x(d).ungroup())},{default:b(()=>[Ca]),_:1},8,["disabled"])]),_:1})]),_:1})):X("",!0)])}}},wa={class:"setting-panel"},Sa={class:"setting-panel-content"},ka={class:"scroll-container"},Va={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=z(),{selectedCom:e}=a(t);return(d,l)=>{const c=C("b-scrollbar");return h(),w("div",wa,[u(Se,{"com-name":x(e).name,"com-alias":x(e).alias,com:x(e)},null,8,["com-name","com-alias","com"]),n("div",Sa,[n("div",ka,[u(c,null,{default:b(()=>[(h(),R(Ze,{key:`${x(e).id}'_basic-setting`,attr:x(e).attr},null,8,["attr"])),(h(),R(We(x(e).name+"Config"),{key:x(e).id,data:x(e)},null,8,["data"]))]),_:1})])])])}}},$a={class:"setting-panel"},Ma=n("span",null,null,-1),Da={class:"setting-panel-content"},Ta={class:"scroll-container"},Ba={__name:"multi-setting",setup(o){const{schemaStore:t,storeToRefs:a}=z(),{areaData:e}=a(t),d=k(()=>e.value.showArea),l=k(()=>({x:e.value.x,y:e.value.y,w:e.value.width,h:e.value.height}));return(c,i)=>{const s=C("b-scrollbar");return h(),w("div",$a,[u(Se,{"com-alias":"\u591A\u9009\u533A\u57DF"},{default:b(()=>[Ma]),_:1}),n("div",Da,[n("div",Ta,[u(s,null,{default:b(()=>[u(Ze,{attr:x(l),readonly:x(d)},null,8,["attr","readonly"])]),_:1})])])])}}},La={style:{margin:"-16px",padding:"10px"}},Ra={__name:"EventParamsModal",props:{modelValue:{type:Boolean,default:!1},params:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:t}){const a=o,e=k({get:()=>a.modelValue,set:l=>t("update:modelValue",l)}),d=[{title:"\u53C2\u6570\u540D",key:"desc"},{title:"\u53C2\u6570Key",key:"name"},{title:"\u53C2\u6570\u7C7B\u578B",key:"type"}];return(l,c)=>{const i=C("b-table"),s=C("b-modal");return h(),R(s,{modelValue:x(e),"onUpdate:modelValue":c[0]||(c[0]=r=>rt(e)?e.value=r:null),title:"\u53C2\u6570\u4FE1\u606F",width:"750px","append-to-body":"","custom-class":"schema-modal"},{default:b(()=>[n("div",La,[u(i,{columns:d,data:o.params,size:"small",border:""},null,8,["data"])])]),_:1},8,["modelValue"])}}},Na={flex:"main:justify cross:center"},Ia=B(" \u67E5\u770B "),za={__name:"trigger-config",props:{eventList:{type:Array,default:()=>bt},events:{type:Object,default:()=>({})}},setup(o){const t=o,a=k(()=>t.events),e=k(()=>{let i=!1;return t.eventList.forEach(s=>{if(!we(a.value[s])){i=!0;return}}),i}),d=T([]),l=T(!1);function c(i){d.value=i,l.value=!0}return(i,s)=>{const r=C("b-checkbox"),f=C("b-button"),_=C("g-field"),m=C("g-field-collapse");return x(e)?(h(),R(m,{key:0,label:"\u89E6\u53D1\u4E8B\u4EF6","default-open":""},{default:b(()=>[(h(!0),w(H,null,te(o.eventList,v=>(h(),w(H,{key:v},[x(a)[v]?(h(),R(_,{key:0,label:x(a)[v].name},{default:b(()=>[n("div",Na,[u(r,{modelValue:x(a)[v].enable,"onUpdate:modelValue":p=>x(a)[v].enable=p},null,8,["modelValue","onUpdate:modelValue"]),u(f,{type:"text",title:"\u67E5\u770B\u4E8B\u4EF6\u53C2\u6570",onClick:p=>c(x(a)[v].params)},{default:b(()=>[Ia]),_:2},1032,["onClick"])])]),_:2},1032,["label"])):X("",!0)],64))),128)),u(Ra,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=v=>l.value=v),params:d.value},null,8,["modelValue","params"])]),_:1})):X("",!0)}}},Ua={class:"series-title",style:{top:"-8px"}},Ea={style:{width:"50%","padding-right":"8px"}},Aa=B(" \u6CE8\u518C\u4E8B\u4EF6 "),Oa={style:{width:"50%","padding-right":"8px"}},Ha={key:0,style:{"min-height":"80px"},flex:"main:center cross:center"},Pa={__name:"response-config",props:{compId:{type:String,default:""},events:{type:Object,default:()=>({})}},setup(o){const t=o,a=k(()=>t.events),e=k(()=>Object.keys(a.value).includes("onEvents")),d=k(()=>yt.value.filter(_=>_.compId!==t.compId).map(_=>({value:_.compId,label:_.compName}))),l=k(()=>{const _=a.value.actions;return Object.keys(_).map(m=>({value:m,label:_[m].title}))});function c(_){return xt.value.filter(m=>m.eventName.includes(_)).map(m=>({value:m.eventName,label:m.title}))}function i(){a.value.onEvents.push({eventSource:"",eventName:"",actionName:"",actionParams:[],register:!1})}function s(_){if(_.eventSource===""){Q.warning("\u8BF7\u9009\u62E9\u4E8B\u4EF6\u6E90\uFF01");return}if(_.eventName===""){Q.warning("\u8BF7\u7ED1\u5B9A\u4E8B\u4EF6\uFF01");return}if(_.actionName===""){Q.warning("\u8BF7\u7ED1\u5B9A\u52A8\u4F5C\uFF01");return}_.register=!0}function r(_,m){m.register?m.register=!1:a.value.onEvents.splice(_,1)}function f(_,m){const v=a.value.actions[_];v&&(m.actionParams=Ct(v.params))}return(_,m)=>{const v=C("b-icon"),p=C("b-button"),y=C("g-select"),g=C("g-field"),V=C("b-ace-editor"),S=C("g-field-collapse");return x(e)?(h(),R(S,{key:0,label:"\u54CD\u5E94\u4E8B\u4EF6","default-open":""},{add:b(()=>[u(p,{type:"text",title:"\u65B0\u589E\u4E00\u4E2A\u54CD\u5E94\u4E8B\u4EF6",onClick:i},{default:b(()=>[u(v,{name:"plus",size:"16"})]),_:1})]),default:b(()=>[(h(!0),w(H,null,te(x(a).onEvents,(D,ee)=>(h(),R(g,{key:ee,label:"\u4E8B\u4EF6","label-width":"85px",flat:""},{label:b(()=>[n("div",Ua,[n("span",null,"\u4E8B\u4EF6"+Z(ee+1),1)])]),default:b(()=>[u(y,{modelValue:D.eventSource,"onUpdate:modelValue":K=>D.eventSource=K,data:x(d),disabled:D.register,inline:"inline-single",label:"\u4E8B\u4EF6\u6E90"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),D.eventSource!==""?(h(),w(H,{key:0},[u(y,{modelValue:D.eventName,"onUpdate:modelValue":K=>D.eventName=K,data:c(D.eventSource),disabled:D.register,inline:"",label:"\u7ED1\u5B9A\u4E8B\u4EF6"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),u(y,{modelValue:D.actionName,"onUpdate:modelValue":K=>D.actionName=K,data:x(l),disabled:D.register,inline:"",label:"\u7ED1\u5B9A\u52A8\u4F5C",onChange:K=>f(D.actionName,D)},null,8,["modelValue","onUpdate:modelValue","data","disabled","onChange"])],64)):X("",!0),n("span",Ea,[u(p,{size:"small",style:{width:"100%"},type:"primary",disabled:D.register,onClick:K=>s(D)},{default:b(()=>[Aa]),_:2},1032,["disabled","onClick"])]),n("span",Oa,[u(p,{size:"small",style:{width:"100%"},onClick:K=>r(ee,D)},{default:b(()=>[B(Z(D.register?"\u53D6\u6D88":"\u5220\u9664"),1)]),_:2},1032,["onClick"])])]),_:2},1024))),128)),x(a).onEvents.length===0?(h(),w("div",Ha," \u6682\u65E0\u54CD\u5E94\u4E8B\u4EF6 ")):X("",!0),u(V,{"model-value":JSON.stringify(x(a),null,2),theme:"tomorrow_night",wrap:"",styles:{border:"none"}},null,8,["model-value"])]),_:1})):X("",!0)}}},Ya={class:"events-panel"},ja={class:"events-panel-content"},Xa=n("div",{class:"data-result-title"},"\u4E8B\u4EF6\u914D\u7F6E",-1),Wa={class:"scroll-container"},Ka={class:"setting-panel-gui"},Fa={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=z(),{selectedCom:e}=a(t),d=k(()=>e.value.events);return(l,c)=>{const i=C("b-scrollbar");return h(),w("div",Ya,[u(Se,{"com-name":x(e).name,"com-alias":x(e).alias,com:x(e)},null,8,["com-name","com-alias","com"]),n("div",ja,[Xa,n("div",Wa,[u(i,null,{default:b(()=>[n("div",Ka,[u(za,{events:x(d)},null,8,["events"]),u(Pa,{events:x(d),"comp-id":x(e).id},null,8,["events","comp-id"])])]),_:1})])])])}}},Ja={class:"config-panel"},qa={key:0,class:"page-config-panel"},Ga={class:"page-config-top"},Za={class:"tabs-wrapper"},Qa={key:0,class:"page-config-content"},el={key:1,class:"page-config-content"},tl={style:{height:"100%"}},ol={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=z(),{toolbar:e,selectedCom:d,multiSelect:l}=a(t),c=T(0),i=s=>{l.value&&s>0||c.value!==s&&(c.value=s)};return re(()=>d.value,()=>{c.value=0}),(s,r)=>{const f=C("b-icon"),_=C("b-tooltip");return h(),w("div",{class:L(["config-panel-wp",{"is-hide":!x(e).config}])},[n("div",Ja,[x(d)||x(l)?(h(),w("div",qa,[n("div",Ga,[n("div",Za,[n("div",{class:L(["tab-item",{active:c.value===0}]),onClick:r[0]||(r[0]=m=>i(0))},[u(_,{content:"\u914D\u7F6E"},{default:b(()=>[u(f,{name:"control",size:"20"})]),_:1})],2),n("div",{class:L(["tab-item",{active:c.value===1}]),onClick:r[1]||(r[1]=m=>i(1))},[u(_,{content:"\u6570\u636E"},{default:b(()=>[u(f,{name:"cloud-server",size:"22"})]),_:1})],2),n("div",{class:L(["tab-item",{active:c.value===2}]),onClick:r[2]||(r[2]=m=>i(2))},[u(_,{content:"\u4E8B\u4EF6"},{default:b(()=>[u(f,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),x(l)?(h(),w("div",Qa,[u(Ba)])):(h(),w("div",el,[n("div",tl,[c.value===0?(h(),R(Va,{key:x(d).id})):X("",!0),c.value===1?(h(),R(ga,{key:x(d).id})):X("",!0),c.value===2?(h(),R(Fa,{key:x(d).id})):X("",!0)])]))])):(h(),R(Qn,{key:1}))])],2)}}};const nl={class:"toolbox-panel",flex:"main:justify"},al={style:{width:"500px"},flex:""},ll=n("i",{class:"action-btn b-iconfont b-icon-rollback"},null,-1),sl=B(" \u64A4\u9500 "),il=n("i",{class:"action-btn b-iconfont b-icon-rollback",style:{transform:"rotateY(180deg)"}},null,-1),cl=B(" \u91CD\u505A "),rl=n("div",null,null,-1),dl={class:"btn-box"},ul=B(" \u53C2\u8003\u7EBF\xA0\xA0 "),ml={class:"btn-box"},vl=B(" \u5BF9\u9F50\u7EBF\xA0\xA0 "),fl={class:"ctrl-box",flex:"cross:center"},pl=B(" \xA0\xA0 "),_l=B("\u7C98\u8D34\u56FE\u8868"),hl=B("\u6E05\u7A7A\u753B\u5E03"),gl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=z(),{toolbar:e,toolbox:d}=a(t),l=T(!1),c=T(null),i=()=>{Fe.confirm({type:"error",title:"\u786E\u8BA4\u6E05\u7A7A\u753B\u5E03\u5417\uFF1F\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"}).then(()=>{t.clearScreen()}).catch(()=>{})},s=()=>t.undo(),r=()=>t.redo();function f(){l.value=!0,ve(()=>{c.value&&c.value.addEventListener("paste",_),c.value.focus(),c.value.placeholder="\u7C98\u8D34\u56FE\u8868\u914D\u7F6E"})}function _(m){const v=m.clipboardData.getData("Text");try{const p=JSON.parse(v);((p==null?void 0:p.type)==="com"||(p==null?void 0:p.type)==="group")&&(p.id=`${p.name}_${be()}`,p.name==="Group"&&p.components.forEach(y=>{y.id=`${y.name}_${be()}`}),t.addCom({component:p}),Q.success("\u7C98\u8D34\u56FE\u8868\u6210\u529F\uFF01"))}catch(p){console.log(p),Q.error("\u7C98\u8D34\u7684\u5185\u5BB9\u4E0D\u662F\u56FE\u8868\u7EC4\u4EF6\uFF01")}setTimeout(()=>{c.value.value="",l.value=!1,c.value.removeEventListener("paste",_)},100)}return(m,v)=>{const p=C("b-button"),y=C("b-switch");return h(),w("div",{class:L(["toolbox-panel-wp",{"is-hide":!x(e).toolbox}])},[n("div",nl,[n("div",al,[u(p,{size:"mini",onClick:s},{default:b(()=>[ll,sl]),_:1}),u(p,{size:"mini",onClick:r},{default:b(()=>[il,cl]),_:1}),rl,n("div",dl,[ul,u(y,{modelValue:x(d).referLine,"onUpdate:modelValue":v[0]||(v[0]=g=>x(d).referLine=g),size:"small"},null,8,["modelValue"])]),n("div",ml,[vl,u(y,{modelValue:x(d).markLine,"onUpdate:modelValue":v[1]||(v[1]=g=>x(d).markLine=g),size:"small"},null,8,["modelValue"])])]),n("div",fl,[pl,l.value?(h(),w("textarea",{key:0,class:"paste-inner",ref_key:"textpasteRef",ref:c},null,512)):(h(),R(p,{key:1,size:"mini",icon:"diff",onClick:f},{default:b(()=>[_l]),_:1})),u(p,{size:"mini",icon:"clear",onClick:i},{default:b(()=>[hl]),_:1})])])],2)}}};const bl={name:"shortcut",props:{modelValue:{type:Boolean}},emits:["update:modelValue"]},yl=o=>(pe("data-v-7e8e628e"),o=o(),_e(),o),xl=yl(()=>n("div",{class:"shortcut-wp"},[n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u57FA\u7840\u5FEB\u6377\u952E"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2190")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u914D\u7F6E\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u7EC4\u4EF6\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2191")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u5DE5\u5177\u680F"),n("div",{class:"shortcut-value"},"Ctrl + \u2193")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u590D\u5236\u9009\u4E2D\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Ctrl + C")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7C98\u8D34\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Ctrl + V")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u64A4\u9500\u64CD\u4F5C"),n("div",{class:"shortcut-value"},"Ctrl + Z")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4FDD\u5B58\u770B\u677F"),n("div",{class:"shortcut-value"},"Ctrl + S")])])]),n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u753B\u5E03\u64CD\u4F5C"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u6700\u4F73\u6BD4\u4F8B"),n("div",{class:"shortcut-value"},"Ctrl + A")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A1\uFF1A1"),n("div",{class:"shortcut-value"},"Ctrl + D")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u81EA\u7531\u7F29\u653E"),n("div",{class:"shortcut-value"},"Ctrl + \u9F20\u6807\u6EDA\u8F6E/\u6EDA\u52A8")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u753B\u5E03"),n("div",{class:"shortcut-value"},"Space + \u9F20\u6807\u5DE6\u952E/\u62D6\u52A8")])])]),n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u7EC4\u4EF6\u64CD\u4F5C"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u9876"),n("div",{class:"shortcut-value"},"Alt + Home")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u5E95"),n("div",{class:"shortcut-value"},"Alt + End")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4E0A\u79FB\u4E00\u5C42"),n("div",{class:"shortcut-value"},"Alt + \u2191")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4E0B\u79FB\u4E00\u5C42"),n("div",{class:"shortcut-value"},"Alt + \u2193")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF61\u50CF\u7D20"),n("div",{class:"shortcut-value"},"\u2191 \u2193 \u2190 \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF610\u50CF\u7D20"),n("div",{class:"shortcut-value"},"Shift + \u2191 \u2193 \u2190 \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u91CD\u547D\u540D"),n("div",{class:"shortcut-value"},"F2/\u53CC\u51FB\u56FE\u5C42")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5220\u9664\u9009\u4E2D\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Delete")])])])],-1));function Cl(o,t,a,e,d,l){const c=C("b-modal");return h(),R(c,{title:"\u5FEB\u6377\u952E\u6307\u5357","model-value":a.modelValue,"append-to-body":"","custom-class":"schema-modal",onClose:t[0]||(t[0]=i=>o.$emit("update:modelValue",!1))},{default:b(()=>[xl]),_:1},8,["model-value"])}var wl=Y(bl,[["render",Cl],["__scopeId","data-v-7e8e628e"]]);const Sl={name:"footer-panel",components:{Shortcut:wl},setup(){const{schemaStore:o,storeToRefs:t}=z(),{pageConfig:a,canvas:e}=t(o),d=T([200,150,100,50]),l=T(20),c=T(20),i=T(!1),s=async r=>{r===-1?o.autoCanvasScale():o.setCanvasScale(r===0?l.value:r)};return re(()=>e.value.scale,r=>{const f=parseInt((r*100).toFixed(2));c.value=f,l.value=f}),{pageConfig:a,scaleList:d,inputScale:l,scale:c,submitScale:s,keycodeVisible:i}}},kl={class:"footer-panel"},Vl={class:"screen-info",flex:"cross:center"},$l={class:"ml-8",style:{transform:"scale(0.9)"}},Ml={flex:"cross:center"},Dl={class:"scale-input-wp"},Tl=n("span",{class:"percent"},"%",-1),Bl=n("i",{class:"b-iconfont b-icon-down"},null,-1),Ll=B("\u81EA\u9002\u5E94"),Rl={class:"scale-slider-wp"};function Nl(o,t,a,e,d,l){const c=C("b-icon"),i=C("b-tooltip"),s=C("b-dropdown-item"),r=C("b-dropdown-menu"),f=C("b-dropdown"),_=C("b-slider"),m=C("shortcut");return h(),w(H,null,[n("div",kl,[n("div",Vl,[u(i,{content:"\u5FEB\u6377\u952E\u63D0\u793A","open-delay":500},{default:b(()=>[u(c,{name:"read",size:"16",type:"button",onClick:t[0]||(t[0]=v=>e.keycodeVisible=!0)})]),_:1}),n("span",$l,Z(e.pageConfig.width)+" \u50CF\u7D20 * "+Z(e.pageConfig.height)+" \u50CF\u7D20",1)]),n("div",Ml,[u(f,{trigger:"click",onCommand:e.submitScale},{dropdown:b(()=>[u(r,null,{default:b(()=>[(h(!0),w(H,null,te(e.scaleList,v=>(h(),R(s,{key:v,name:v},{default:b(()=>[B(Z(`${v}%`),1)]),_:2},1032,["name"]))),128)),u(s,{name:-1},{default:b(()=>[Ll]),_:1})]),_:1})]),default:b(()=>[n("div",Dl,[de(n("input",{"onUpdate:modelValue":t[1]||(t[1]=v=>e.inputScale=v),type:"number",class:"scale-input",onKeydown:t[2]||(t[2]=Pe(v=>e.submitScale(0),["enter"]))},null,544),[[$e,e.inputScale]]),Tl,Bl])]),_:1},8,["onCommand"]),n("div",Rl,[u(_,{modelValue:e.scale,"onUpdate:modelValue":t[3]||(t[3]=v=>e.scale=v),min:10,max:200,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])]),u(m,{modelValue:e.keycodeVisible,"onUpdate:modelValue":t[4]||(t[4]=v=>e.keycodeVisible=v)},null,8,["modelValue"])],64)}var Il=Y(Sl,[["render",Nl]]);const zl={name:"context-menu",setup(){const{schemaStore:o,storeToRefs:t}=z(),{selectedCom:a}=t(o),{isLocked:e,isHided:d,contextMenu:l,contextMenuStyle:c}=Le(),i=S=>{a.value&&o.moveCom({id:a.value.id,moveType:S})},s=()=>i(se.up),r=()=>i(se.down),f=()=>i(se.top),_=()=>i(se.bottom),m=()=>{a.value&&(a.value.locked=!a.value.locked)},v=()=>{a.value&&(a.value.hided=!a.value.hided)},p=()=>{const S=a.value;S&&Fe.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{o.deleteCom(S.id)}).catch(()=>{})},y=()=>{const S=a.value;S&&o.renamingCom(S.id)},g=()=>{const S=a.value;S&&o.copyCom(S.id)},V=S=>S.preventDefault();return fe(()=>{q(document,"contextmenu",V)}),Ce(()=>{G(document,"contextmenu",V)}),{contextMenu:l,contextMenuStyle:c,isLocked:e,isHided:d,moveUp:s,moveDown:r,moveTop:f,moveBottom:_,toDeleteCom:p,renameCom:y,toCopyCom:g,lockCom:m,hideCom:v}}},P=o=>(pe("data-v-68b5ef35"),o=o(),_e(),o),Ul=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),El=B(" \u7F6E\u9876 "),Al=P(()=>n("span",{class:"key-code"},"Alt + Home",-1)),Ol=[Ul,El,Al],Hl=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),Pl=B(" \u7F6E\u5E95 "),Yl=P(()=>n("span",{class:"key-code"},"Alt + End",-1)),jl=[Hl,Pl,Yl],Xl=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),Wl=B(" \u4E0A\u79FB\u4E00\u5C42 "),Kl=P(()=>n("span",{class:"key-code"},"Alt + \u2191",-1)),Fl=[Xl,Wl,Kl],Jl=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),ql=B(" \u4E0B\u79FB\u4E00\u5C42 "),Gl=P(()=>n("span",{class:"key-code"},"Alt + \u2193",-1)),Zl=[Jl,ql,Gl],Ql=P(()=>n("div",{class:"context-menu-divider"},null,-1)),es=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),ts=B(" \u89E3\u9501 "),os=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),ns=B(" \u9501\u5B9A "),as=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),ls=B(" \u663E\u793A "),ss=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),is=B(" \u9690\u85CF "),cs=P(()=>n("div",{class:"context-menu-divider"},null,-1)),rs=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),ds=B(" \u91CD\u547D\u540D "),us=P(()=>n("span",{class:"key-code"},"F2",-1)),ms=[rs,ds,us],vs=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),fs=B(" \u590D\u5236 "),ps=P(()=>n("span",{class:"key-code"},"Ctrl + C,V",-1)),_s=[vs,fs,ps],hs=P(()=>n("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),gs=B(" \u5220\u9664 "),bs=P(()=>n("span",{class:"key-code"},"Delete",-1)),ys=[hs,gs,bs];function xs(o,t,a,e,d,l){return h(),R(dt,{name:"zoom-in-top"},{default:b(()=>[e.contextMenu.show?(h(),w("div",{key:0,class:"context-menu-wrap",style:A(e.contextMenuStyle)},[n("div",{class:"context-menu-item",onClick:t[0]||(t[0]=(...c)=>e.moveTop&&e.moveTop(...c))},Ol),n("div",{class:"context-menu-item",onClick:t[1]||(t[1]=(...c)=>e.moveBottom&&e.moveBottom(...c))},jl),n("div",{class:"context-menu-item",onClick:t[2]||(t[2]=(...c)=>e.moveUp&&e.moveUp(...c))},Fl),n("div",{class:"context-menu-item",onClick:t[3]||(t[3]=(...c)=>e.moveDown&&e.moveDown(...c))},Zl),Ql,n("div",{class:"context-menu-item",onClick:t[4]||(t[4]=(...c)=>e.lockCom&&e.lockCom(...c))},[e.isLocked?(h(),w(H,{key:0},[es,ts],64)):(h(),w(H,{key:1},[os,ns],64))]),n("div",{class:"context-menu-item",onClick:t[5]||(t[5]=(...c)=>e.hideCom&&e.hideCom(...c))},[e.isHided?(h(),w(H,{key:0},[as,ls],64)):(h(),w(H,{key:1},[ss,is],64))]),cs,n("div",{class:"context-menu-item",onClick:t[6]||(t[6]=(...c)=>e.renameCom&&e.renameCom(...c))},ms),n("div",{class:"context-menu-item",onClick:t[7]||(t[7]=(...c)=>e.toCopyCom&&e.toCopyCom(...c))},_s),n("div",{class:"context-menu-item",onClick:t[8]||(t[8]=(...c)=>e.toDeleteCom&&e.toDeleteCom(...c))},ys)],4)):X("",!0)]),_:1})}var Cs=Y(zl,[["render",xs],["__scopeId","data-v-68b5ef35"]]);function ws(){const o=xe(),{schemaStore:t}=z(),a=T(!1),e=async l=>{try{a.value=!0;const c=await wt(l);if(c){const{id:i,name:s,pid:r,layout:f,components:_}=c,m={pageInfo:{id:i,name:s,pid:r},pageConfig:JSON.parse(f),comps:_.map(v=>JSON.parse(v.componentContent))};t.loadScreenData(m),await ve(),document.title=s}}catch(c){console.log(c)}a.value=!1},d=async()=>{try{a.value=!0;const l=await kt();if(l.tpl.length>0){const c=await Dt(l.tpl);if(c){const i=JSON.parse(c.content),{comps:s,pageConfig:r}=i;t.loadScreenData({comps:s,pageConfig:r})}}else t.setScreenSize(l)}catch(l){console.log(l)}a.value=!1};return re(()=>o.path,async()=>{const{id:l}=o.query;l?await e(l):await d()},{immediate:!0}),{loading:a}}function Ss(){const o=T(null),t=T(null),{saveScreenData:a}=Be(),{schemaStore:e,storeToRefs:d}=z(),{pageInfo:l,canvas:c,selectedCom:i}=d(e),s=xe();let r=null;const f=p=>{const y=p.target;if(!["input","textarea"].includes(y.tagName.toLowerCase())){const g=p.key.toLowerCase();g==="delete"?(t.value&&t.value.toDeleteCom(),p.preventDefault()):g==="f2"&&(t.value&&t.value.renameCom(),p.preventDefault());const V=i.value;p.altKey&&(_("altKey"),g==="arrowup"?t.value&&t.value.moveUp():g==="arrowdown"?t.value&&t.value.moveDown():g==="home"?t.value&&t.value.moveTop():g==="end"&&t.value&&t.value.moveBottom(),p.preventDefault()),p.ctrlKey&&(_("ctrlKey"),g==="arrowup"?(e.toggleCompsPanel(),p.preventDefault()):g==="arrowdown"?(e.toggleToolbox(),p.preventDefault()):g==="arrowleft"?(e.toggleLayerPanel(),p.preventDefault()):g==="arrowright"?(e.toggleConfigPanel(),p.preventDefault()):g==="a"?(e.autoCanvasScale(),p.preventDefault()):g==="d"?(e.setCanvasScale(100),p.preventDefault()):g==="c"?(r=i.value,Te(JSON.stringify(r)),p.preventDefault()):g==="v"?(r&&e.copyCom(r.id),p.preventDefault()):g==="s"?(l.value.id||s.query.id?(Q("\u6B63\u5728\u4FDD\u5B58..."),a("edit").then(()=>Q.success("\u4FDD\u5B58\u6210\u529F\uFF01"))):o.value&&o.value.handleSaveScreen(),p.preventDefault()):g==="z"&&(e.undo(),p.preventDefault())),p.shiftKey&&_("shiftKey"),p.keyCode===32&&(_("spaceKey"),p.preventDefault());const S=p.shiftKey?10:1;V&&!p.altKey&&(g==="arrowleft"?(V.attr.x-=S,p.preventDefault()):g==="arrowright"?(V.attr.x+=S,p.preventDefault()):g==="arrowup"?(V.attr.y-=S,p.preventDefault()):g==="arrowdown"&&(V.attr.y+=S,p.preventDefault()))}},_=p=>{e.toggleKey({key:p,status:!0})},m=()=>{e.resetKeyCode()},v=p=>{const y=parseInt((c.value.scale*100).toFixed(2)),g=(p.wheelDelta>0?1:-1)*5,V=Math.min(Math.max(y+g,20),200);e.setCanvasScale(V)};return fe(()=>{q(document,"keydown",f),q(document,"keyup",m)}),Ce(()=>{G(document,"keydown",f),G(document,"keyup",m)}),{headerRef:o,contextMenuRef:t,ctrlMouseWheel:v}}const ks={name:"ScreenEditor",components:{ContextMenu:Cs,FooterPanel:Il,ToolboxPanel:gl,CanvasMain:Yn,ConfigPanel:ol,ComponentsPanel:an,LayerPanel:bo,HeaderBar:oo},setup(){return{...ws(),...Ss()}}},Vs={key:0,flex:"main:center cross:center",class:"full-wrapper"},$s={key:1,class:"editor-main-wrapper"},Ms={class:"edit-main-wp"};function Ds(o,t,a,e,d,l){const c=C("header-bar"),i=C("svg-loading"),s=C("components-panel"),r=C("layer-panel"),f=C("toolbox-panel"),_=C("canvas-main"),m=C("footer-panel"),v=C("config-panel"),p=C("context-menu");return h(),w("div",{class:"schema-screen-container",onWheel:t[0]||(t[0]=le((...y)=>o.ctrlMouseWheel&&o.ctrlMouseWheel(...y),["ctrl","prevent"]))},[u(c,{ref:"headerRef","back-url":"/dashboard"},null,512),o.loading?(h(),w("div",Vs,[u(i,{name:"loading02"})])):(h(),w("div",$s,[u(s),u(r),n("div",Ms,[u(f),u(_),u(m)]),u(v)])),u(p,{ref:"contextMenuRef"},null,512)],32)}var Es=Y(ks,[["render",Ds]]);export{Es as default};
