import{S as g,t as U,h as j,I as q,K,T as J,U as B,B as G,V as H}from"./index-a4e94847.js";import{aB as Q,g as h,a4 as x,o as l,A as u,F as E,D as A,B as t,t as C,a8 as L,a9 as z,y as W,J as p,u as _,h as I,f as M,c as k,w as S,a as V,d as X,z as Y,K as R,q as O}from"./vendor-0fc4fabe.js";import{u as P}from"./useSchemaStore-a5915d07.js";import{a as Z}from"./chunk-bin-ui-next-51eb6328.js";import{g as ee,f as te}from"./field-type-icon-e90083b8.js";import"./chunk-brace-7fd40d4c.js";import"./database.api-9713b641.js";const ae=Q({name:"DisplayApiStatus",props:{status:{type:String,default:g.incomplete},loadingText:{type:String,default:"\u5339\u914D\u4E2D"},successText:{type:String,default:"\u5339\u914D\u6210\u529F"},failedText:{type:String,default:"\u672A\u627E\u5230\u5B57\u6BB5"},completedText:{type:String,default:"\u914D\u7F6E\u5B8C\u6210"},incompleteText:{type:String,default:"\u914D\u7F6E\u672A\u5B8C\u6210"},optional:{type:Boolean,default:!1}},setup(e){const s=h(()=>e.status===g.loading?e.loadingText:e.status===g.success?e.successText:e.status===g.completed?e.completedText:e.optional?"\u53EF\u9009":e.status===g.failed?e.failedText:e.status===g.incomplete?e.incompleteText:e.status);return{apiStatus:g,statusText:s}}}),$=e=>(L("data-v-3321e9e7"),e=e(),z(),e),se=$(()=>t("i",{class:"status-icon validating"},null,-1)),oe=$(()=>t("i",{class:"status-icon validating"},null,-1)),ne=$(()=>t("i",{class:"status-icon validating"},null,-1)),ie={key:2,class:"status-icon --success"},le={class:"status-text"};function re(e,s,f,a,y,b){return l(),u("div",null,[e.status===e.apiStatus.loading?(l(),u(E,{key:0},[se,oe,ne],64)):e.status===e.apiStatus.success||e.status===e.apiStatus.completed?(l(),u("i",{key:1,class:A(["status-icon",`--${e.status}`])},null,2)):e.optional?(l(),u("i",ie)):(l(),u("i",{key:3,class:A(["status-icon",`--${e.status}`])},null,2)),t("span",le,C(e.statusText),1)])}var de=x(ae,[["render",re],["__scopeId","data-v-3321e9e7"]]);const ce={name:"ds-api",setup(){const e=W({dimensionTree:{},dimensionTreeFlats:[],dimensionFields:[],measureTree:{},measureTreeFlats:[],measureFields:[]}),s=P(),f=n=>{const{dimension:r,measure:i}=n||{};e.dimensionTree=r||{title:"\u7EF4\u5EA6",nodeType:"root",children:[]},e.measureTree=i||{title:"\u5EA6\u91CF",nodeType:"root",children:[]},e.dimensionTreeFlats=j(e.dimensionTree),e.measureTreeFlats=j(e.measureTree),e.dimensionFields=e.dimensionTreeFlats.filter(m=>m.node.nodeType==="attribute"),e.measureFields=e.measureTreeFlats.filter(m=>m.node.nodeType==="attribute")};(async()=>{try{const{pageId:n,workspaceId:r,sourceId:i}=s.pageInfo.value,{cubeSchema:m}=await ee({workspaceId:r,id:n||i});f(m)}catch(n){U("schema/index",n)}})();const y=h(()=>e.dimensionTree),b=h(()=>e.measureTree);function c({root:n,node:r,data:i}){const m=[I("span",{class:`${i.type} t-ellipsis`,style:{width:"calc(100% - 24px)"},flex:"cross:center",title:`${i.title}-(${i.field})`},[i.nodeType!=="root"?I(te,{type:i.dataType,size:"14px",style:{marginRight:"4px"}}):null,i.title])];return I("span",{style:{width:"100%",fontSize:"12px"},flex:"main:justify"},m)}const o=(n,r,i)=>!1,D=n=>n.nodeType==="attribute";let v=null;function w(n){v=n.target,n.target.classList.add("highlight-area")}function d(n){v===n.target&&n.target.classList.remove("highlight-area")}function F(n){console.log(n.target),v&&(v.classList.remove("highlight-area"),v=null)}function N(n,r,i,m){console.log("tree drag end: ",n,i),Z(`\u62D6\u62FD\u7684\u8282\u70B9\uFF1A${n.title}`)}return{dimensionTree:y,measureTree:b,allowDrop:o,allowDrag:D,renderContent:c,onDragEnter:w,onDragLeave:d,onDrop:F,handleDragEnd:N}}},T=e=>(L("data-v-4806f770"),e=e(),z(),e),ue={class:"data-source-api"},pe={class:"data-config-left"},_e={class:"config-data-container"},me={class:"config-data-panel"},ge=T(()=>t("div",{class:"area-name"},[t("span",null,"\u503C\u8F74/\u5EA6\u91CF")],-1)),fe=T(()=>t("ul",{class:"column-list",id:"area_value"},null,-1)),ve=T(()=>t("div",{class:"no-column-tip"},[t("span",{title:"\u53CC\u51FB\u6216\u62D6\u52A8\u6570\u636E\u5B57\u6BB5\u81F3\u6B64\u5904"},"\u53CC\u51FB\u6216\u62D6\u52A8\u6570\u636E\u5B57\u6BB5\u81F3\u6B64\u5904")],-1)),he=[ge,fe,ve],ye=T(()=>t("div",{class:"area-name"},[t("span",null,"\u7C7B\u522B\u8F74/\u7EF4\u5EA6")],-1)),be=T(()=>t("ul",{class:"column-list",id:"area_type"},null,-1)),De=T(()=>t("div",{class:"no-column-tip"},[t("span",{title:"\u53CC\u51FB\u6216\u62D6\u52A8\u6570\u636E\u5B57\u6BB5\u81F3\u6B64\u5904"},"\u53CC\u51FB\u6216\u62D6\u52A8\u6570\u636E\u5B57\u6BB5\u81F3\u6B64\u5904")],-1)),Te=[ye,be,De],Se=T(()=>t("div",{class:"bottom-menus"},[t("div",{class:"refresh-panel"},[t("button",{id:"refresh-panel-button"},"\u66F4\u65B0")])],-1)),we={class:"data-config-right"},xe={class:"tree-box"},Ce={class:"tree-box"};function ke(e,s,f,a,y,b){const c=p("b-tree");return l(),u("div",ue,[t("div",pe,[t("div",_e,[t("div",me,[t("div",{id:"area_value_panel",class:"config-data-item",onDrop:s[0]||(s[0]=o=>a.onDrop(o)),onDragover:s[1]||(s[1]=o=>o.preventDefault()),onDragenter:s[2]||(s[2]=o=>a.onDragEnter(o)),onDragleave:s[3]||(s[3]=o=>a.onDragLeave(o))},he,32),t("div",{id:"area_type_panel",class:"config-data-item",onDrop:s[4]||(s[4]=o=>a.onDrop(o)),onDragover:s[5]||(s[5]=o=>o.preventDefault()),onDragenter:s[6]||(s[6]=o=>a.onDragEnter(o)),onDragleave:s[7]||(s[7]=o=>a.onDragLeave(o))},Te,32)]),Se])]),t("div",we,[t("div",xe,[_(c,{"default-expand":"",draggable:"","allow-drop":a.allowDrop,"allow-drag":a.allowDrag,data:[a.dimensionTree],render:a.renderContent,onNodeDragEnd:a.handleDragEnd},null,8,["allow-drop","allow-drag","data","render","onNodeDragEnd"])]),t("div",Ce,[_(c,{"default-expand":"",draggable:"","allow-drop":a.allowDrop,"allow-drag":a.allowDrag,data:[a.measureTree],render:a.renderContent,onNodeDragEnd:a.handleDragEnd},null,8,["allow-drop","allow-drag","data","render","onNodeDragEnd"])])])])}var Fe=x(ce,[["render",ke],["__scopeId","data-v-4806f770"]]);const Ne={name:"source-drawer",components:{DsApi:Fe},setup(){const e=M(!1);return{visible:e,open:()=>{e.value=!0}}}};function Ee(e,s,f,a,y,b){const c=p("ds-api"),o=p("b-drawer");return l(),k(o,{modelValue:a.visible,"onUpdate:modelValue":s[0]||(s[0]=D=>a.visible=D),"class-name":"source-drawer",width:500,title:"\u914D\u7F6E\u6570\u636E\u6E90","append-to-body":"",styles:{padding:0}},{default:S(()=>[a.visible?(l(),k(c,{key:0})):V("",!0)]),_:1},8,["modelValue"])}var Ae=x(Ne,[["render",Ee]]);const Ie={name:"source-panel",components:{SourceDrawer:Ae,DisplayApiStatus:de,DataEditor:q(()=>K(()=>import("./data-editor-100b8819.js"),["static/js/data-editor-100b8819.js","static/css/data-editor-fea543a8.css","static/js/vendor-0fc4fabe.js","static/js/chunk-brace-7fd40d4c.js"]))},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(e){const{selectedCom:s}=P(),{apiFieldStatusMap:f}=J(),a=M(null),y=h(()=>e.apiName===e.activeName),b=h(()=>s.value.apis[e.apiName]),c=h(()=>s.value.apiData[e.apiName]),o=h(()=>{const d=f.value[s.value.id];return d?d[e.apiName]:{}}),D=h(()=>{const d=Object.values(o.value);return d.includes(B.loading)?g.loading:d.includes(B.failed)?g.incomplete:g.completed}),v=d=>{c.value.config.data=d},w=()=>{var d;(d=a.value)==null||d.open()};return{sourceDrawerRef:a,ApiType:G,ApiTypeMap:H(),visible:y,apiConfig:b,apiDataConfig:c,fieldsStatus:o,totalStatus:D,updateData:v,openSourceDrawer:w}}},Ve={class:"api-editor-title"},$e={class:"api-desc"},je={class:"api-status success"},Be={class:"attr-source-wp"},Le={class:"data-attr-table-container"},ze={class:"data-attr-table"},Me=t("thead",{class:"table-head"},[t("tr",{class:"table-head-row"},[t("th",{class:"th-item column-item attr-name"},"\u5B57\u6BB5"),t("th",{class:"th-item column-item attr-value"},"\u6620\u5C04"),t("th",{class:"th-item column-item attr-status"},"\u72B6\u6001")])],-1),Re={class:"table-body"},Oe={class:"column-item attr-name"},Pe={class:"ellipsis2"},Ue={class:"column-item attr-value"},qe={class:"column-item attr-status"},Ke={key:1,class:"table-body-row"},Je=t("td",{class:"column-item attr-name"},[t("span",null,"\u4EFB\u610F")],-1),Ge=t("td",{class:"column-item attr-value"},null,-1),He={class:"column-item attr-status"},Qe={class:"data-source"},We=t("div",{class:"data-result-title"},"\u6570\u636E\u6E90\u914D\u7F6E",-1),Xe={class:"data-source-config"},Ye={key:1,class:"p16"},Ze=O("\u914D\u7F6E\u6570\u636E\u6E90");function et(e,s,f,a,y,b){const c=p("display-api-status"),o=p("b-tooltip"),D=p("g-input"),v=p("b-radio"),w=p("b-radio-group"),d=p("g-field"),F=p("data-editor"),N=p("b-button"),n=p("source-drawer");return l(),u("div",{class:A(["api-editor",{"--disable-fold":!f.collapse,"--fold":f.collapse&&a.visible}])},[t("div",Ve,[t("div",$e,C(a.apiConfig.description||"\u6570\u636E\u63A5\u53E3"),1),t("div",je,[_(c,{status:a.totalStatus,"success-text":"\u914D\u7F6E\u5B8C\u6210"},null,8,["status"])])]),X(t("div",Be,[t("div",Le,[t("table",ze,[Me,t("tbody",Re,[Object.keys(a.apiConfig.fields).length>0?(l(!0),u(E,{key:0},R(a.apiConfig.fields,(r,i)=>(l(),u("tr",{key:i,class:"table-body-row"},[t("td",Oe,[_(o,{content:r.description},{default:S(()=>[t("span",Pe,C(i),1)]),_:2},1032,["content"])]),t("td",Ue,[_(D,{"model-value":r.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",size:"mini",onChange:m=>r.map=m,style:{margin:"0"}},null,8,["model-value","onChange"])]),t("td",qe,[_(c,{status:a.fieldsStatus[i],optional:r.optional},null,8,["status","optional"])])]))),128)):(l(),u("tr",Ke,[Je,Ge,t("td",He,[_(c,{status:"completed"})])]))])])]),t("div",Qe,[We,t("div",Xe,[_(d,{label:"\u6570\u636E\u6765\u6E90"},{default:S(()=>[_(w,{modelValue:a.apiDataConfig.type,"onUpdate:modelValue":s[0]||(s[0]=r=>a.apiDataConfig.type=r),type:"button",size:"mini"},{default:S(()=>[(l(!0),u(E,null,R(a.ApiTypeMap,(r,i)=>(l(),k(v,{key:i,label:i},{default:S(()=>[O(C(r),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a.apiDataConfig.type===a.ApiType.static?(l(),k(F,{key:0,"model-value":a.apiDataConfig.config.data,onChange:a.updateData},null,8,["model-value","onChange"])):V("",!0),a.apiDataConfig.type===a.ApiType.api?(l(),u("div",Ye,[_(N,{type:"primary",size:"small",onClick:a.openSourceDrawer},{default:S(()=>[Ze]),_:1},8,["onClick"])])):V("",!0)])])],512),[[Y,a.visible]]),_(n,{ref:"sourceDrawerRef"},null,512)],2)}var rt=x(Ie,[["render",et]]);export{rt as default};
