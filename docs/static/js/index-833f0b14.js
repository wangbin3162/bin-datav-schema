import{n as C,c as Z}from"./chunk-bin-ui-design-9314e876.js";import{c as ue,t as x,m as pe,r as he,b as _e,w as I,e as E,_ as ae,I as me,h as be,l as ge,s as fe,i as ve,j as we}from"./index-71bcd248.js";import{a as V,t as ye,ad as ee,ai as le,r as q,R as w,b as h,k as X,l as v,M as p,x as j,h as e,q as N,p as u,c as m,F as S,d as G,N as ne,z as B,A as U,ae as te,af as se,ah as $e,w as ke,g as Ce,e as ie,Q as xe,O as oe}from"./vendor-c1103bdb.js";import{d as Ve,s as De}from"./database.api-5878d93e.js";import{g as Ie,r as Se,l as Ne}from"./cross-tab-msg-ed14d683.js";import"./chunk-brace-0dab6832.js";import"./chunk-bin-datav-6a4e943a.js";import"./chunk-particles.vue3-91e644a5.js";import"./chunk-three-06bdd351.js";import"./chunk-gsap-ecfb8fd4.js";import"./chunk-mockjs-03499d26.js";const F={pid:"1",name:"\u7F3A\u7701\u76EE\u5F55",directory:"Y"};function je(){const n=V({selectedPid:F.pid,selectedName:F.name,folderList:[],adding:!1}),b=({id:o,name:a})=>{n.selectedPid=o,n.selectedName=a},D=o=>{if(!n.adding)return;(o.target.value||"").trim()||(n.adding=!1)},$=async o=>{if(!n.adding)return;const a=(o.target.value||"").trim();if(a)try{await ue({...F,name:a}),n.adding=!1,c(),C.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(f){x("useModelFolder/addGroup",f)}else n.adding=!1},s=(o,a)=>{if(!a.editing)return;const f=(o.target.value||"").trim();(!f||a.name===f)&&(a.editing=!1)},g=async(o,a)=>{if(!a.editing)return;const f=(o.target.value||"").trim();if(f&&a.name!==f){try{await pe({id:a.id,name:f}),a.name=f,b({id:a.id,name:f}),C.success("\u4FEE\u6539\u6210\u529F\uFF01")}catch(K){x("useModelFolder/editGroup",K)}a.editing=!1}else a.editing=!1},r=({id:o,name:a})=>{Z.confirm({type:"error",title:"\u63D0\u793A",message:`\u786E\u5B9A\u8981\u5220\u9664 [ ${a} ] \u5417\uFF1F`}).then(async()=>{try{await he(o),b({id:F.pid,name:F.name}),c(),C.success("\u5220\u9664\u6210\u529F\uFF01")}catch(f){x("useModelFolder/confirmDeleteGroup",f)}}).catch(()=>{})},c=()=>{_e().then(o=>{n.folderList=(o.children||[]).map(a=>({id:a.id,name:a.text}))})};return c(),{...ye(n),toggleProject:b,confirmDeleteGroup:r,onAddInputBlur:D,onEditInputBlur:s,editGroup:g,addGroup:$}}var Be="/bin-datav-schema/static/png/new-project-b5c06121.png";const y=n=>(te("data-v-574e311c"),n=n(),se(),n),Ke=y(()=>e("h2",{class:"title-bar"},"\u9884\u8BBE",-1)),Le={class:"preset-wp"},Pe=y(()=>e("i",{class:"b-iconfont b-icon-laptop"},null,-1)),ze={class:"label-title"},Te={class:"h2"},Fe={class:"h4"},Ge={flex:"main:justify",style:{width:"180px"}},Me=y(()=>e("i",{class:"b-iconfont b-icon-mobile"},null,-1)),Oe={class:"label-title"},Re={class:"h2"},Ae={class:"h4"},Ee={flex:"main:justify",style:{width:"180px"}},Ue=y(()=>e("i",{class:"b-iconfont b-icon-gateway"},null,-1)),qe=y(()=>e("p",{class:"mb-5"},"\u81EA\u5B9A\u4E49\u5927\u5C0F",-1)),Ye={class:"custom-input"},Je=y(()=>e("span",{class:"mr-5"},"W:",-1)),We=y(()=>e("span",{class:"ml-5 mr-5"},"H:",-1)),He=y(()=>e("div",{style:{width:"24px"}},null,-1)),Qe=y(()=>e("h2",{class:"title-bar"},"\u6A21\u677F",-1)),Xe={class:"template-list"},Ze=["onClick"],et={class:"template-image"},tt={class:"preview-image"},st=["src"],nt={key:1,src:ae,alt:"default",style:{width:"147px",height:"147px"}},ot={class:"tpl-remove"},at={class:"template-info"},lt=["title"],it={class:"template-size"},dt=y(()=>e("p",null,"\u753B\u5E03\u5C3A\u5BF8",-1)),ct={__name:"create-kanban",setup(n,{expose:b}){const D=le(),$=q(!1),s=V({...Ve}),g=V({label:I[0].label,width:I[0].width,height:I[0].height}),r=V({label:E[0].label,width:E[0].width,height:E[0].height}),c=V({width:1920,height:1080}),o=q([]),a=()=>{$.value=!1},f=()=>{s.label=I[0].label,s.width=I[0].width,s.height=I[0].height,s.type="web",s.tpl="",M(),$.value=!0},K=i=>{s.type="tpl",s.tpl=i.template.id},L=({width:i,height:t})=>{s.label="\u81EA\u5B9A\u4E49",s.width=i,s.height=t,s.tpl=""},Y=i=>{g.label=i.label,g.width=i.width,g.height=i.height,s.label=i.label,s.type=i.type,s.width=i.width,s.height=i.height,s.tpl=""},J=i=>{r.label=i.label,r.width=i.width,r.height=i.height,s.label=i.label,s.type=i.type,s.width=i.width,s.height=i.height,s.tpl=""},M=()=>{Ie().then(i=>{o.value=(i.rows||[]).map(t=>{let d={};try{d=JSON.parse(t.content)}catch{d={pageConfig:{}}}return d})})},W=i=>{Z.confirm({type:"error",title:"\u63D0\u793A",message:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u6A21\u677F\u5417\uFF1F"}).then(async()=>{try{await Se(i.id),M(),C.success("\u5220\u9664\u6A21\u677F\u6210\u529F\uFF01")}catch(t){x("create-screen/removeTpl",t)}}).catch(()=>{})},P=i=>{i==="web"?(s.label=g.label,s.width=g.width,s.height=g.height):i==="mobile"?(s.label=r.label,s.width=r.width,s.height=r.height):i==="custom"&&(s.label="\u81EA\u5B9A\u4E49",s.width=c.width,s.height=c.height),s.type=i,s.tpl=""},H=async()=>{a(),await De(s);const i=D.resolve("/schema/screen");window.open(i.href,"_blank")};function O(i){return i.thumbnail||i.bgImage}return b({openCreate:f}),(i,t)=>{const d=w("b-icon"),k=w("b-dropdown-item"),z=w("b-dropdown-menu"),R=w("b-dropdown"),A=w("b-input-number"),T=w("b-button"),Q=w("b-empty"),_=w("b-modal");return h(),X(_,{modelValue:$.value,"onUpdate:modelValue":t[7]||(t[7]=l=>$.value=l),title:"\u65B0\u5EFA\u5927\u5C4F",width:"1000px","custom-class":"schema-modal","destroy-on-close":""},{footer:v(()=>[p(T,{onClick:a},{default:v(()=>[j("\u53D6\u6D88")]),_:1}),p(T,{type:"primary",onClick:H},{default:v(()=>[j("\u5F00\u59CB\u8BBE\u8BA1")]),_:1})]),default:v(()=>[e("div",null,[Ke,e("div",Le,[e("div",{class:N(["preset-item web-box",{selected:s.type==="web"}]),onClick:t[0]||(t[0]=l=>P("web"))},[Pe,e("div",ze,[e("div",Te,u(g.label),1),e("div",Fe,u(g.width)+"x"+u(g.height),1)]),p(R,{trigger:"click",placement:"bottom-end",style:{width:"24px",height:"46px","line-height":"46px"},onCommand:Y},{dropdown:v(()=>[p(z,null,{default:v(()=>[(h(!0),m(S,null,G(ne(I),l=>(h(),X(k,{key:l.label,name:l},{default:v(()=>[e("div",Ge,[e("span",null,u(l.label),1),e("span",null,u(l.width)+"x"+u(l.height),1)])]),_:2},1032,["name"]))),128))]),_:1})]),default:v(()=>[p(d,{name:"down",type:"button"})]),_:1})],2),e("div",{class:N(["preset-item mobile-box",{selected:s.type==="mobile"}]),onClick:t[1]||(t[1]=l=>P("mobile"))},[Me,e("div",Oe,[e("div",Re,u(r.label),1),e("div",Ae,u(r.width)+"x"+u(r.height),1)]),p(R,{trigger:"click",placement:"bottom-end",style:{width:"24px",height:"46px","line-height":"46px"},onCommand:J},{dropdown:v(()=>[p(z,null,{default:v(()=>[(h(!0),m(S,null,G(ne(E),l=>(h(),X(k,{key:l.label,name:l},{default:v(()=>[e("div",Ee,[e("span",null,u(l.label),1),e("span",null,u(l.width)+"x"+u(l.height),1)])]),_:2},1032,["name"]))),128))]),_:1})]),default:v(()=>[p(d,{name:"down",type:"button"})]),_:1})],2),e("div",{class:N(["preset-item custom-box",{selected:s.type==="custom"}]),onClick:t[6]||(t[6]=l=>P("custom"))},[Ue,e("div",null,[qe,e("p",Ye,[Je,p(A,{modelValue:c.width,"onUpdate:modelValue":t[2]||(t[2]=l=>c.width=l),min:100,step:1,precision:0,size:"mini",onChange:t[3]||(t[3]=l=>L(c))},null,8,["modelValue"]),We,p(A,{modelValue:c.height,"onUpdate:modelValue":t[4]||(t[4]=l=>c.height=l),min:100,step:1,precision:0,size:"mini",onChange:t[5]||(t[5]=l=>L(c))},null,8,["modelValue"])])]),He],2)]),Qe,e("div",Xe,[(h(!0),m(S,null,G(o.value,l=>(h(),m("div",{class:"template-grid",key:l.template.id},[e("div",{class:N(["template-item",{selected:s.type==="tpl"&&s.tpl===l.template.id}]),onClick:re=>K(l)},[e("div",et,[e("div",tt,[O(l.pageConfig)?(h(),m("img",{key:0,src:O(l.pageConfig),alt:""},null,8,st)):(h(),m("img",nt))]),e("div",ot,[p(T,{type:"text","text-color":"#f5222d",title:"\u79FB\u9664\u6A21\u677F",icon:"delete",onClick:re=>W(l)},null,8,["onClick"])])]),e("div",at,[e("div",{class:"template-name","t-ellipsis":"",title:l.name},u(l.name),9,lt),e("div",it,[dt,e("p",null,u(l.pageConfig.width)+"x"+u(l.pageConfig.height)+"px",1)])])],10,Ze)]))),128))]),B(p(Q,null,{default:v(()=>[j("\u6682\u65E0\u6A21\u677F")]),_:1},512),[[U,o.value.length===0]])])]),_:1},8,["modelValue"])}}};var rt=ee(ct,[["__scopeId","data-v-574e311c"]]);const de=n=>(te("data-v-c01df974"),n=n(),se(),n),ut={class:"kanban-list-wp"},pt=de(()=>e("img",{src:Be},null,-1)),ht=de(()=>e("span",{class:"text-title ellipsis"},"\u65B0\u5EFA\u5927\u5C4F",-1)),_t=[pt,ht],mt={class:"list-header"},bt={class:"title"},gt={class:"header-manager"},ft={class:"list-wrap"},vt={class:"list-item-inner"},wt={class:"list-item-img"},yt={class:"preview-image"},$t=["src"],kt={key:1,src:ae,alt:"default",style:{width:"147px",height:"147px"}},Ct={class:"list-item-mask"},xt={class:"action"},Vt={class:"icon-box"},Dt=["onClick"],It=["onClick"],St=["onClick"],Nt=["onClick"],jt={class:"list-item-info"},Bt=["title"],Kt={class:"loading-wrap",flex:"main:center cross:center"},Lt={class:"t-center pb-24"},Pt={__name:"kanban-list",props:{group:{type:Object,default:()=>({})}},setup(n){const b=n,D=le(),$=$e(),s=q(null),g=q(!1),r=V({name:"",page:1,size:10}),c=V({rows:[],total:0,loading:!1}),o=V({id:"",pid:"",name:"",directory:"N"}),a=async()=>{try{c.loading=!0;const t=await be({pid:b.group.pid,...r});c.rows=(t.rows||[]).map(d=>{let k={};try{k=JSON.parse(d.layout)}catch{k={}}return{id:d.id,name:d.name,status:d.status,pageConfig:k}}),c.total=t.total}catch(t){x("kanban-list/getSearchList",t)}c.loading=!1},f=async t=>{r.page=t,await a()},K=t=>{let d=D.resolve({path:`/screen/${t.id}`});window.open(d.href,"_blank")};function L(t){return t.thumbnail||t.bgImage}const Y=()=>{o.pid="",o.name="",o.directory="N"},J=t=>{let d=D.resolve({path:"/schema/screen",query:{id:t}});window.open(d.href,"_blank")},M=()=>{s.value&&s.value.openCreate()},W=t=>{Y(),o.id=t.id,o.pid=t.pid,o.name=t.name,o.directory=t.directory,J(t.id)},P=async t=>{try{const d=await ge(t.id);d.name=`${d.name}_copy`,delete d.id,await fe({...d,status:"edit"}),await a(),C.success("\u590D\u5236\u6210\u529F\uFF01")}catch(d){x("kanban-list/handleCopy",d)}},H=async t=>{if(t.status!=="audited")try{C(`\u6B63\u5728\u53D1\u5E03[${t.name}]`),await ve(t.id),await a(),C.success("\u53D1\u5E03\u6210\u529F\uFF01")}catch(d){x("kanban-list/handlePublish",d)}},O=t=>{Z.confirm({type:"error",title:"\u63D0\u793A",message:"\u5220\u9664\u540E\u65E0\u6CD5\u6062\u590D\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F"}).then(async()=>{try{await we(t),await a(),C.success("\u5220\u9664\u6210\u529F\uFF01")}catch(d){x("kanban-list/removeDashboard",d)}}).catch(()=>{})};ke([()=>b.group,()=>$.path],()=>{r.page=1,r.name="",a(),g.value=!1},{immediate:!0,deep:!0});const i=Ne(a);return Ce(i),(t,d)=>{const k=w("b-input"),z=w("b-button"),R=w("b-tag"),A=w("b-loading"),T=w("b-empty"),Q=w("b-page");return h(),m(S,null,[e("div",ut,[e("div",{class:"new-box",onClick:M},_t),e("div",mt,[e("div",bt,[e("h2",null,u(n.group?n.group.name:"")+" ("+u(c.total)+")",1)]),e("div",gt,[p(k,{modelValue:r.name,"onUpdate:modelValue":d[0]||(d[0]=_=>r.name=_),size:"small",placeholder:"\u641C\u7D22",search:"",clearable:"",onSearch:d[1]||(d[1]=()=>{g.value=!0,a()})},null,8,["modelValue"])])]),e("ul",ft,[(h(!0),m(S,null,G(c.rows,_=>(h(),m("li",{key:_.id,class:"base-list-item"},[e("div",vt,[e("div",wt,[e("div",yt,[L(_.pageConfig)?(h(),m("img",{key:0,src:L(_.pageConfig),alt:""},null,8,$t)):(h(),m("img",kt))]),e("div",Ct,[e("div",xt,[p(z,{type:"primary",transparent:"",icon:"edit-square",onClick:l=>W(_)},{default:v(()=>[j(" \u7F16\u8F91 ")]),_:2},1032,["onClick"])]),e("div",Vt,[_.status==="edit"?(h(),m("i",{key:0,class:"b-iconfont b-icon-send",onClick:l=>H(_),title:"\u53D1\u5E03"},null,8,Dt)):ie("",!0),e("i",{class:"b-iconfont b-icon-eye",onClick:l=>K(_),title:"\u9884\u89C8"},null,8,It),e("i",{class:"b-iconfont b-icon-file-copy",onClick:l=>P(_),title:"\u590D\u5236"},null,8,St),e("i",{class:"b-iconfont b-icon-delete",onClick:l=>O(_.id),title:"\u5220\u9664"},null,8,Nt)])])]),e("div",jt,[e("div",{class:"item-title","t-ellipsis":"",title:_.name},[p(me,{icon:_.directory==="Y"?"folder":"linechart",color:_.directory==="Y"?"#fa8c16":"#1089ff"},null,8,["icon","color"]),e("span",null,u(_.name),1)],8,Bt),p(R,{type:_.status==="audited"?"success":"warning",dot:"","tag-style":{color:"#999"}},{default:v(()=>[j(u(_.status==="audited"?"\u5DF2\u53D1\u5E03":"\u5F85\u53D1\u5E03"),1)]),_:2},1032,["type"])])])]))),128))]),B(e("div",Kt,[p(A)],512),[[U,c.loading]]),B(p(T,null,{default:v(()=>[j(u(g.value?"\u67E5\u8BE2\u65E0\u7ED3\u679C":"\u8BE5\u5206\u7EC4\u4E0B\u6CA1\u6709\u5927\u5C4F"),1)]),_:1},512),[[U,!c.loading&&c.rows.length===0]]),B(e("div",Lt,[p(Q,{total:c.total,current:r.page,"page-size":r.size,onChange:f},null,8,["total","current","page-size"])],512),[[U,!c.loading&&c.total>0]])]),p(rt,{ref_key:"createRef",ref:s},null,512)],64)}}};var zt=ee(Pt,[["__scopeId","data-v-c01df974"]]);const Tt={name:"AnalysisDashboard",components:{KanbanList:zt},setup(){return{...je()}}},ce=n=>(te("data-v-cb8d1ef4"),n=n(),se(),n),Ft={class:"kanban-wrapper"},Gt={class:"kanban-main"},Mt={class:"folder-manage"},Ot={class:"folder-manage-group"},Rt=ce(()=>e("span",null,"\u5927\u5C4F\u5206\u7EC4",-1)),At={class:"folder-manage-main"},Et=ce(()=>e("span",null,"\u7F3A\u7701\u76EE\u5F55",-1)),Ut=[Et],qt={key:0,class:"folder-item new-group"},Yt=["onClick"],Jt=["default-value","onBlur","onKeyup"],Wt={class:"folder-name"},Ht={class:"group-btns"},Qt=["onClick"],Xt=["onClick"],Zt={class:"right-list"};function es(n,b,D,$,s,g){const r=w("kanban-list"),c=xe("focus");return h(),m("div",Ft,[e("div",Gt,[e("div",Mt,[e("div",Ot,[Rt,e("i",{class:"b-iconfont b-icon-plus btn-add-icon",title:"\u65B0\u589E\u6587\u4EF6\u5939",onClick:b[0]||(b[0]=o=>n.adding=!0)})]),e("div",At,[e("div",{class:N(["folder-item folder-all",{"folder-item-checked-color":n.selectedPid==="1"}]),onClick:b[1]||(b[1]=o=>n.toggleProject({id:"1",name:"\u7F3A\u7701\u76EE\u5F55"}))},Ut,2),n.adding?(h(),m("div",qt,[B(e("input",{class:"edit-input",onBlur:b[2]||(b[2]=(...o)=>n.onAddInputBlur&&n.onAddInputBlur(...o)),onKeyup:b[3]||(b[3]=oe((...o)=>n.addGroup&&n.addGroup(...o),["enter"]))},null,544),[[c]])])):ie("",!0),(h(!0),m(S,null,G(n.folderList,o=>(h(),m("div",{key:o.id,class:N(["folder-item",{"folder-item-checked-color":n.selectedPid===o.id}]),onClick:a=>n.toggleProject(o)},[o.editing?B((h(),m("input",{key:0,"default-value":o.name,class:"edit-input",onBlur:a=>n.onEditInputBlur(a,o),onKeyup:oe(a=>n.editGroup(a,o),["enter"])},null,40,Jt)),[[c]]):(h(),m(S,{key:1},[e("span",Wt,u(o.name),1),e("span",Ht,[e("i",{class:"b-iconfont b-icon-edit",title:"\u7F16\u8F91",onClick:a=>o.editing=!0},null,8,Qt),e("i",{class:"b-iconfont b-icon-delete",title:"\u5220\u9664",onClick:a=>n.confirmDeleteGroup(o)},null,8,Xt)])],64))],10,Yt))),128))])]),e("div",Zt,[p(r,{group:{pid:n.selectedPid,name:n.selectedName}},null,8,["group"])])])])}var ps=ee(Tt,[["render",es],["__scopeId","data-v-cb8d1ef4"]]);export{ps as default};
