import{u as k}from"./useSchemaStore-487cf8d0.js";import{as as $,aC as C,a5 as I,l as N,H as z,o as i,a as l,g as B,v as O,b as u,c as D,F as E,O as L,h as f,e as P,M as R}from"./vendor-1e0971ef.js";import{l as F}from"./database.api-f0f62620.js";import{L as J,l as V,y as q,N as p}from"./index-0ca6328d.js";import"./chunk-brace-269ffce0.js";import"./chunk-bin-ui-next-c6b728c8.js";const A={name:"Screen",components:{GLoading:J},setup(){const c=C(),d=I(),{loadScreenData:m,pageConfig:t,comps:g}=k(),s=N(!0),r=()=>{const a=t.value.width,n=document.documentElement.clientWidth/a;p(document.body,{transform:`scale(${n})`,transformOrigin:"left top",backgroundSize:"100%",backgroundRepeat:"no-repeat"})},e=async()=>{const a=d.params.screenId,n=d.name;if(!a){await c.push("/notfound");return}try{s.value=!0;let o={};if(n==="Preview")o=await F();else{const v=await V(a);if(v){const{id:_,name:w,pid:y,layout:b,components:x}=v;o={pageInfo:{id:_,name:w,pid:y},pageConfig:JSON.parse(b),comps:x.map(S=>JSON.parse(S.componentContent))}}}o&&(await m(o),h(o),setTimeout(()=>{s.value=!1},500),q(window,"resize",r))}catch{await c.push("/notfound")}},h=a=>{const{pageInfo:n}=a;document.title=n.name,document.querySelector('meta[name="viewport"]').setAttribute("content",`width=${t.value.width}`),p(document.documentElement,{overflowX:"hidden",overflowY:"visible"}),p(document.body,{width:`${t.value.width}px`,height:`${t.value.height}px`,backgroundImage:`url(${t.value.bgImage})`,backgroundColor:t.value.bgColor}),r()};return e(),{loading:s,comps:g}}},G={class:"screen-wrapper"},H={class:"dv-loading"},K={class:"scene"};function M(c,d,m,t,g,s){const r=z("g-loading");return i(),l("div",G,[B(u("div",H,[D(r,{spinning:""})],512),[[O,t.loading]]),u("div",{class:"dv-layout",style:f({visibility:t.loading?"hidden":"visible"})},[u("div",K,[(i(!0),l(E,null,L(t.comps,e=>(i(),l("div",{class:"dv-com absolute",key:e.id,style:f({left:e.attr.x+"px",top:e.attr.y+"px",width:e.attr.w+"px",height:e.attr.h+"px",opacity:e.attr.opacity,transform:`rotate(${e.attr.rotate}deg)`})},[(i(),P(R(e.name),{data:e},null,8,["data"]))],4))),128))])],4)])}var U=$(A,[["render",M]]);export{U as default};
