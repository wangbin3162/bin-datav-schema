import{ax as q,l as I,o as g,a as S,g as E,a5 as $e,aM as it,m as T,G as ve,n as ge,H as k,f as z,w as x,c as u,F as X,e as N,j as P,b as a,t as Q,A as be,a1 as _,O as fe,h as F,k as le,Y as rt,M as ye,S as Vt,a3 as dt,aO as Mt,P as ae,ac as Dt,z as It,I as Tt,s as oe,d as Ee,v as Oe,az as Ve,$ as Bt,E as Ce,V as Lt,aI as xe,aJ as we,D as Me,C as Rt,N as ut,a0 as Nt,aP as zt,aQ as Et,a6 as Ot,T as Ut,u as qe}from"./vendor-0c23bfd6.js";import{e as Y,z as De,A as Ue,s as At,t as Ae,v as Gt,j as Pt,B as Ge,q as me,D as ee,E as te,M as re,F as J,u as Yt,b as Ie,f as Pe,G as mt,H as Ze,J as Qe,K as jt,L as et,N as tt,O as de,a as Kt,P as Xt,w as Jt,k as Ht,Q as Wt,R as Ft,T as qt,U as Zt,n as Qt}from"./index-d4fc2d74.js";import{M as W,a as pe,s as eo,b as to}from"./chunk-bin-ui-next-6e1c6195.js";import{a as oo,g as pt,b as ao}from"./database.api-7a8953ff.js";import{d as no,a as so}from"./file-helper-e95db66d.js";import{s as lo,l as co}from"./template.api-c6380275.js";import{d as Ye,a as io,u as ro,r as uo,g as mo,m as po,b as vo,c as fo}from"./images.api-9d0ce6b5.js";import{p as _o,m as ho}from"./select-options-04fab100.js";import"./chunk-brace-b1f520b9.js";const go={name:"HeadLoading",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{toolbar:n}=t(o);return{loading:I(()=>n.value.loading)}}};function bo(o,t,n,e,l,s){return g(),S("div",{class:E(["loading-indicator",{loading:e.loading}])},null,2)}var yo=q(go,[["render",bo],["__scopeId","data-v-5475ad30"]]);function je(){const o=$e(),{schemaStore:t,storeToRefs:n}=Y(),{pageInfo:e,pageConfig:l,comps:s}=n(t);async function d(r="edit"){const c={id:e.value.id||o.query.id,name:e.value.name,pid:e.value.pid,status:r,layout:JSON.stringify(l.value),components:s.value.map(m=>De(m.apiData)?{name:m.alias,componentType:m.componentType,componentContent:JSON.stringify(m),componentDataType:Ue.static,modelId:"",x:[],y:[],drill:[],filters:[]}:{name:m.alias,componentType:m.componentType,componentDataType:m.apiData.type,modelId:m.apiData.config.modelId,componentContent:JSON.stringify(m),x:m.apiData.config.x,y:m.apiData.config.y,drill:[],filters:[]})};try{return await At(c)}catch(m){Ae("userSchemaStore/saveScreenData",m)}return""}async function i(){let r={};try{t.setGlobalLoading(!0);const c={pageInfo:{id:e.value.id,name:e.value.name||"\u770B\u677F\u9884\u89C8",pid:e.value.pid||"1"},pageConfig:l.value,comps:s.value};r=await oo(c)}catch{r={}}return t.setGlobalLoading(!1),r}return{saveScreenData:d,previewScreen:i}}function H(o){const{schemaStore:t}=Y();o?t.setGlobalLoading(o):setTimeout(()=>t.setGlobalLoading(o),300)}const Co={name:"save-screen",props:{modelValue:{type:Boolean},status:{type:String,default:"edit",validator:o=>["edit","audited"].includes(o)}},emits:["update:modelValue"],setup(o,t){const n=I({get:()=>o.modelValue,set:C=>t.emit("update:modelValue",C)}),{schemaStore:e,storeToRefs:l}=Y(),{pageInfo:s}=l(e),{saveScreenData:d}=je(),i=it(),r=$e(),c=T([]),m=T(null),h=T(!1),p=I(()=>window.location.origin+Gt(`/#/screen/${r.query.id}`));Pt().then(C=>{c.value=C.data?[C.data]:[]});const f=I(()=>o.status==="edit"?"\u4FDD\u5B58\u770B\u677F":"\u53D1\u5E03\u770B\u677F"),b=()=>{m.value.validate(async C=>{if(C){let $="";try{H(!0),h.value=!0,$=await d(o.status)}catch(w){Ae("save-screes/saveKanban",w)}H(!1),s.value.id=$,h.value=!1,n.value=!1,W.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0});let y=i.resolve({path:"/schema/screen",query:{id:$}});window.location.replace(y.href)}})},v=()=>{ge(()=>{Ge(p.value)&&W.success("\u590D\u5236\u53D1\u5E03\u5730\u5740\u6210\u529F!")})};return ve(()=>o.modelValue,C=>{C&&ge(()=>{m.value&&m.value.resetFields()})}),{formRef:m,pageInfo:s,dirTree:c,loading:h,visible:n,saveKanban:b,btnText:f,shareUrl:p,copyUrl:v}}},xo={class:"t-center"};function wo(o,t,n,e,l,s){const d=k("b-input"),i=k("b-form-item"),r=k("g-input"),c=k("b-button"),m=k("b-form"),h=k("b-modal");return g(),z(h,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=p=>e.visible=p),"append-to-body":"",title:e.btnText,top:"200px","custom-class":"schema-modal",onClose:t[3]||(t[3]=p=>e.visible=!1)},{default:x(()=>[u(m,{"label-width":"80px",ref:"formRef",model:e.pageInfo,"label-suffix":":"},{default:x(()=>[u(i,{label:"\u770B\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u770B\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:x(()=>[u(d,{modelValue:e.pageInfo.name,"onUpdate:modelValue":t[0]||(t[0]=p=>e.pageInfo.name=p)},null,8,["modelValue"])]),_:1}),n.status==="audited"&&o.$route.query.id?(g(),S(X,{key:0},[u(i,{label:"\u9884\u89C8\u5730\u5740"},{default:x(()=>[u(r,{modelValue:e.shareUrl,"onUpdate:modelValue":t[1]||(t[1]=p=>e.shareUrl=p),readonly:"",type:"textarea",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),u(i,null,{default:x(()=>[u(c,{type:"text",onClick:e.copyUrl},{default:x(()=>[N("\u590D\u5236\u9884\u89C8\u5730\u5740")]),_:1},8,["onClick"])]),_:1})],64)):P("",!0)]),_:1},8,["model"]),a("div",xo,[u(c,{type:"primary",onClick:e.saveKanban,loading:e.loading,style:{width:"200px"}},{default:x(()=>[N(Q(e.btnText),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["modelValue","title"])}var ko=q(Co,[["render",wo]]);const So={name:"save-template",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,t){const{schemaStore:n,storeToRefs:e}=Y(),{pageConfig:l,comps:s}=e(n),d=T(null),i=be({loading:!1,id:`temp_${me()}`,name:""}),r=I({get:()=>o.modelValue,set:p=>t.emit("update:modelValue",p)}),c=I(()=>({template:{id:i.id,name:i.name},pageConfig:l.value,comps:s.value})),m=()=>{d.value&&d.value.validate(async p=>{if(p){const f=c.value,b=JSON.stringify(f);no(b,`${f.template.id}.json`),W.success({message:"\u6A21\u677F\u6587\u4EF6\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})},h=async()=>{d.value&&d.value.validate(async p=>{if(p){try{H(!0),i.loading=!0;const f=c.value,b=f.template.name,v=JSON.stringify(f);await lo({name:b,content:v})}catch(f){Ae("save-template/saveAsTemplate",f)}H(!1),i.loading=!1,r.value=!1,W.success({message:"\u6A21\u677F\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})};return ve(()=>o.modelValue,p=>{p&&(d.value&&d.value.resetFields(),i.id=`temp_${me()}`)}),{formRef:d,formStatus:i,visible:r,downloadCfg:m,saveAsTemplate:h}}},$o={class:"t-center"};function Vo(o,t,n,e,l,s){const d=k("b-input"),i=k("b-form-item"),r=k("b-form"),c=k("b-button"),m=k("b-modal");return g(),z(m,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=h=>e.visible=h),"append-to-body":"",title:"\u4FDD\u5B58\u4E3A\u6A21\u677F",top:"200px","custom-class":"schema-modal",onClose:t[2]||(t[2]=h=>e.visible=!1)},{default:x(()=>[u(r,{"label-width":"80px",ref:"formRef",model:e.formStatus,"label-suffix":":"},{default:x(()=>[u(i,{label:"\u6A21\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:x(()=>[u(d,{modelValue:e.formStatus.name,"onUpdate:modelValue":t[0]||(t[0]=h=>e.formStatus.name=h)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a("div",$o,[u(c,{type:"primary",icon:"vertical-align-botto",transparent:"",style:{width:"120px"},onClick:e.downloadCfg},{default:x(()=>[N(" \u914D\u7F6E\u6587\u4EF6 ")]),_:1},8,["onClick"]),u(c,{type:"primary",icon:"save",style:{width:"120px"},loading:e.formStatus.loading,onClick:e.saveAsTemplate},{default:x(()=>[N(" \u4FDD\u5B58\u6A21\u677F ")]),_:1},8,["loading","onClick"])])]),_:1},8,["modelValue"])}var Mo=q(So,[["render",Vo]]);const Do={class:"header-container"},Io={class:"left-actions"},To={class:"screen-info"},Bo=a("span",null,"\u5206\u6790\u770B\u677F",-1),Lo=a("span",{style:{padding:"0 8px"}},"-",-1),Ro={class:"global-actions"},No={class:"head-btn"},zo={__name:"index",props:{backUrl:{type:String},backTarget:{type:String,default:"_self",validator:o=>["_self","_blank"].includes(o)},pageStatus:{type:Object,default:()=>({})}},setup(o,{expose:t}){const n=o,e=it(),{schemaStore:l,storeToRefs:s}=Y(),{pageInfo:d,toolbar:i}=s(l),{previewScreen:r}=je(),c=T(!1),m=T("edit"),h=T(!1),p=()=>{const $=n.backUrl||"/";if(n.backTarget==="_blank"){const y=e.resolve($);window.open(y.href,n.backTarget)}else pe.confirm({type:"warning",title:"\u786E\u5B9A\u8FD4\u56DE\u5217\u8868\u5417\uFF1F"}).then(()=>{e.push($),l.clearStore()}).catch(()=>{})},f=$=>$.type!=="application/json"?(W.warning("\u8BF7\u9009\u62E9\u6B63\u786E\u7684json\u914D\u7F6E\u6587\u4EF6"),!1):(so($).then(y=>{try{const w=JSON.parse(y),{comps:V,pageConfig:O}=w;l.loadScreenData({comps:V,pageConfig:O})}catch{console.warn("The imported file could not be converted to the correct JSON!")}}),!1),b=()=>{m.value="edit",c.value=!0},v=()=>{m.value="audited",c.value=!0},C=async()=>{const $=await r();let y=e.resolve({path:`/screen/preview/${$.pageInfo.id}`});window.open(y.href,"_blank")};return t({handleSaveScreen:b,handlePublish:v,handPreview:C}),($,y)=>{const w=k("b-icon"),V=k("b-tooltip"),O=k("b-space"),R=k("b-upload");return g(),S(X,null,[a("div",Do,[a("div",Io,[u(O,{size:"mini"},{default:x(()=>[u(V,{content:"\u7EC4\u4EF6","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:_(i).components}]),onClick:y[0]||(y[0]=U=>_(l).toggleCompsPanel())},[u(w,{name:"hourglass",class:E(["com-list-icon",{"is-rotate":!_(i).components}])},null,8,["class"])],2)]),_:1}),u(V,{content:"\u56FE\u5C42","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:_(i).layer}]),onClick:y[1]||(y[1]=U=>_(l).toggleLayerPanel())},[u(w,{name:"container"})],2)]),_:1}),u(V,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:_(i).config}]),onClick:y[2]||(y[2]=U=>_(l).toggleConfigPanel())},[u(w,{name:"control"})],2)]),_:1}),u(V,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:_(i).toolbox}]),onClick:y[3]||(y[3]=U=>_(l).toggleToolbox())},[u(w,{name:"shopping"})],2)]),_:1})]),_:1})]),a("div",To,[u(V,{content:"\u8FD4\u56DE","open-delay":500},{default:x(()=>[u(w,{name:"laptop",type:"button",onClick:p})]),_:1}),Bo,Lo,a("span",null,Q(_(d).name),1)]),a("div",Ro,[u(O,{size:"mini"},{default:x(()=>[u(V,{content:"\u5BFC\u5165json (\u4F1A\u8986\u76D6\u6240\u6709\u5185\u5BB9\uFF01)","open-delay":500},{default:x(()=>[u(R,{action:"/","show-upload-list":!1,"before-upload":f},{default:x(()=>[a("div",No,[u(w,{name:"Import"})])]),_:1})]),_:1}),u(V,{content:"\u4FDD\u5B58\u6A21\u677F","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:y[4]||(y[4]=U=>h.value=!0)},[u(w,{name:"Storedprocedure"})])]),_:1}),u(V,{content:"\u4FDD\u5B58","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:b},[u(w,{name:"save"})])]),_:1}),u(V,{content:"\u53D1\u5E03","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:v},[u(w,{name:"send"})])]),_:1}),u(V,{content:"\u9884\u89C8","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:C},[u(w,{name:"View"})])]),_:1})]),_:1})])]),u(yo),u(ko,{modelValue:c.value,"onUpdate:modelValue":y[5]||(y[5]=U=>c.value=U),status:m.value},null,8,["modelValue","status"]),u(Mo,{modelValue:h.value,"onUpdate:modelValue":y[6]||(y[6]=U=>h.value=U)},null,8,["modelValue"])],64)}}},he=be({x:0,y:0});function Ke(o={}){const{schemaStore:t,storeToRefs:n}=Y(),{contextMenu:e,selectedCom:l}=n(t),s=I(()=>{var m;return(m=l.value)==null?void 0:m.locked}),d=I(()=>{var m;return(m=l.value)==null?void 0:m.hided}),i=I(()=>({display:e.value.show?"block":"none",left:`${he.x+10}px`,top:`${he.y+10}px`,transform:document.documentElement.clientHeight-he.y<250?"translate(0px, -100%)":""})),r=m=>{m.preventDefault(),l.value&&(he.x=m.clientX,he.y=m.clientY,e.value.show=!0,ee(document,"click",c))},c=()=>{te(document,"click",c),o&&o.beforeClose&&o.beforeClose(),e.value.show=!1};return{showMenu:r,isLocked:s,isHided:d,contextMenu:e,contextMenuStyle:i}}const Eo={class:"layer-panel"},Oo={class:"layer-top"},Uo=a("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),Ao=a("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),Go=[Ao],Po={class:"layer-toolbar layer-toolbar-top"},Yo={class:"layer-manager-wrap"},jo=["title","onMousedown","onMouseenter","onDblclick"],Ko=["onUpdate:modelValue"],Xo={key:1,class:"layer-item-span"},Jo={class:"layer-item-text"},Ho=["title","onClick"],Wo=["title","onClick"],Fo={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{comps:e,toolbar:l,hoveredComId:s,selectedCom:d,renamingComId:i,isMultiSelect:r,selectedComs:c}=n(t),{showMenu:m}=Ke(),h=I(()=>!!d.value),p=I(()=>({opacity:d.value?1:.3}));function f(j){return r.value?c.value.map(D=>D.id).includes(j.id):!De(d.value)&&d.value.id===j.id}const b=I({get:()=>[...e.value].reverse(),set:j=>e.value=j.reverse()}),v=j=>{d.value&&t.moveCom({id:d.value.id,moveType:j})},C=()=>v(re.up),$=()=>v(re.down),y=()=>v(re.top),w=()=>v(re.bottom),V=j=>t.hoverCom(j),O=()=>t.hoverCom(""),R=j=>{const D=e.value.find(A=>A.id===j);D&&t.selectCom(D)},U=()=>t.selectCom();return(j,D)=>{const A=k("b-icon"),B=fe("focus");return g(),S("div",{class:E(["layer-panel-wp",{"is-hide":!_(l).layer}])},[a("div",Eo,[a("div",Oo,[Uo,a("div",{class:"layer-action",onClick:D[0]||(D[0]=M=>_(t).toggleLayerPanel(!1))},Go)]),a("div",Po,[a("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:E(["b-iconfont b-icon-arrowup toolbar-icon standard",_(h)]),style:F(_(p)),onClick:C},null,6),a("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:E(["b-iconfont b-icon-arrowdown toolbar-icon standard",_(h)]),style:F(_(p)),onClick:$},null,6),a("i",{title:"\u7F6E\u9876",class:E(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",_(h)]),style:F({transform:"rotate(180deg)",..._(p)}),onClick:y},null,6),a("i",{title:"\u7F6E\u5E95",class:E(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",_(h)]),style:F(_(p)),onClick:w},null,6)]),a("div",Yo,[u(_(Mt),Vt({modelValue:_(b),"onUpdate:modelValue":D[4]||(D[4]=M=>dt(b)?b.value=M:null),class:"drag-area","item-key":"id"},{animation:200}),{item:x(({element:M})=>[a("div",{title:M.alias,class:E(["layer-manager-item",[{hided:M.hided,locked:M.locked,hovered:M.id===_(s),selected:f(M)}]]),onMousedown:L=>R(M.id),onMouseenter:L=>V(M.id),onMouseleave:O,onDblclick:L=>_(t).renamingCom(M.id),onContextmenu:D[3]||(D[3]=L=>_(m)(L))},[u(A,{name:M.icon,size:"18"},null,8,["name"]),M.id===_(i)?le((g(),S("input",{key:0,"onUpdate:modelValue":L=>M.alias=L,class:"layer-item-input",onBlur:D[1]||(D[1]=L=>_(t).renamingCom("")),onKeydown:D[2]||(D[2]=ye(L=>_(t).renamingCom(""),["enter"]))},null,40,Ko)),[[rt,M.alias,void 0,{trim:!0}],[B]]):(g(),S("span",Xo,[a("span",Jo,Q(M.alias),1)])),a("i",{class:E(["b-iconfont",`b-icon-${M.hided?"eye-close":"eye"}`,"show-toggle-btn"]),title:M.hided?"\u663E\u793A":"\u9690\u85CF",onClick:L=>M.hided=!M.hided},null,10,Ho),a("i",{class:E(["b-iconfont",`b-icon-${M.locked?"lock":"unlock"}`,"show-toggle-btn"]),title:M.locked?"\u89E3\u9501":"\u9501\u5B9A",onClick:L=>M.locked=!M.locked},null,10,Wo)],42,jo)]),_:1},16,["modelValue"]),a("div",{class:"last-flex-item",onClick:U})])])],2)}}},qo={name:"VBasicBar",alias:"\u67F1\u56FE",img:J("basic-bar.svg")},Zo={name:"VHorizontalBar",alias:"\u6761\u5F62\u56FE",img:J("hori-basic-bar.svg")},Qo={name:"VCapsuleBar",alias:"\u80F6\u56CA\u67F1\u56FE",img:J("capsule-bar.svg")},ea={name:"VBasicLine",alias:"\u6298\u7EBF\u56FE",img:J("basic-line.svg")},ta={name:"VBasicArea",alias:"\u533A\u57DF\u56FE",img:J("basic-area.svg")},oa={name:"VBasicPie",alias:"\u997C\u56FE",img:J("basic-pie.svg")},aa={name:"VBasicRing",alias:"\u73AF\u56FE",img:J("basic-ring.svg")},na={name:"VBasicRadar",alias:"\u96F7\u8FBE\u56FE",img:J("basic-radar.svg")},sa={name:"VBasicMap",alias:"\u4E2D\u56FD\u5730\u56FE",img:J("2d-china.svg")},la={name:"VBasicMapEvo",alias:"\u6CB3\u5317\u7701\u5730\u56FE",img:J("basic-map-evo.svg")},ca={name:"VBasicScatter",alias:"\u6563\u70B9\u56FE",img:J("basic-scatter.svg")},ia={name:"VLineBasicScatter",alias:"\u6563\u70B9\u7EBF\u56FE",img:J("line-basic-scatter.svg")},ra={name:"VBasicBoxplot",alias:"\u76D2\u987B\u56FE",img:J("basic-boxplot.svg")},da={name:"VBasicFunnel",alias:"\u68AF\u5EA6\u56FE",img:J("basic-funnel.svg")},ua={name:"VBasicWordCloud",alias:"\u8BCD\u4E91\u56FE",img:J("basic-wordcloud.svg")},ma={name:"VBasicGauge",alias:"\u4EEA\u8868\u76D8",img:J("basic-gauge.svg")},pa={name:"VProgressCircle",alias:"\u8FDB\u5EA6\u73AF",img:J("pie-one-value.svg")},va={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:J("number-title-flop.svg")},fa={name:"VTimer",alias:"\u65F6\u95F4\u5668",img:J("timer.svg")},_a={name:"VSelect",alias:"\u4E0B\u62C9\u63A7\u4EF6",img:J("select.svg")},ha={name:"VMainTitle",alias:"\u6807\u9898",img:J("main-title.svg")},ga={name:"VBgBox",alias:"\u80CC\u666F\u5757",img:J("bg-box.svg")},ba={name:"VBorderBox",alias:"\u8FB9\u6846",img:J("border-box.svg")},ya={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:J("img.svg")},Ca={name:"VScrollTable",alias:"\u6EDA\u52A8\u8868\u683C",img:J("scroll-table.svg")},Se=[{type:"basic",name:"\u57FA\u7840",icon:"block",group:[],comps:[ha,ga,ya,ba]},{type:"analysis",name:"\u5206\u6790",icon:"barchart",group:[{name:"\u6307\u6807",comps:[va,pa]},{name:"\u67F1\u56FE",comps:[qo,Zo,Qo]},{name:"\u7EBF\u56FE",comps:[ea,ta]},{name:"\u997C\u56FE",comps:[oa,aa]},{name:"\u6563\u70B9\u56FE",comps:[ca,ia]},{name:"\u96F7\u8FBE\u56FE",comps:[na]},{name:"\u5730\u56FE",comps:[sa,la]},{name:"\u5176\u4ED6\u56FE\u8868",comps:[ra,da,ua,ma]}],comps:[]},{type:"control",name:"\u63A7\u4EF6",icon:"edit-square",group:[],comps:[_a,fa]},{type:"table",name:"\u8868\u683C",icon:"table",group:[],comps:[Ca]},{type:"images",name:"\u56FE\u7247",icon:"image",group:[],comps:[]},{type:"comps",name:"\u7EC4\u4EF6",icon:"CodeSandbox",group:[],comps:[]}];function xa(o){const t=[];return Se.forEach(n=>{t.push(...n.comps),n.group.forEach(e=>{t.push(...e.comps)})}),t.find(n=>n.name===o)}const wa={key:0,class:"comp-wrap"},ka=["title"],Sa={class:"inner"},$a=["onDragstart","onClick"],Va=["src"],Ma={class:"comp-item-text"},Da={__name:"comps",props:{comps:{type:Array,default:()=>[]}},emits:["dragstart","click"],setup(o,{emit:t}){const n=(l,s)=>t("dragstart",l,s),e=l=>t("click",l);return(l,s)=>o.comps.length>0?(g(),S("div",wa,[(g(!0),S(X,null,ae(o.comps,(d,i)=>(g(),S("div",{class:"comp-item",key:i,title:d.alias},[a("div",Sa,[a("div",{class:"comp-item-img",draggable:!0,onDragstart:r=>n(r,d.name),onClick:r=>e(d.name)},[a("img",{src:d.img},null,8,Va)],40,$a),a("div",Ma,Q(d.alias),1)])],8,ka))),128))])):P("",!0)}};var ot=q(Da,[["__scopeId","data-v-23a6401e"]]);function Xe(){const o=Dt(),t=T("");function n(e){t.value===e?t.value="":t.value=e}o.on("item-click",n),It("collapse",{activeGroupKey:t,collapseMitt:o})}function Ia(o){const t=Tt("collapse"),n=t==null?void 0:t.collapseMitt,e=I(()=>(t==null?void 0:t.activeGroupKey.value)===o.name);function l(s){n==null||n.emit("item-click",s)}return{isActive:e,triggerClick:l}}const Ta={class:"collapse-group"},Ba={class:"name"},La={class:"wrap-label"},Ra={key:1},Na={key:0,class:"wrap-edit"},za=["onClick"],Ea=["onClick"],Oa={class:"content"},Ua={__name:"collapse",props:{title:{type:String,required:!0},name:{type:[String,Number,Object],required:!0},canEdit:{type:Boolean,default:!1}},emits:["edit","remove"],setup(o,{emit:t}){const n=o,{isActive:e,triggerClick:l}=Ia(n),s=T(!1),d=T("");let i="";function r(){l(n.name)}function c(){s.value=!0,d.value=n.title,i=n.title}function m(b){const v=(b.target.value||"").trim();(!v||v===i)&&(s.value=!1)}function h(b){(b.target.value||"").trim()?p():s.value=!1}function p(){s.value=!1,t("edit",d.value)}const f=()=>t("remove");return(b,v)=>{const C=k("b-input"),$=k("b-icon"),y=k("b-collapse-transition"),w=fe("focus");return g(),S("div",Ta,[a("div",{class:E(["header",[{active:_(e)}]]),flex:"cross:center",onClick:r},[a("div",Ba,[a("div",La,[s.value?(g(),S("div",{key:0,class:"create-box",onClick:v[1]||(v[1]=oe(()=>{},["stop"]))},[le(u(C,{modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=V=>d.value=V),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"mini",style:{width:"150px",top:"-2px"},onBlur:m,onKeyup:ye(h,["enter"])},null,8,["modelValue","onKeyup"]),[[w]])])):(g(),S("div",Ra,Q(o.title),1))]),o.canEdit&&!s.value?(g(),S("span",Na,[a("i",{class:"b-iconfont b-icon-edit",onClick:oe(c,["stop"])},null,8,za),a("i",{class:"b-iconfont b-icon-delete",onClick:oe(f,["stop"])},null,8,Ea)])):P("",!0),a("span",{class:E(["wrap-arrow",[{active:_(e)}]])},[u($,{name:"right",size:"12"})],2)])],2),u(y,null,{default:x(()=>[le(a("div",Oa,[Ee(b.$slots,"default",{},void 0,!0)],512),[[Oe,_(e)]])]),_:3})])}}};var Je=q(Ua,[["__scopeId","data-v-ead41a62"]]);const Aa={class:"group-comps"},Ga={class:"comp-wrap"},Pa={key:0,class:"comp-item img-add"},Ya={class:"inner"},ja={class:"comp-item-img"},Ka={class:"inner"},Xa=["onDragstart","onClick"],Ja={key:0,class:"hover-layer"},Ha=["onClick"],Wa=["title"],Fa={__name:"images-item",props:{groupId:{type:String,required:!0}},emits:["dragstart","click"],setup(o,{emit:t}){const n=o,e=T([]),l=I(()=>!Ye.includes(n.groupId)),s=()=>io(n.groupId).then(m=>e.value=m);s();async function d(m){try{H(!0);const h=m.map(p=>({group:n.groupId,name:p.name,attr:{w:p.width,h:p.height},src:p.image}));await ro(h),s()}catch(h){console.log(h)}H(!1)}async function i({group:m,id:h}){try{H(!0),await uo(m,h),s()}catch(p){console.log(p)}H(!1)}const r=(m,h)=>t("dragstart",m,h),c=m=>t("click",m);return(m,h)=>{const p=k("g-upload"),f=fe("lazy");return g(),S("div",Aa,[a("div",Ga,[_(l)?(g(),S("div",Pa,[a("div",Ya,[a("div",ja,[u(p,{onUpload:d,multiple:""})])])])):P("",!0),(g(!0),S(X,null,ae(e.value,(b,v)=>(g(),S("div",{class:"comp-item",key:v},[a("div",Ka,[a("div",{class:E(["comp-item-img",{"can-edit":_(l)}]),draggable:!0,onDragstart:C=>r(C,b),onClick:C=>c(b)},[le(a("img",null,null,512),[[f,b.src]]),_(l)?(g(),S("div",Ja,[a("i",{class:"b-iconfont b-icon-delete-fill",title:"\u5220\u9664\u56FE\u7247",onClick:oe(C=>i(b),["stop"])},null,8,Ha)])):P("",!0)],42,Xa),a("div",{class:"comp-item-text",title:JSON.stringify(b,null,2)},Q(b.name),9,Wa)])]))),128))])])}}};var qa=q(Fa,[["__scopeId","data-v-bc0f8576"]]);const Za={class:"group-wrap"},Qa={class:"group-list"},en={key:0,class:"create-box"},tn={class:"create-group"},on={__name:"images-list",emits:["dragstart","click"],setup(o,{emit:t}){const n=T([]);Xe();const e=T({key:"",value:""}),l=be({create:!1,edit:!1}),s=()=>mo().then(f=>n.value=f);s();function d(){e.value={key:`group_images_${me()}`,value:""},l.create=!0}function i(f){if(!l.create)return;(f.target.value||"").trim()?m():l.create=!1}async function r(f,b){try{H(!0);const v={key:f.key,value:b};await po(v),s(),W.success("\u4FEE\u6539\u6210\u529F")}catch(v){console.log(v)}H(!1)}async function c(f){try{await pe.confirm({type:"error",title:"\u786E\u5B9A\u79FB\u9664\u5F53\u524D\u56FE\u7247\u5206\u7EC4\u5417\uFF1F"}),H(!0),await vo(f.key),s(),W.success("\u5220\u9664\u6210\u529F\uFF01")}catch(b){console.log(b)}H(!1)}async function m(){try{H(!0),await fo(e.value),s(),l.create=!1,W.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(f){console.log(f)}H(!1)}const h=(f,b)=>t("dragstart",f,b),p=f=>t("click",f);return(f,b)=>{const v=k("b-input"),C=k("b-scrollbar"),$=k("b-button"),y=fe("focus");return g(),S("div",Za,[a("div",Qa,[u(C,{native:""},{default:x(()=>[(g(!0),S(X,null,ae(n.value,w=>(g(),z(Je,{key:w.key,name:w.key,title:w.value,"can-edit":!_(Ye).includes(w.key),onEdit:V=>r(w,V),onRemove:V=>c(w)},{default:x(()=>[u(qa,{"group-id":w.key,onDragstart:h,onClick:p},null,8,["group-id"])]),_:2},1032,["name","title","can-edit","onEdit","onRemove"]))),128)),l.create?(g(),S("div",en,[le(u(v,{modelValue:e.value.value,"onUpdate:modelValue":b[0]||(b[0]=w=>e.value.value=w),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"small",onBlur:i,onKeyup:ye(i,["enter"])},null,8,["modelValue","onKeyup"]),[[y]])])):P("",!0)]),_:1})]),a("div",tn,[u($,{type:"primary",transparent:"",onClick:d},{default:x(()=>[N("\u521B\u5EFA\u56FE\u7247\u5206\u7EC4")]),_:1})])])}}};var an=q(on,[["__scopeId","data-v-74e445e6"]]);const vt=[];vt.map(o=>o.key);const ft="COMPS_GROUP",_t="COMPS_LIB",Te=async()=>Ve.getItem(ft),Be=async o=>Ve.setItem(ft,Ie(o)),He=async()=>Ve.getItem(_t),Ne=async o=>Ve.setItem(_t,Ie(o));async function ht(){try{const o=await Te();if(o)return o;const t=Ie(vt);return await Be(t),t}catch{return[]}}async function nn(o){try{const t=await Te();return t?(t.push(o),await Be(t),!0):!1}catch{return!1}}async function sn(o){try{const t=await Te();if(t){const n=Pe(t,o.key,"key");return t[n].value=o.value,await Be(t),o.key}return!1}catch{return!1}}async function ln(o){try{const t=await Te();if(t){const n=Pe(t,o,"key");return t.splice(n,1),await Be(t),!0}return!1}catch{return!1}}async function cn(o,t,n){try{const e={id:Yt(),group:o,comp:t,src:n},l=await He();return l?(l.push(e),await Ne(l),!0):(await Ne([e]),!1)}catch{return!1}}async function rn(o){try{const t=await He();return t?t.filter(n=>n.group===o):[]}catch{return[]}}async function dn(o,t){try{const n=await He();if(n){const e=n.filter(s=>s.group===o),l=Pe(e,t);return e.splice(l,1),await Ne(e),!0}return!1}catch{return!1}}const un={class:"group-comps"},mn={key:1,class:"comp-wrap"},pn={class:"inner"},vn=["onDragstart","onClick"],fn={class:"hover-layer"},_n=["onClick"],hn={class:"comp-item-text"},gn={__name:"comp-item",props:{groupId:{type:String,required:!0}},emits:["dragstart","click"],setup(o,{emit:t}){const n=o,e=T([]),l=()=>rn(n.groupId).then(r=>e.value=r);l();async function s({group:r,id:c}){try{H(!0),await dn(r,c),l()}catch(m){console.log(m)}H(!1)}const d=(r,c)=>t("dragstart",r,c),i=r=>t("click",r);return(r,c)=>{const m=k("b-empty"),h=fe("lazy");return g(),S("div",un,[e.value.length===0?(g(),z(m,{key:0},{default:x(()=>[N("\u6682\u65E0\u7EC4\u4EF6")]),_:1})):(g(),S("div",mn,[(g(!0),S(X,null,ae(e.value,(p,f)=>(g(),S("div",{class:"comp-item",key:f},[a("div",pn,[a("div",{class:"comp-item-img",draggable:!0,onDragstart:b=>d(b,p.comp),onClick:b=>i(p.comp)},[le(a("img",null,null,512),[[h,p.src]]),a("div",fn,[a("i",{class:"b-iconfont b-icon-delete-fill",title:"\u5220\u9664\u56FE\u7247",onClick:oe(b=>s(p),["stop"])},null,8,_n)])],40,vn),a("div",hn,Q(p.comp.alias),1)])]))),128))]))])}}};var bn=q(gn,[["__scopeId","data-v-c2ee8224"]]);const yn={class:"group-wrap"},Cn={class:"group-list"},xn={key:1,class:"create-box"},wn={class:"create-group"},kn={__name:"comp-list",emits:["dragstart","click"],setup(o,{emit:t}){const n=T([]);Xe();const e=T({key:"",value:""}),l=be({create:!1,edit:!1}),s=()=>ht().then(f=>n.value=f);s();function d(){e.value={key:`group_comp_${me()}`,value:""},l.create=!0}function i(f){if(!l.create)return;(f.target.value||"").trim()?m():l.create=!1}async function r(f,b){try{H(!0);const v={key:f.key,value:b};await sn(v),s(),W.success("\u4FEE\u6539\u6210\u529F")}catch(v){console.log(v)}H(!1)}async function c(f){try{H(!0),await pe.confirm({type:"error",title:"\u786E\u5B9A\u79FB\u9664\u5F53\u524D\u7EC4\u4EF6\u5E93\u5417\uFF1F"}),await ln(f.key),s(),W.success("\u5220\u9664\u6210\u529F\uFF01")}catch(b){console.log(b)}H(!1)}async function m(){try{H(!0),await nn(e.value),s(),l.create=!1,W.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(f){console.log(f)}H(!1)}const h=(f,b)=>t("dragstart",f,b),p=f=>t("click",f);return(f,b)=>{const v=k("b-empty"),C=k("b-input"),$=k("b-scrollbar"),y=k("b-button"),w=fe("focus");return g(),S("div",yn,[a("div",Cn,[u($,{native:""},{default:x(()=>[n.value.length===0?(g(),z(v,{key:0},{default:x(()=>[N("\u6682\u65E0\u7EC4\u4EF6\u5E93")]),_:1})):P("",!0),(g(!0),S(X,null,ae(n.value,V=>(g(),z(Je,{key:V.key,name:V.key,title:V.value,"can-edit":!_(Ye).includes(V.key),onEdit:O=>r(V,O),onRemove:O=>c(V)},{default:x(()=>[u(bn,{"group-id":V.key,onDragstart:h,onClick:p},null,8,["group-id"])]),_:2},1032,["name","title","can-edit","onEdit","onRemove"]))),128)),l.create?(g(),S("div",xn,[le(u(C,{modelValue:e.value.value,"onUpdate:modelValue":b[0]||(b[0]=V=>e.value.value=V),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"small",onBlur:i,onKeyup:ye(i,["enter"])},null,8,["modelValue","onKeyup"]),[[w]])])):P("",!0)]),_:1})]),a("div",wn,[u(y,{type:"primary",transparent:"",onClick:d},{default:x(()=>[N("\u521B\u5EFA\u7EC4\u4EF6\u5E93")]),_:1})])])}}};var Sn=q(kn,[["__scopeId","data-v-47c3cece"]]);const $n={class:"components-panel-wp"},Vn={class:"components-panel"},Mn=a("div",{class:"panel-title"},[a("span",{class:"panel-text"},"\u7EC4\u4EF6")],-1),Dn={class:"components-type"},In=["onClick"],Tn={class:"com-tab-title"},Bn=a("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),Ln=[Bn],Rn={class:"components-list-content"},Nn={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,toolbar:l,selectedCom:s}=n(t),d=T(-1);Xe();const i=I(()=>d.value===-1?[]:Se[d.value].group),r=I(()=>d.value===-1?[]:Se[d.value].comps);function c(y){t.toggleCompsPanel(!0),d.value=y}function m(y,w){y.dataTransfer.setData("normal-comp",w)}async function h(y){try{const w=mt(y);if(w.attr.x=Math.floor((e.value.width-w.attr.w)/2),w.attr.y=Math.floor((e.value.height-w.attr.h)/2),t.addCom({component:w}),t.selectCom(w),w.apiData&&w.apiData.type===Ue.static&&w.apiData.staticPath){const{data:V}=await pt(w.id,w.apiData.staticPath);s.value.apiData.config.data=JSON.stringify(V)}}catch(w){console.log(w)}}function p(y,w){y.dataTransfer.setData("image-comp",JSON.stringify(Ze(w)))}function f(y){const w=Ze(y);w.attr.x=Math.floor((e.value.width-w.attr.w)/2),w.attr.y=Math.floor((e.value.height-w.attr.h)/2),t.addCom({component:w}),t.selectCom(w)}function b(y,w){y.dataTransfer.setData("custom-comp",JSON.stringify(Qe(w)))}function v(y){const w=Qe(y);t.addCom({component:w}),t.selectCom(w)}function C(y){y.preventDefault(),y.stopPropagation(),y.dataTransfer.dropEffect="none"}function $(){l.value.components&&(t.toggleCompsPanel(!1),d.value=-1)}return(y,w)=>{const V=k("b-icon"),O=k("b-scrollbar");return g(),S("div",$n,[a("div",Vn,[Mn,a("div",{class:"components-panel-content",onDragover:C},[a("div",Dn,[u(O,{native:""},{default:x(()=>[(g(!0),S(X,null,ae(_(Se),(R,U)=>(g(),S("div",{class:E(["components-item",{active:d.value===U}]),key:U,onClick:j=>c(U)},[u(V,{class:"com-tab-icon",name:R.icon},null,8,["name"]),a("span",Tn,Q(R.name),1)],10,In))),128))]),_:1})])],32),a("div",{class:E(["components-list",{"is-hide":!_(l).components}])},[a("div",{class:"components-list-top"},[a("div",{class:"action",onClick:$},Ln)]),a("div",Rn,[u(O,{native:""},{default:x(()=>[(g(!0),S(X,null,ae(_(i),(R,U)=>(g(),z(Je,{key:U,name:U,title:R.name},{default:x(()=>[u(ot,{comps:R.comps,onDragstart:m,onClick:h},null,8,["comps"])]),_:2},1032,["name","title"]))),128)),u(ot,{comps:_(r),onDragstart:m,onClick:h},null,8,["comps"]),d.value===4?(g(),z(an,{key:0,onDragstart:p,onClick:f})):P("",!0),d.value===5?(g(),z(Sn,{key:1,onDragstart:b,onClick:v})):P("",!0)]),_:1})])],2)])])}}},at=o=>`${o}px`,nt=(o,t,n,e)=>{const l=o!=null?o:document.createElement("canvas");l.width=t*e,l.height=n*e,l.style.width=at(t),l.style.height=at(n);const s=l.getContext("2d");return s&&s.setTransform(e,0,0,e,0,0),l};class st{constructor(t,n){this.el=t,this.options={direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2,...n},this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:n}=this,{direction:e,width:l,height:s,ratio:d}=n,i=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,l),r=s;this.ruler.width=i,this.ruler.height=r;const c=nt(null,i,r,d);jt(c,"canvas-ruler"),t.appendChild(c),this.canvas=c,this.ctx=c.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:n,ruler:e}=this,{width:l,height:s}=e;t.beginPath(),t.fillStyle=n.bgColor,t.fillRect(0,0,l,s),t.closePath(),t.beginPath(),t.font=`${n.fontSize} ${n.fontFamily}`,t.textAlign="left",t.fillStyle=n.fontColor,t.strokeStyle=n.strokeStyle,t.lineWidth=n.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:n,ruler:e}=this,{width:l,height:s}=e,{offset:d,scale:i}=n,r=0,c=s/1.5,m=s/1.2;for(let h=0;h<=l;h+=1){const p=h-d;if(p<0)continue;let f=-1,b=-1;p%50===0?(f=Math.floor(p/i),b=r):p%25===0?b=c:p%5===0&&(b=m),b>=0&&(t.moveTo(h+.5,s+.5),t.lineTo(h+.5,b),f>-1&&t.fillText(`${f}`,h+2.5,s/1.5))}}setSize(t,n,e){const{el:l,options:s}=this;s.width=t,s.height=n,s.scale=e;const{direction:d,width:i,height:r,ratio:c}=s,m=Math.max(d==="TB"?l.offsetWidth:l.offsetHeight,i),h=r;this.ruler.width=m,this.ruler.height=h,nt(this.canvas,m,h,c),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const zn={name:"ruler",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{canvas:n}=t(o),e=T(null),l=T(null),s=T(null),d=T(null),i=T(!0),r=T(0),c=T(0),m=document.documentElement.clientWidth;Bt(()=>{if(e.value&&l.value){const p=Math.max(n.value.width,m);s.value?s.value.setSize(p,18,n.value.scale):s.value=new st(e.value,{direction:"TB",width:p,scale:n.value.scale}),d.value?d.value.setSize(n.value.height,18,n.value.scale):d.value=new st(l.value,{direction:"LR",width:n.value.height,scale:n.value.scale})}});const h=p=>{const f=p.target;r.value=f.scrollLeft,c.value=f.scrollTop};return Ce(()=>{const p=document.getElementById("canvas-wp");p==null||p.addEventListener("scroll",h)}),Lt(()=>{const p=document.getElementById("canvas-wp");p==null||p.removeEventListener("scroll",h)}),{visible:i,hRulerWpRef:e,vRulerWpRef:l,vScroll:c,hScroll:r}}},En=o=>(xe("data-v-5f454e16"),o=o(),we(),o),On={class:"canvas-ruler-wp"},Un=En(()=>a("div",{class:"ruler-corner"},null,-1));function An(o,t,n,e,l,s){return g(),S("div",On,[a("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:F(`transform: translateX(-${e.hScroll}px);`)},null,4),a("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:F(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),Un])}var Gn=q(zn,[["render",An],["__scopeId","data-v-5f454e16"]]);function lt(o){if(o={...o},o.rotate!==0){const t=o.width*et(o.rotate)+o.height*tt(o.rotate),n=(o.width-t)/2;o.left+=n,o.right=o.left+t;const e=o.height*et(o.rotate)+o.width*tt(o.rotate),l=(e-o.height)/2;o.top-=l,o.bottom=o.top+e,o.width=t,o.height=e}else o.bottom=o.top+o.height,o.right=o.left+o.width;return o}const Pn=5,Yn={name:"mark-line",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{comps:n,selectedCom:e,canvas:l,toolbox:s}=t(o),d=T([]),i=T(["xt","xc","xb","yl","yc","yr"]),r=T({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),c=()=>{Object.keys(r.value).forEach(C=>{r.value[C]=!1})};function m({key:C,value:$}){const y={left:"x",top:"y"};o.setShapeSingleStyle({key:y[C],value:$})}const h=(C,$)=>{const y=d.value,w=e.value,V=n.value.filter(D=>!D.hided),O=l.value.scale,R=lt(b(w.attr)),U=R.width/2,j=R.height/2;c(),V.forEach(D=>{if(D.id===w.id||D.locked||D.hided)return;const{top:A,left:B,bottom:M,right:L,width:G,height:K}=lt(b(D.attr)),se=G/2,ie=K/2,ne={top:[{isNearly:v(R.top,A),lineNode:y.xt,line:"xt",dragShift:A,lineShift:A},{isNearly:v(R.bottom,A),lineNode:y.xt,line:"xt",dragShift:A-R.height,lineShift:A},{isNearly:v(R.top+j,A+ie),lineNode:y.xc,line:"xc",dragShift:A+ie-j,lineShift:A+ie},{isNearly:v(R.top,M),lineNode:y.xb,line:"xb",dragShift:M,lineShift:M},{isNearly:v(R.bottom,M),lineNode:y.xb,line:"xb",dragShift:M-R.height,lineShift:M}],left:[{isNearly:v(R.left,B),lineNode:y.yl,line:"yl",dragShift:B,lineShift:B},{isNearly:v(R.right,B),lineNode:y.yl,line:"yl",dragShift:B-R.width,lineShift:B},{isNearly:v(R.left+U,B+se),lineNode:y.yc,line:"yc",dragShift:B+se-U,lineShift:B+se},{isNearly:v(R.left,L),lineNode:y.yr,line:"yr",dragShift:L,lineShift:L},{isNearly:v(R.right,L),lineNode:y.yr,line:"yr",dragShift:L-R.width,lineShift:L}]},_e=[],{rotate:Re}=R;Object.keys(ne).forEach(ue=>{ne[ue].forEach(ce=>{if(!ce.isNearly)return;const ke=Re!==0?p(ue,ce,R):ce.dragShift;m({key:ue,value:ke}),ce.lineNode.style[ue]=`${ce.lineShift*O+60}px`,_e.push(ce.line)})}),_e.length&&f(_e,C,$)})},p=(C,$,y)=>{const{w,h:V}=e.value.attr;return Math.round(C==="top"?$.dragShift-(V-y.height)/2:$.dragShift-(w-y.width)/2)},f=(C,$,y)=>{y?C.includes("yr")?r.value.yr=!0:C.includes("yc")?r.value.yc=!0:C.includes("yl")&&(r.value.yl=!0):C.includes("yl")?r.value.yl=!0:C.includes("yc")?r.value.yc=!0:C.includes("yr")&&(r.value.yr=!0),$?C.includes("xb")?r.value.xb=!0:C.includes("xc")?r.value.xc=!0:C.includes("xt")&&(r.value.xt=!0):C.includes("xt")?r.value.xt=!0:C.includes("xc")?r.value.xc=!0:C.includes("xb")&&(r.value.xb=!0)},b=C=>({left:C.x,top:C.y,width:C.w,height:C.h,rotate:C.rotate}),v=(C,$)=>Math.abs(C-$)<=Pn;return Ce(()=>{de.on("move",({isDownward:C,isRightward:$})=>{s.value.markLine&&h(C,$)}),de.on("unmove",()=>{c()})}),Me(()=>{de.off("move"),de.off("unmove")}),{lineRefs:d,lines:i,lineStatus:r}}},jn={class:"mark-line"};function Kn(o,t,n,e,l,s){return g(),S("div",jn,[(g(!0),S(X,null,ae(e.lines,d=>le((g(),S("div",{key:d,class:E(["line",[d.includes("x")?"xline":"yline",d]]),ref_for:!0,ref:i=>{e.lineRefs[d]=i}},null,2)),[[Oe,e.lineStatus[d]||!1]])),128))])}var Xn=q(Yn,[["render",Kn],["__scopeId","data-v-00d4450a"]]);const{schemaStore:gt}=Y(),Jn=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],ct=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],Hn=o=>{const t=(o+360)%360,n={};let e=-1;return Jn.forEach(l=>{const s=(l.angle+t)%360,d=ct.length,i=0;for(;i<d;){e=(e+1)%d;const r=ct[e];if(s<23||s>=338){n[l.direction]="nwse-resize";break}if(r.start<=s&&s<r.end){n[l.direction]=r.cursor;break}}}),n};function Wn(o,t,n,e,l,s){o==="t"?(s.h=Math.round(t.h+(n.y-e.y)/l),s.y=Math.round(t.y+(e.y-n.y)/l),s.h=Math.max(s.h,20)):o==="rt"?(s.h=Math.round(t.h+(n.y-e.y)/l),s.w=Math.round(t.w+(e.x-n.x)/l),s.y=Math.round(t.y+(e.y-n.y)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20)):o==="r"?(s.w=Math.round(t.w+(e.x-n.x)/l),s.w=Math.max(s.w,20)):o==="rb"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.w=Math.round(t.w+(e.x-n.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20)):o==="b"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.h=Math.max(s.h,20)):o==="lb"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.w=Math.round(t.w+(n.x-e.x)/l),s.x=Math.round(t.x+(e.x-n.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20)):o==="l"?(s.w=Math.round(t.w+(n.x-e.x)/l),s.x=Math.round(t.x+(e.x-n.x)/l),s.w=Math.max(s.w,20)):o==="lt"&&(s.h=Math.round(t.h+(n.y-e.y)/l),s.w=Math.round(t.w+(n.x-e.x)/l),s.x=Math.round(t.x+(e.x-n.x)/l),s.y=Math.round(t.y+(e.y-n.y)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20))}const bt=(o,t,n,e,l)=>{const s={...n.attr},d=Object.create(null),i=o.clientX,r=o.clientY;let c=!1;const m=p=>{const f=p.clientX,b=p.clientY,v=Math.round((f-i)/e/l)*l,C=Math.round((b-r)/e/l)*l;c=Math.abs(v)>=1||Math.abs(C)>=1,t?Wn(t,s,{x:i,y:r},{x:f,y:b},e,d):(d.x=s.x+v,d.y=s.y+C),n.attr={...n.attr,...d},ge().then(()=>{de.emit("move",{isDownward:b-r>0,isRightward:f-i>0})})},h=()=>{de.emit("unmove"),c&&gt.recordSnapshot(),te(document,"mousemove",m),te(document,"mouseup",h)};ee(document,"mousemove",m),ee(document,"mouseup",h)},Fn=(o,t,n,e)=>{bt(o,null,t,n,e)},qn=(o,t,n,e,l)=>{bt(o,t,n,e,l)},Zn=(o,t,n)=>{const e=t.getBoundingClientRect(),l=e.left+e.width/2,s=e.top+e.height/2,d=Math.atan2(s-o.clientY,l-o.clientX)*180/Math.PI-n.attr.rotate;let i=!1;const r=m=>{i=!0;const h=Math.atan2(s-m.clientY,l-m.clientX)*180/Math.PI-d,p=Math.round(h%360);n.attr.rotate=p<0?p+360:p},c=()=>{i&&gt.recordSnapshot(),te(document,"mousemove",r),te(document,"mouseup",c)};ee(document,"mousemove",r),ee(document,"mouseup",c)},Qn={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(o){const t=I(()=>({height:`${o.attr.y+60/o.scale}px`,borderLeftWidth:`${.9/o.scale}px`})),n=I(()=>({width:`${o.attr.x+60/o.scale}px`,borderTopWidth:`${.9/o.scale}px`})),e=I(()=>({fontSize:`${12/o.scale}px`,top:`-${6/o.scale}px`,left:`-${6/o.scale}px`}));return{topLineStyle:t,leftLineStyle:n,accountStyle:e}}},es={class:"nav-line"};function ts(o,t,n,e,l,s){return g(),S("div",es,[a("div",{class:"nav-line-top",style:F(e.topLineStyle)},null,4),a("div",{class:"nav-line-left",style:F(e.leftLineStyle)},null,4),a("div",{class:"nav-line-account",style:F(e.accountStyle)},Q(n.attr.x)+", "+Q(n.attr.y),5)])}var os=q(Qn,[["render",ts]]);const as={name:"dv-transform",components:{ReferLine:os},props:{data:{type:Object,required:!0}},setup(o){const t=Rt(),{showMenu:n}=Ke(),{schemaStore:e,storeToRefs:l}=Y(),{canvas:s,comps:d,pageConfig:i,selectedCom:r,hoveredComId:c,toolbox:m,spaceDown:h,isMultiSelect:p}=l(e),f=I(()=>c.value===o.data.id),b=I(()=>p.value?!1:!De(r.value)&&r.value.id===o.data.id),v=I(()=>({locked:o.data.locked,selected:b.value})),C=I(()=>({top:0,left:0,width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`,transform:`translate(${o.data.attr.x}px, ${o.data.attr.y}px)`})),$=I(()=>({"is-hide":!b.value||o.data.locked})),y=I(()=>({transform:`rotate(${o.data.attr.rotate}deg)`})),w=I(()=>({width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`})),V=I(()=>({display:o.data.hided?"none":"block"})),O=I(()=>Hn(o.data.attr.rotate)),R=I(()=>s.value.scale),U=I(()=>{const G=`scale(${1/R.value}, ${1/R.value})`;return{t:{name:"top",style:{cursor:O.value.t,transform:G}},rt:{name:"top-right",style:{cursor:O.value.rt,transform:G}},r:{name:"right",style:{cursor:O.value.r,transform:G}},rb:{name:"bottom-right",style:{cursor:O.value.rb,transform:G}},b:{name:"bottom",style:{cursor:O.value.b,transform:G}},lb:{name:"bottom-left",style:{cursor:O.value.lb,transform:G}},l:{name:"left",style:{cursor:O.value.l,transform:G}},lt:{name:"top-left",style:{cursor:O.value.lt,transform:G}}}}),j=()=>e.hoverCom(o.data.id),D=()=>e.hoverCom(""),A=()=>{e.selectCom(o.data)};return{comps:d,selectedCom:r,hoveredComId:c,toolbox:m,isHovered:f,isSelected:b,hideStyle:V,transformClass:v,transformStyle:C,handlerClass:$,handlerStyle:y,wrapperStyle:w,onEnter:j,onLeave:D,onMove:G=>{h.value||(G.stopPropagation(),G.preventDefault(),A(),!o.data.locked&&Fn(G,o.data,R.value,i.value.grid))},onZoom:(G,K)=>{A(),qn(G,K,o.data,R.value,i.value.grid)},onRotate:G=>{Zn(G,t.vnode.el,o.data)},points:U,scale:R,showMenu:n}}},ns={class:"dv-com"},ss=["onMousedown"],ls=["onMousedown"],cs=a("div",{class:"transform-bg"},null,-1),is={key:1,class:"b-iconfont b-icon-lock",title:"\u89E3\u9501"};function rs(o,t,n,e,l,s){const d=k("refer-line");return g(),S("div",{class:E(["dv-transform",e.transformClass]),style:F(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(g(),z(d,{key:0,attr:n.data.attr,scale:e.scale},null,8,["attr","scale"])):P("",!0),a("div",{class:E(["dv-scale",{hovered:e.isHovered}]),style:F(e.hideStyle),onMouseenter:t[2]||(t[2]=(...i)=>e.onEnter&&e.onEnter(...i)),onMouseleave:t[3]||(t[3]=(...i)=>e.onLeave&&e.onLeave(...i)),onMousedown:t[4]||(t[4]=(...i)=>e.onMove&&e.onMove(...i))},[a("div",{class:E(["transform-handler",e.handlerClass]),style:F(e.handlerStyle)},[a("div",ns,[Ee(o.$slots,"default"),a("div",{class:"dv-event-disable",style:F(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...i)=>e.showMenu&&e.showMenu(...i))},null,36)]),(g(!0),S(X,null,ae(e.points,(i,r)=>(g(),S(X,{key:r},[i.rotateStyle?(g(),S("i",{key:0,class:E(`${i.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"rotate-handler",style:F(i.rotateStyle),onMousedown:t[1]||(t[1]=oe((...c)=>e.onRotate&&e.onRotate(...c),["prevent","stop"]))},[a("span",{class:"control-point",style:F(i.style),onMousedown:oe(c=>e.onZoom(c,r),["prevent","stop"])},null,44,ss)],36)],2)):(g(),S("i",{key:1,class:E(`${i.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"control-point",style:F(i.style),onMousedown:oe(c=>e.onZoom(c,r),["prevent","stop"])},null,44,ls)],2))],64))),128)),cs],6)],38),n.data.locked?(g(),S("i",is)):P("",!0)],6)}var ds=q(as,[["render",rs]]);const us=["onClick"],ms=["onClick"],ps={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{undoDisable:e,redoDisable:l}=n(t),s=I(()=>t.toolbar.config?{right:"330px"}:{right:0}),d=()=>t.undo(),i=()=>t.redo();return(r,c)=>(g(),S("div",{class:"action-bar-wrap",style:F(_(s))},[a("i",{class:"action-btn b-iconfont b-icon-aim",title:"\u6700\u4F73\u753B\u5E03\u6BD4\u4F8B",onClick:c[0]||(c[0]=oe(m=>_(t).autoCanvasScale(),["stop"]))}),a("i",{class:"action-btn b-iconfont b-icon-icon-test",title:"1:1\u753B\u5E03\u5927\u5C0F",onClick:c[1]||(c[1]=oe(m=>_(t).setCanvasScale(100),["stop"]))}),a("i",{class:E(["action-btn b-iconfont b-icon-rollback",{disabled:_(e)}]),title:"\u64A4\u9500",onClick:oe(d,["stop"])},null,10,us),a("i",{class:E(["action-btn b-iconfont b-icon-rollback",{disabled:_(l)}]),title:"\u91CD\u505A",onClick:oe(i,["stop"]),style:{transform:"rotateY(180deg)"}},null,10,ms)],4))}};var vs=q(ps,[["__scopeId","data-v-293a1cf3"]]);const fs=["onMousedown"],_s={__name:"index",props:{x:Number,y:Number,width:Number,height:Number,showArea:Boolean},setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,canvas:l,selectedComs:s,areaData:d}=n(t);function i(r){let c=!1;const m={x:d.value.x,y:d.value.y},h=s.value.map(V=>V.attr),p=Object.create(null),f=[],b=r.clientX,v=r.clientY,C=l.value.scale,$=e.value.grid,y=V=>{const O=V.clientX,R=V.clientY,U=Math.round((O-b)/C/$)*$,j=Math.round((R-v)/C/$)*$;c=Math.abs(U)>=1||Math.abs(j)>=1,p.x=m.x+U,p.y=m.y+j,d.value={...d.value,...p},s.value.forEach((D,A)=>{f[A]={x:h[A].x+U,y:h[A].y+j},D.attr={...D.attr,...f[A]}})},w=()=>{c&&t.recordSnapshot(),te(document,"mousemove",y),te(document,"mouseup",w)};ee(document,"mousemove",y),ee(document,"mouseup",w)}return(r,c)=>le((g(),S("div",{style:F({left:o.x+"px",top:o.y+"px",width:o.width+"px",height:o.height+"px"}),class:"select-area",onMousedown:oe(i,["stop"])},null,44,fs)),[[Oe,o.showArea]])}};var hs=q(_s,[["__scopeId","data-v-8dc9f1ea"]]);const gs={class:"canvas-main"},bs=["onMousedown"],ys={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,spaceDown:l,canvas:s,selectedCom:d,comps:i,toolbox:r,getPanelOffsetLeft:c,getPanelOffsetTop:m,editorEL:h,areaData:p}=n(t),f=T(null),b=be({drag:!1,startX:0,startY:0});let v=0,C=0;const $=I(()=>({width:`${s.value.width}px`,height:`${s.value.height}px`})),y=I(()=>({position:"absolute",width:`${e.value.width}px`,height:`${e.value.height}px`,transform:`scale(${s.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${e.value.bgImage})`,backgroundColor:e.value.bgColor})),w=Kt(t.autoCanvasScale,50);async function V(B){B.preventDefault();try{const M=B.dataTransfer.getData("image-comp");if(M){const K=JSON.parse(M);O(B,K);return}const L=B.dataTransfer.getData("custom-comp");if(L){const K=JSON.parse(L);O(B,K);return}const G=B.dataTransfer.getData("normal-comp");if(G){const K=mt(G);if(O(B,K),K.apiData&&K.apiData.type===Ue.static&&K.apiData.staticPath){const{data:se}=await pt(K.id,K.apiData.staticPath);d.value.apiData.config.data=JSON.stringify(se)}}}catch(M){console.warn(M)}}function O(B,M){const{scale:L}=s.value,G=(B.clientX-c.value+f.value.scrollLeft)/L,K=(B.clientY-m.value+f.value.scrollTop)/L;M.attr.x=Math.round(G-M.attr.w/2),M.attr.y=Math.round(K-M.attr.h/2),t.addCom({component:M}),t.selectCom(M)}function R(B){B.preventDefault(),B.stopPropagation(),B.dataTransfer.dropEffect="copy"}function U(B){if(l.value){b.drag=!0;const M=B.clientX,L=B.clientY,G=s.value.scale,{scrollLeft:K,scrollTop:se,clientWidth:ie,scrollWidth:ne,clientHeight:_e,scrollHeight:Re}=f.value,ue=ie<ne||_e<Re,ce={left:K,top:se},ke=Fe=>{if(ue){const wt=Fe.clientX,kt=Fe.clientY,St=Math.round((wt-M)/G),$t=Math.round((kt-L)/G);f.value.scrollLeft=ce.left-St,f.value.scrollTop=ce.top-$t}},We=()=>{b.drag=!1,te(document,"mousemove",ke),te(document,"mouseup",We)};ee(document,"mousemove",ke),ee(document,"mouseup",We)}else t.selectCom()}function j(B){if(d.value||B.preventDefault(),l.value||B.target.className==="select-area")return;A();const M=h.value.getBoundingClientRect();v=M.x,C=M.y;const L=B.clientX,G=B.clientY;p.value.showArea=!0;const K=s.value.scale;p.value.x=(L-v)/K,p.value.y=(G-C)/K;const se=ne=>{p.value.width=Math.abs((ne.clientX-L)/K),p.value.height=Math.abs((ne.clientY-G)/K),ne.clientX<L&&(p.value.x=(ne.clientX-v)/K),ne.clientY<G&&(p.value.y=(ne.clientY-C)/K)},ie=ne=>{if(te(document,"mousemove",se),te(document,"mouseup",ie),ne.clientX===L&&ne.clientY===G){A();return}D()};ee(document,"mousemove",se),ee(document,"mouseup",ie)}function D(){const B=Xt(p.value,i.value);if(B.length===0){A();return}if(B.length===1){t.selectCom(B[0]),A();return}t.multiSelectComs(B)}function A(){p.value.showArea=!1,p.value.width=0,p.value.height=0}return Ce(()=>{ee(window,"resize",w),de.on("hideArea",A),t.getEditor(),w()}),Me(()=>{te(window,"resize",w)}),(B,M)=>(g(),S("div",gs,[a("div",{id:"canvas-wp",ref_key:"canvasWpRef",ref:f,class:"canvas-panel-wrap",onMousedown:oe(U,["stop"])},[a("div",{class:"screen-shot",style:F(_($))},[_(r).markLine?(g(),z(Xn,{key:0,style:F(_($))},null,8,["style"])):P("",!0),u(vs),u(Gn),a("div",{id:"canvas-components",class:"canvas-panel",style:F(_(y)),onDragover:R,onDrop:V,onMousedown:j},[(g(!0),S(X,null,ae(_(i),L=>(g(),z(ds,{key:L.id,data:L},{default:x(()=>[(g(),z(ut(L.name),{data:L,style:F({width:L.attr.w+"px",height:L.attr.h+"px",opacity:L.attr.opacity,transform:"translateZ(0px)"}),id:`component_${L.id}`},null,8,["data","style","id"]))]),_:2},1032,["data"]))),128)),u(hs,Nt(zt(_(p))),null,16)],36)],4)],40,bs)]))}};async function ze(o){try{const t=o.clientWidth,n=o.clientHeight;return await Et(o,{quality:.7,width:t,height:n})}catch(t){return console.error(t),""}}const Cs={name:"page-config",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{pageConfig:n}=t(o),e=T(""),l=T(!1),s=()=>{n.value.bgColor="#0d2a42",n.value.bgImage=""},d=()=>o.autoCanvasScale(),i=c=>{if(c!=="custom"){const m=c.split("x"),h=+m[0],p=+m[1];o.setScreenSize({width:h,height:p})}};async function r(){H(!0),W.warning("\u6B63\u5728\u622A\u53D6\u753B\u5E03\u7F29\u7565\u56FE\uFF0C\u8BF7\u52FF\u8FDB\u884C\u5176\u4ED6\u64CD\u4F5C\uFF01"),l.value=!0;const c=document.getElementById("canvas-components");c.style.top=0,c.style.left=0,o.setCanvasScale(100),setTimeout(async()=>{try{const m=await ze(c);n.value.thumbnail=m,W.success("\u622A\u53D6\u7F29\u7565\u56FE\u6210\u529F\uFF01")}catch(m){console.log(m)}c.style.top="60px",c.style.left="60px",o.autoCanvasScale(),l.value=!1,H(!1)},300)}return ve([()=>n.value.width,()=>n.value.height],()=>{const{width:c,height:m}=n.value;c===1920&&m===1080||c===2560&&m===1080||c===3440&&m===1080||c===3440&&m===1440||c===414&&m===736||c===375&&m===667||c===375&&m===812?e.value=`${c}x${m}`:e.value="custom"},{immediate:!0}),{screenLabel:e,onSizeChange:d,resetBGImage:s,pageConfig:n,pageMap:[{group:"web\u7AEF",data:Jt.map(c=>({value:`${c.width}x${c.height}`,label:c.label}))},{group:"\u79FB\u52A8\u8BBE\u5907",data:Ht.map(c=>({value:`${c.width}x${c.height}`,label:c.label}))},{group:"\u5176\u4ED6",data:[{value:"custom",label:"\u81EA\u5B9A\u4E49"}]}],sizeChange:i,createPreviewThumb:ze,createThumb:r,thumbLoading:l}}},yt=o=>(xe("data-v-644ec27b"),o=o(),we(),o),xs={class:"page-config-panel"},ws=yt(()=>a("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),ks={class:"page-config-content"},Ss={class:"page-config-wp"},$s={class:"page-config-wp"},Vs={class:"page-config-wp"},Ms={class:"image-thumb-wrap"},Ds=["src"],Is={key:1,class:"tip",flex:"dir:top main:center cross:center"},Ts=yt(()=>a("p",null,"\u6682\u672A\u622A\u53D6\u7F29\u7565\u56FE",-1)),Bs={class:"pt-5"};function Ls(o,t,n,e,l,s){const d=k("g-group-select"),i=k("g-field"),r=k("g-input-number"),c=k("g-color-picker"),m=k("g-image"),h=k("b-icon"),p=k("b-button"),f=k("b-scrollbar");return g(),S("div",xs,[ws,a("div",ks,[u(f,null,{default:x(()=>[a("div",Ss,[u(i,{label:"\u5C4F\u5E55\u8BBE\u7F6E"},{default:x(()=>[u(d,{modelValue:e.screenLabel,"onUpdate:modelValue":t[0]||(t[0]=b=>e.screenLabel=b),data:e.pageMap,onChange:e.sizeChange},null,8,["modelValue","data","onChange"])]),_:1}),u(i,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:x(()=>[u(r,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[1]||(t[1]=b=>e.pageConfig.width=b),label:"\u5BBD\u5EA6",min:375,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),u(r,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[2]||(t[2]=b=>e.pageConfig.height=b),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),u(i,{label:"\u80CC\u666F\u989C\u8272"},{default:x(()=>[u(c,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[3]||(t[3]=b=>e.pageConfig.bgColor=b)},null,8,["modelValue"])]),_:1}),u(i,{label:"\u80CC\u666F\u9884\u8BBE",tooltip:"\u53EF\u4EE5\u52A0\u8F7D\u5BF9\u5E94\u9884\u8BBE\u7684\u56FE\u7247\u80CC\u666F"},{default:x(()=>[u(m,{"ignore-group-keys":["header","box","decoration","widget"],"show-resize":!1,"show-clear":"",onClear:e.resetBGImage,modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[4]||(t[4]=b=>e.pageConfig.bgImage=b)},null,8,["onClear","modelValue"])]),_:1})]),a("div",$s,[u(i,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:x(()=>[u(r,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[5]||(t[5]=b=>e.pageConfig.grid=b),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})]),a("div",Vs,[u(i,{label:"\u7F29\u7565\u56FE",tooltip:"\u622A\u53D6\u5F53\u524D\u753B\u5E03\u5B58\u4E3A\u7F29\u7565\u56FE"},{default:x(()=>[a("div",Ms,[e.pageConfig.thumbnail?(g(),S("img",{key:0,src:e.pageConfig.thumbnail,alt:""},null,8,Ds)):(g(),S("div",Is,[u(h,{name:"image",size:"52"}),Ts]))]),a("div",Bs,[u(p,{type:"primary",size:"small",loading:e.thumbLoading,onClick:e.createThumb},{default:x(()=>[N(" \u622A\u53D6 ")]),_:1},8,["loading","onClick"]),u(p,{size:"small",loading:e.thumbLoading,onClick:t[6]||(t[6]=b=>e.pageConfig.thumbnail="")},{default:x(()=>[N(" \u6E05\u9664 ")]),_:1},8,["loading"])])]),_:1})])]),_:1})])])}var Rs=q(Cs,[["render",Ls],["__scopeId","data-v-644ec27b"]]);const{schemaStore:Ct,storeToRefs:Ns}=Y(),{selectedCom:zs}=Ns(Ct),Es={name:"config-title",props:{comName:{type:String},comAlias:{type:String},com:{type:Object,default:()=>({})},showCfg:{type:Boolean,default:!1}},emits:["update:com"],setup(o){const t=T(!1),n=T(""),e=I(()=>{const r=xa(o.comName);return r?r.name:o.comName}),l=()=>{t.value=!0,n.value=JSON.stringify(o.com,null,2)},s=()=>{Ge(JSON.stringify(o.com)),W.success("\u5DF2\u590D\u5236\u914D\u7F6E\u9879\u81F3\u526A\u5207\u677F"),t.value=!1},d=()=>{try{const r=JSON.parse(n.value);n.value=JSON.stringify(r,null,2),i(r),W.success("\u56FE\u8868\u5E94\u7528\u6210\u529F\uFF01"),t.value=!1}catch{W.error("\u914D\u7F6E\u9879\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u68C0\u67E5\u540E\u518D\u5E94\u7528\u914D\u7F6E\uFF01")}};function i(r){const c=zs.value.id;Ct.replaceCom(c,r)}return{openDetail:l,compJson:n,comTitle:e,copyCom:s,putJson:d,detailVisible:t}}},Os=o=>(xe("data-v-133b1084"),o=o(),we(),o),Us={class:"com-title-wp"},As={class:"com-title"},Gs={class:"title-name"},Ps={class:"alias-name"},Ys={class:"version-tag"},js=Os(()=>a("span",null,"\u914D\u7F6E\u9879",-1)),Ks={class:"data-editor",style:{margin:"0"}},Xs={class:"t-right pt-8"};function Js(o,t,n,e,l,s){const d=k("b-icon"),i=k("b-ace-editor"),r=k("b-button"),c=k("b-modal");return g(),S("div",Us,[a("div",As,[a("div",Gs,[a("span",Ps,Q(n.comAlias),1)]),a("div",Ys,[a("span",null,Q(e.comTitle),1)])]),Ee(o.$slots,"default",{},()=>[n.showCfg?(g(),S("div",{key:0,class:"search-config",onClick:t[0]||(t[0]=(...m)=>e.openDetail&&e.openDetail(...m)),title:"\u67E5\u770B\u914D\u7F6E\u9879"},[u(d,{name:"filesearch",size:"14"}),js])):P("",!0)],!0),u(c,{modelValue:e.detailVisible,"onUpdate:modelValue":t[2]||(t[2]=m=>e.detailVisible=m),title:`[${n.comAlias}] \u914D\u7F6E\u9879 `,"append-to-body":"",top:"60px","custom-class":"schema-modal"},{default:x(()=>[a("div",Ks,[u(i,{modelValue:e.compJson,"onUpdate:modelValue":t[1]||(t[1]=m=>e.compJson=m),theme:"tomorrow_night",wrap:"",styles:{border:"none"}},null,8,["modelValue"])]),a("div",Xs,[u(r,{size:"small",type:"primary",icon:"snippets",onClick:e.putJson},{default:x(()=>[N("\u5E94\u7528\u914D\u7F6E\u9879")]),_:1},8,["onClick"]),u(r,{size:"small",type:"primary",icon:"file-copy",onClick:e.copyCom},{default:x(()=>[N(" \u590D\u5236\u914D\u7F6E\u9879 ")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"])])}var Le=q(Es,[["render",Js],["__scopeId","data-v-133b1084"]]);const Hs={name:"data-center-panel",components:{ConfigTitle:Le,SourcePanel:Wt(()=>Ot(()=>import("./source-panel-27b90698.js"),["static/js/source-panel-27b90698.js","static/css/source-panel-9456a5cd.css","static/js/vendor-0c23bfd6.js","static/css/vendor-2b79d43b.css","static/js/chunk-brace-b1f520b9.js","static/js/index-d4fc2d74.js","static/css/index-058521fd.css","static/js/chunk-bin-ui-next-6e1c6195.js","static/css/chunk-bin-ui-next-233b4550.css"]))},setup(){const{schemaStore:o,storeToRefs:t}=Y(),{selectedCom:n}=t(o),e=I(()=>Object.keys(n.value.apiData));return{selectedCom:n,dataKeys:e}}},Ws={class:"data-center-panel"},Fs={class:"scroll-container"},qs={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"};function Zs(o,t,n,e,l,s){const d=k("config-title"),i=k("source-panel"),r=k("b-empty"),c=k("b-scrollbar");return g(),S("div",Ws,[u(d,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),a("div",Fs,[u(c,{native:""},{default:x(()=>[e.dataKeys.length>0?(g(),z(i,{key:0})):(g(),S("div",qs,[u(r,null,{default:x(()=>[N("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E")]),_:1})]))]),_:1})])])}var Qs=q(Hs,[["render",Zs]]);const el={class:"basic-setting-wp"},xt={__name:"basic-setting",props:{attr:{type:Object,required:!0},readonly:{type:Boolean,default:!1}},emits:["update:attr"],setup(o,{emit:t}){const n=o,e=I({get:()=>n.attr,set:r=>t("update:attr",r)}),{schemaStore:l,storeToRefs:s}=Y(),{curComIsGroup:d,isMultiSelect:i}=s(l);return(r,c)=>{const m=k("g-input-number"),h=k("g-field"),p=k("g-slider"),f=k("b-button"),b=k("b-button-group");return g(),S("div",el,[u(h,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{default:x(()=>[u(m,{modelValue:_(e).w,"onUpdate:modelValue":c[0]||(c[0]=v=>_(e).w=v),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(m,{modelValue:_(e).h,"onUpdate:modelValue":c[1]||(c[1]=v=>_(e).h=v),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),u(h,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:x(()=>[u(m,{modelValue:_(e).x,"onUpdate:modelValue":c[2]||(c[2]=v=>_(e).x=v),label:"X",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(m,{modelValue:_(e).y,"onUpdate:modelValue":c[3]||(c[3]=v=>_(e).y=v),label:"Y",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),_(i)?P("",!0):(g(),z(h,{key:0,label:"\u65CB\u8F6C\u89D2\u5EA6"},{default:x(()=>[u(p,{modelValue:_(e).rotate,"onUpdate:modelValue":c[4]||(c[4]=v=>_(e).rotate=v),min:0,max:360,step:1},null,8,["modelValue"])]),_:1})),_(i)||_(d)?P("",!0):(g(),z(h,{key:1,label:"\u900F\u660E\u5EA6"},{default:x(()=>[u(p,{modelValue:_(e).opacity,"onUpdate:modelValue":c[5]||(c[5]=v=>_(e).opacity=v),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})),_(i)?P("",!0):(g(),z(h,{key:2,label:"\u4F4D\u7F6E"},{default:x(()=>[u(b,null,{default:x(()=>[(g(!0),S(X,null,ae(_(_o),v=>(g(),z(f,{key:v.value,size:"mini",title:v.label,onClick:C=>_(l).doAdsorption(v.value)},{default:x(()=>[a("i",{class:E(`iconfont-align b-icon-${v.value}-vs`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})),_(i)?(g(),z(h,{key:3,label:"\u5BF9\u9F50"},{default:x(()=>[u(b,null,{default:x(()=>[(g(!0),S(X,null,ae(_(ho),v=>(g(),z(f,{key:v.value,size:"mini",title:v.label,onClick:C=>_(l).doAlign(v.value)},{default:x(()=>[a("i",{class:E(`iconfont-align b-icon-${v.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})):P("",!0),_(i)||_(d)?(g(),z(h,{key:4,label:"\u7EC4\u5408\u62C6\u5206"},{default:x(()=>[u(b,null,{default:x(()=>[u(f,{size:"mini",icon:"group",disabled:!_(i),onClick:c[6]||(c[6]=v=>_(l).group())},{default:x(()=>[N(" \u7EC4\u5408 ")]),_:1},8,["disabled"]),u(f,{size:"mini",icon:"ungroup",disabled:!_(d),onClick:c[7]||(c[7]=v=>_(l).ungroup())},{default:x(()=>[N(" \u62C6\u5206 ")]),_:1},8,["disabled"])]),_:1})]),_:1})):P("",!0)])}}},tl={class:"setting-panel"},ol={class:"setting-panel-content"},al={class:"scroll-container"},nl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{selectedCom:e}=n(t);return(l,s)=>{const d=k("b-scrollbar");return g(),S("div",tl,[u(Le,{"com-name":_(e).name,"com-alias":_(e).alias,com:_(e),"show-cfg":""},null,8,["com-name","com-alias","com"]),a("div",ol,[a("div",al,[u(d,null,{default:x(()=>[(g(),z(xt,{key:`${_(e).id}'_basic-setting`,attr:_(e).attr},null,8,["attr"])),(g(),z(ut(_(e).name+"Config"),{key:_(e).id,data:_(e)},null,8,["data"]))]),_:1})])])])}}},sl={class:"setting-panel"},ll={class:"setting-panel-content"},cl={class:"scroll-container"},il={__name:"multi-setting",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{areaData:e}=n(t),l=I(()=>e.value.showArea),s=I(()=>({x:e.value.x,y:e.value.y,w:e.value.width,h:e.value.height}));return(d,i)=>{const r=k("b-scrollbar");return g(),S("div",sl,[u(Le,{"com-alias":"\u591A\u9009\u533A\u57DF"}),a("div",ll,[a("div",cl,[u(r,null,{default:x(()=>[u(xt,{attr:_(s),readonly:_(l)},null,8,["attr","readonly"])]),_:1})])])])}}},rl={style:{margin:"-16px",padding:"10px"}},dl={__name:"EventParamsModal",props:{modelValue:{type:Boolean,default:!1},params:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:t}){const n=o,e=I({get:()=>n.modelValue,set:s=>t("update:modelValue",s)}),l=[{title:"\u53C2\u6570\u540D",key:"desc"},{title:"\u53C2\u6570Key",key:"name"},{title:"\u53C2\u6570\u7C7B\u578B",key:"type"}];return(s,d)=>{const i=k("b-table"),r=k("b-modal");return g(),z(r,{modelValue:_(e),"onUpdate:modelValue":d[0]||(d[0]=c=>dt(e)?e.value=c:null),title:"\u53C2\u6570\u4FE1\u606F",width:"750px","append-to-body":"","custom-class":"schema-modal"},{default:x(()=>[a("div",rl,[u(i,{columns:l,data:o.params,size:"small",border:""},null,8,["data"])])]),_:1},8,["modelValue"])}}},ul={flex:"main:justify cross:center"},ml={__name:"trigger-config",props:{eventList:{type:Array,default:()=>Ft},events:{type:Object,default:()=>({})}},setup(o){const t=o,n=I(()=>t.events),e=I(()=>{let i=!1;return t.eventList.forEach(r=>{if(!De(n.value[r])){i=!0;return}}),i}),l=T([]),s=T(!1);function d(i){l.value=i,s.value=!0}return(i,r)=>{const c=k("b-checkbox"),m=k("b-button"),h=k("g-field"),p=k("g-field-collapse");return _(e)?(g(),z(p,{key:0,label:"\u89E6\u53D1\u4E8B\u4EF6","default-open":""},{default:x(()=>[(g(!0),S(X,null,ae(o.eventList,f=>(g(),S(X,{key:f},[_(n)[f]?(g(),z(h,{key:0,label:_(n)[f].name},{default:x(()=>[a("div",ul,[u(c,{modelValue:_(n)[f].enable,"onUpdate:modelValue":b=>_(n)[f].enable=b},null,8,["modelValue","onUpdate:modelValue"]),u(m,{type:"text",title:"\u67E5\u770B\u4E8B\u4EF6\u53C2\u6570",onClick:b=>d(_(n)[f].params)},{default:x(()=>[N(" \u67E5\u770B ")]),_:2},1032,["onClick"])])]),_:2},1032,["label"])):P("",!0)],64))),128)),u(dl,{modelValue:s.value,"onUpdate:modelValue":r[0]||(r[0]=f=>s.value=f),params:l.value},null,8,["modelValue","params"])]),_:1})):P("",!0)}}},pl={class:"series-title",style:{top:"-8px"}},vl={style:{width:"50%","padding-right":"8px"}},fl={style:{width:"50%","padding-right":"8px"}},_l={key:0,style:{"min-height":"80px"},flex:"main:center cross:center"},hl={__name:"response-config",props:{compId:{type:String,default:""},events:{type:Object,default:()=>({})}},setup(o){const t=o,n=I(()=>t.events),e=I(()=>Object.keys(n.value).includes("onEvents")),l=I(()=>qt.value.filter(h=>h.compId!==t.compId).map(h=>({value:h.compId,label:h.compName}))),s=I(()=>{const h=n.value.actions;return Object.keys(h).map(p=>({value:p,label:h[p].title}))});function d(h){return Zt.value.filter(p=>p.eventName.includes(h)).map(p=>({value:p.eventName,label:p.title}))}function i(){n.value.onEvents.push({eventSource:"",eventName:"",actionName:"",actionParams:[],register:!1})}function r(h){if(h.eventSource===""){W.warning("\u8BF7\u9009\u62E9\u4E8B\u4EF6\u6E90\uFF01");return}if(h.eventName===""){W.warning("\u8BF7\u7ED1\u5B9A\u4E8B\u4EF6\uFF01");return}if(h.actionName===""){W.warning("\u8BF7\u7ED1\u5B9A\u52A8\u4F5C\uFF01");return}h.register=!0}function c(h,p){p.register?p.register=!1:n.value.onEvents.splice(h,1)}function m(h,p){const f=n.value.actions[h];f&&(p.actionParams=Ie(f.params))}return(h,p)=>{const f=k("b-icon"),b=k("b-button"),v=k("g-select"),C=k("g-field"),$=k("g-field-collapse");return _(e)?(g(),z($,{key:0,label:"\u54CD\u5E94\u4E8B\u4EF6","default-open":""},{add:x(()=>[u(b,{type:"text",title:"\u65B0\u589E\u4E00\u4E2A\u54CD\u5E94\u4E8B\u4EF6",onClick:i},{default:x(()=>[u(f,{name:"plus",size:"16"})]),_:1})]),default:x(()=>[(g(!0),S(X,null,ae(_(n).onEvents,(y,w)=>(g(),z(C,{key:w,label:"\u4E8B\u4EF6","label-width":"85px",flat:""},{label:x(()=>[a("div",pl,[a("span",null,"\u4E8B\u4EF6"+Q(w+1),1)])]),default:x(()=>[u(v,{modelValue:y.eventSource,"onUpdate:modelValue":V=>y.eventSource=V,data:_(l),disabled:y.register,label:"\u4E8B\u4EF6\u6E90"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),y.eventSource!==""?(g(),S(X,{key:0},[u(v,{modelValue:y.eventName,"onUpdate:modelValue":V=>y.eventName=V,data:d(y.eventSource),disabled:y.register,inline:"",label:"\u7ED1\u5B9A\u4E8B\u4EF6"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),u(v,{modelValue:y.actionName,"onUpdate:modelValue":V=>y.actionName=V,data:_(s),disabled:y.register,inline:"",label:"\u7ED1\u5B9A\u52A8\u4F5C",onChange:V=>m(y.actionName,y)},null,8,["modelValue","onUpdate:modelValue","data","disabled","onChange"])],64)):P("",!0),a("span",vl,[u(b,{size:"small",style:{width:"100%"},type:"primary",disabled:y.register,onClick:V=>r(y)},{default:x(()=>[N(" \u6CE8\u518C\u4E8B\u4EF6 ")]),_:2},1032,["disabled","onClick"])]),a("span",fl,[u(b,{size:"small",style:{width:"100%"},onClick:V=>c(w,y)},{default:x(()=>[N(Q(y.register?"\u53D6\u6D88":"\u5220\u9664"),1)]),_:2},1032,["onClick"])])]),_:2},1024))),128)),_(n).onEvents.length===0?(g(),S("div",_l," \u6682\u65E0\u54CD\u5E94\u4E8B\u4EF6 ")):P("",!0)]),_:1})):P("",!0)}}},gl={class:"events-panel"},bl={class:"events-panel-content"},yl=a("div",{class:"data-result-title"},"\u4E8B\u4EF6\u914D\u7F6E",-1),Cl={class:"scroll-container"},xl={class:"setting-panel-gui"},wl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{selectedCom:e}=n(t),l=I(()=>e.value.events);return(s,d)=>{const i=k("b-scrollbar");return g(),S("div",gl,[u(Le,{"com-name":_(e).name,"com-alias":_(e).alias,com:_(e)},null,8,["com-name","com-alias","com"]),a("div",bl,[yl,a("div",Cl,[u(i,null,{default:x(()=>[a("div",xl,[u(ml,{events:_(l)},null,8,["events"]),u(hl,{events:_(l),"comp-id":_(e).id},null,8,["events","comp-id"])])]),_:1})])])])}}},kl={class:"config-panel"},Sl={key:0,class:"page-config-panel"},$l={class:"page-config-top"},Vl={class:"tabs-wrapper"},Ml={key:0,class:"page-config-content"},Dl={key:1,class:"page-config-content"},Il={style:{height:"100%"}},Tl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{toolbar:e,selectedCom:l,isMultiSelect:s}=n(t),d=T(0),i=r=>{s.value&&r>0||d.value!==r&&(d.value=r)};return ve(()=>l.value,()=>{d.value=0}),(r,c)=>{const m=k("b-icon"),h=k("b-tooltip");return g(),S("div",{class:E(["config-panel-wp",{"is-hide":!_(e).config}])},[a("div",kl,[_(l)||_(s)?(g(),S("div",Sl,[a("div",$l,[a("div",Vl,[a("div",{class:E(["tab-item",{active:d.value===0}]),onClick:c[0]||(c[0]=p=>i(0))},[u(h,{content:"\u914D\u7F6E"},{default:x(()=>[u(m,{name:"control",size:"20"})]),_:1})],2),a("div",{class:E(["tab-item",{active:d.value===1}]),onClick:c[1]||(c[1]=p=>i(1))},[u(h,{content:"\u6570\u636E"},{default:x(()=>[u(m,{name:"cloud-server",size:"22"})]),_:1})],2),a("div",{class:E(["tab-item",{active:d.value===2}]),onClick:c[2]||(c[2]=p=>i(2))},[u(h,{content:"\u4E8B\u4EF6"},{default:x(()=>[u(m,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),_(s)?(g(),S("div",Ml,[u(il)])):(g(),S("div",Dl,[a("div",Il,[d.value===0?(g(),z(nl,{key:_(l).id})):P("",!0),d.value===1?(g(),z(Qs,{key:_(l).id})):P("",!0),d.value===2?(g(),z(wl,{key:_(l).id})):P("",!0)])]))])):(g(),z(Rs,{key:1}))])],2)}}};const Bl={class:"toolbox-panel",flex:"main:justify"},Ll={style:{width:"500px"},flex:""},Rl=a("i",{class:"action-btn b-iconfont b-icon-rollback"},null,-1),Nl=a("i",{class:"action-btn b-iconfont b-icon-rollback",style:{transform:"rotateY(180deg)"}},null,-1),zl=a("div",null,null,-1),El={class:"btn-box"},Ol={class:"btn-box"},Ul={class:"ctrl-box",flex:"cross:center"},Al={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{toolbar:e,toolbox:l,undoDisable:s,redoDisable:d}=n(t),i=T(!1),r=T(null),c=()=>{pe.confirm({type:"error",title:"\u786E\u8BA4\u6E05\u7A7A\u753B\u5E03\u5417\uFF1F\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"}).then(()=>{t.clearScreen()}).catch(()=>{})},m=()=>t.undo(),h=()=>t.redo();function p(){i.value=!0,ge(()=>{r.value&&r.value.addEventListener("paste",f),r.value.focus(),r.value.placeholder="\u7C98\u8D34\u56FE\u8868\u914D\u7F6E"})}function f(b){const v=b.clipboardData.getData("Text");try{const C=JSON.parse(v);((C==null?void 0:C.type)==="com"||(C==null?void 0:C.type)==="group")&&(C.id=`${C.name}_${me()}`,C.name==="Group"&&C.components.forEach($=>{$.id=`${$.name}_${me()}`}),t.addCom({component:C}),W.success("\u7C98\u8D34\u56FE\u8868\u6210\u529F\uFF01"))}catch(C){console.log(C),W.error("\u7C98\u8D34\u7684\u5185\u5BB9\u4E0D\u662F\u56FE\u8868\u7EC4\u4EF6\uFF01")}setTimeout(()=>{r.value.value="",i.value=!1,r.value.removeEventListener("paste",f)},100)}return(b,v)=>{const C=k("b-button"),$=k("b-switch");return g(),S("div",{class:E(["toolbox-panel-wp",{"is-hide":!_(e).toolbox}])},[a("div",Bl,[a("div",Ll,[u(C,{size:"mini",disabled:_(s),onClick:m},{default:x(()=>[Rl,N(" \u64A4\u9500 ")]),_:1},8,["disabled"]),u(C,{size:"mini",disabled:_(d),onClick:h},{default:x(()=>[Nl,N(" \u91CD\u505A ")]),_:1},8,["disabled"]),zl,a("div",El,[N(" \u53C2\u8003\u7EBF\xA0\xA0 "),u($,{modelValue:_(l).referLine,"onUpdate:modelValue":v[0]||(v[0]=y=>_(l).referLine=y),size:"small"},null,8,["modelValue"])]),a("div",Ol,[N(" \u5BF9\u9F50\u7EBF\xA0\xA0 "),u($,{modelValue:_(l).markLine,"onUpdate:modelValue":v[1]||(v[1]=y=>_(l).markLine=y),size:"small"},null,8,["modelValue"])])]),a("div",Ul,[N(" \xA0\xA0 "),i.value?(g(),S("textarea",{key:0,class:"paste-inner",ref_key:"textpasteRef",ref:r},null,512)):(g(),z(C,{key:1,size:"mini",icon:"diff",onClick:p},{default:x(()=>[N("\u7C98\u8D34\u56FE\u8868")]),_:1})),u(C,{size:"mini",icon:"clear",onClick:c},{default:x(()=>[N("\u6E05\u7A7A\u753B\u5E03")]),_:1})])])],2)}}};const Gl={name:"shortcut",props:{modelValue:{type:Boolean}},emits:["update:modelValue"]},Pl=o=>(xe("data-v-7e8e628e"),o=o(),we(),o),Yl=Pl(()=>a("div",{class:"shortcut-wp"},[a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u57FA\u7840\u5FEB\u6377\u952E"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2190")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u914D\u7F6E\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u7EC4\u4EF6\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2191")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u5DE5\u5177\u680F"),a("div",{class:"shortcut-value"},"Ctrl + \u2193")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u590D\u5236\u9009\u4E2D\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Ctrl + C")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7C98\u8D34\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Ctrl + V")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u64A4\u9500\u64CD\u4F5C"),a("div",{class:"shortcut-value"},"Ctrl + Z")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4FDD\u5B58\u770B\u677F"),a("div",{class:"shortcut-value"},"Ctrl + S")])])]),a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u753B\u5E03\u64CD\u4F5C"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u6700\u4F73\u6BD4\u4F8B"),a("div",{class:"shortcut-value"},"Ctrl + A")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A1\uFF1A1"),a("div",{class:"shortcut-value"},"Ctrl + D")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u81EA\u7531\u7F29\u653E"),a("div",{class:"shortcut-value"},"Ctrl + \u9F20\u6807\u6EDA\u8F6E/\u6EDA\u52A8")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u753B\u5E03"),a("div",{class:"shortcut-value"},"Space + \u9F20\u6807\u5DE6\u952E/\u62D6\u52A8")])])]),a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u7EC4\u4EF6\u64CD\u4F5C"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u9876"),a("div",{class:"shortcut-value"},"Alt + Home")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u5E95"),a("div",{class:"shortcut-value"},"Alt + End")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4E0A\u79FB\u4E00\u5C42"),a("div",{class:"shortcut-value"},"Alt + \u2191")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4E0B\u79FB\u4E00\u5C42"),a("div",{class:"shortcut-value"},"Alt + \u2193")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF61\u50CF\u7D20"),a("div",{class:"shortcut-value"},"\u2191 \u2193 \u2190 \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF610\u50CF\u7D20"),a("div",{class:"shortcut-value"},"Shift + \u2191 \u2193 \u2190 \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u91CD\u547D\u540D"),a("div",{class:"shortcut-value"},"F2/\u53CC\u51FB\u56FE\u5C42")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5220\u9664\u9009\u4E2D\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Delete")])])])],-1));function jl(o,t,n,e,l,s){const d=k("b-modal");return g(),z(d,{title:"\u5FEB\u6377\u952E\u6307\u5357","model-value":n.modelValue,"append-to-body":"","custom-class":"schema-modal",onClose:t[0]||(t[0]=i=>o.$emit("update:modelValue",!1))},{default:x(()=>[Yl]),_:1},8,["model-value"])}var Kl=q(Gl,[["render",jl],["__scopeId","data-v-7e8e628e"]]);const Xl={name:"footer-panel",components:{Shortcut:Kl},setup(){const{schemaStore:o,storeToRefs:t}=Y(),{pageConfig:n,canvas:e}=t(o),l=T([200,150,100,50]),s=T(20),d=T(20),i=T(!1),r=async c=>{c===-1?o.autoCanvasScale():o.setCanvasScale(c===0?s.value:c)};return ve(()=>e.value.scale,c=>{const m=parseInt((c*100).toFixed(2));d.value=m,s.value=m}),{pageConfig:n,scaleList:l,inputScale:s,scale:d,submitScale:r,keycodeVisible:i}}},Jl={class:"footer-panel"},Hl={class:"screen-info",flex:"cross:center"},Wl={class:"ml-8",style:{transform:"scale(0.9)"}},Fl={flex:"cross:center"},ql={class:"scale-input-wp"},Zl=a("span",{class:"percent"},"%",-1),Ql=a("i",{class:"b-iconfont b-icon-down"},null,-1),ec={class:"scale-slider-wp"};function tc(o,t,n,e,l,s){const d=k("b-icon"),i=k("b-tooltip"),r=k("b-dropdown-item"),c=k("b-dropdown-menu"),m=k("b-dropdown"),h=k("b-slider"),p=k("shortcut");return g(),S(X,null,[a("div",Jl,[a("div",Hl,[u(i,{content:"\u5FEB\u6377\u952E\u63D0\u793A","open-delay":500},{default:x(()=>[u(d,{name:"read",size:"16",type:"button",onClick:t[0]||(t[0]=f=>e.keycodeVisible=!0)})]),_:1}),a("span",Wl,Q(e.pageConfig.width)+" \u50CF\u7D20 * "+Q(e.pageConfig.height)+" \u50CF\u7D20",1)]),a("div",Fl,[u(m,{trigger:"click",onCommand:e.submitScale},{dropdown:x(()=>[u(c,null,{default:x(()=>[(g(!0),S(X,null,ae(e.scaleList,f=>(g(),z(r,{key:f,name:f},{default:x(()=>[N(Q(`${f}%`),1)]),_:2},1032,["name"]))),128)),u(r,{name:-1},{default:x(()=>[N("\u81EA\u9002\u5E94")]),_:1})]),_:1})]),default:x(()=>[a("div",ql,[le(a("input",{"onUpdate:modelValue":t[1]||(t[1]=f=>e.inputScale=f),type:"number",class:"scale-input",onKeydown:t[2]||(t[2]=ye(f=>e.submitScale(0),["enter"]))},null,544),[[rt,e.inputScale]]),Zl,Ql])]),_:1},8,["onCommand"]),a("div",ec,[u(h,{modelValue:e.scale,"onUpdate:modelValue":t[3]||(t[3]=f=>e.scale=f),min:10,max:200,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])]),u(p,{modelValue:e.keycodeVisible,"onUpdate:modelValue":t[4]||(t[4]=f=>e.keycodeVisible=f)},null,8,["modelValue"])],64)}var oc=q(Xl,[["render",tc]]);const Z=o=>(xe("data-v-00b8514a"),o=o(),we(),o),ac=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),nc=Z(()=>a("span",{class:"key-code"},"Alt + Home",-1)),sc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),lc=Z(()=>a("span",{class:"key-code"},"Alt + End",-1)),cc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),ic=Z(()=>a("span",{class:"key-code"},"Alt + \u2191",-1)),rc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),dc=Z(()=>a("span",{class:"key-code"},"Alt + \u2193",-1)),uc=Z(()=>a("div",{class:"context-menu-divider"},null,-1)),mc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),pc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),vc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),fc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),_c=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-save"},null,-1)),hc=Z(()=>a("div",{class:"context-menu-divider"},null,-1)),gc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),bc=Z(()=>a("span",{class:"key-code"},"F2",-1)),yc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),Cc=Z(()=>a("span",{class:"key-code"},"Ctrl + C,V",-1)),xc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),wc=Z(()=>a("span",{class:"key-code"},"Delete",-1)),kc={__name:"index",setup(o,{expose:t}){const n=T([]),e=T({}),l=()=>ht().then(D=>n.value=D),{schemaStore:s,storeToRefs:d}=Y(),{selectedCom:i,selectedComs:r}=d(s),{isLocked:c,isHided:m,contextMenu:h,contextMenuStyle:p}=Ke(),f=D=>{i.value&&s.moveCom({id:i.value.id,moveType:D})},b=()=>f(re.up),v=()=>f(re.down),C=()=>f(re.top),$=()=>f(re.bottom),y=()=>{i.value&&(i.value.locked=!i.value.locked)},w=()=>{i.value&&(i.value.hided=!i.value.hided)},V=async()=>{e.value=n.value[0].key,pe({title:"\u6307\u5B9A\u7EC4\u4EF6\u5E93",message:qe(to,{modelValue:e.value,onChange:D=>e.value=D},()=>n.value.map(D=>qe(eo,{label:D.value,value:D.key}))),showCancelButton:!0,confirmText:"\u4FDD\u5B58",cancelText:"\u53D6\u6D88",beforeClose:async(D,A,B)=>{if(D==="confirm"){try{const M=document.getElementById(`component_${i.value.id}`),L=await ze(M);await cn(e.value,i.value,L),A.confirmButtonLoading=!0}catch(M){console.log(M)}A.confirmButtonLoading=!1,B()}else B()}}).then(()=>W.success("\u4FDD\u5B58\u6210\u529F!")).catch(()=>{})},O=()=>{const D=i.value;D&&pe.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{s.deleteCom(D.id)}).catch(()=>{})},R=()=>{const D=i.value;D&&s.renamingCom(D.id)},U=()=>{s.copyComs(r.value)},j=D=>{D.preventDefault(),l()};return Ce(()=>{ee(document,"contextmenu",j)}),Me(()=>{te(document,"contextmenu",j)}),t({moveUp:b,moveBottom:$,moveDown:v,moveTop:C,lockCom:y,hideCom:w,toDeleteCom:O,renameCom:R,toCopyCom:U}),(D,A)=>(g(),z(Ut,{name:"zoom-in-top"},{default:x(()=>[_(h).show?(g(),S("div",{key:0,class:"context-menu-wrap",style:F(_(p))},[a("div",{class:"context-menu-item",onClick:C},[ac,N(" \u7F6E\u9876 "),nc]),a("div",{class:"context-menu-item",onClick:$},[sc,N(" \u7F6E\u5E95 "),lc]),a("div",{class:"context-menu-item",onClick:b},[cc,N(" \u4E0A\u79FB\u4E00\u5C42 "),ic]),a("div",{class:"context-menu-item",onClick:v},[rc,N(" \u4E0B\u79FB\u4E00\u5C42 "),dc]),uc,a("div",{class:"context-menu-item",onClick:y},[_(c)?(g(),S(X,{key:0},[mc,N(" \u89E3\u9501 ")],64)):(g(),S(X,{key:1},[pc,N(" \u9501\u5B9A ")],64))]),a("div",{class:"context-menu-item",onClick:w},[_(m)?(g(),S(X,{key:0},[vc,N(" \u663E\u793A ")],64)):(g(),S(X,{key:1},[fc,N(" \u9690\u85CF ")],64))]),n.value.length?(g(),S("div",{key:0,class:"context-menu-item",onClick:V},[_c,N(" \u4FDD\u5B58 ")])):P("",!0),hc,a("div",{class:"context-menu-item",onClick:R},[gc,N(" \u91CD\u547D\u540D "),bc]),a("div",{class:"context-menu-item",onClick:U},[yc,N(" \u590D\u5236 "),Cc]),a("div",{class:"context-menu-item",onClick:O},[xc,N(" \u5220\u9664 "),wc])],4)):P("",!0)]),_:1}))}};var Sc=q(kc,[["__scopeId","data-v-00b8514a"]]);function $c(){const o=$e(),{schemaStore:t}=Y(),n=T(!1),e=async s=>{try{n.value=!0;const d=await Qt(s);if(d){const{id:i,name:r,pid:c,layout:m,components:h}=d,p={pageInfo:{id:i,name:r,pid:c},pageConfig:JSON.parse(m),comps:h.map(f=>JSON.parse(f.componentContent))};t.loadScreenData(p),await ge(),document.title=r}}catch(d){console.log(d)}n.value=!1},l=async()=>{try{n.value=!0;const s=await ao();if(s.tpl.length>0){const d=await co(s.tpl);if(d){const i=JSON.parse(d.content),{comps:r,pageConfig:c}=i;t.loadScreenData({comps:r,pageConfig:c})}}else t.setScreenSize(s)}catch(s){console.log(s)}n.value=!1};return ve(()=>o.path,async()=>{const{id:s}=o.query;s?await e(s):await l()},{immediate:!0}),{loading:n}}function Vc(){const o=T(null),t=T(null),{saveScreenData:n}=je(),{schemaStore:e,storeToRefs:l}=Y(),{pageInfo:s,canvas:d,selectedCom:i,selectedComs:r}=l(e),c=$e();let m=null;const h=v=>{const C=v.target;if(!["input","textarea"].includes(C.tagName.toLowerCase())){const $=v.key.toLowerCase();$==="delete"?(t.value&&t.value.toDeleteCom(),v.preventDefault()):$==="f2"&&(t.value&&t.value.renameCom(),v.preventDefault());const y=i.value;v.altKey&&(p("altKey"),$==="arrowup"?t.value&&t.value.moveUp():$==="arrowdown"?t.value&&t.value.moveDown():$==="home"?t.value&&t.value.moveTop():$==="end"&&t.value&&t.value.moveBottom(),v.preventDefault()),v.ctrlKey&&(p("ctrlKey"),$==="arrowup"?(e.toggleCompsPanel(),v.preventDefault()):$==="arrowdown"?(e.toggleToolbox(),v.preventDefault()):$==="arrowleft"?(e.toggleLayerPanel(),v.preventDefault()):$==="arrowright"?(e.toggleConfigPanel(),v.preventDefault()):$==="a"?(e.autoCanvasScale(),v.preventDefault()):$==="d"?(e.setCanvasScale(100),v.preventDefault()):$==="c"?(m=r.value,console.log(m),Ge(JSON.stringify(m)),v.preventDefault()):$==="v"?(m&&e.copyComs(m),v.preventDefault()):$==="s"?(s.value.id||c.query.id?(W("\u6B63\u5728\u4FDD\u5B58..."),n("edit").then(()=>W.success("\u4FDD\u5B58\u6210\u529F\uFF01"))):o.value&&o.value.handleSaveScreen(),v.preventDefault()):$==="z"&&(e.undo(),v.preventDefault())),v.shiftKey&&p("shiftKey"),v.keyCode===32&&(p("spaceKey"),v.preventDefault());const w=v.shiftKey?10:1;y&&!v.altKey&&($==="arrowleft"?(y.attr.x-=w,e.recordSnapshot(),v.preventDefault()):$==="arrowright"?(y.attr.x+=w,e.recordSnapshot(),v.preventDefault()):$==="arrowup"?(y.attr.y-=w,e.recordSnapshot(),v.preventDefault()):$==="arrowdown"&&(y.attr.y+=w,e.recordSnapshot(),v.preventDefault()))}},p=v=>{e.toggleKey({key:v,status:!0})},f=()=>{e.resetKeyCode()},b=v=>{const C=parseInt((d.value.scale*100).toFixed(2)),$=(v.wheelDelta>0?1:-1)*5,y=Math.min(Math.max(C+$,20),200);e.setCanvasScale(y)};return Ce(()=>{ee(document,"keydown",h),ee(document,"keyup",f)}),Me(()=>{te(document,"keydown",h),te(document,"keyup",f)}),{headerRef:o,contextMenuRef:t,ctrlMouseWheel:b}}const Mc={name:"ScreenEditor",components:{ContextMenu:Sc,FooterPanel:oc,ToolboxPanel:Al,CanvasMain:ys,ConfigPanel:Tl,ComponentsPanel:Nn,LayerPanel:Fo,HeaderBar:zo},setup(){return{...$c(),...Vc()}}},Dc={key:0,flex:"main:center cross:center",class:"full-wrapper"},Ic={key:1,class:"editor-main-wrapper"},Tc={class:"edit-main-wp"};function Bc(o,t,n,e,l,s){const d=k("header-bar"),i=k("svg-loading"),r=k("components-panel"),c=k("layer-panel"),m=k("toolbox-panel"),h=k("canvas-main"),p=k("footer-panel"),f=k("config-panel"),b=k("context-menu");return g(),S("div",{class:"schema-screen-container",onWheel:t[0]||(t[0]=oe((...v)=>o.ctrlMouseWheel&&o.ctrlMouseWheel(...v),["ctrl","prevent"]))},[u(d,{ref:"headerRef","back-url":"/dashboard"},null,512),o.loading?(g(),S("div",Dc,[u(i,{name:"loading02"})])):(g(),S("div",Ic,[u(r),u(c),a("div",Tc,[u(m),u(h),u(p)]),u(f)])),u(b,{ref:"contextMenuRef"},null,512)],32)}var Pc=q(Mc,[["render",Bc]]);export{Pc as default};
