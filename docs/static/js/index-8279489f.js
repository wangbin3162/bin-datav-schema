var he=Object.defineProperty,_e=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var ae=(t,s,_)=>s in t?he(t,s,{enumerable:!0,configurable:!0,writable:!0,value:_}):t[s]=_,K=(t,s)=>{for(var _ in s||(s={}))be.call(s,_)&&ae(t,_,s[_]);if(oe)for(var _ of oe(s))ge.call(s,_)&&ae(t,_,s[_]);return t},H=(t,s)=>_e(t,me(s));import{M as I,a as Q,U as fe}from"./chunk-bin-ui-next-f50ab7f2.js";import{h as ve,t as V,m as ye,r as we,i as $e,w as D,j as U,k as ke,l as Ce,s as xe,p as Se,n as Ve}from"./index-3bc00ece.js";import{y as j,G as je,as as q,g as X,o as b,A as w,B as e,D as B,E as ze,aC as ie,f as Z,J as C,c as ee,w as k,u as g,a1 as d,t as f,K as P,F as N,az as te,aA as ne,q as G,n as Ie,a as le,d as F,z as se,L as De,H as de}from"./vendor-aee7c04c.js";import{_ as Be}from"./logo-39114ead.js";import{g as Ne,r as Ke,S as Le}from"./template.api-dbe245d6.js";import{d as Me,s as Pe}from"./database.api-590de463.js";import"./chunk-brace-269ffce0.js";const T={pid:"1",name:"\u7F3A\u7701\u76EE\u5F55",directory:"Y"};function Ge(){const t=j({selectedPid:T.pid,selectedName:T.name,folderList:[],adding:!1}),s=({id:a,name:l})=>{t.selectedPid=a,t.selectedName=l},_=a=>{if(!t.adding)return;(a.target.value||"").trim()||(t.adding=!1)},v=async a=>{if(!t.adding)return;const l=(a.target.value||"").trim();if(l)try{await ve(H(K({},T),{name:l})),t.adding=!1,p(),I.success("\u65B0\u589E\u6210\u529F\uFF01")}catch($){V("useModelFolder/addGroup",$)}else t.adding=!1},n=(a,l)=>{if(!l.editing)return;const $=(a.target.value||"").trim();(!$||l.name===$)&&(l.editing=!1)},r=async(a,l)=>{if(!l.editing)return;const $=(a.target.value||"").trim();if($&&l.name!==$){try{await ye({id:l.id,name:$}),l.name=$,s({id:l.id,name:$}),I.success("\u4FEE\u6539\u6210\u529F\uFF01")}catch(L){V("useModelFolder/editGroup",L)}l.editing=!1}else l.editing=!1},o=({id:a,name:l})=>{Q.confirm({type:"error",title:`\u786E\u5B9A\u8981\u5220\u9664 [ ${l} ] \u5417\uFF1F`}).then(async()=>{try{await we(a),s({id:T.pid,name:T.name}),p(),I.success("\u5220\u9664\u6210\u529F\uFF01")}catch($){V("useModelFolder/confirmDeleteGroup",$)}}).catch(()=>{})},p=()=>{$e().then(a=>{t.folderList=(a.children||[]).map(l=>({id:l.id,name:l.text}))})};return p(),H(K({},je(t)),{toggleProject:s,confirmDeleteGroup:o,onAddInputBlur:_,onEditInputBlur:n,editGroup:r,addGroup:v})}var Fe="/bin-datav-schema/static/png/new-project-b5c06121.png";const{mixWhite:Te}=fe.color,Ee={name:"Iconfont",props:{icon:{type:String,required:!0},color:{type:String},size:{type:Number,default:24},bg:Boolean,round:Boolean,type:String},emits:["click"],setup(t,{emit:s}){const _=X(()=>{const o=t.color;if(!o)return null;const p={primary:"#1089ff",success:"#52c41a",info:"#35495E",warning:"#fea638",danger:"#ff4d4f"};return p[o]?p[o]:o}),v=X(()=>{const o=_.value;return!o||!t.bg?null:Te(o,.95)}),n=X(()=>{const o=t.size,p=o/2+2;return{cursor:t.type==="btn"?"pointer":null,width:`${o}px`,height:`${o}px`,fontSize:`${p}px`,color:_.value,backgroundColor:v.value,borderRadius:t.round?"50%":"2px"}});function r(){t.type==="btn"&&s("click",t.icon)}return{colorVar:_,bgVar:v,styles:n,handleClick:r}}};function Ae(t,s,_,v,n,r){return b(),w("div",{class:"icon-wrapper",style:ze(v.styles),onClick:s[0]||(s[0]=(...o)=>v.handleClick&&v.handleClick(...o))},[e("i",{class:B(`b-iconfont b-icon-${_.icon}`)},null,2)],4)}var Oe=q(Ee,[["render",Ae],["__scopeId","data-v-23013ff1"]]);const x=t=>(te("data-v-5bde0b16"),t=t(),ne(),t),Ue=x(()=>e("h2",{class:"title-bar"},"\u9884\u8BBE",-1)),qe={class:"preset-wp"},Re=x(()=>e("i",{class:"b-iconfont b-icon-laptop"},null,-1)),Je={class:"label-title"},We={class:"h2"},Ye={class:"h4"},He={flex:"main:justify",style:{width:"180px"}},Qe=x(()=>e("i",{class:"b-iconfont b-icon-mobile"},null,-1)),Xe={class:"label-title"},Ze={class:"h2"},et={class:"h4"},tt={flex:"main:justify",style:{width:"180px"}},nt=x(()=>e("i",{class:"b-iconfont b-icon-gateway"},null,-1)),st=x(()=>e("p",{class:"mb-5"},"\u81EA\u5B9A\u4E49\u5927\u5C0F",-1)),ot={class:"custom-input"},at=x(()=>e("span",{class:"mr-5"},"W:",-1)),it=x(()=>e("span",{class:"ml-5 mr-5"},"H:",-1)),lt=x(()=>e("div",{style:{width:"24px"}},null,-1)),dt=x(()=>e("h2",{class:"title-bar"},"\u6A21\u677F",-1)),ct={class:"template-list"},rt=["onClick"],ut={class:"template-image"},pt={class:"preview-image"},ht=["src"],_t={class:"tpl-remove"},mt={class:"template-info"},bt={class:"template-name"},gt={class:"template-size"},ft=x(()=>e("p",null,"\u753B\u5E03\u5C3A\u5BF8",-1)),vt=G("\u53D6\u6D88"),yt=G("\u5F00\u59CB\u521B\u4F5C"),wt={setup(t,{expose:s}){const _=ie(),v=Z(!1),n=j(K({},Me)),r=j({label:D[0].label,width:D[0].width,height:D[0].height}),o=j({label:U[0].label,width:U[0].width,height:U[0].height}),p=j({width:1920,height:1080}),a=Z([]),l=()=>{v.value=!1},$=()=>{n.label=D[0].label,n.width=D[0].width,n.height=D[0].height,n.type="web",n.tpl="",A(),v.value=!0},L=i=>{n.type="tpl",n.tpl=i.id},E=({width:i,height:h})=>{n.label="\u81EA\u5B9A\u4E49",n.width=i,n.height=h,n.tpl=""},R=i=>{r.label=i.label,r.width=i.width,r.height=i.height,n.label=i.label,n.type=i.type,n.width=i.width,n.height=i.height,n.tpl=""},J=i=>{o.label=i.label,o.width=i.width,o.height=i.height,n.label=i.label,n.type=i.type,n.width=i.width,n.height=i.height,n.tpl=""},A=()=>{Ne().then(i=>{a.value=(i.rows||[]).map(h=>{let S={};try{S=JSON.parse(h.content)}catch{S={pageConfig:{}}}return{id:h.id,name:h.name,pageConfig:S.pageConfig}})})},W=i=>{Q.confirm({type:"error",title:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u6A21\u677F\u5417\uFF1F"}).then(async()=>{try{await Ke(i.id),A(),I.success("\u79FB\u9664\u6A21\u677F\u6210\u529F\uFF01")}catch(h){V("create-screen/removeTpl",h)}}).catch(()=>{})},u=i=>{i==="web"?(n.label=r.label,n.width=r.width,n.height=r.height):i==="mobile"?(n.label=o.label,n.width=o.width,n.height=o.height):i==="custom"&&(n.label="\u81EA\u5B9A\u4E49",n.width=p.width,n.height=p.height),n.type=i,n.tpl=""},m=async()=>{l(),await Pe(n),await _.push({path:"/schema/screen"})};return s({openCreate:$}),(i,h)=>{const S=C("b-icon"),M=C("b-dropdown-item"),O=C("b-dropdown-menu"),y=C("b-dropdown"),z=C("b-input-number"),Y=C("b-button"),ue=C("b-modal");return b(),ee(ue,{modelValue:v.value,"onUpdate:modelValue":h[7]||(h[7]=c=>v.value=c),title:"\u521B\u5EFA\u770B\u677F",width:"1000px","custom-class":"schema-modal","destroy-on-close":""},{footer:k(()=>[g(Y,{onClick:l},{default:k(()=>[vt]),_:1}),g(Y,{type:"primary",onClick:m},{default:k(()=>[yt]),_:1})]),default:k(()=>[e("div",null,[Ue,e("div",qe,[e("div",{class:B(["preset-item web-box",{selected:d(n).type==="web"}]),onClick:h[0]||(h[0]=c=>u("web"))},[Re,e("div",Je,[e("div",We,f(d(r).label),1),e("div",Ye,f(d(r).width)+"x"+f(d(r).height),1)]),g(y,{trigger:"click",placement:"bottom-end",style:{width:"24px",height:"46px","line-height":"46px"},onCommand:R},{dropdown:k(()=>[g(O,null,{default:k(()=>[(b(!0),w(N,null,P(d(D),c=>(b(),ee(M,{key:c.label,name:c},{default:k(()=>[e("div",He,[e("span",null,f(c.label),1),e("span",null,f(c.width)+"x"+f(c.height),1)])]),_:2},1032,["name"]))),128))]),_:1})]),default:k(()=>[g(S,{name:"down",type:"button"})]),_:1})],2),e("div",{class:B(["preset-item mobile-box",{selected:d(n).type==="mobile"}]),onClick:h[1]||(h[1]=c=>u("mobile"))},[Qe,e("div",Xe,[e("div",Ze,f(d(o).label),1),e("div",et,f(d(o).width)+"x"+f(d(o).height),1)]),g(y,{trigger:"click",placement:"bottom-end",style:{width:"24px",height:"46px","line-height":"46px"},onCommand:J},{dropdown:k(()=>[g(O,null,{default:k(()=>[(b(!0),w(N,null,P(d(U),c=>(b(),ee(M,{key:c.label,name:c},{default:k(()=>[e("div",tt,[e("span",null,f(c.label),1),e("span",null,f(c.width)+"x"+f(c.height),1)])]),_:2},1032,["name"]))),128))]),_:1})]),default:k(()=>[g(S,{name:"down",type:"button"})]),_:1})],2),e("div",{class:B(["preset-item custom-box",{selected:d(n).type==="custom"}]),onClick:h[6]||(h[6]=c=>u("custom"))},[nt,e("div",null,[st,e("p",ot,[at,g(z,{modelValue:d(p).width,"onUpdate:modelValue":h[2]||(h[2]=c=>d(p).width=c),min:100,step:1,precision:0,size:"mini",onChange:h[3]||(h[3]=c=>E(d(p)))},null,8,["modelValue"]),it,g(z,{modelValue:d(p).height,"onUpdate:modelValue":h[4]||(h[4]=c=>d(p).height=c),min:100,step:1,precision:0,size:"mini",onChange:h[5]||(h[5]=c=>E(d(p)))},null,8,["modelValue"])])]),lt],2)]),dt,e("div",ct,[(b(!0),w(N,null,P(a.value,c=>(b(),w("div",{class:"template-grid",key:c.id},[e("div",{class:B(["template-item",{selected:d(n).type==="tpl"&&d(n).tpl===c.id}]),onClick:pe=>L(c)},[e("div",ut,[e("div",pt,[e("img",{src:c.pageConfig.bgImage,alt:""},null,8,ht)]),e("div",_t,[g(Y,{type:"text","text-color":"#f5222d",title:"\u79FB\u9664\u6A21\u677F",icon:"delete",onClick:pe=>W(c)},null,8,["onClick"])])]),e("div",mt,[e("div",bt,f(c.name),1),e("div",gt,[ft,e("p",null,f(c.pageConfig.width)+"x"+f(c.pageConfig.height)+"px",1)])])],10,rt)]))),128))])])]),_:1},8,["modelValue"])}}};var $t=q(wt,[["__scopeId","data-v-5bde0b16"]]);const ce=t=>(te("data-v-dd3c346c"),t=t(),ne(),t),kt={class:"kanban-list-wp"},Ct=ce(()=>e("img",{src:Fe},null,-1)),xt=ce(()=>e("span",{class:"text-title ellipsis"},"\u65B0\u5EFA\u770B\u677F",-1)),St=[Ct,xt],Vt={class:"list-header"},jt={class:"title"},zt={class:"header-manager"},It={key:0,class:"list-wrap"},Dt={class:"list-item-inner"},Bt={class:"list-item-img"},Nt={class:"preview-image"},Kt=["src"],Lt={key:1,src:Be,alt:"default",style:{width:"147px",height:"147px"}},Mt={class:"list-item-mask"},Pt={class:"action"},Gt=G("\u7F16\u8F91\u770B\u677F"),Ft={class:"icon-ctrl pt-10"},Tt=["onClick"],Et=["onClick"],At={class:"icon-box"},Ot=["onClick"],Ut=["onClick"],qt={class:"list-item-info"},Rt={class:"item-title","t-ellipsis":""},Jt={style:{height:"200px"},flex:"main:center cross:center"},Wt=G("\u8BE5\u5206\u7EC4\u4E0B\u6CA1\u6709\u770B\u677F"),Yt={class:"t-center pb-24"},Ht={props:{group:{type:Object,default:()=>({})}},setup(t){const s=t,_=ie(),v=Z(null),n=j({name:"",page:1,size:20}),r=j({rows:[],total:0,loading:!1}),o=j({id:"",pid:"",name:"",directory:"N"}),p=async()=>{try{r.loading=!0;const u=await ke(K({pid:s.group.pid},n));r.rows=(u.rows||[]).map(m=>{let i={};try{i=JSON.parse(m.layout)}catch{i={}}return{id:m.id,name:m.name,status:m.status,pageConfig:i}}),r.total=u.total}catch(u){V("kanban-list/getSearchList",u)}r.loading=!1},a=async u=>{n.page=u,await p()},l=u=>{let m=_.resolve({path:`/screen/${u.id}`});window.open(m.href,"_blank")},$=()=>{o.pid="",o.name="",o.directory="N"},L=u=>{let m=_.resolve({path:"/schema/screen",query:{id:u}});window.open(m.href,"_blank")},E=()=>{v.value&&v.value.openCreate()},R=u=>{$(),o.id=u.id,o.pid=u.pid,o.name=u.name,o.directory=u.directory,L(u.id)},J=async u=>{try{const m=await Ce(u.id);m.name=`${m.name}_copy`,delete m.id,await xe(m),await p(),I.success("\u590D\u5236\u6210\u529F\uFF01")}catch(m){V("kanban-list/handleCopy",m)}},A=async u=>{if(u.status!=="audited")try{await Se(u.id),await p(),I.success("\u53D1\u5E03\u6210\u529F\uFF01")}catch(m){V("kanban-list/handlePublish",m)}},W=u=>{Q.confirm({type:"error",title:"\u5220\u9664\u540E\u65E0\u6CD5\u6062\u590D\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F"}).then(async()=>{try{await Ve(u),await p(),I.success("\u5220\u9664\u6210\u529F\uFF01")}catch(m){V("kanban-list/removeDashboard",m)}}).catch(()=>{})};return Ie(()=>s.group,()=>{n.page=1,p()},{immediate:!0,deep:!0}),(u,m)=>{const i=C("b-input"),h=C("b-button"),S=C("b-tag"),M=C("b-empty"),O=C("b-page");return b(),w(N,null,[e("div",kt,[e("div",{class:"new-box",onClick:E},St),e("div",Vt,[e("div",jt,[e("h2",null,f(t.group?t.group.name:"")+" ("+f(d(r).total)+")",1)]),e("div",zt,[g(i,{modelValue:d(n).name,"onUpdate:modelValue":m[0]||(m[0]=y=>d(n).name=y),size:"small",placeholder:"\u641C\u7D22",search:"",onSearch:p},null,8,["modelValue"])])]),d(r).loading?le("",!0):(b(),w("ul",It,[(b(!0),w(N,null,P(d(r).rows,y=>(b(),w("li",{key:y.id,class:"base-list-item"},[e("div",Dt,[e("div",Bt,[e("div",Nt,[y.pageConfig.bgImage?(b(),w("img",{key:0,src:y.pageConfig.bgImage,alt:""},null,8,Kt)):(b(),w("img",Lt))]),e("div",Mt,[e("div",Pt,[g(h,{type:"primary",icon:"edit-square",onClick:z=>R(y)},{default:k(()=>[Gt]),_:2},1032,["onClick"]),e("div",Ft,[e("i",{class:"b-iconfont b-icon-file-copy",onClick:z=>J(y),title:"\u590D\u5236"},null,8,Tt),e("i",{class:"b-iconfont b-icon-delete",onClick:z=>W(y.id),title:"\u5220\u9664"},null,8,Et)])]),e("div",At,[e("i",{class:"b-iconfont b-icon-View",onClick:z=>l(y),title:"\u9884\u89C8"},null,8,Ot),e("i",{class:"b-iconfont b-icon-send",onClick:z=>A(y),title:"\u53D1\u5E03"},null,8,Ut)])])]),e("div",qt,[e("div",Rt,[g(Oe,{icon:y.directory==="Y"?"folder":"linechart",color:y.directory==="Y"?"#fa8c16":"#1089ff"},null,8,["icon","color"]),e("span",null,f(y.name),1)]),g(S,{type:y.status==="audited"?"success":"primary",dot:"","tag-style":{color:"#999"}},{default:k(()=>[G(f(y.status==="audited"?"\u5DF2\u53D1\u5E03":"\u5F85\u53D1\u5E03"),1)]),_:2},1032,["type"])])])]))),128))])),F(e("div",Jt,[g(Le,{name:"loading02",width:100})],512),[[se,d(r).loading]]),F(g(M,null,{default:k(()=>[Wt]),_:1},512),[[se,!d(r).loading&&d(r).rows.length===0]]),F(e("div",Yt,[g(O,{total:d(r).total,current:d(n).page,"page-size":d(n).size,onChange:a},null,8,["total","current","page-size"])],512),[[se,!d(r).loading&&d(r).total>d(n).size]])]),g($t,{ref_key:"createRef",ref:v},null,512)],64)}}};var Qt=q(Ht,[["__scopeId","data-v-dd3c346c"]]);const Xt={name:"AnalysisDashboard",components:{KanbanList:Qt},setup(){return K({},Ge())}},re=t=>(te("data-v-abf4d4dc"),t=t(),ne(),t),Zt={class:"kanban-wrapper"},en={class:"kanban-main"},tn={class:"folder-manage"},nn={class:"folder-manage-group"},sn=re(()=>e("span",null,"\u770B\u677F\u5206\u7EC4",-1)),on={class:"folder-manage-main"},an=re(()=>e("span",null,"\u7F3A\u7701\u76EE\u5F55",-1)),ln=[an],dn={key:0,class:"folder-item new-group"},cn=["onClick"],rn=["default-value","onBlur","onKeyup"],un={class:"folder-name"},pn={class:"group-btns"},hn=["onClick"],_n=["onClick"],mn={class:"right-list"};function bn(t,s,_,v,n,r){const o=C("kanban-list"),p=De("focus");return b(),w("div",Zt,[e("div",en,[e("div",tn,[e("div",nn,[sn,e("i",{class:"b-iconfont b-icon-plus btn-add-icon",title:"\u65B0\u589E\u6587\u4EF6\u5939",onClick:s[0]||(s[0]=a=>t.adding=!0)})]),e("div",on,[e("div",{class:B(["folder-item folder-all",{"folder-item-checked-color":t.selectedPid==="1"}]),onClick:s[1]||(s[1]=a=>t.toggleProject({id:"1",name:"\u7F3A\u7701\u76EE\u5F55"}))},ln,2),t.adding?(b(),w("div",dn,[F(e("input",{class:"edit-input",onBlur:s[2]||(s[2]=(...a)=>t.onAddInputBlur&&t.onAddInputBlur(...a)),onKeyup:s[3]||(s[3]=de((...a)=>t.addGroup&&t.addGroup(...a),["enter"]))},null,544),[[p]])])):le("",!0),(b(!0),w(N,null,P(t.folderList,a=>(b(),w("div",{key:a.id,class:B(["folder-item",{"folder-item-checked-color":t.selectedPid===a.id}]),onClick:l=>t.toggleProject(a)},[a.editing?F((b(),w("input",{key:0,"default-value":a.name,class:"edit-input",onBlur:l=>t.onEditInputBlur(l,a),onKeyup:de(l=>t.editGroup(l,a),["enter"])},null,40,rn)),[[p]]):(b(),w(N,{key:1},[e("span",un,f(a.name),1),e("span",pn,[e("i",{class:"b-iconfont b-icon-edit",title:"\u7F16\u8F91",onClick:l=>a.editing=!0},null,8,hn),e("i",{class:"b-iconfont b-icon-delete",title:"\u5220\u9664",onClick:l=>t.confirmDeleteGroup(a)},null,8,_n)])],64))],10,cn))),128))])]),e("div",mn,[g(o,{group:{pid:t.selectedPid,name:t.selectedName}},null,8,["group"])])])])}var xn=q(Xt,[["render",bn],["__scopeId","data-v-abf4d4dc"]]);export{xn as default};
