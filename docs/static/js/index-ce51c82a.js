import{cL as q,j as I,b as h,c as $,q as E,cw as $e,cU as it,r as T,w as ve,s as ge,K as k,k as z,l as x,v as u,F as J,y as N,e as Y,h as n,p as Q,a as be,a1 as v,Q as fe,n as F,z as le,Y as rt,P as ye,U as Vt,a3 as dt,cW as Mt,d as ne,cD as Dt,I as It,L as Tt,D as oe,i as Ee,A as Ue,cN as Ve,$ as Rt,f as Ce,o as Lt,cS as xe,cT as we,g as Me,J as Bt,m as ut,a0 as Nt,cX as zt,cY as Et,cx as Ut,T as At,E as qe}from"./vendor-4c8a7a86.js";import{e as K,z as De,A as Ae,s as Ot,t as Oe,v as Gt,j as Yt,B as Ge,q as me,D as ee,E as te,M as re,F as j,u as Kt,b as Ie,f as Ye,G as mt,H as Ze,J as Qe,K as Xt,L as et,N as tt,O as de,a as jt,P as Pt,w as Jt,k as Ht,Q as Wt,R as Ft,T as qt,U as Zt,n as Qt}from"./index-0b9505b3.js";import{M as W,a as pe,s as eo,b as to}from"./chunk-bin-ui-next-b686a83e.js";import{a as oo,g as pt,b as no}from"./database.api-521ca794.js";import{d as ao,a as so}from"./file-helper-e95db66d.js";import{s as lo,l as co}from"./template.api-99e0fa67.js";import{d as Ke,a as io,u as ro,r as uo,g as mo,m as po,b as vo,c as fo}from"./images.api-2b149560.js";import{p as _o,m as ho}from"./select-options-04fab100.js";import"./chunk-echarts-cf4087a0.js";import"./chunk-brace-b1f520b9.js";import"./chunk-bin-datav-cf728ffc.js";import"./chunk-particles.vue3-9bc75d83.js";import"./chunk-mockjs-9e1335a8.js";const go={name:"HeadLoading",setup(){const{schemaStore:o,storeToRefs:t}=K(),{toolbar:a}=t(o);return{loading:I(()=>a.value.loading)}}};function bo(o,t,a,e,l,s){return h(),$("div",{class:E(["loading-indicator",{loading:e.loading}])},null,2)}var yo=q(go,[["render",bo],["__scopeId","data-v-5475ad30"]]);function Xe(){const o=$e(),{schemaStore:t,storeToRefs:a}=K(),{pageInfo:e,pageConfig:l,comps:s}=a(t);async function i(d="edit"){const c={id:e.value.id||o.query.id,name:e.value.name,pid:e.value.pid,status:d,layout:JSON.stringify(l.value),components:s.value.map(m=>De(m.apiData)?{name:m.alias,componentType:m.componentType,componentContent:JSON.stringify(m),componentDataType:Ae.static,modelId:"",x:[],y:[],drill:[],filters:[]}:{name:m.alias,componentType:m.componentType,componentDataType:m.apiData.type,modelId:m.apiData.config.modelId,componentContent:JSON.stringify(m),x:m.apiData.config.x,y:m.apiData.config.y,drill:[],filters:[]})};try{return await Ot(c)}catch(m){Oe("userSchemaStore/saveScreenData",m)}return""}async function r(){let d={};try{t.setGlobalLoading(!0);const c={pageInfo:{id:e.value.id,name:e.value.name||"\u770B\u677F\u9884\u89C8",pid:e.value.pid||"1"},pageConfig:l.value,comps:s.value};d=await oo(c)}catch{d={}}return t.setGlobalLoading(!1),d}return{saveScreenData:i,previewScreen:r}}function H(o){const{schemaStore:t}=K();o?t.setGlobalLoading(o):setTimeout(()=>t.setGlobalLoading(o),300)}const Co={name:"save-screen",props:{modelValue:{type:Boolean},status:{type:String,default:"edit",validator:o=>["edit","audited"].includes(o)}},emits:["update:modelValue"],setup(o,t){const a=I({get:()=>o.modelValue,set:_=>t.emit("update:modelValue",_)}),{schemaStore:e,storeToRefs:l}=K(),{pageInfo:s}=l(e),{saveScreenData:i}=Xe(),r=it(),d=$e(),c=T([]),m=T(null),g=T(!1),p=I(()=>window.location.origin+Gt(`/#/screen/${d.query.id}`));Yt().then(_=>{c.value=_.data?[_.data]:[]});const f=I(()=>o.status==="edit"?"\u4FDD\u5B58\u770B\u677F":"\u53D1\u5E03\u770B\u677F"),y=()=>{m.value.validate(async _=>{if(_){let S="";try{H(!0),g.value=!0,S=await i(o.status)}catch(w){Oe("save-screes/saveKanban",w)}H(!1),s.value.id=S,g.value=!1,a.value=!1,W.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0});let C=r.resolve({path:"/schema/screen",query:{id:S}});window.location.replace(C.href)}})},b=()=>{ge(()=>{Ge(p.value)&&W.success("\u590D\u5236\u53D1\u5E03\u5730\u5740\u6210\u529F!")})};return ve(()=>o.modelValue,_=>{_&&ge(()=>{m.value&&m.value.resetFields()})}),{formRef:m,pageInfo:s,dirTree:c,loading:g,visible:a,saveKanban:y,btnText:f,shareUrl:p,copyUrl:b}}},xo={class:"t-center"};function wo(o,t,a,e,l,s){const i=k("b-input"),r=k("b-form-item"),d=k("g-input"),c=k("b-button"),m=k("b-form"),g=k("b-modal");return h(),z(g,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=p=>e.visible=p),"append-to-body":"",title:e.btnText,top:"200px","custom-class":"schema-modal",onClose:t[3]||(t[3]=p=>e.visible=!1)},{default:x(()=>[u(m,{"label-width":"80px",ref:"formRef",model:e.pageInfo,"label-suffix":":"},{default:x(()=>[u(r,{label:"\u770B\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u770B\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:x(()=>[u(i,{modelValue:e.pageInfo.name,"onUpdate:modelValue":t[0]||(t[0]=p=>e.pageInfo.name=p)},null,8,["modelValue"])]),_:1}),a.status==="audited"&&o.$route.query.id?(h(),$(J,{key:0},[u(r,{label:"\u9884\u89C8\u5730\u5740"},{default:x(()=>[u(d,{modelValue:e.shareUrl,"onUpdate:modelValue":t[1]||(t[1]=p=>e.shareUrl=p),readonly:"",type:"textarea",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),u(r,null,{default:x(()=>[u(c,{type:"text",onClick:e.copyUrl},{default:x(()=>[N("\u590D\u5236\u9884\u89C8\u5730\u5740")]),_:1},8,["onClick"])]),_:1})],64)):Y("",!0)]),_:1},8,["model"]),n("div",xo,[u(c,{type:"primary",onClick:e.saveKanban,loading:e.loading,style:{width:"200px"}},{default:x(()=>[N(Q(e.btnText),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["modelValue","title"])}var ko=q(Co,[["render",wo]]);const So={name:"save-template",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,t){const{schemaStore:a,storeToRefs:e}=K(),{pageConfig:l,comps:s}=e(a),i=T(null),r=be({loading:!1,id:`temp_${me()}`,name:""}),d=I({get:()=>o.modelValue,set:p=>t.emit("update:modelValue",p)}),c=I(()=>({template:{id:r.id,name:r.name},pageConfig:l.value,comps:s.value})),m=()=>{i.value&&i.value.validate(async p=>{if(p){const f=c.value,y=JSON.stringify(f);ao(y,`${f.template.id}.json`),W.success({message:"\u6A21\u677F\u6587\u4EF6\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})},g=async()=>{i.value&&i.value.validate(async p=>{if(p){try{H(!0),r.loading=!0;const f=c.value,y=f.template.name,b=JSON.stringify(f);await lo({name:y,content:b})}catch(f){Oe("save-template/saveAsTemplate",f)}H(!1),r.loading=!1,d.value=!1,W.success({message:"\u6A21\u677F\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})};return ve(()=>o.modelValue,p=>{p&&(i.value&&i.value.resetFields(),r.id=`temp_${me()}`)}),{formRef:i,formStatus:r,visible:d,downloadCfg:m,saveAsTemplate:g}}},$o={class:"t-center"};function Vo(o,t,a,e,l,s){const i=k("b-input"),r=k("b-form-item"),d=k("b-form"),c=k("b-button"),m=k("b-modal");return h(),z(m,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=g=>e.visible=g),"append-to-body":"",title:"\u4FDD\u5B58\u4E3A\u6A21\u677F",top:"200px","custom-class":"schema-modal",onClose:t[2]||(t[2]=g=>e.visible=!1)},{default:x(()=>[u(d,{"label-width":"80px",ref:"formRef",model:e.formStatus,"label-suffix":":"},{default:x(()=>[u(r,{label:"\u6A21\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:x(()=>[u(i,{modelValue:e.formStatus.name,"onUpdate:modelValue":t[0]||(t[0]=g=>e.formStatus.name=g)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),n("div",$o,[u(c,{type:"primary",icon:"vertical-align-botto",transparent:"",style:{width:"120px"},onClick:e.downloadCfg},{default:x(()=>[N(" \u914D\u7F6E\u6587\u4EF6 ")]),_:1},8,["onClick"]),u(c,{type:"primary",icon:"save",style:{width:"120px"},loading:e.formStatus.loading,onClick:e.saveAsTemplate},{default:x(()=>[N(" \u4FDD\u5B58\u6A21\u677F ")]),_:1},8,["loading","onClick"])])]),_:1},8,["modelValue"])}var Mo=q(So,[["render",Vo]]);const Do={class:"header-container"},Io={class:"left-actions"},To={class:"screen-info"},Ro=n("span",null,"\u5206\u6790\u770B\u677F",-1),Lo=n("span",{style:{padding:"0 8px"}},"-",-1),Bo={class:"global-actions"},No={class:"head-btn"},zo={__name:"index",props:{backUrl:{type:String},backTarget:{type:String,default:"_self",validator:o=>["_self","_blank"].includes(o)},pageStatus:{type:Object,default:()=>({})}},setup(o,{expose:t}){const a=o,e=it(),{schemaStore:l,storeToRefs:s}=K(),{pageInfo:i,toolbar:r}=s(l),{previewScreen:d}=Xe(),c=T(!1),m=T("edit"),g=T(!1),p=()=>{const S=a.backUrl||"/";if(a.backTarget==="_blank"){const C=e.resolve(S);window.open(C.href,a.backTarget)}else pe.confirm({type:"warning",title:"\u786E\u5B9A\u8FD4\u56DE\u5217\u8868\u5417\uFF1F"}).then(()=>{e.push(S),l.clearStore()}).catch(()=>{})},f=S=>S.type!=="application/json"?(W.warning("\u8BF7\u9009\u62E9\u6B63\u786E\u7684json\u914D\u7F6E\u6587\u4EF6"),!1):(so(S).then(C=>{try{const w=JSON.parse(C),{comps:V,pageConfig:U}=w;l.loadScreenData({comps:V,pageConfig:U})}catch{console.warn("The imported file could not be converted to the correct JSON!")}}),!1),y=()=>{m.value="edit",c.value=!0},b=()=>{m.value="audited",c.value=!0},_=async()=>{const S=await d();let C=e.resolve({path:`/screen/preview/${S.pageInfo.id}`});window.open(C.href,"_blank")};return t({handleSaveScreen:y,handlePublish:b,handPreview:_}),(S,C)=>{const w=k("b-icon"),V=k("b-tooltip"),U=k("b-space"),B=k("b-upload");return h(),$(J,null,[n("div",Do,[n("div",Io,[u(U,{size:"mini"},{default:x(()=>[u(V,{content:"\u7EC4\u4EF6","open-delay":500},{default:x(()=>[n("div",{class:E(["head-btn",{active:v(r).components}]),onClick:C[0]||(C[0]=A=>v(l).toggleCompsPanel())},[u(w,{name:"hourglass",class:E(["com-list-icon",{"is-rotate":!v(r).components}])},null,8,["class"])],2)]),_:1}),u(V,{content:"\u56FE\u5C42","open-delay":500},{default:x(()=>[n("div",{class:E(["head-btn",{active:v(r).layer}]),onClick:C[1]||(C[1]=A=>v(l).toggleLayerPanel())},[u(w,{name:"container"})],2)]),_:1}),u(V,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:x(()=>[n("div",{class:E(["head-btn",{active:v(r).config}]),onClick:C[2]||(C[2]=A=>v(l).toggleConfigPanel())},[u(w,{name:"control"})],2)]),_:1}),u(V,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:x(()=>[n("div",{class:E(["head-btn",{active:v(r).toolbox}]),onClick:C[3]||(C[3]=A=>v(l).toggleToolbox())},[u(w,{name:"shopping"})],2)]),_:1})]),_:1})]),n("div",To,[u(V,{content:"\u8FD4\u56DE","open-delay":500},{default:x(()=>[u(w,{name:"laptop",type:"button",onClick:p})]),_:1}),Ro,Lo,n("span",null,Q(v(i).name),1)]),n("div",Bo,[u(U,{size:"mini"},{default:x(()=>[u(V,{content:"\u5BFC\u5165json (\u4F1A\u8986\u76D6\u6240\u6709\u5185\u5BB9\uFF01)","open-delay":500},{default:x(()=>[u(B,{action:"/","show-upload-list":!1,"before-upload":f},{default:x(()=>[n("div",No,[u(w,{name:"Import"})])]),_:1})]),_:1}),u(V,{content:"\u4FDD\u5B58\u6A21\u677F","open-delay":500},{default:x(()=>[n("div",{class:"head-btn",onClick:C[4]||(C[4]=A=>g.value=!0)},[u(w,{name:"Storedprocedure"})])]),_:1}),u(V,{content:"\u4FDD\u5B58","open-delay":500},{default:x(()=>[n("div",{class:"head-btn",onClick:y},[u(w,{name:"save"})])]),_:1}),u(V,{content:"\u53D1\u5E03","open-delay":500},{default:x(()=>[n("div",{class:"head-btn",onClick:b},[u(w,{name:"send"})])]),_:1}),u(V,{content:"\u9884\u89C8","open-delay":500},{default:x(()=>[n("div",{class:"head-btn",onClick:_},[u(w,{name:"View"})])]),_:1})]),_:1})])]),u(yo),u(ko,{modelValue:c.value,"onUpdate:modelValue":C[5]||(C[5]=A=>c.value=A),status:m.value},null,8,["modelValue","status"]),u(Mo,{modelValue:g.value,"onUpdate:modelValue":C[6]||(C[6]=A=>g.value=A)},null,8,["modelValue"])],64)}}},he=be({x:0,y:0});function je(o={}){const{schemaStore:t,storeToRefs:a}=K(),{contextMenu:e,selectedCom:l}=a(t),s=I(()=>{var m;return(m=l.value)==null?void 0:m.locked}),i=I(()=>{var m;return(m=l.value)==null?void 0:m.hided}),r=I(()=>({display:e.value.show?"block":"none",left:`${he.x+10}px`,top:`${he.y+10}px`,transform:document.documentElement.clientHeight-he.y<250?"translate(0px, -100%)":""})),d=m=>{m.preventDefault(),l.value&&(he.x=m.clientX,he.y=m.clientY,e.value.show=!0,ee(document,"click",c))},c=()=>{te(document,"click",c),o&&o.beforeClose&&o.beforeClose(),e.value.show=!1};return{showMenu:d,isLocked:s,isHided:i,contextMenu:e,contextMenuStyle:r}}const Eo={class:"layer-panel"},Uo={class:"layer-top"},Ao=n("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),Oo=n("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),Go=[Oo],Yo={class:"layer-toolbar layer-toolbar-top"},Ko={class:"layer-manager-wrap"},Xo=["title","onMousedown","onMouseenter","onDblclick"],jo=["onUpdate:modelValue"],Po={key:1,class:"layer-item-span"},Jo={class:"layer-item-text"},Ho=["title","onClick"],Wo=["title","onClick"],Fo={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{comps:e,toolbar:l,hoveredComId:s,selectedCom:i,renamingComId:r,isMultiSelect:d,selectedComs:c}=a(t),{showMenu:m}=je(),g=I(()=>!!i.value),p=I(()=>({opacity:i.value?1:.3}));function f(X){return d.value?c.value.map(D=>D.id).includes(X.id):!De(i.value)&&i.value.id===X.id}const y=I({get:()=>[...e.value].reverse(),set:X=>e.value=X.reverse()}),b=X=>{i.value&&t.moveCom({id:i.value.id,moveType:X})},_=()=>b(re.up),S=()=>b(re.down),C=()=>b(re.top),w=()=>b(re.bottom),V=X=>t.hoverCom(X),U=()=>t.hoverCom(""),B=X=>{const D=e.value.find(O=>O.id===X);D&&t.selectCom(D)},A=()=>t.selectCom();return(X,D)=>{const O=k("b-icon"),R=fe("focus");return h(),$("div",{class:E(["layer-panel-wp",{"is-hide":!v(l).layer}])},[n("div",Eo,[n("div",Uo,[Ao,n("div",{class:"layer-action",onClick:D[0]||(D[0]=M=>v(t).toggleLayerPanel(!1))},Go)]),n("div",Yo,[n("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:E(["b-iconfont b-icon-arrowup toolbar-icon standard",v(g)]),style:F(v(p)),onClick:_},null,6),n("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:E(["b-iconfont b-icon-arrowdown toolbar-icon standard",v(g)]),style:F(v(p)),onClick:S},null,6),n("i",{title:"\u7F6E\u9876",class:E(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",v(g)]),style:F({transform:"rotate(180deg)",...v(p)}),onClick:C},null,6),n("i",{title:"\u7F6E\u5E95",class:E(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",v(g)]),style:F(v(p)),onClick:w},null,6)]),n("div",Ko,[u(v(Mt),Vt({modelValue:v(y),"onUpdate:modelValue":D[4]||(D[4]=M=>dt(y)?y.value=M:null),class:"drag-area","item-key":"id"},{animation:200}),{item:x(({element:M})=>[n("div",{title:M.alias,class:E(["layer-manager-item",[{hided:M.hided,locked:M.locked,hovered:M.id===v(s),selected:f(M)}]]),onMousedown:L=>B(M.id),onMouseenter:L=>V(M.id),onMouseleave:U,onDblclick:L=>v(t).renamingCom(M.id),onContextmenu:D[3]||(D[3]=L=>v(m)(L))},[u(O,{name:M.name==="VIcon"?M.config.src:M.icon,size:"18"},null,8,["name"]),M.id===v(r)?le((h(),$("input",{key:0,"onUpdate:modelValue":L=>M.alias=L,class:"layer-item-input",onBlur:D[1]||(D[1]=L=>v(t).renamingCom("")),onKeydown:D[2]||(D[2]=ye(L=>v(t).renamingCom(""),["enter"]))},null,40,jo)),[[rt,M.alias,void 0,{trim:!0}],[R]]):(h(),$("span",Po,[n("span",Jo,Q(M.alias),1)])),n("i",{class:E(["b-iconfont",`b-icon-${M.hided?"eye-close":"eye"}`,"show-toggle-btn"]),title:M.hided?"\u663E\u793A":"\u9690\u85CF",onClick:L=>M.hided=!M.hided},null,10,Ho),n("i",{class:E(["b-iconfont",`b-icon-${M.locked?"lock":"unlock"}`,"show-toggle-btn"]),title:M.locked?"\u89E3\u9501":"\u9501\u5B9A",onClick:L=>M.locked=!M.locked},null,10,Wo)],42,Xo)]),_:1},16,["modelValue"]),n("div",{class:"last-flex-item",onClick:A})])])],2)}}},qo={name:"VBasicBar",alias:"\u67F1\u56FE",img:j("basic-bar.svg")},Zo={name:"VHorizontalBar",alias:"\u6761\u5F62\u56FE",img:j("hori-basic-bar.svg")},Qo={name:"VCapsuleBar",alias:"\u80F6\u56CA\u67F1\u56FE",img:j("capsule-bar.svg")},en={name:"VBasicLine",alias:"\u6298\u7EBF\u56FE",img:j("basic-line.svg")},tn={name:"VBasicArea",alias:"\u533A\u57DF\u56FE",img:j("basic-area.svg")},on={name:"VBasicPie",alias:"\u997C\u56FE",img:j("basic-pie.svg")},nn={name:"VBasicRing",alias:"\u73AF\u56FE",img:j("basic-ring.svg")},an={name:"VBasicRadar",alias:"\u96F7\u8FBE\u56FE",img:j("basic-radar.svg")},sn={name:"VBasicMap",alias:"\u4E2D\u56FD\u5730\u56FE",img:j("2d-china.svg")},ln={name:"VBasicMapEvo",alias:"\u6CB3\u5317\u7701\u5730\u56FE",img:j("basic-map-evo.svg")},cn={name:"VBasicScatter",alias:"\u6563\u70B9\u56FE",img:j("basic-scatter.svg")},rn={name:"VLineBasicScatter",alias:"\u6563\u70B9\u7EBF\u56FE",img:j("line-basic-scatter.svg")},dn={name:"VBasicBoxplot",alias:"\u76D2\u987B\u56FE",img:j("basic-boxplot.svg")},un={name:"VBasicFunnel",alias:"\u68AF\u5EA6\u56FE",img:j("basic-funnel.svg")},mn={name:"VBasicWordCloud",alias:"\u8BCD\u4E91\u56FE",img:j("basic-wordcloud.svg")},pn={name:"VBasicGauge",alias:"\u4EEA\u8868\u76D8",img:j("basic-gauge.svg")},vn={name:"VProgressCircle",alias:"\u8FDB\u5EA6\u73AF",img:j("pie-one-value.svg")},fn={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:j("number-title-flop.svg")},_n={name:"VTimer",alias:"\u65F6\u95F4\u5668",img:j("timer.svg")},hn={name:"VSelect",alias:"\u4E0B\u62C9\u63A7\u4EF6",img:j("select.svg")},gn={name:"VMainTitle",alias:"\u6807\u9898",img:j("main-title.svg")},bn={name:"VBgBox",alias:"\u80CC\u666F\u5757",img:j("bg-box.svg")},yn={name:"VBorderBox",alias:"\u8FB9\u6846",img:j("border-box.svg")},Cn={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:j("img.svg")},xn={name:"VIcon",alias:"\u56FE\u6807",img:j("icon.svg")},wn={name:"VScrollTable",alias:"\u6EDA\u52A8\u8868\u683C",img:j("scroll-table.svg")},Se=[{type:"basic",name:"\u57FA\u7840",icon:"block",group:[],comps:[gn,bn,Cn,yn,xn]},{type:"analysis",name:"\u5206\u6790",icon:"barchart",group:[{name:"\u6307\u6807",comps:[fn,vn]},{name:"\u67F1\u56FE",comps:[qo,Zo,Qo]},{name:"\u7EBF\u56FE",comps:[en,tn]},{name:"\u997C\u56FE",comps:[on,nn]},{name:"\u6563\u70B9\u56FE",comps:[cn,rn]},{name:"\u96F7\u8FBE\u56FE",comps:[an]},{name:"\u5730\u56FE",comps:[sn,ln]},{name:"\u5176\u4ED6\u56FE\u8868",comps:[dn,un,mn,pn]}],comps:[]},{type:"control",name:"\u63A7\u4EF6",icon:"edit-square",group:[],comps:[hn,_n]},{type:"table",name:"\u8868\u683C",icon:"table",group:[],comps:[wn]},{type:"images",name:"\u56FE\u7247",icon:"image",group:[],comps:[]},{type:"comps",name:"\u7EC4\u4EF6",icon:"CodeSandbox",group:[],comps:[]}];function kn(o){const t=[];return Se.forEach(a=>{t.push(...a.comps),a.group.forEach(e=>{t.push(...e.comps)})}),t.find(a=>a.name===o)}const Sn={key:0,class:"comp-wrap"},$n=["title"],Vn={class:"inner"},Mn=["onDragstart","onClick"],Dn=["src"],In={class:"comp-item-text"},Tn={__name:"comps",props:{comps:{type:Array,default:()=>[]}},emits:["dragstart","click"],setup(o,{emit:t}){const a=(l,s)=>t("dragstart",l,s),e=l=>t("click",l);return(l,s)=>o.comps.length>0?(h(),$("div",Sn,[(h(!0),$(J,null,ne(o.comps,(i,r)=>(h(),$("div",{class:"comp-item",key:r,title:i.alias},[n("div",Vn,[n("div",{class:"comp-item-img",draggable:!0,onDragstart:d=>a(d,i.name),onClick:d=>e(i.name)},[n("img",{src:i.img},null,8,Dn)],40,Mn),n("div",In,Q(i.alias),1)])],8,$n))),128))])):Y("",!0)}};var ot=q(Tn,[["__scopeId","data-v-23a6401e"]]);function Pe(){const o=Dt(),t=T("");function a(e){t.value===e?t.value="":t.value=e}o.on("item-click",a),It("collapse",{activeGroupKey:t,collapseMitt:o})}function Rn(o){const t=Tt("collapse"),a=t==null?void 0:t.collapseMitt,e=I(()=>(t==null?void 0:t.activeGroupKey.value)===o.name);function l(s){a==null||a.emit("item-click",s)}return{isActive:e,triggerClick:l}}const Ln={class:"collapse-group"},Bn={class:"name"},Nn={class:"wrap-label"},zn={key:1},En={key:0,class:"wrap-edit"},Un=["onClick"],An=["onClick"],On={class:"content"},Gn={__name:"collapse",props:{title:{type:String,required:!0},name:{type:[String,Number,Object],required:!0},canEdit:{type:Boolean,default:!1}},emits:["edit","remove"],setup(o,{emit:t}){const a=o,{isActive:e,triggerClick:l}=Rn(a),s=T(!1),i=T("");let r="";function d(){l(a.name)}function c(){s.value=!0,i.value=a.title,r=a.title}function m(y){const b=(y.target.value||"").trim();(!b||b===r)&&(s.value=!1)}function g(y){(y.target.value||"").trim()?p():s.value=!1}function p(){s.value=!1,t("edit",i.value)}const f=()=>t("remove");return(y,b)=>{const _=k("b-input"),S=k("b-icon"),C=k("b-collapse-transition"),w=fe("focus");return h(),$("div",Ln,[n("div",{class:E(["header",[{active:v(e)}]]),flex:"cross:center",onClick:d},[n("div",Bn,[n("div",Nn,[s.value?(h(),$("div",{key:0,class:"create-box",onClick:b[1]||(b[1]=oe(()=>{},["stop"]))},[le(u(_,{modelValue:i.value,"onUpdate:modelValue":b[0]||(b[0]=V=>i.value=V),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"mini",style:{width:"150px",top:"-2px"},onBlur:m,onKeyup:ye(g,["enter"])},null,8,["modelValue","onKeyup"]),[[w]])])):(h(),$("div",zn,Q(o.title),1))]),o.canEdit&&!s.value?(h(),$("span",En,[n("i",{class:"b-iconfont b-icon-edit",onClick:oe(c,["stop"])},null,8,Un),n("i",{class:"b-iconfont b-icon-delete",onClick:oe(f,["stop"])},null,8,An)])):Y("",!0),n("span",{class:E(["wrap-arrow",[{active:v(e)}]])},[u(S,{name:"right",size:"12"})],2)])],2),u(C,null,{default:x(()=>[le(n("div",On,[Ee(y.$slots,"default",{},void 0,!0)],512),[[Ue,v(e)]])]),_:3})])}}};var Je=q(Gn,[["__scopeId","data-v-ead41a62"]]);const Yn={class:"group-comps"},Kn={class:"comp-wrap"},Xn={key:0,class:"comp-item img-add"},jn={class:"inner"},Pn={class:"comp-item-img"},Jn={class:"inner"},Hn=["onDragstart","onClick"],Wn={key:0,class:"hover-layer"},Fn=["onClick"],qn=["title"],Zn={__name:"images-item",props:{groupId:{type:String,required:!0}},emits:["dragstart","click"],setup(o,{emit:t}){const a=o,e=T([]),l=I(()=>!Ke.includes(a.groupId)),s=()=>io(a.groupId).then(m=>e.value=m);s();async function i(m){try{H(!0);const g=m.map(p=>({group:a.groupId,name:p.name,attr:{w:p.width,h:p.height},src:p.image}));await ro(g),s()}catch(g){console.log(g)}H(!1)}async function r({group:m,id:g}){try{H(!0),await uo(m,g),s()}catch(p){console.log(p)}H(!1)}const d=(m,g)=>t("dragstart",m,g),c=m=>t("click",m);return(m,g)=>{const p=k("g-upload"),f=fe("lazy");return h(),$("div",Yn,[n("div",Kn,[v(l)?(h(),$("div",Xn,[n("div",jn,[n("div",Pn,[u(p,{onUpload:i,multiple:""})])])])):Y("",!0),(h(!0),$(J,null,ne(e.value,(y,b)=>(h(),$("div",{class:"comp-item",key:b},[n("div",Jn,[n("div",{class:E(["comp-item-img",{"can-edit":v(l)}]),draggable:!0,onDragstart:_=>d(_,y),onClick:_=>c(y)},[le(n("img",null,null,512),[[f,y.src]]),v(l)?(h(),$("div",Wn,[n("i",{class:"b-iconfont b-icon-delete-fill",title:"\u5220\u9664\u56FE\u7247",onClick:oe(_=>r(y),["stop"])},null,8,Fn)])):Y("",!0)],42,Hn),n("div",{class:"comp-item-text",title:JSON.stringify(y,null,2)},Q(y.name),9,qn)])]))),128))])])}}};var Qn=q(Zn,[["__scopeId","data-v-bc0f8576"]]);const ea={class:"group-wrap"},ta={class:"group-list"},oa={key:0,class:"create-box"},na={class:"create-group"},aa={__name:"images-list",emits:["dragstart","click"],setup(o,{emit:t}){const a=T([]);Pe();const e=T({key:"",value:""}),l=be({create:!1,edit:!1}),s=()=>mo().then(f=>a.value=f);s();function i(){e.value={key:`group_images_${me()}`,value:""},l.create=!0}function r(f){if(!l.create)return;(f.target.value||"").trim()?m():l.create=!1}async function d(f,y){try{H(!0);const b={key:f.key,value:y};await po(b),s(),W.success("\u4FEE\u6539\u6210\u529F")}catch(b){console.log(b)}H(!1)}async function c(f){try{await pe.confirm({type:"error",title:"\u786E\u5B9A\u79FB\u9664\u5F53\u524D\u56FE\u7247\u5206\u7EC4\u5417\uFF1F"}),H(!0),await vo(f.key),s(),W.success("\u5220\u9664\u6210\u529F\uFF01")}catch(y){console.log(y)}H(!1)}async function m(){try{H(!0),await fo(e.value),s(),l.create=!1,W.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(f){console.log(f)}H(!1)}const g=(f,y)=>t("dragstart",f,y),p=f=>t("click",f);return(f,y)=>{const b=k("b-input"),_=k("b-scrollbar"),S=k("b-button"),C=fe("focus");return h(),$("div",ea,[n("div",ta,[u(_,{native:""},{default:x(()=>[(h(!0),$(J,null,ne(a.value,w=>(h(),z(Je,{key:w.key,name:w.key,title:w.value,"can-edit":!v(Ke).includes(w.key),onEdit:V=>d(w,V),onRemove:V=>c(w)},{default:x(()=>[u(Qn,{"group-id":w.key,onDragstart:g,onClick:p},null,8,["group-id"])]),_:2},1032,["name","title","can-edit","onEdit","onRemove"]))),128)),l.create?(h(),$("div",oa,[le(u(b,{modelValue:e.value.value,"onUpdate:modelValue":y[0]||(y[0]=w=>e.value.value=w),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"small",onBlur:r,onKeyup:ye(r,["enter"])},null,8,["modelValue","onKeyup"]),[[C]])])):Y("",!0)]),_:1})]),n("div",na,[u(S,{type:"primary",transparent:"",onClick:i},{default:x(()=>[N("\u521B\u5EFA\u56FE\u7247\u5206\u7EC4")]),_:1})])])}}};var sa=q(aa,[["__scopeId","data-v-74e445e6"]]);const vt=[];vt.map(o=>o.key);const ft="COMPS_GROUP",_t="COMPS_LIB",Te=async()=>Ve.getItem(ft),Re=async o=>Ve.setItem(ft,Ie(o)),He=async()=>Ve.getItem(_t),Ne=async o=>Ve.setItem(_t,Ie(o));async function ht(){try{const o=await Te();if(o)return o;const t=Ie(vt);return await Re(t),t}catch{return[]}}async function la(o){try{const t=await Te();return t?(t.push(o),await Re(t),!0):!1}catch{return!1}}async function ca(o){try{const t=await Te();if(t){const a=Ye(t,o.key,"key");return t[a].value=o.value,await Re(t),o.key}return!1}catch{return!1}}async function ia(o){try{const t=await Te();if(t){const a=Ye(t,o,"key");return t.splice(a,1),await Re(t),!0}return!1}catch{return!1}}async function ra(o,t,a){try{const e={id:Kt(),group:o,comp:t,src:a},l=await He();return l?(l.push(e),await Ne(l),!0):(await Ne([e]),!1)}catch{return!1}}async function da(o){try{const t=await He();return t?t.filter(a=>a.group===o):[]}catch{return[]}}async function ua(o,t){try{const a=await He();if(a){const e=a.filter(s=>s.group===o),l=Ye(e,t);return e.splice(l,1),await Ne(e),!0}return!1}catch{return!1}}const ma={class:"group-comps"},pa={key:1,class:"comp-wrap"},va={class:"inner"},fa=["onDragstart","onClick"],_a={class:"hover-layer"},ha=["onClick"],ga={class:"comp-item-text"},ba={__name:"comp-item",props:{groupId:{type:String,required:!0}},emits:["dragstart","click"],setup(o,{emit:t}){const a=o,e=T([]),l=()=>da(a.groupId).then(d=>e.value=d);l();async function s({group:d,id:c}){try{H(!0),await ua(d,c),l()}catch(m){console.log(m)}H(!1)}const i=(d,c)=>t("dragstart",d,c),r=d=>t("click",d);return(d,c)=>{const m=k("b-empty"),g=fe("lazy");return h(),$("div",ma,[e.value.length===0?(h(),z(m,{key:0},{default:x(()=>[N("\u6682\u65E0\u7EC4\u4EF6")]),_:1})):(h(),$("div",pa,[(h(!0),$(J,null,ne(e.value,(p,f)=>(h(),$("div",{class:"comp-item",key:f},[n("div",va,[n("div",{class:"comp-item-img",draggable:!0,onDragstart:y=>i(y,p.comp),onClick:y=>r(p.comp)},[le(n("img",null,null,512),[[g,p.src]]),n("div",_a,[n("i",{class:"b-iconfont b-icon-delete-fill",title:"\u5220\u9664\u56FE\u7247",onClick:oe(y=>s(p),["stop"])},null,8,ha)])],40,fa),n("div",ga,Q(p.comp.alias),1)])]))),128))]))])}}};var ya=q(ba,[["__scopeId","data-v-c2ee8224"]]);const Ca={class:"group-wrap"},xa={class:"group-list"},wa={key:1,class:"create-box"},ka={class:"create-group"},Sa={__name:"comp-list",emits:["dragstart","click"],setup(o,{emit:t}){const a=T([]);Pe();const e=T({key:"",value:""}),l=be({create:!1,edit:!1}),s=()=>ht().then(f=>a.value=f);s();function i(){e.value={key:`group_comp_${me()}`,value:""},l.create=!0}function r(f){if(!l.create)return;(f.target.value||"").trim()?m():l.create=!1}async function d(f,y){try{H(!0);const b={key:f.key,value:y};await ca(b),s(),W.success("\u4FEE\u6539\u6210\u529F")}catch(b){console.log(b)}H(!1)}async function c(f){try{H(!0),await pe.confirm({type:"error",title:"\u786E\u5B9A\u79FB\u9664\u5F53\u524D\u7EC4\u4EF6\u5E93\u5417\uFF1F"}),await ia(f.key),s(),W.success("\u5220\u9664\u6210\u529F\uFF01")}catch(y){console.log(y)}H(!1)}async function m(){try{H(!0),await la(e.value),s(),l.create=!1,W.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(f){console.log(f)}H(!1)}const g=(f,y)=>t("dragstart",f,y),p=f=>t("click",f);return(f,y)=>{const b=k("b-empty"),_=k("b-input"),S=k("b-scrollbar"),C=k("b-button"),w=fe("focus");return h(),$("div",Ca,[n("div",xa,[u(S,{native:""},{default:x(()=>[a.value.length===0?(h(),z(b,{key:0},{default:x(()=>[N("\u6682\u65E0\u7EC4\u4EF6\u5E93")]),_:1})):Y("",!0),(h(!0),$(J,null,ne(a.value,V=>(h(),z(Je,{key:V.key,name:V.key,title:V.value,"can-edit":!v(Ke).includes(V.key),onEdit:U=>d(V,U),onRemove:U=>c(V)},{default:x(()=>[u(ya,{"group-id":V.key,onDragstart:g,onClick:p},null,8,["group-id"])]),_:2},1032,["name","title","can-edit","onEdit","onRemove"]))),128)),l.create?(h(),$("div",wa,[le(u(_,{modelValue:e.value.value,"onUpdate:modelValue":y[0]||(y[0]=V=>e.value.value=V),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"small",onBlur:r,onKeyup:ye(r,["enter"])},null,8,["modelValue","onKeyup"]),[[w]])])):Y("",!0)]),_:1})]),n("div",ka,[u(C,{type:"primary",transparent:"",onClick:i},{default:x(()=>[N("\u521B\u5EFA\u7EC4\u4EF6\u5E93")]),_:1})])])}}};var $a=q(Sa,[["__scopeId","data-v-47c3cece"]]);const Va={class:"components-panel-wp"},Ma={class:"components-panel"},Da=n("div",{class:"panel-title"},[n("span",{class:"panel-text"},"\u7EC4\u4EF6")],-1),Ia={class:"components-type"},Ta=["onClick"],Ra={class:"com-tab-title"},La=n("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),Ba=[La],Na={class:"components-list-content"},za={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{pageConfig:e,toolbar:l,selectedCom:s}=a(t),i=T(-1);Pe();const r=I(()=>i.value===-1?[]:Se[i.value].group),d=I(()=>i.value===-1?[]:Se[i.value].comps);function c(C){t.toggleCompsPanel(!0),i.value=C}function m(C,w){C.dataTransfer.setData("normal-comp",w)}async function g(C){try{const w=mt(C);if(w.attr.x=Math.floor((e.value.width-w.attr.w)/2),w.attr.y=Math.floor((e.value.height-w.attr.h)/2),t.addCom({component:w}),t.selectCom(w),w.apiData&&w.apiData.type===Ae.static&&w.apiData.staticPath){const{data:V}=await pt(w.id,w.apiData.staticPath);s.value.apiData.config.data=JSON.stringify(V)}}catch(w){console.log(w)}}function p(C,w){C.dataTransfer.setData("image-comp",JSON.stringify(Ze(w)))}function f(C){const w=Ze(C);w.attr.x=Math.floor((e.value.width-w.attr.w)/2),w.attr.y=Math.floor((e.value.height-w.attr.h)/2),t.addCom({component:w}),t.selectCom(w)}function y(C,w){C.dataTransfer.setData("custom-comp",JSON.stringify(Qe(w)))}function b(C){const w=Qe(C);t.addCom({component:w}),t.selectCom(w)}function _(C){C.preventDefault(),C.stopPropagation(),C.dataTransfer.dropEffect="none"}function S(){l.value.components&&(t.toggleCompsPanel(!1),i.value=-1)}return(C,w)=>{const V=k("b-icon"),U=k("b-scrollbar");return h(),$("div",Va,[n("div",Ma,[Da,n("div",{class:"components-panel-content",onDragover:_},[n("div",Ia,[u(U,{native:""},{default:x(()=>[(h(!0),$(J,null,ne(v(Se),(B,A)=>(h(),$("div",{class:E(["components-item",{active:i.value===A}]),key:A,onClick:X=>c(A)},[u(V,{class:"com-tab-icon",name:B.icon},null,8,["name"]),n("span",Ra,Q(B.name),1)],10,Ta))),128))]),_:1})])],32),n("div",{class:E(["components-list",{"is-hide":!v(l).components}])},[n("div",{class:"components-list-top"},[n("div",{class:"action",onClick:S},Ba)]),n("div",Na,[u(U,{native:""},{default:x(()=>[(h(!0),$(J,null,ne(v(r),(B,A)=>(h(),z(Je,{key:A,name:A,title:B.name},{default:x(()=>[u(ot,{comps:B.comps,onDragstart:m,onClick:g},null,8,["comps"])]),_:2},1032,["name","title"]))),128)),u(ot,{comps:v(d),onDragstart:m,onClick:g},null,8,["comps"]),i.value===4?(h(),z(sa,{key:0,onDragstart:p,onClick:f})):Y("",!0),i.value===5?(h(),z($a,{key:1,onDragstart:y,onClick:b})):Y("",!0)]),_:1})])],2)])])}}},nt=o=>`${o}px`,at=(o,t,a,e)=>{const l=o!=null?o:document.createElement("canvas");l.width=t*e,l.height=a*e,l.style.width=nt(t),l.style.height=nt(a);const s=l.getContext("2d");return s&&s.setTransform(e,0,0,e,0,0),l};class st{constructor(t,a){this.el=t,this.options={direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2,...a},this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:a}=this,{direction:e,width:l,height:s,ratio:i}=a,r=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,l),d=s;this.ruler.width=r,this.ruler.height=d;const c=at(null,r,d,i);Xt(c,"canvas-ruler"),t.appendChild(c),this.canvas=c,this.ctx=c.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:a,ruler:e}=this,{width:l,height:s}=e;t.beginPath(),t.fillStyle=a.bgColor,t.fillRect(0,0,l,s),t.closePath(),t.beginPath(),t.font=`${a.fontSize} ${a.fontFamily}`,t.textAlign="left",t.fillStyle=a.fontColor,t.strokeStyle=a.strokeStyle,t.lineWidth=a.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:a,ruler:e}=this,{width:l,height:s}=e,{offset:i,scale:r}=a,d=0,c=s/1.5,m=s/1.2;for(let g=0;g<=l;g+=1){const p=g-i;if(p<0)continue;let f=-1,y=-1;p%50===0?(f=Math.floor(p/r),y=d):p%25===0?y=c:p%5===0&&(y=m),y>=0&&(t.moveTo(g+.5,s+.5),t.lineTo(g+.5,y),f>-1&&t.fillText(`${f}`,g+2.5,s/1.5))}}setSize(t,a,e){const{el:l,options:s}=this;s.width=t,s.height=a,s.scale=e;const{direction:i,width:r,height:d,ratio:c}=s,m=Math.max(i==="TB"?l.offsetWidth:l.offsetHeight,r),g=d;this.ruler.width=m,this.ruler.height=g,at(this.canvas,m,g,c),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const Ea={name:"ruler",setup(){const{schemaStore:o,storeToRefs:t}=K(),{canvas:a}=t(o),e=T(null),l=T(null),s=T(null),i=T(null),r=T(!0),d=T(0),c=T(0),m=document.documentElement.clientWidth;Rt(()=>{if(e.value&&l.value){const p=Math.max(a.value.width,m);s.value?s.value.setSize(p,18,a.value.scale):s.value=new st(e.value,{direction:"TB",width:p,scale:a.value.scale}),i.value?i.value.setSize(a.value.height,18,a.value.scale):i.value=new st(l.value,{direction:"LR",width:a.value.height,scale:a.value.scale})}});const g=p=>{const f=p.target;d.value=f.scrollLeft,c.value=f.scrollTop};return Ce(()=>{const p=document.getElementById("canvas-wp");p==null||p.addEventListener("scroll",g)}),Lt(()=>{const p=document.getElementById("canvas-wp");p==null||p.removeEventListener("scroll",g)}),{visible:r,hRulerWpRef:e,vRulerWpRef:l,vScroll:c,hScroll:d}}},Ua=o=>(xe("data-v-5f454e16"),o=o(),we(),o),Aa={class:"canvas-ruler-wp"},Oa=Ua(()=>n("div",{class:"ruler-corner"},null,-1));function Ga(o,t,a,e,l,s){return h(),$("div",Aa,[n("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:F(`transform: translateX(-${e.hScroll}px);`)},null,4),n("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:F(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),Oa])}var Ya=q(Ea,[["render",Ga],["__scopeId","data-v-5f454e16"]]);function lt(o){if(o={...o},o.rotate!==0){const t=o.width*et(o.rotate)+o.height*tt(o.rotate),a=(o.width-t)/2;o.left+=a,o.right=o.left+t;const e=o.height*et(o.rotate)+o.width*tt(o.rotate),l=(e-o.height)/2;o.top-=l,o.bottom=o.top+e,o.width=t,o.height=e}else o.bottom=o.top+o.height,o.right=o.left+o.width;return o}const Ka=5,Xa={name:"mark-line",setup(){const{schemaStore:o,storeToRefs:t}=K(),{comps:a,selectedCom:e,canvas:l,toolbox:s}=t(o),i=T([]),r=T(["xt","xc","xb","yl","yc","yr"]),d=T({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),c=()=>{Object.keys(d.value).forEach(_=>{d.value[_]=!1})};function m({key:_,value:S}){const C={left:"x",top:"y"};o.setShapeSingleStyle({key:C[_],value:S})}const g=(_,S)=>{const C=i.value,w=e.value,V=a.value.filter(D=>!D.hided),U=l.value.scale,B=lt(y(w.attr)),A=B.width/2,X=B.height/2;c(),V.forEach(D=>{if(D.id===w.id||D.locked||D.hided)return;const{top:O,left:R,bottom:M,right:L,width:G,height:P}=lt(y(D.attr)),se=G/2,ie=P/2,ae={top:[{isNearly:b(B.top,O),lineNode:C.xt,line:"xt",dragShift:O,lineShift:O},{isNearly:b(B.bottom,O),lineNode:C.xt,line:"xt",dragShift:O-B.height,lineShift:O},{isNearly:b(B.top+X,O+ie),lineNode:C.xc,line:"xc",dragShift:O+ie-X,lineShift:O+ie},{isNearly:b(B.top,M),lineNode:C.xb,line:"xb",dragShift:M,lineShift:M},{isNearly:b(B.bottom,M),lineNode:C.xb,line:"xb",dragShift:M-B.height,lineShift:M}],left:[{isNearly:b(B.left,R),lineNode:C.yl,line:"yl",dragShift:R,lineShift:R},{isNearly:b(B.right,R),lineNode:C.yl,line:"yl",dragShift:R-B.width,lineShift:R},{isNearly:b(B.left+A,R+se),lineNode:C.yc,line:"yc",dragShift:R+se-A,lineShift:R+se},{isNearly:b(B.left,L),lineNode:C.yr,line:"yr",dragShift:L,lineShift:L},{isNearly:b(B.right,L),lineNode:C.yr,line:"yr",dragShift:L-B.width,lineShift:L}]},_e=[],{rotate:Be}=B;Object.keys(ae).forEach(ue=>{ae[ue].forEach(ce=>{if(!ce.isNearly)return;const ke=Be!==0?p(ue,ce,B):ce.dragShift;m({key:ue,value:ke}),ce.lineNode.style[ue]=`${ce.lineShift*U+60}px`,_e.push(ce.line)})}),_e.length&&f(_e,_,S)})},p=(_,S,C)=>{const{w,h:V}=e.value.attr;return Math.round(_==="top"?S.dragShift-(V-C.height)/2:S.dragShift-(w-C.width)/2)},f=(_,S,C)=>{C?_.includes("yr")?d.value.yr=!0:_.includes("yc")?d.value.yc=!0:_.includes("yl")&&(d.value.yl=!0):_.includes("yl")?d.value.yl=!0:_.includes("yc")?d.value.yc=!0:_.includes("yr")&&(d.value.yr=!0),S?_.includes("xb")?d.value.xb=!0:_.includes("xc")?d.value.xc=!0:_.includes("xt")&&(d.value.xt=!0):_.includes("xt")?d.value.xt=!0:_.includes("xc")?d.value.xc=!0:_.includes("xb")&&(d.value.xb=!0)},y=_=>({left:_.x,top:_.y,width:_.w,height:_.h,rotate:_.rotate}),b=(_,S)=>Math.abs(_-S)<=Ka;return Ce(()=>{de.on("move",({isDownward:_,isRightward:S})=>{s.value.markLine&&g(_,S)}),de.on("unmove",()=>{c()})}),Me(()=>{de.off("move"),de.off("unmove")}),{lineRefs:i,lines:r,lineStatus:d}}},ja={class:"mark-line"};function Pa(o,t,a,e,l,s){return h(),$("div",ja,[(h(!0),$(J,null,ne(e.lines,i=>le((h(),$("div",{key:i,class:E(["line",[i.includes("x")?"xline":"yline",i]]),ref_for:!0,ref:r=>{e.lineRefs[i]=r}},null,2)),[[Ue,e.lineStatus[i]||!1]])),128))])}var Ja=q(Xa,[["render",Pa],["__scopeId","data-v-00d4450a"]]);const{schemaStore:gt}=K(),Ha=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],ct=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],Wa=o=>{const t=(o+360)%360,a={};let e=-1;return Ha.forEach(l=>{const s=(l.angle+t)%360,i=ct.length,r=0;for(;r<i;){e=(e+1)%i;const d=ct[e];if(s<23||s>=338){a[l.direction]="nwse-resize";break}if(d.start<=s&&s<d.end){a[l.direction]=d.cursor;break}}}),a};function Fa(o,t,a,e,l,s,i){o==="t"?(s.h=Math.round(t.h+(a.y-e.y)/l),s.y=Math.round(t.y+(e.y-a.y)/l),s.h=Math.max(s.h,20),t.lockedRatio&&(s.w=s.h*i)):o==="rt"?(s.h=Math.round(t.h+(a.y-e.y)/l),s.w=Math.round(t.w+(e.x-a.x)/l),s.y=Math.round(t.y+(e.y-a.y)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20),t.lockedRatio&&(s.w=s.h*i)):o==="r"?(s.w=Math.round(t.w+(e.x-a.x)/l),s.w=Math.max(s.w,20),t.lockedRatio&&(s.h=s.w/i)):o==="rb"?(s.h=Math.round(t.h+(e.y-a.y)/l),s.w=Math.round(t.w+(e.x-a.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20),t.lockedRatio&&(s.h=s.w/i)):o==="b"?(s.h=Math.round(t.h+(e.y-a.y)/l),s.h=Math.max(s.h,20),t.lockedRatio&&(s.w=s.h*i)):o==="lb"?(s.h=Math.round(t.h+(e.y-a.y)/l),s.w=Math.round(t.w+(a.x-e.x)/l),s.x=Math.round(t.x+(e.x-a.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20),t.lockedRatio&&(s.h=s.w/i)):o==="l"?(s.w=Math.round(t.w+(a.x-e.x)/l),s.x=Math.round(t.x+(e.x-a.x)/l),s.w=Math.max(s.w,20),t.lockedRatio&&(s.h=s.w/i)):o==="lt"&&(s.h=Math.round(t.h+(a.y-e.y)/l),s.w=Math.round(t.w+(a.x-e.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20),s.x=Math.round(t.x+(e.x-a.x)/l),s.y=Math.round(t.y+(e.y-a.y)/l),t.lockedRatio&&(s.h=s.w/i,s.y=Math.round(t.y+(e.x-a.x)/l)))}const bt=(o,t,a,e,l)=>{const s={...a.attr},i=s.w/s.h,r=Object.create(null),d=o.clientX,c=o.clientY;let m=!1;const g=f=>{const y=f.clientX,b=f.clientY,_=Math.round((y-d)/e/l)*l,S=Math.round((b-c)/e/l)*l;m=Math.abs(_)>=1||Math.abs(S)>=1,t?Fa(t,s,{x:d,y:c},{x:y,y:b},e,r,i):(r.x=s.x+_,r.y=s.y+S),a.attr={...a.attr,...r},ge().then(()=>{de.emit("move",{isDownward:b-c>0,isRightward:y-d>0})})},p=()=>{de.emit("unmove"),m&&gt.recordSnapshot(),te(document,"mousemove",g),te(document,"mouseup",p)};ee(document,"mousemove",g),ee(document,"mouseup",p)},qa=(o,t,a,e)=>{bt(o,null,t,a,e)},Za=(o,t,a,e,l)=>{bt(o,t,a,e,l)},Qa=(o,t,a)=>{const e=t.getBoundingClientRect(),l=e.left+e.width/2,s=e.top+e.height/2,i=Math.atan2(s-o.clientY,l-o.clientX)*180/Math.PI-a.attr.rotate;let r=!1;const d=m=>{r=!0;const g=Math.atan2(s-m.clientY,l-m.clientX)*180/Math.PI-i,p=Math.round(g%360);a.attr.rotate=p<0?p+360:p},c=()=>{r&&gt.recordSnapshot(),te(document,"mousemove",d),te(document,"mouseup",c)};ee(document,"mousemove",d),ee(document,"mouseup",c)},es={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(o){const t=I(()=>({height:`${o.attr.y+60/o.scale}px`,borderLeftWidth:`${.9/o.scale}px`})),a=I(()=>({width:`${o.attr.x+60/o.scale}px`,borderTopWidth:`${.9/o.scale}px`})),e=I(()=>({fontSize:`${12/o.scale}px`,top:`-${6/o.scale}px`,left:`-${6/o.scale}px`}));return{topLineStyle:t,leftLineStyle:a,accountStyle:e}}},ts={class:"nav-line"};function os(o,t,a,e,l,s){return h(),$("div",ts,[n("div",{class:"nav-line-top",style:F(e.topLineStyle)},null,4),n("div",{class:"nav-line-left",style:F(e.leftLineStyle)},null,4),n("div",{class:"nav-line-account",style:F(e.accountStyle)},Q(a.attr.x)+", "+Q(a.attr.y),5)])}var ns=q(es,[["render",os]]);const as={name:"dv-transform",components:{ReferLine:ns},props:{data:{type:Object,required:!0}},setup(o){const t=Bt(),{showMenu:a}=je(),{schemaStore:e,storeToRefs:l}=K(),{canvas:s,comps:i,pageConfig:r,selectedCom:d,hoveredComId:c,toolbox:m,spaceDown:g,isMultiSelect:p}=l(e),f=I(()=>c.value===o.data.id),y=I(()=>p.value?!1:!De(d.value)&&d.value.id===o.data.id),b=I(()=>({locked:o.data.locked,selected:y.value})),_=I(()=>({top:0,left:0,width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`,transform:`translate(${o.data.attr.x}px, ${o.data.attr.y}px)`})),S=I(()=>({"is-hide":!y.value||o.data.locked})),C=I(()=>({transform:`rotate(${o.data.attr.rotate}deg)`})),w=I(()=>({width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`})),V=I(()=>({display:o.data.hided?"none":"block"})),U=I(()=>Wa(o.data.attr.rotate)),B=I(()=>s.value.scale),A=I(()=>{const G=`scale(${1/B.value}, ${1/B.value})`;return{t:{name:"top",style:{cursor:U.value.t,transform:G}},rt:{name:"top-right",style:{cursor:U.value.rt,transform:G}},r:{name:"right",style:{cursor:U.value.r,transform:G}},rb:{name:"bottom-right",style:{cursor:U.value.rb,transform:G}},b:{name:"bottom",style:{cursor:U.value.b,transform:G}},lb:{name:"bottom-left",style:{cursor:U.value.lb,transform:G}},l:{name:"left",style:{cursor:U.value.l,transform:G}},lt:{name:"top-left",style:{cursor:U.value.lt,transform:G}}}}),X=()=>e.hoverCom(o.data.id),D=()=>e.hoverCom(""),O=()=>{e.selectCom(o.data)};return{comps:i,selectedCom:d,hoveredComId:c,toolbox:m,isHovered:f,isSelected:y,hideStyle:V,transformClass:b,transformStyle:_,handlerClass:S,handlerStyle:C,wrapperStyle:w,onEnter:X,onLeave:D,onMove:G=>{g.value||(G.stopPropagation(),G.preventDefault(),O(),!o.data.locked&&qa(G,o.data,B.value,r.value.grid))},onZoom:(G,P)=>{O(),Za(G,P,o.data,B.value,r.value.grid)},onRotate:G=>{Qa(G,t.vnode.el,o.data)},points:A,scale:B,showMenu:a}}},ss={class:"dv-com"},ls=["onMousedown"],cs=["onMousedown"],is=n("div",{class:"transform-bg"},null,-1),rs={key:1,class:"b-iconfont b-icon-lock",title:"\u89E3\u9501"};function ds(o,t,a,e,l,s){const i=k("refer-line");return h(),$("div",{class:E(["dv-transform",e.transformClass]),style:F(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(h(),z(i,{key:0,attr:a.data.attr,scale:e.scale},null,8,["attr","scale"])):Y("",!0),n("div",{class:E(["dv-scale",{hovered:e.isHovered}]),style:F(e.hideStyle),onMouseenter:t[2]||(t[2]=(...r)=>e.onEnter&&e.onEnter(...r)),onMouseleave:t[3]||(t[3]=(...r)=>e.onLeave&&e.onLeave(...r)),onMousedown:t[4]||(t[4]=(...r)=>e.onMove&&e.onMove(...r))},[n("div",{class:E(["transform-handler",e.handlerClass]),style:F(e.handlerStyle)},[n("div",ss,[Ee(o.$slots,"default"),n("div",{class:"dv-event-disable",style:F(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...r)=>e.showMenu&&e.showMenu(...r))},null,36)]),(h(!0),$(J,null,ne(e.points,(r,d)=>(h(),$(J,{key:d},[r.rotateStyle?(h(),$("i",{key:0,class:E(`${r.name}-handler`),"data-html2canvas-ignore":""},[n("span",{class:"rotate-handler",style:F(r.rotateStyle),onMousedown:t[1]||(t[1]=oe((...c)=>e.onRotate&&e.onRotate(...c),["prevent","stop"]))},[n("span",{class:"control-point",style:F(r.style),onMousedown:oe(c=>e.onZoom(c,d),["prevent","stop"])},null,44,ls)],36)],2)):(h(),$("i",{key:1,class:E(`${r.name}-handler`),"data-html2canvas-ignore":""},[n("span",{class:"control-point",style:F(r.style),onMousedown:oe(c=>e.onZoom(c,d),["prevent","stop"])},null,44,cs)],2))],64))),128)),is],6)],38),a.data.locked?(h(),$("i",rs)):Y("",!0)],6)}var us=q(as,[["render",ds]]);const ms=["onClick"],ps=["onClick"],vs={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{undoDisable:e,redoDisable:l}=a(t),s=I(()=>t.toolbar.config?{right:"330px"}:{right:0}),i=()=>t.undo(),r=()=>t.redo();return(d,c)=>(h(),$("div",{class:"action-bar-wrap",style:F(v(s))},[n("i",{class:"action-btn b-iconfont b-icon-aim",title:"\u6700\u4F73\u753B\u5E03\u6BD4\u4F8B",onClick:c[0]||(c[0]=oe(m=>v(t).autoCanvasScale(),["stop"]))}),n("i",{class:"action-btn b-iconfont b-icon-icon-test",title:"1:1\u753B\u5E03\u5927\u5C0F",onClick:c[1]||(c[1]=oe(m=>v(t).setCanvasScale(100),["stop"]))}),n("i",{class:E(["action-btn b-iconfont b-icon-rollback",{disabled:v(e)}]),title:"\u64A4\u9500",onClick:oe(i,["stop"])},null,10,ms),n("i",{class:E(["action-btn b-iconfont b-icon-rollback",{disabled:v(l)}]),title:"\u91CD\u505A",onClick:oe(r,["stop"]),style:{transform:"rotateY(180deg)"}},null,10,ps)],4))}};var fs=q(vs,[["__scopeId","data-v-293a1cf3"]]);const _s=["onMousedown"],hs={__name:"index",props:{x:Number,y:Number,width:Number,height:Number,showArea:Boolean},setup(o){const{schemaStore:t,storeToRefs:a}=K(),{pageConfig:e,canvas:l,selectedComs:s,areaData:i}=a(t);function r(d){let c=!1;const m={x:i.value.x,y:i.value.y},g=s.value.map(V=>V.attr),p=Object.create(null),f=[],y=d.clientX,b=d.clientY,_=l.value.scale,S=e.value.grid,C=V=>{const U=V.clientX,B=V.clientY,A=Math.round((U-y)/_/S)*S,X=Math.round((B-b)/_/S)*S;c=Math.abs(A)>=1||Math.abs(X)>=1,p.x=m.x+A,p.y=m.y+X,i.value={...i.value,...p},s.value.forEach((D,O)=>{f[O]={x:g[O].x+A,y:g[O].y+X},D.attr={...D.attr,...f[O]}})},w=()=>{c&&t.recordSnapshot(),te(document,"mousemove",C),te(document,"mouseup",w)};ee(document,"mousemove",C),ee(document,"mouseup",w)}return(d,c)=>le((h(),$("div",{style:F({left:o.x+"px",top:o.y+"px",width:o.width+"px",height:o.height+"px"}),class:"select-area",onMousedown:oe(r,["stop"])},null,44,_s)),[[Ue,o.showArea]])}};var gs=q(hs,[["__scopeId","data-v-8dc9f1ea"]]);const bs={class:"canvas-main"},ys=["onMousedown"],Cs={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{pageConfig:e,spaceDown:l,canvas:s,selectedCom:i,comps:r,toolbox:d,getPanelOffsetLeft:c,getPanelOffsetTop:m,editorEL:g,areaData:p}=a(t),f=T(null),y=be({drag:!1,startX:0,startY:0});let b=0,_=0;const S=I(()=>({width:`${s.value.width}px`,height:`${s.value.height}px`})),C=I(()=>({position:"absolute",width:`${e.value.width}px`,height:`${e.value.height}px`,transform:`scale(${s.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${e.value.bgImage})`,backgroundColor:e.value.bgColor})),w=jt(t.autoCanvasScale,50);async function V(R){R.preventDefault();try{const M=R.dataTransfer.getData("image-comp");if(M){const P=JSON.parse(M);U(R,P);return}const L=R.dataTransfer.getData("custom-comp");if(L){const P=JSON.parse(L);U(R,P);return}const G=R.dataTransfer.getData("normal-comp");if(G){const P=mt(G);if(U(R,P),P.apiData&&P.apiData.type===Ae.static&&P.apiData.staticPath){const{data:se}=await pt(P.id,P.apiData.staticPath);i.value.apiData.config.data=JSON.stringify(se)}}}catch(M){console.warn(M)}}function U(R,M){const{scale:L}=s.value,G=(R.clientX-c.value+f.value.scrollLeft)/L,P=(R.clientY-m.value+f.value.scrollTop)/L;M.attr.x=Math.round(G-M.attr.w/2),M.attr.y=Math.round(P-M.attr.h/2),t.addCom({component:M}),t.selectCom(M)}function B(R){R.preventDefault(),R.stopPropagation(),R.dataTransfer.dropEffect="copy"}function A(R){if(l.value){y.drag=!0;const M=R.clientX,L=R.clientY,G=s.value.scale,{scrollLeft:P,scrollTop:se,clientWidth:ie,scrollWidth:ae,clientHeight:_e,scrollHeight:Be}=f.value,ue=ie<ae||_e<Be,ce={left:P,top:se},ke=Fe=>{if(ue){const wt=Fe.clientX,kt=Fe.clientY,St=Math.round((wt-M)/G),$t=Math.round((kt-L)/G);f.value.scrollLeft=ce.left-St,f.value.scrollTop=ce.top-$t}},We=()=>{y.drag=!1,te(document,"mousemove",ke),te(document,"mouseup",We)};ee(document,"mousemove",ke),ee(document,"mouseup",We)}else t.selectCom()}function X(R){if(i.value||R.preventDefault(),l.value||R.target.className==="select-area")return;O();const M=g.value.getBoundingClientRect();b=M.x,_=M.y;const L=R.clientX,G=R.clientY;p.value.showArea=!0;const P=s.value.scale;p.value.x=(L-b)/P,p.value.y=(G-_)/P;const se=ae=>{p.value.width=Math.abs((ae.clientX-L)/P),p.value.height=Math.abs((ae.clientY-G)/P),ae.clientX<L&&(p.value.x=(ae.clientX-b)/P),ae.clientY<G&&(p.value.y=(ae.clientY-_)/P)},ie=ae=>{if(te(document,"mousemove",se),te(document,"mouseup",ie),ae.clientX===L&&ae.clientY===G){O();return}D()};ee(document,"mousemove",se),ee(document,"mouseup",ie)}function D(){const R=Pt(p.value,r.value);if(R.length===0){O();return}if(R.length===1){t.selectCom(R[0]),O();return}t.multiSelectComs(R)}function O(){p.value.showArea=!1,p.value.width=0,p.value.height=0}return Ce(()=>{ee(window,"resize",w),de.on("hideArea",O),t.getEditor(),w()}),Me(()=>{te(window,"resize",w)}),(R,M)=>(h(),$("div",bs,[n("div",{id:"canvas-wp",ref_key:"canvasWpRef",ref:f,class:"canvas-panel-wrap",onMousedown:oe(A,["stop"])},[n("div",{class:"screen-shot",style:F(v(S))},[v(d).markLine?(h(),z(Ja,{key:0,style:F(v(S))},null,8,["style"])):Y("",!0),u(fs),u(Ya),n("div",{id:"canvas-components",class:"canvas-panel",style:F(v(C)),onDragover:B,onDrop:V,onMousedown:X},[(h(!0),$(J,null,ne(v(r),L=>(h(),z(us,{key:L.id,data:L},{default:x(()=>[(h(),z(ut(L.name),{data:L,style:F({width:L.attr.w+"px",height:L.attr.h+"px",opacity:L.attr.opacity,transform:"translateZ(0px)"}),id:`component_${L.id}`},null,8,["data","style","id"]))]),_:2},1032,["data"]))),128)),u(gs,Nt(zt(v(p))),null,16)],36)],4)],40,ys)]))}};async function ze(o){try{const t=o.clientWidth,a=o.clientHeight;return await Et(o,{quality:.7,width:t,height:a})}catch(t){return console.error(t),""}}const xs={name:"page-config",setup(){const{schemaStore:o,storeToRefs:t}=K(),{pageConfig:a}=t(o),e=T(""),l=T(!1),s=()=>{a.value.bgColor="#0d2a42",a.value.bgImage=""},i=()=>o.autoCanvasScale(),r=c=>{if(c!=="custom"){const m=c.split("x"),g=+m[0],p=+m[1];o.setScreenSize({width:g,height:p})}};async function d(){H(!0),W.warning("\u6B63\u5728\u622A\u53D6\u753B\u5E03\u7F29\u7565\u56FE\uFF0C\u8BF7\u52FF\u8FDB\u884C\u5176\u4ED6\u64CD\u4F5C\uFF01"),l.value=!0;const c=document.getElementById("canvas-components");c.style.top=0,c.style.left=0,o.setCanvasScale(100),setTimeout(async()=>{try{const m=await ze(c);a.value.thumbnail=m,W.success("\u622A\u53D6\u7F29\u7565\u56FE\u6210\u529F\uFF01")}catch(m){console.log(m)}c.style.top="60px",c.style.left="60px",o.autoCanvasScale(),l.value=!1,H(!1)},300)}return ve([()=>a.value.width,()=>a.value.height],()=>{const{width:c,height:m}=a.value;c===1920&&m===1080||c===2560&&m===1080||c===3440&&m===1080||c===3440&&m===1440||c===414&&m===736||c===375&&m===667||c===375&&m===812?e.value=`${c}x${m}`:e.value="custom"},{immediate:!0}),{screenLabel:e,onSizeChange:i,resetBGImage:s,pageConfig:a,pageMap:[{group:"web\u7AEF",data:Jt.map(c=>({value:`${c.width}x${c.height}`,label:c.label}))},{group:"\u79FB\u52A8\u8BBE\u5907",data:Ht.map(c=>({value:`${c.width}x${c.height}`,label:c.label}))},{group:"\u5176\u4ED6",data:[{value:"custom",label:"\u81EA\u5B9A\u4E49"}]}],sizeChange:r,createPreviewThumb:ze,createThumb:d,thumbLoading:l}}},yt=o=>(xe("data-v-644ec27b"),o=o(),we(),o),ws={class:"page-config-panel"},ks=yt(()=>n("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),Ss={class:"page-config-content"},$s={class:"page-config-wp"},Vs={class:"page-config-wp"},Ms={class:"page-config-wp"},Ds={class:"image-thumb-wrap"},Is=["src"],Ts={key:1,class:"tip",flex:"dir:top main:center cross:center"},Rs=yt(()=>n("p",null,"\u6682\u672A\u622A\u53D6\u7F29\u7565\u56FE",-1)),Ls={class:"pt-5"};function Bs(o,t,a,e,l,s){const i=k("g-group-select"),r=k("g-field"),d=k("g-input-number"),c=k("g-color-picker"),m=k("g-image"),g=k("b-icon"),p=k("b-button"),f=k("b-scrollbar");return h(),$("div",ws,[ks,n("div",Ss,[u(f,null,{default:x(()=>[n("div",$s,[u(r,{label:"\u5C4F\u5E55\u8BBE\u7F6E"},{default:x(()=>[u(i,{modelValue:e.screenLabel,"onUpdate:modelValue":t[0]||(t[0]=y=>e.screenLabel=y),data:e.pageMap,onChange:e.sizeChange},null,8,["modelValue","data","onChange"])]),_:1}),u(r,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:x(()=>[u(d,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[1]||(t[1]=y=>e.pageConfig.width=y),label:"\u5BBD\u5EA6",min:375,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),u(d,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[2]||(t[2]=y=>e.pageConfig.height=y),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),u(r,{label:"\u80CC\u666F\u989C\u8272"},{default:x(()=>[u(c,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[3]||(t[3]=y=>e.pageConfig.bgColor=y)},null,8,["modelValue"])]),_:1}),u(r,{label:"\u80CC\u666F\u9884\u8BBE",tooltip:"\u53EF\u4EE5\u52A0\u8F7D\u5BF9\u5E94\u9884\u8BBE\u7684\u56FE\u7247\u80CC\u666F"},{default:x(()=>[u(m,{"ignore-group-keys":["header","box","decoration","widget"],"show-resize":!1,"show-clear":"",onClear:e.resetBGImage,modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[4]||(t[4]=y=>e.pageConfig.bgImage=y)},null,8,["onClear","modelValue"])]),_:1})]),n("div",Vs,[u(r,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:x(()=>[u(d,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[5]||(t[5]=y=>e.pageConfig.grid=y),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})]),n("div",Ms,[u(r,{label:"\u7F29\u7565\u56FE",tooltip:"\u622A\u53D6\u5F53\u524D\u753B\u5E03\u5B58\u4E3A\u7F29\u7565\u56FE"},{default:x(()=>[n("div",Ds,[e.pageConfig.thumbnail?(h(),$("img",{key:0,src:e.pageConfig.thumbnail,alt:""},null,8,Is)):(h(),$("div",Ts,[u(g,{name:"image",size:"52"}),Rs]))]),n("div",Ls,[u(p,{type:"primary",size:"small",loading:e.thumbLoading,onClick:e.createThumb},{default:x(()=>[N(" \u622A\u53D6 ")]),_:1},8,["loading","onClick"]),u(p,{size:"small",loading:e.thumbLoading,onClick:t[6]||(t[6]=y=>e.pageConfig.thumbnail="")},{default:x(()=>[N(" \u6E05\u9664 ")]),_:1},8,["loading"])])]),_:1})])]),_:1})])])}var Ns=q(xs,[["render",Bs],["__scopeId","data-v-644ec27b"]]);const{schemaStore:Ct,storeToRefs:zs}=K(),{selectedCom:Es}=zs(Ct),Us={name:"config-title",props:{comName:{type:String},comAlias:{type:String},com:{type:Object,default:()=>({})},showCfg:{type:Boolean,default:!1}},emits:["update:com"],setup(o){const t=T(!1),a=T(""),e=I(()=>{const d=kn(o.comName);return d?d.name:o.comName}),l=()=>{t.value=!0,a.value=JSON.stringify(o.com,null,2)},s=()=>{Ge(JSON.stringify(o.com)),W.success("\u5DF2\u590D\u5236\u914D\u7F6E\u9879\u81F3\u526A\u5207\u677F"),t.value=!1},i=()=>{try{const d=JSON.parse(a.value);a.value=JSON.stringify(d,null,2),r(d),W.success("\u56FE\u8868\u5E94\u7528\u6210\u529F\uFF01"),t.value=!1}catch{W.error("\u914D\u7F6E\u9879\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u68C0\u67E5\u540E\u518D\u5E94\u7528\u914D\u7F6E\uFF01")}};function r(d){const c=Es.value.id;Ct.replaceCom(c,d)}return{openDetail:l,compJson:a,comTitle:e,copyCom:s,putJson:i,detailVisible:t}}},As=o=>(xe("data-v-133b1084"),o=o(),we(),o),Os={class:"com-title-wp"},Gs={class:"com-title"},Ys={class:"title-name"},Ks={class:"alias-name"},Xs={class:"version-tag"},js=As(()=>n("span",null,"\u914D\u7F6E\u9879",-1)),Ps={class:"data-editor",style:{margin:"0"}},Js={class:"t-right pt-8"};function Hs(o,t,a,e,l,s){const i=k("b-icon"),r=k("b-ace-editor"),d=k("b-button"),c=k("b-modal");return h(),$("div",Os,[n("div",Gs,[n("div",Ys,[n("span",Ks,Q(a.comAlias),1)]),n("div",Xs,[n("span",null,Q(e.comTitle),1)])]),Ee(o.$slots,"default",{},()=>[a.showCfg?(h(),$("div",{key:0,class:"search-config",onClick:t[0]||(t[0]=(...m)=>e.openDetail&&e.openDetail(...m)),title:"\u67E5\u770B\u914D\u7F6E\u9879"},[u(i,{name:"filesearch",size:"14"}),js])):Y("",!0)],!0),u(c,{modelValue:e.detailVisible,"onUpdate:modelValue":t[2]||(t[2]=m=>e.detailVisible=m),title:`[${a.comAlias}] \u914D\u7F6E\u9879 `,"append-to-body":"",top:"60px","custom-class":"schema-modal"},{default:x(()=>[n("div",Ps,[u(r,{modelValue:e.compJson,"onUpdate:modelValue":t[1]||(t[1]=m=>e.compJson=m),theme:"tomorrow_night",wrap:"",styles:{border:"none"}},null,8,["modelValue"])]),n("div",Js,[u(d,{size:"small",type:"primary",icon:"snippets",onClick:e.putJson},{default:x(()=>[N("\u5E94\u7528\u914D\u7F6E\u9879")]),_:1},8,["onClick"]),u(d,{size:"small",type:"primary",icon:"file-copy",onClick:e.copyCom},{default:x(()=>[N(" \u590D\u5236\u914D\u7F6E\u9879 ")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"])])}var Le=q(Us,[["render",Hs],["__scopeId","data-v-133b1084"]]);const Ws={name:"data-center-panel",components:{ConfigTitle:Le,SourcePanel:Wt(()=>Ut(()=>import("./source-panel-d8ce5a60.js"),["static/js/source-panel-d8ce5a60.js","static/css/source-panel-9456a5cd.css","static/js/vendor-4c8a7a86.js","static/js/chunk-echarts-cf4087a0.js","static/js/chunk-brace-b1f520b9.js","static/js/index-0b9505b3.js","static/css/index-1c17caf9.css","static/js/chunk-bin-ui-next-b686a83e.js","static/css/chunk-bin-ui-next-233b4550.css","static/js/chunk-bin-datav-cf728ffc.js","static/css/chunk-bin-datav-b06db975.css","static/js/chunk-particles.vue3-9bc75d83.js","static/js/chunk-mockjs-9e1335a8.js"]))},setup(){const{schemaStore:o,storeToRefs:t}=K(),{selectedCom:a}=t(o),e=I(()=>Object.keys(a.value.apiData));return{selectedCom:a,dataKeys:e}}},Fs={class:"data-center-panel"},qs={class:"scroll-container"},Zs={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"};function Qs(o,t,a,e,l,s){const i=k("config-title"),r=k("source-panel"),d=k("b-empty"),c=k("b-scrollbar");return h(),$("div",Fs,[u(i,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),n("div",qs,[u(c,{native:""},{default:x(()=>[e.dataKeys.length>0?(h(),z(r,{key:0})):(h(),$("div",Zs,[u(d,null,{default:x(()=>[N("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E")]),_:1})]))]),_:1})])])}var el=q(Ws,[["render",Qs]]);const tl={class:"basic-setting-wp"},ol={flex:"cross:center"},nl=n("span",{class:"pr-5"},"\u56FE\u8868\u5C3A\u5BF8",-1),xt={__name:"basic-setting",props:{attr:{type:Object,required:!0},readonly:{type:Boolean,default:!1}},emits:["update:attr"],setup(o,{emit:t}){const a=o,e=I({get:()=>a.attr,set:d=>t("update:attr",d)}),{schemaStore:l,storeToRefs:s}=K(),{curComIsGroup:i,isMultiSelect:r}=s(l);return(d,c)=>{const m=k("b-icon"),g=k("g-input-number"),p=k("g-field"),f=k("g-slider"),y=k("b-button"),b=k("b-button-group");return h(),$("div",tl,[u(p,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{label:x(()=>[n("div",ol,[nl,u(m,{name:v(e).lockedRatio?"link":"disconnect",color:v(e).lockedRatio?"#1089ff":"#ccc",title:v(e).lockedRatio?"\u89E3\u9664\u9501\u5B9A\u5BBD\u9AD8\u5173\u8054":"\u9501\u5B9A\u5BBD\u9AD8\u5173\u8054",type:"button",onClick:c[0]||(c[0]=_=>v(e).lockedRatio=!v(e).lockedRatio)},null,8,["name","color","title"])])]),default:x(()=>[u(g,{modelValue:v(e).w,"onUpdate:modelValue":c[1]||(c[1]=_=>v(e).w=_),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(g,{modelValue:v(e).h,"onUpdate:modelValue":c[2]||(c[2]=_=>v(e).h=_),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),u(p,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:x(()=>[u(g,{modelValue:v(e).x,"onUpdate:modelValue":c[3]||(c[3]=_=>v(e).x=_),label:"X",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(g,{modelValue:v(e).y,"onUpdate:modelValue":c[4]||(c[4]=_=>v(e).y=_),label:"Y",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),v(r)?Y("",!0):(h(),z(p,{key:0,label:"\u65CB\u8F6C\u89D2\u5EA6"},{default:x(()=>[u(f,{modelValue:v(e).rotate,"onUpdate:modelValue":c[5]||(c[5]=_=>v(e).rotate=_),min:0,max:360,step:1},null,8,["modelValue"])]),_:1})),v(r)||v(i)?Y("",!0):(h(),z(p,{key:1,label:"\u900F\u660E\u5EA6"},{default:x(()=>[u(f,{modelValue:v(e).opacity,"onUpdate:modelValue":c[6]||(c[6]=_=>v(e).opacity=_),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})),v(r)?Y("",!0):(h(),z(p,{key:2,label:"\u4F4D\u7F6E"},{default:x(()=>[u(b,null,{default:x(()=>[(h(!0),$(J,null,ne(v(_o),_=>(h(),z(y,{key:_.value,size:"mini",title:_.label,onClick:S=>v(l).doAdsorption(_.value)},{default:x(()=>[n("i",{class:E(`iconfont-align b-icon-${_.value}-vs`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})),v(r)?(h(),z(p,{key:3,label:"\u5BF9\u9F50"},{default:x(()=>[u(b,null,{default:x(()=>[(h(!0),$(J,null,ne(v(ho),_=>(h(),z(y,{key:_.value,size:"mini",title:_.label,onClick:S=>v(l).doAlign(_.value)},{default:x(()=>[n("i",{class:E(`iconfont-align b-icon-${_.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})):Y("",!0),v(r)||v(i)?(h(),z(p,{key:4,label:"\u7EC4\u5408\u62C6\u5206"},{default:x(()=>[u(b,null,{default:x(()=>[u(y,{size:"mini",icon:"group",disabled:!v(r),onClick:c[7]||(c[7]=_=>v(l).group())},{default:x(()=>[N(" \u7EC4\u5408 ")]),_:1},8,["disabled"]),u(y,{size:"mini",icon:"ungroup",disabled:!v(i),onClick:c[8]||(c[8]=_=>v(l).ungroup())},{default:x(()=>[N(" \u62C6\u5206 ")]),_:1},8,["disabled"])]),_:1})]),_:1})):Y("",!0)])}}},al={class:"setting-panel"},sl={class:"setting-panel-content"},ll={class:"scroll-container"},cl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{selectedCom:e}=a(t);return(l,s)=>{const i=k("b-scrollbar");return h(),$("div",al,[u(Le,{"com-name":v(e).name,"com-alias":v(e).alias,com:v(e),"show-cfg":""},null,8,["com-name","com-alias","com"]),n("div",sl,[n("div",ll,[u(i,null,{default:x(()=>[(h(),z(xt,{key:`${v(e).id}'_basic-setting`,attr:v(e).attr},null,8,["attr"])),(h(),z(ut(v(e).name+"Config"),{key:v(e).id,data:v(e)},null,8,["data"]))]),_:1})])])])}}},il={class:"setting-panel"},rl={class:"setting-panel-content"},dl={class:"scroll-container"},ul={__name:"multi-setting",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{areaData:e}=a(t),l=I(()=>e.value.showArea),s=I(()=>({x:e.value.x,y:e.value.y,w:e.value.width,h:e.value.height}));return(i,r)=>{const d=k("b-scrollbar");return h(),$("div",il,[u(Le,{"com-alias":"\u591A\u9009\u533A\u57DF"}),n("div",rl,[n("div",dl,[u(d,null,{default:x(()=>[u(xt,{attr:v(s),readonly:v(l)},null,8,["attr","readonly"])]),_:1})])])])}}},ml={style:{margin:"-16px",padding:"10px"}},pl={__name:"EventParamsModal",props:{modelValue:{type:Boolean,default:!1},params:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:t}){const a=o,e=I({get:()=>a.modelValue,set:s=>t("update:modelValue",s)}),l=[{title:"\u53C2\u6570\u540D",key:"desc"},{title:"\u53C2\u6570Key",key:"name"},{title:"\u53C2\u6570\u7C7B\u578B",key:"type"}];return(s,i)=>{const r=k("b-table"),d=k("b-modal");return h(),z(d,{modelValue:v(e),"onUpdate:modelValue":i[0]||(i[0]=c=>dt(e)?e.value=c:null),title:"\u53C2\u6570\u4FE1\u606F",width:"750px","append-to-body":"","custom-class":"schema-modal"},{default:x(()=>[n("div",ml,[u(r,{columns:l,data:o.params,size:"small",border:""},null,8,["data"])])]),_:1},8,["modelValue"])}}},vl={flex:"main:justify cross:center"},fl={__name:"trigger-config",props:{eventList:{type:Array,default:()=>Ft},events:{type:Object,default:()=>({})}},setup(o){const t=o,a=I(()=>t.events),e=I(()=>{let r=!1;return t.eventList.forEach(d=>{if(!De(a.value[d])){r=!0;return}}),r}),l=T([]),s=T(!1);function i(r){l.value=r,s.value=!0}return(r,d)=>{const c=k("b-checkbox"),m=k("b-button"),g=k("g-field"),p=k("g-field-collapse");return v(e)?(h(),z(p,{key:0,label:"\u89E6\u53D1\u4E8B\u4EF6","default-open":""},{default:x(()=>[(h(!0),$(J,null,ne(o.eventList,f=>(h(),$(J,{key:f},[v(a)[f]?(h(),z(g,{key:0,label:v(a)[f].name},{default:x(()=>[n("div",vl,[u(c,{modelValue:v(a)[f].enable,"onUpdate:modelValue":y=>v(a)[f].enable=y},null,8,["modelValue","onUpdate:modelValue"]),u(m,{type:"text",title:"\u67E5\u770B\u4E8B\u4EF6\u53C2\u6570",onClick:y=>i(v(a)[f].params)},{default:x(()=>[N(" \u67E5\u770B ")]),_:2},1032,["onClick"])])]),_:2},1032,["label"])):Y("",!0)],64))),128)),u(pl,{modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=f=>s.value=f),params:l.value},null,8,["modelValue","params"])]),_:1})):Y("",!0)}}},_l={class:"series-title",style:{top:"-8px"}},hl={style:{width:"50%","padding-right":"8px"}},gl={style:{width:"50%","padding-right":"8px"}},bl={key:0,style:{"min-height":"80px"},flex:"main:center cross:center"},yl={__name:"response-config",props:{compId:{type:String,default:""},events:{type:Object,default:()=>({})}},setup(o){const t=o,a=I(()=>t.events),e=I(()=>Object.keys(a.value).includes("onEvents")),l=I(()=>qt.value.filter(g=>g.compId!==t.compId).map(g=>({value:g.compId,label:g.compName}))),s=I(()=>{const g=a.value.actions;return Object.keys(g).map(p=>({value:p,label:g[p].title}))});function i(g){return Zt.value.filter(p=>p.eventName.includes(g)).map(p=>({value:p.eventName,label:p.title}))}function r(){a.value.onEvents.push({eventSource:"",eventName:"",actionName:"",actionParams:[],register:!1})}function d(g){if(g.eventSource===""){W.warning("\u8BF7\u9009\u62E9\u4E8B\u4EF6\u6E90\uFF01");return}if(g.eventName===""){W.warning("\u8BF7\u7ED1\u5B9A\u4E8B\u4EF6\uFF01");return}if(g.actionName===""){W.warning("\u8BF7\u7ED1\u5B9A\u52A8\u4F5C\uFF01");return}g.register=!0}function c(g,p){p.register?p.register=!1:a.value.onEvents.splice(g,1)}function m(g,p){const f=a.value.actions[g];f&&(p.actionParams=Ie(f.params))}return(g,p)=>{const f=k("b-icon"),y=k("b-button"),b=k("g-select"),_=k("g-field"),S=k("g-field-collapse");return v(e)?(h(),z(S,{key:0,label:"\u54CD\u5E94\u4E8B\u4EF6","default-open":""},{add:x(()=>[u(y,{type:"text",title:"\u65B0\u589E\u4E00\u4E2A\u54CD\u5E94\u4E8B\u4EF6",onClick:r},{default:x(()=>[u(f,{name:"plus",size:"16"})]),_:1})]),default:x(()=>[(h(!0),$(J,null,ne(v(a).onEvents,(C,w)=>(h(),z(_,{key:w,label:"\u4E8B\u4EF6","label-width":"85px",flat:""},{label:x(()=>[n("div",_l,[n("span",null,"\u4E8B\u4EF6"+Q(w+1),1)])]),default:x(()=>[u(b,{modelValue:C.eventSource,"onUpdate:modelValue":V=>C.eventSource=V,data:v(l),disabled:C.register,label:"\u4E8B\u4EF6\u6E90"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),C.eventSource!==""?(h(),$(J,{key:0},[u(b,{modelValue:C.eventName,"onUpdate:modelValue":V=>C.eventName=V,data:i(C.eventSource),disabled:C.register,inline:"",label:"\u7ED1\u5B9A\u4E8B\u4EF6"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),u(b,{modelValue:C.actionName,"onUpdate:modelValue":V=>C.actionName=V,data:v(s),disabled:C.register,inline:"",label:"\u7ED1\u5B9A\u52A8\u4F5C",onChange:V=>m(C.actionName,C)},null,8,["modelValue","onUpdate:modelValue","data","disabled","onChange"])],64)):Y("",!0),n("span",hl,[u(y,{size:"small",style:{width:"100%"},type:"primary",disabled:C.register,onClick:V=>d(C)},{default:x(()=>[N(" \u6CE8\u518C\u4E8B\u4EF6 ")]),_:2},1032,["disabled","onClick"])]),n("span",gl,[u(y,{size:"small",style:{width:"100%"},onClick:V=>c(w,C)},{default:x(()=>[N(Q(C.register?"\u53D6\u6D88":"\u5220\u9664"),1)]),_:2},1032,["onClick"])])]),_:2},1024))),128)),v(a).onEvents.length===0?(h(),$("div",bl," \u6682\u65E0\u54CD\u5E94\u4E8B\u4EF6 ")):Y("",!0)]),_:1})):Y("",!0)}}},Cl={class:"events-panel"},xl={class:"events-panel-content"},wl=n("div",{class:"data-result-title"},"\u4E8B\u4EF6\u914D\u7F6E",-1),kl={class:"scroll-container"},Sl={class:"setting-panel-gui"},$l={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{selectedCom:e}=a(t),l=I(()=>e.value.events);return(s,i)=>{const r=k("b-scrollbar");return h(),$("div",Cl,[u(Le,{"com-name":v(e).name,"com-alias":v(e).alias,com:v(e)},null,8,["com-name","com-alias","com"]),n("div",xl,[wl,n("div",kl,[u(r,null,{default:x(()=>[n("div",Sl,[u(fl,{events:v(l)},null,8,["events"]),u(yl,{events:v(l),"comp-id":v(e).id},null,8,["events","comp-id"])])]),_:1})])])])}}},Vl={class:"config-panel"},Ml={key:0,class:"page-config-panel"},Dl={class:"page-config-top"},Il={class:"tabs-wrapper"},Tl={key:0,class:"page-config-content"},Rl={key:1,class:"page-config-content"},Ll={style:{height:"100%"}},Bl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{toolbar:e,selectedCom:l,isMultiSelect:s}=a(t),i=T(0),r=d=>{s.value&&d>0||i.value!==d&&(i.value=d)};return ve(()=>l.value,()=>{i.value=0}),(d,c)=>{const m=k("b-icon"),g=k("b-tooltip");return h(),$("div",{class:E(["config-panel-wp",{"is-hide":!v(e).config}])},[n("div",Vl,[v(l)||v(s)?(h(),$("div",Ml,[n("div",Dl,[n("div",Il,[n("div",{class:E(["tab-item",{active:i.value===0}]),onClick:c[0]||(c[0]=p=>r(0))},[u(g,{content:"\u914D\u7F6E"},{default:x(()=>[u(m,{name:"control",size:"20"})]),_:1})],2),n("div",{class:E(["tab-item",{active:i.value===1}]),onClick:c[1]||(c[1]=p=>r(1))},[u(g,{content:"\u6570\u636E"},{default:x(()=>[u(m,{name:"cloud-server",size:"22"})]),_:1})],2),n("div",{class:E(["tab-item",{active:i.value===2}]),onClick:c[2]||(c[2]=p=>r(2))},[u(g,{content:"\u4E8B\u4EF6"},{default:x(()=>[u(m,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),v(s)?(h(),$("div",Tl,[u(ul)])):(h(),$("div",Rl,[n("div",Ll,[i.value===0?(h(),z(cl,{key:v(l).id})):Y("",!0),i.value===1?(h(),z(el,{key:v(l).id})):Y("",!0),i.value===2?(h(),z($l,{key:v(l).id})):Y("",!0)])]))])):(h(),z(Ns,{key:1}))])],2)}}};const Nl={class:"toolbox-panel",flex:"main:justify"},zl={style:{width:"500px"},flex:""},El=n("i",{class:"action-btn b-iconfont b-icon-rollback"},null,-1),Ul=n("i",{class:"action-btn b-iconfont b-icon-rollback",style:{transform:"rotateY(180deg)"}},null,-1),Al=n("div",null,null,-1),Ol={class:"btn-box"},Gl={class:"btn-box"},Yl={class:"ctrl-box",flex:"cross:center"},Kl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=K(),{toolbar:e,toolbox:l,undoDisable:s,redoDisable:i}=a(t),r=T(!1),d=T(null),c=()=>{pe.confirm({type:"error",title:"\u786E\u8BA4\u6E05\u7A7A\u753B\u5E03\u5417\uFF1F\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"}).then(()=>{t.clearScreen()}).catch(()=>{})},m=()=>t.undo(),g=()=>t.redo();function p(){r.value=!0,ge(()=>{d.value&&d.value.addEventListener("paste",f),d.value.focus(),d.value.placeholder="\u7C98\u8D34\u56FE\u8868\u914D\u7F6E"})}function f(y){const b=y.clipboardData.getData("Text");try{const _=JSON.parse(b);((_==null?void 0:_.type)==="com"||(_==null?void 0:_.type)==="group")&&(_.id=`${_.name}_${me()}`,_.name==="Group"&&_.components.forEach(S=>{S.id=`${S.name}_${me()}`}),t.addCom({component:_}),W.success("\u7C98\u8D34\u56FE\u8868\u6210\u529F\uFF01"))}catch(_){console.log(_),W.error("\u7C98\u8D34\u7684\u5185\u5BB9\u4E0D\u662F\u56FE\u8868\u7EC4\u4EF6\uFF01")}setTimeout(()=>{d.value.value="",r.value=!1,d.value.removeEventListener("paste",f)},100)}return(y,b)=>{const _=k("b-button"),S=k("b-switch");return h(),$("div",{class:E(["toolbox-panel-wp",{"is-hide":!v(e).toolbox}])},[n("div",Nl,[n("div",zl,[u(_,{size:"mini",disabled:v(s),onClick:m},{default:x(()=>[El,N(" \u64A4\u9500 ")]),_:1},8,["disabled"]),u(_,{size:"mini",disabled:v(i),onClick:g},{default:x(()=>[Ul,N(" \u91CD\u505A ")]),_:1},8,["disabled"]),Al,n("div",Ol,[N(" \u53C2\u8003\u7EBF\xA0\xA0 "),u(S,{modelValue:v(l).referLine,"onUpdate:modelValue":b[0]||(b[0]=C=>v(l).referLine=C),size:"small"},null,8,["modelValue"])]),n("div",Gl,[N(" \u5BF9\u9F50\u7EBF\xA0\xA0 "),u(S,{modelValue:v(l).markLine,"onUpdate:modelValue":b[1]||(b[1]=C=>v(l).markLine=C),size:"small"},null,8,["modelValue"])])]),n("div",Yl,[N(" \xA0\xA0 "),r.value?(h(),$("textarea",{key:0,class:"paste-inner",ref_key:"textpasteRef",ref:d},null,512)):(h(),z(_,{key:1,size:"mini",icon:"diff",onClick:p},{default:x(()=>[N("\u7C98\u8D34\u56FE\u8868")]),_:1})),u(_,{size:"mini",icon:"clear",onClick:c},{default:x(()=>[N("\u6E05\u7A7A\u753B\u5E03")]),_:1})])])],2)}}};const Xl={name:"shortcut",props:{modelValue:{type:Boolean}},emits:["update:modelValue"]},jl=o=>(xe("data-v-7e8e628e"),o=o(),we(),o),Pl=jl(()=>n("div",{class:"shortcut-wp"},[n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u57FA\u7840\u5FEB\u6377\u952E"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2190")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u914D\u7F6E\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u7EC4\u4EF6\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2191")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u5DE5\u5177\u680F"),n("div",{class:"shortcut-value"},"Ctrl + \u2193")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u590D\u5236\u9009\u4E2D\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Ctrl + C")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7C98\u8D34\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Ctrl + V")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u64A4\u9500\u64CD\u4F5C"),n("div",{class:"shortcut-value"},"Ctrl + Z")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4FDD\u5B58\u770B\u677F"),n("div",{class:"shortcut-value"},"Ctrl + S")])])]),n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u753B\u5E03\u64CD\u4F5C"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u6700\u4F73\u6BD4\u4F8B"),n("div",{class:"shortcut-value"},"Ctrl + A")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A1\uFF1A1"),n("div",{class:"shortcut-value"},"Ctrl + D")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u81EA\u7531\u7F29\u653E"),n("div",{class:"shortcut-value"},"Ctrl + \u9F20\u6807\u6EDA\u8F6E/\u6EDA\u52A8")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u753B\u5E03"),n("div",{class:"shortcut-value"},"Space + \u9F20\u6807\u5DE6\u952E/\u62D6\u52A8")])])]),n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u7EC4\u4EF6\u64CD\u4F5C"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u9876"),n("div",{class:"shortcut-value"},"Alt + Home")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u5E95"),n("div",{class:"shortcut-value"},"Alt + End")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4E0A\u79FB\u4E00\u5C42"),n("div",{class:"shortcut-value"},"Alt + \u2191")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4E0B\u79FB\u4E00\u5C42"),n("div",{class:"shortcut-value"},"Alt + \u2193")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF61\u50CF\u7D20"),n("div",{class:"shortcut-value"},"\u2191 \u2193 \u2190 \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF610\u50CF\u7D20"),n("div",{class:"shortcut-value"},"Shift + \u2191 \u2193 \u2190 \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u91CD\u547D\u540D"),n("div",{class:"shortcut-value"},"F2/\u53CC\u51FB\u56FE\u5C42")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5220\u9664\u9009\u4E2D\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Delete")])])])],-1));function Jl(o,t,a,e,l,s){const i=k("b-modal");return h(),z(i,{title:"\u5FEB\u6377\u952E\u6307\u5357","model-value":a.modelValue,"append-to-body":"","custom-class":"schema-modal",onClose:t[0]||(t[0]=r=>o.$emit("update:modelValue",!1))},{default:x(()=>[Pl]),_:1},8,["model-value"])}var Hl=q(Xl,[["render",Jl],["__scopeId","data-v-7e8e628e"]]);const Wl={name:"footer-panel",components:{Shortcut:Hl},setup(){const{schemaStore:o,storeToRefs:t}=K(),{pageConfig:a,canvas:e}=t(o),l=T([200,150,100,50]),s=T(20),i=T(20),r=T(!1),d=async c=>{c===-1?o.autoCanvasScale():o.setCanvasScale(c===0?s.value:c)};return ve(()=>e.value.scale,c=>{const m=parseInt((c*100).toFixed(2));i.value=m,s.value=m}),{pageConfig:a,scaleList:l,inputScale:s,scale:i,submitScale:d,keycodeVisible:r}}},Fl={class:"footer-panel"},ql={class:"screen-info",flex:"cross:center"},Zl={class:"ml-8",style:{transform:"scale(0.9)"}},Ql={flex:"cross:center"},ec={class:"scale-input-wp"},tc=n("span",{class:"percent"},"%",-1),oc=n("i",{class:"b-iconfont b-icon-down"},null,-1),nc={class:"scale-slider-wp"};function ac(o,t,a,e,l,s){const i=k("b-icon"),r=k("b-tooltip"),d=k("b-dropdown-item"),c=k("b-dropdown-menu"),m=k("b-dropdown"),g=k("b-slider"),p=k("shortcut");return h(),$(J,null,[n("div",Fl,[n("div",ql,[u(r,{content:"\u5FEB\u6377\u952E\u63D0\u793A","open-delay":500},{default:x(()=>[u(i,{name:"read",size:"16",type:"button",onClick:t[0]||(t[0]=f=>e.keycodeVisible=!0)})]),_:1}),n("span",Zl,Q(e.pageConfig.width)+" \u50CF\u7D20 * "+Q(e.pageConfig.height)+" \u50CF\u7D20",1)]),n("div",Ql,[u(m,{trigger:"click",onCommand:e.submitScale},{dropdown:x(()=>[u(c,null,{default:x(()=>[(h(!0),$(J,null,ne(e.scaleList,f=>(h(),z(d,{key:f,name:f},{default:x(()=>[N(Q(`${f}%`),1)]),_:2},1032,["name"]))),128)),u(d,{name:-1},{default:x(()=>[N("\u81EA\u9002\u5E94")]),_:1})]),_:1})]),default:x(()=>[n("div",ec,[le(n("input",{"onUpdate:modelValue":t[1]||(t[1]=f=>e.inputScale=f),type:"number",class:"scale-input",onKeydown:t[2]||(t[2]=ye(f=>e.submitScale(0),["enter"]))},null,544),[[rt,e.inputScale]]),tc,oc])]),_:1},8,["onCommand"]),n("div",nc,[u(g,{modelValue:e.scale,"onUpdate:modelValue":t[3]||(t[3]=f=>e.scale=f),min:10,max:200,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])]),u(p,{modelValue:e.keycodeVisible,"onUpdate:modelValue":t[4]||(t[4]=f=>e.keycodeVisible=f)},null,8,["modelValue"])],64)}var sc=q(Wl,[["render",ac]]);const Z=o=>(xe("data-v-00b8514a"),o=o(),we(),o),lc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),cc=Z(()=>n("span",{class:"key-code"},"Alt + Home",-1)),ic=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),rc=Z(()=>n("span",{class:"key-code"},"Alt + End",-1)),dc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),uc=Z(()=>n("span",{class:"key-code"},"Alt + \u2191",-1)),mc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),pc=Z(()=>n("span",{class:"key-code"},"Alt + \u2193",-1)),vc=Z(()=>n("div",{class:"context-menu-divider"},null,-1)),fc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),_c=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),hc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),gc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),bc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-save"},null,-1)),yc=Z(()=>n("div",{class:"context-menu-divider"},null,-1)),Cc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),xc=Z(()=>n("span",{class:"key-code"},"F2",-1)),wc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),kc=Z(()=>n("span",{class:"key-code"},"Ctrl + C,V",-1)),Sc=Z(()=>n("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),$c=Z(()=>n("span",{class:"key-code"},"Delete",-1)),Vc={__name:"index",setup(o,{expose:t}){const a=T([]),e=T({}),l=()=>ht().then(D=>a.value=D),{schemaStore:s,storeToRefs:i}=K(),{selectedCom:r,selectedComs:d}=i(s),{isLocked:c,isHided:m,contextMenu:g,contextMenuStyle:p}=je(),f=D=>{r.value&&s.moveCom({id:r.value.id,moveType:D})},y=()=>f(re.up),b=()=>f(re.down),_=()=>f(re.top),S=()=>f(re.bottom),C=()=>{r.value&&(r.value.locked=!r.value.locked)},w=()=>{r.value&&(r.value.hided=!r.value.hided)},V=async()=>{e.value=a.value[0].key,pe({title:"\u6307\u5B9A\u7EC4\u4EF6\u5E93",message:qe(to,{modelValue:e.value,onChange:D=>e.value=D},()=>a.value.map(D=>qe(eo,{label:D.value,value:D.key}))),showCancelButton:!0,confirmText:"\u4FDD\u5B58",cancelText:"\u53D6\u6D88",beforeClose:async(D,O,R)=>{if(D==="confirm"){try{const M=document.getElementById(`component_${r.value.id}`),L=await ze(M);await ra(e.value,r.value,L),O.confirmButtonLoading=!0}catch(M){console.log(M)}O.confirmButtonLoading=!1,R()}else R()}}).then(()=>W.success("\u4FDD\u5B58\u6210\u529F!")).catch(()=>{})},U=()=>{const D=r.value;D&&pe.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{s.deleteCom(D.id)}).catch(()=>{})},B=()=>{const D=r.value;D&&s.renamingCom(D.id)},A=()=>{s.copyComs(d.value)},X=D=>{D.preventDefault(),l()};return Ce(()=>{ee(document,"contextmenu",X)}),Me(()=>{te(document,"contextmenu",X)}),t({moveUp:y,moveBottom:S,moveDown:b,moveTop:_,lockCom:C,hideCom:w,toDeleteCom:U,renameCom:B,toCopyCom:A}),(D,O)=>(h(),z(At,{name:"zoom-in-top"},{default:x(()=>[v(g).show?(h(),$("div",{key:0,class:"context-menu-wrap",style:F(v(p))},[n("div",{class:"context-menu-item",onClick:_},[lc,N(" \u7F6E\u9876 "),cc]),n("div",{class:"context-menu-item",onClick:S},[ic,N(" \u7F6E\u5E95 "),rc]),n("div",{class:"context-menu-item",onClick:y},[dc,N(" \u4E0A\u79FB\u4E00\u5C42 "),uc]),n("div",{class:"context-menu-item",onClick:b},[mc,N(" \u4E0B\u79FB\u4E00\u5C42 "),pc]),vc,n("div",{class:"context-menu-item",onClick:C},[v(c)?(h(),$(J,{key:0},[fc,N(" \u89E3\u9501 ")],64)):(h(),$(J,{key:1},[_c,N(" \u9501\u5B9A ")],64))]),n("div",{class:"context-menu-item",onClick:w},[v(m)?(h(),$(J,{key:0},[hc,N(" \u663E\u793A ")],64)):(h(),$(J,{key:1},[gc,N(" \u9690\u85CF ")],64))]),a.value.length?(h(),$("div",{key:0,class:"context-menu-item",onClick:V},[bc,N(" \u4FDD\u5B58 ")])):Y("",!0),yc,n("div",{class:"context-menu-item",onClick:B},[Cc,N(" \u91CD\u547D\u540D "),xc]),n("div",{class:"context-menu-item",onClick:A},[wc,N(" \u590D\u5236 "),kc]),n("div",{class:"context-menu-item",onClick:U},[Sc,N(" \u5220\u9664 "),$c])],4)):Y("",!0)]),_:1}))}};var Mc=q(Vc,[["__scopeId","data-v-00b8514a"]]);function Dc(){const o=$e(),{schemaStore:t}=K(),a=T(!1),e=async s=>{try{a.value=!0;const i=await Qt(s);if(i){const{id:r,name:d,pid:c,layout:m,components:g}=i,p={pageInfo:{id:r,name:d,pid:c},pageConfig:JSON.parse(m),comps:g.map(f=>JSON.parse(f.componentContent))};t.loadScreenData(p),await ge(),document.title=d}}catch(i){console.log(i)}a.value=!1},l=async()=>{try{a.value=!0;const s=await no();if(s.tpl.length>0){const i=await co(s.tpl);if(i){const r=JSON.parse(i.content),{comps:d,pageConfig:c}=r;t.loadScreenData({comps:d,pageConfig:c})}}else t.setScreenSize(s)}catch(s){console.log(s)}a.value=!1};return ve(()=>o.path,async()=>{const{id:s}=o.query;s?await e(s):await l()},{immediate:!0}),{loading:a}}function Ic(){const o=T(null),t=T(null),{saveScreenData:a}=Xe(),{schemaStore:e,storeToRefs:l}=K(),{pageInfo:s,canvas:i,selectedCom:r,selectedComs:d}=l(e),c=$e();let m=null;const g=b=>{const _=b.target;if(!["input","textarea"].includes(_.tagName.toLowerCase())){const S=b.key.toLowerCase();S==="delete"?(t.value&&t.value.toDeleteCom(),b.preventDefault()):S==="f2"&&(t.value&&t.value.renameCom(),b.preventDefault());const C=r.value;b.altKey&&(p("altKey"),S==="arrowup"?t.value&&t.value.moveUp():S==="arrowdown"?t.value&&t.value.moveDown():S==="home"?t.value&&t.value.moveTop():S==="end"&&t.value&&t.value.moveBottom(),b.preventDefault()),b.ctrlKey&&(p("ctrlKey"),S==="arrowup"?(e.toggleCompsPanel(),b.preventDefault()):S==="arrowdown"?(e.toggleToolbox(),b.preventDefault()):S==="arrowleft"?(e.toggleLayerPanel(),b.preventDefault()):S==="arrowright"?(e.toggleConfigPanel(),b.preventDefault()):S==="a"?(e.autoCanvasScale(),b.preventDefault()):S==="d"?(e.setCanvasScale(100),b.preventDefault()):S==="c"?(m=d.value,console.log(m),Ge(JSON.stringify(m)),b.preventDefault()):S==="v"?(m&&e.copyComs(m),b.preventDefault()):S==="s"?(s.value.id||c.query.id?(W("\u6B63\u5728\u4FDD\u5B58..."),a("edit").then(()=>W.success("\u4FDD\u5B58\u6210\u529F\uFF01"))):o.value&&o.value.handleSaveScreen(),b.preventDefault()):S==="z"&&(e.undo(),b.preventDefault())),b.shiftKey&&p("shiftKey"),b.keyCode===32&&(p("spaceKey"),b.preventDefault());const w=b.shiftKey?10:1;C&&!b.altKey&&(S==="arrowleft"?(C.attr.x-=w,e.recordSnapshot(),b.preventDefault()):S==="arrowright"?(C.attr.x+=w,e.recordSnapshot(),b.preventDefault()):S==="arrowup"?(C.attr.y-=w,e.recordSnapshot(),b.preventDefault()):S==="arrowdown"&&(C.attr.y+=w,e.recordSnapshot(),b.preventDefault()))}},p=b=>{e.toggleKey({key:b,status:!0})},f=()=>{e.resetKeyCode()},y=b=>{const _=parseInt((i.value.scale*100).toFixed(2)),S=(b.wheelDelta>0?1:-1)*5,C=Math.min(Math.max(_+S,20),200);e.setCanvasScale(C)};return Ce(()=>{ee(document,"keydown",g),ee(document,"keyup",f)}),Me(()=>{te(document,"keydown",g),te(document,"keyup",f)}),{headerRef:o,contextMenuRef:t,ctrlMouseWheel:y}}const Tc={name:"ScreenEditor",components:{ContextMenu:Mc,FooterPanel:sc,ToolboxPanel:Kl,CanvasMain:Cs,ConfigPanel:Bl,ComponentsPanel:za,LayerPanel:Fo,HeaderBar:zo},setup(){return{...Dc(),...Ic()}}},Rc={key:0,flex:"main:center cross:center",class:"full-wrapper"},Lc={key:1,class:"editor-main-wrapper"},Bc={class:"edit-main-wp"};function Nc(o,t,a,e,l,s){const i=k("header-bar"),r=k("svg-loading"),d=k("components-panel"),c=k("layer-panel"),m=k("toolbox-panel"),g=k("canvas-main"),p=k("footer-panel"),f=k("config-panel"),y=k("context-menu");return h(),$("div",{class:"schema-screen-container",onWheel:t[0]||(t[0]=oe((...b)=>o.ctrlMouseWheel&&o.ctrlMouseWheel(...b),["ctrl","prevent"]))},[u(i,{ref:"headerRef","back-url":"/dashboard"},null,512),o.loading?(h(),$("div",Rc,[u(r,{name:"loading02"})])):(h(),$("div",Lc,[u(d),u(c),n("div",Bc,[u(m),u(g),u(p)]),u(f)])),u(y,{ref:"contextMenuRef"},null,512)],32)}var Wc=q(Tc,[["render",Nc]]);export{Wc as default};
