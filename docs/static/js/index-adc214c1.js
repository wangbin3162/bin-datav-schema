import{aw as H,k as M,o as h,a as C,f as D,a5 as Ce,aL as Ee,l as L,A as de,n as ge,G as y,e as E,w as g,c as m,F as Y,j as q,b as n,m as R,t as Z,B as we,g as ue,Y as Se,h as U,O as te,L as je,N as Oe,$ as nt,C as fe,U as at,aH as pe,aI as he,D as ye,v as He,d as Ye,q as ee,X as lt,a1 as x,M as Xe,a0 as st,aN as it,a6 as ct,T as rt}from"./vendor-b7d265ee.js";import{u as N,z as ke,A as Ve,s as dt,t as Me,i as ut,B as mt,o as Te,C as P,D as F,M as ae,E as I,F as We,G as vt,H as Le,I as Re,J as se,f as ft,K as pt,w as ht,j as _t,L as gt,l as bt}from"./index-0df6ecd1.js";import{M as re,a as Ke}from"./chunk-bin-ui-next-925ea2c7.js";import{a as yt,g as Pe,b as xt}from"./database.api-4ba207d2.js";import{d as Ct,a as wt}from"./file-helper-94af9014.js";import{s as St,l as kt}from"./template.api-8825b954.js";import{r as Vt,p as Mt,m as $t}from"./select-options-cf7d80b0.js";import"./chunk-brace-b4ee70be.js";const Dt={name:"HeadLoading",setup(){const{schemaStore:o,storeToRefs:t}=N(),{toolbar:a}=t(o);return{loading:M(()=>a.value.loading)}}};function Bt(o,t,a,e,d,l){return h(),C("div",{class:D(["loading-indicator",{loading:e.loading}])},null,2)}var Tt=H(Dt,[["render",Bt],["__scopeId","data-v-5475ad30"]]);function Fe(){const o=Ce(),{schemaStore:t,storeToRefs:a}=N(),{pageInfo:e,pageConfig:d,comps:l}=a(t);async function c(s="edit"){const r={id:e.value.id||o.query.id,name:e.value.name,pid:e.value.pid,status:s,layout:JSON.stringify(d.value),components:l.value.map(p=>ke(p.apiData)?{name:p.alias,componentType:p.componentType,componentContent:JSON.stringify(p),componentDataType:Ve.static,modelId:"",x:[],y:[],drill:[],filters:[]}:{name:p.alias,componentType:p.componentType,componentDataType:p.apiData.type,modelId:p.apiData.config.modelId,componentContent:JSON.stringify(p),x:p.apiData.config.x,y:p.apiData.config.y,drill:[],filters:[]})};try{return await dt(r)}catch(p){Me("userSchemaStore/saveScreenData",p)}return""}async function i(){let s={};try{t.setGlobalLoading(!0);const r={pageInfo:{id:e.value.id,name:e.value.name||"\u770B\u677F\u9884\u89C8",pid:e.value.pid||"1"},pageConfig:d.value,comps:l.value};s=await yt(r)}catch{s={}}return t.setGlobalLoading(!1),s}return{saveScreenData:c,previewScreen:i}}const Lt={name:"save-screen",props:{modelValue:{type:Boolean},status:{type:String,default:"edit",validator:o=>["edit","audited"].includes(o)}},emits:["update:modelValue"],setup(o,t){const a=M({get:()=>o.modelValue,set:b=>t.emit("update:modelValue",b)}),{schemaStore:e,storeToRefs:d}=N(),{pageInfo:l}=d(e),{saveScreenData:c}=Fe(),i=Ee(),s=Ce(),r=L([]),p=L(null),f=L(!1),v=M(()=>`${window.location.origin}/#/screen/${s.query.id}`);ut().then(b=>{r.value=b.data?[b.data]:[]});const u=M(()=>o.status==="edit"?"\u4FDD\u5B58\u770B\u677F":"\u53D1\u5E03\u770B\u677F"),w=()=>{p.value&&p.value.validate(async b=>{if(b){let T="";try{f.value=!0,T=await c(o.status)}catch(S){Me("save-screes/saveKanban",S)}f.value=!1,a.value=!1,re.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0}),setTimeout(()=>{if(T&&!l.value.id){let X=i.resolve({path:"/schema/screen",query:{id:T}});window.location.replace(X.href)}},300)}})},_=()=>{ge(()=>{mt(v.value)&&re.success("\u590D\u5236\u53D1\u5E03\u5730\u5740\u6210\u529F!")})};return de(()=>o.modelValue,b=>{b&&ge(()=>{p.value&&p.value.resetFields()})}),{formRef:p,pageInfo:l,dirTree:r,loading:f,visible:a,saveKanban:w,btnText:u,shareUrl:v,copyUrl:_}}},Rt=R("\u590D\u5236\u9884\u89C8\u5730\u5740"),It={class:"t-center"};function Nt(o,t,a,e,d,l){const c=y("b-input"),i=y("b-form-item"),s=y("g-input"),r=y("b-button"),p=y("b-form"),f=y("b-modal");return h(),E(f,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=v=>e.visible=v),"append-to-body":"",title:e.btnText,top:"200px","custom-class":"schema-modal",onClose:t[3]||(t[3]=v=>e.visible=!1)},{default:g(()=>[m(p,{"label-width":"80px",ref:"formRef",model:e.pageInfo,"label-suffix":":"},{default:g(()=>[m(i,{label:"\u770B\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u770B\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:g(()=>[m(c,{modelValue:e.pageInfo.name,"onUpdate:modelValue":t[0]||(t[0]=v=>e.pageInfo.name=v)},null,8,["modelValue"])]),_:1}),a.status==="audited"&&o.$route.query.id?(h(),C(Y,{key:0},[m(i,{label:"\u9884\u89C8\u5730\u5740"},{default:g(()=>[m(s,{modelValue:e.shareUrl,"onUpdate:modelValue":t[1]||(t[1]=v=>e.shareUrl=v),readonly:"",type:"textarea",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),m(i,null,{default:g(()=>[m(r,{type:"text",onClick:e.copyUrl},{default:g(()=>[Rt]),_:1},8,["onClick"])]),_:1})],64)):q("",!0)]),_:1},8,["model"]),n("div",It,[m(r,{type:"primary",onClick:e.saveKanban,loading:e.loading,style:{width:"200px"}},{default:g(()=>[R(Z(e.btnText),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["modelValue","title"])}var zt=H(Lt,[["render",Nt]]);const Ut={name:"save-template",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,t){const{schemaStore:a,storeToRefs:e}=N(),{pageConfig:d,comps:l}=e(a),c=L(null),i=we({loading:!1,id:`temp_${Te()}`,name:""}),s=M({get:()=>o.modelValue,set:v=>t.emit("update:modelValue",v)}),r=M(()=>({template:{id:i.id,name:i.name},pageConfig:d.value,comps:l.value})),p=()=>{c.value&&c.value.validate(async v=>{if(v){const u=r.value,w=JSON.stringify(u);Ct(w,`${u.template.id}.json`),re.success({message:"\u6A21\u677F\u6587\u4EF6\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})},f=async()=>{c.value&&c.value.validate(async v=>{if(v){try{i.loading=!0;const u=r.value,w=u.template.name,_=JSON.stringify(u);await St({name:w,content:_})}catch(u){Me("save-template/saveAsTemplate",u)}i.loading=!1,s.value=!1,re.success({message:"\u6A21\u677F\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})};return de(()=>o.modelValue,v=>{v&&(c.value&&c.value.resetFields(),i.id=`temp_${Te()}`)}),{formRef:c,formStatus:i,visible:s,downloadCfg:p,saveAsTemplate:f}}},At={class:"t-center"},Et=R(" \u914D\u7F6E\u6587\u4EF6 "),jt=R(" \u4FDD\u5B58\u6A21\u677F ");function Ot(o,t,a,e,d,l){const c=y("b-input"),i=y("b-form-item"),s=y("b-form"),r=y("b-button"),p=y("b-modal");return h(),E(p,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=f=>e.visible=f),"append-to-body":"",title:"\u4FDD\u5B58\u4E3A\u6A21\u677F",top:"200px","custom-class":"schema-modal",onClose:t[2]||(t[2]=f=>e.visible=!1)},{default:g(()=>[m(s,{"label-width":"80px",ref:"formRef",model:e.formStatus,"label-suffix":":"},{default:g(()=>[m(i,{label:"\u6A21\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:g(()=>[m(c,{modelValue:e.formStatus.name,"onUpdate:modelValue":t[0]||(t[0]=f=>e.formStatus.name=f)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),n("div",At,[m(r,{type:"primary",icon:"vertical-align-botto",transparent:"",style:{width:"120px"},onClick:e.downloadCfg},{default:g(()=>[Et]),_:1},8,["onClick"]),m(r,{type:"primary",icon:"save",style:{width:"120px"},loading:e.formStatus.loading,onClick:e.saveAsTemplate},{default:g(()=>[jt]),_:1},8,["loading","onClick"])])]),_:1},8,["modelValue"])}var Ht=H(Ut,[["render",Ot]]);const Yt={name:"header-bar",components:{SaveTemplate:Ht,SaveScreen:zt,HeadLoading:Tt},props:{backUrl:{type:String},backTarget:{type:String,default:"_blank",validator:o=>["_self","_blank"].includes(o)},pageStatus:{type:Object,default:()=>({})}},setup(o){const t=Ee(),{schemaStore:a,storeToRefs:e}=N(),{pageInfo:d,toolbar:l}=e(a),{previewScreen:c}=Fe(),i=L(!1),s=L("edit"),r=L(!1);return{schemaStore:a,pageInfo:d,toolbar:l,saveVisible:i,saveStatus:s,tempVisible:r,handleBack:()=>{const _=o.backUrl||"/";if(o.backTarget==="_blank"){const b=t.resolve(_);window.open(b.href,o.backTarget)}else t.push(_)},handleSaveScreen:()=>{s.value="edit",i.value=!0},handPreview:async()=>{const _=await c();let b=t.resolve({path:`/screen/preview/${_.pageInfo.id}`});window.open(b.href,"_blank")},handlePublish:()=>{s.value="audited",i.value=!0},handleUpload:_=>_.type!=="application/json"?(re.warning("\u8BF7\u9009\u62E9\u6B63\u786E\u7684json\u914D\u7F6E\u6587\u4EF6"),!1):(wt(_).then(b=>{try{const T=JSON.parse(b),{comps:S,pageConfig:X}=T;a.loadScreenData({comps:S,pageConfig:X})}catch{console.warn("The imported file could not be converted to the correct JSON!")}}),!1)}}},Xt={class:"header-container"},Wt={class:"left-actions"},Kt={class:"screen-info"},Pt=n("span",null,"\u5206\u6790\u770B\u677F",-1),Ft=n("span",{style:{padding:"0 6px 0 12px"}},"-",-1),Jt={class:"global-actions"},qt={class:"head-btn"};function Gt(o,t,a,e,d,l){const c=y("b-icon"),i=y("b-tooltip"),s=y("b-space"),r=y("b-upload"),p=y("head-loading"),f=y("save-screen"),v=y("save-template");return h(),C(Y,null,[n("div",Xt,[n("div",Wt,[m(s,{size:"mini"},{default:g(()=>[m(i,{content:"\u7EC4\u4EF6","open-delay":500},{default:g(()=>[n("div",{class:D(["head-btn",{active:e.toolbar.components}]),onClick:t[0]||(t[0]=u=>e.schemaStore.toggleCompsPanel())},[m(c,{name:"hourglass",class:D(["com-list-icon",{"is-rotate":!e.toolbar.components}])},null,8,["class"])],2)]),_:1}),m(i,{content:"\u56FE\u5C42","open-delay":500},{default:g(()=>[n("div",{class:D(["head-btn",{active:e.toolbar.layer}]),onClick:t[1]||(t[1]=u=>e.schemaStore.toggleLayerPanel())},[m(c,{name:"container"})],2)]),_:1}),m(i,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:g(()=>[n("div",{class:D(["head-btn",{active:e.toolbar.config}]),onClick:t[2]||(t[2]=u=>e.schemaStore.toggleConfigPanel())},[m(c,{name:"control"})],2)]),_:1}),m(i,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:g(()=>[n("div",{class:D(["head-btn",{active:e.toolbar.toolbox}]),onClick:t[3]||(t[3]=u=>e.schemaStore.toggleToolbox())},[m(c,{name:"shopping"})],2)]),_:1})]),_:1})]),n("div",Kt,[m(i,{content:"\u8FD4\u56DE","open-delay":500},{default:g(()=>[m(c,{name:"laptop",type:"button",onClick:e.handleBack},null,8,["onClick"])]),_:1}),Pt,Ft,ue(n("input",{class:"header-input",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",maxlength:"50",type:"text","onUpdate:modelValue":t[4]||(t[4]=u=>e.pageInfo.name=u)},null,512),[[Se,e.pageInfo.name]])]),n("div",Jt,[m(s,{size:"mini"},{default:g(()=>[m(i,{content:"\u5BFC\u5165json (\u4F1A\u8986\u76D6\u6240\u6709\u5185\u5BB9\uFF01)","open-delay":500},{default:g(()=>[m(r,{action:"/","show-upload-list":!1,"before-upload":e.handleUpload},{default:g(()=>[n("div",qt,[m(c,{name:"Import"})])]),_:1},8,["before-upload"])]),_:1}),m(i,{content:"\u4FDD\u5B58\u6A21\u677F","open-delay":500},{default:g(()=>[n("div",{class:"head-btn",onClick:t[5]||(t[5]=u=>e.tempVisible=!0)},[m(c,{name:"Storedprocedure"})])]),_:1}),m(i,{content:"\u4FDD\u5B58","open-delay":500},{default:g(()=>[n("div",{class:"head-btn",onClick:t[6]||(t[6]=(...u)=>e.handleSaveScreen&&e.handleSaveScreen(...u))},[m(c,{name:"save"})])]),_:1}),m(i,{content:"\u53D1\u5E03","open-delay":500},{default:g(()=>[n("div",{class:"head-btn",onClick:t[7]||(t[7]=(...u)=>e.handlePublish&&e.handlePublish(...u))},[m(c,{name:"send"})])]),_:1}),m(i,{content:"\u9884\u89C8","open-delay":500},{default:g(()=>[n("div",{class:"head-btn",onClick:t[8]||(t[8]=(...u)=>e.handPreview&&e.handPreview(...u))},[m(c,{name:"View"})])]),_:1})]),_:1})])]),m(p),m(f,{modelValue:e.saveVisible,"onUpdate:modelValue":t[9]||(t[9]=u=>e.saveVisible=u),status:e.saveStatus},null,8,["modelValue","status"]),m(v,{modelValue:e.tempVisible,"onUpdate:modelValue":t[10]||(t[10]=u=>e.tempVisible=u)},null,8,["modelValue"])],64)}var Zt=H(Yt,[["render",Gt]]);const ve=we({x:0,y:0});function $e(o={}){const{schemaStore:t,storeToRefs:a}=N(),{contextMenu:e,selectedCom:d}=a(t),l=M(()=>{var p;return(p=d.value)==null?void 0:p.locked}),c=M(()=>{var p;return(p=d.value)==null?void 0:p.hided}),i=M(()=>({display:e.value.show?"block":"none",left:`${ve.x+10}px`,top:`${ve.y+10}px`,transform:document.documentElement.clientHeight-ve.y<250?"translate(0px, -100%)":""})),s=p=>{p.preventDefault(),d.value&&(ve.x=p.clientX,ve.y=p.clientY,e.value.show=!0,P(document,"click",r))},r=()=>{F(document,"click",r),o&&o.beforeClose&&o.beforeClose(),e.value.show=!1};return{showMenu:s,isLocked:l,isHided:c,contextMenu:e,contextMenuStyle:i}}const Qt={name:"layer-panel",setup(){const{schemaStore:o,storeToRefs:t}=N(),{comps:a,toolbar:e,hoveredComId:d,selectedCom:l,renamingComId:c,multiSelect:i,multipleComs:s}=t(o),{showMenu:r}=$e(),p=M(()=>!!l.value),f=M(()=>({opacity:l.value?1:.3})),v=M(()=>{var B;return{enable:!!l.value,checked:(B=l.value)==null?void 0:B.locked}}),u=M(()=>{var B;return{enable:!!l.value,checked:(B=l.value)==null?void 0:B.hided}});function w(B){return i.value?s.value.map(k=>k.id).includes(B.id):!ke(l.value)&&l.value.id===B.id}const _=M(()=>[...a.value].reverse()),b=B=>{l.value&&o.moveCom({id:l.value.id,moveType:B})};return{schemaStore:o,comps:a,toolbar:e,enableBtnClass:p,enableBtnStyle:f,moveUp:()=>b(ae.up),moveDown:()=>b(ae.down),moveTop:()=>b(ae.top),moveBottom:()=>b(ae.bottom),descComs:_,enableLockBtnClass:v,enableHideBtnClass:u,onEnter:B=>o.hoverCom(B),onLeave:()=>o.hoverCom(""),selectCom:B=>{const k=a.value.find(z=>z.id===B);k&&o.selectCom(k)},hoveredComId:d,selectedCom:l,renamingComId:c,showMenu:r,cancelSelectCom:()=>o.selectCom(),isSelected:w}}},eo={class:"layer-panel"},to={class:"layer-top"},oo=n("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),no=n("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),ao=[no],lo={class:"layer-toolbar layer-toolbar-top"},so={class:"layer-manager-wrap"},io=["title","onMousedown","onMouseenter","onDblclick"],co=["onUpdate:modelValue"],ro={key:1,class:"layer-item-span"},uo={class:"layer-item-text"},mo=["title","onClick"],vo=["title","onClick"];function fo(o,t,a,e,d,l){const c=y("b-icon"),i=Oe("focus");return h(),C("div",{class:D(["layer-panel-wp",{"is-hide":!e.toolbar.layer}])},[n("div",eo,[n("div",to,[oo,n("div",{class:"layer-action",onClick:t[0]||(t[0]=s=>e.schemaStore.toggleLayerPanel(!1))},ao)]),n("div",lo,[n("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:D(["b-iconfont b-icon-arrowup toolbar-icon standard",e.enableBtnClass]),style:U(e.enableBtnStyle),onClick:t[1]||(t[1]=(...s)=>e.moveUp&&e.moveUp(...s))},null,6),n("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:D(["b-iconfont b-icon-arrowdown toolbar-icon standard",e.enableBtnClass]),style:U(e.enableBtnStyle),onClick:t[2]||(t[2]=(...s)=>e.moveDown&&e.moveDown(...s))},null,6),n("i",{title:"\u7F6E\u9876",class:D(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:U({transform:"rotate(180deg)",...e.enableBtnStyle}),onClick:t[3]||(t[3]=(...s)=>e.moveTop&&e.moveTop(...s))},null,6),n("i",{title:"\u7F6E\u5E95",class:D(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:U(e.enableBtnStyle),onClick:t[4]||(t[4]=(...s)=>e.moveBottom&&e.moveBottom(...s))},null,6)]),n("div",so,[(h(!0),C(Y,null,te(e.descComs,s=>(h(),C("div",{key:s.id,title:s.alias,class:D(["layer-manager-item",[{hided:s.hided,locked:s.locked,hovered:s.id===e.hoveredComId,selected:e.isSelected(s)}]]),onMousedown:r=>e.selectCom(s.id),onMouseenter:r=>e.onEnter(s.id),onMouseleave:t[7]||(t[7]=(...r)=>e.onLeave&&e.onLeave(...r)),onDblclick:r=>e.schemaStore.renamingCom(s.id),onContextmenu:t[8]||(t[8]=r=>e.showMenu(r))},[m(c,{name:s.icon,size:"18"},null,8,["name"]),s.id===e.renamingComId?ue((h(),C("input",{key:0,"onUpdate:modelValue":r=>s.alias=r,class:"layer-item-input",onBlur:t[5]||(t[5]=r=>e.schemaStore.renamingCom("")),onKeydown:t[6]||(t[6]=je(r=>e.schemaStore.renamingCom(""),["enter"]))},null,40,co)),[[Se,s.alias,void 0,{trim:!0}],[i]]):(h(),C("span",ro,[n("span",uo,Z(s.alias),1)])),n("i",{class:D(["b-iconfont",`b-icon-${s.hided?"eye-close":"eye"}`,"show-toggle-btn"]),title:s.hided?"\u663E\u793A":"\u9690\u85CF",onClick:r=>s.hided=!s.hided},null,10,mo),n("i",{class:D(["b-iconfont",`b-icon-${s.locked?"lock":"unlock"}`,"show-toggle-btn"]),title:s.locked?"\u89E3\u9501":"\u9501\u5B9A",onClick:r=>s.locked=!s.locked},null,10,vo)],42,io))),128)),n("div",{class:"last-flex-item",onClick:t[9]||(t[9]=(...s)=>e.cancelSelectCom&&e.cancelSelectCom(...s))})])])],2)}var po=H(Qt,[["render",fo]]);const ho={name:"VBasicBar",alias:"\u57FA\u672C\u67F1\u56FE",img:I("basic-bar.jpg"),type:"bar",used:!0},_o={name:"VHorizontalBar",alias:"\u57FA\u672C\u6761\u5F62\u56FE",img:I("hori-basic-bar.jpg"),type:"bar",used:!0},go={name:"VCapsuleBar",alias:"\u80F6\u56CA\u67F1\u56FE",img:I("capsule-bar.png"),type:"bar",used:!0},bo={name:"VBasicLine",alias:"\u57FA\u672C\u6298\u7EBF\u56FE",img:I("basic-line.jpg"),type:"line",used:!0},yo={name:"VBasicArea",alias:"\u57FA\u672C\u533A\u57DF\u56FE",img:I("basic-area.jpg"),type:"line",used:!0},xo={name:"VBasicPie",alias:"\u57FA\u672C\u997C\u56FE",img:I("basic-pie.jpg"),type:"pie",used:!0},Co={name:"VBasicRing",alias:"\u57FA\u672C\u73AF\u56FE",img:I("basic-ring.jpg"),type:"pie",used:!0},wo={name:"VBasicRadar",alias:"\u57FA\u672C\u96F7\u8FBE\u56FE",img:I("basic-radar.jpg"),type:"radar",used:!0},So={name:"VBasicMap",alias:"\u57FA\u672C\u5730\u56FE",img:I("2d-china.png"),type:"map",used:!0},ko={name:"VBasicMapEvo",alias:"\u7701\u4EFD\u5730\u56FE",img:I("basic-map-evo.png"),type:"map",used:!0},Vo={name:"VBasicScatter",alias:"\u57FA\u672C\u6563\u70B9\u56FE",img:I("basic-scatter.png"),type:"scatter",used:!0},Mo={name:"VLineBasicScatter",alias:"\u6563\u70B9\u7EBF\u56FE",img:I("line-basic-scatter.png"),type:"scatter",used:!0},$o={name:"VBasicBoxplot",alias:"\u76D2\u987B\u56FE",img:I("basic-boxplot.png"),type:"boxplot",used:!0},Do={name:"VBasicFunnel",alias:"\u57FA\u672C\u68AF\u5EA6\u56FE",img:I("basic-funnel.jpg"),type:"funnel",used:!0},Bo={name:"VBasicWordCloud",alias:"\u57FA\u672C\u8BCD\u4E91\u56FE",img:I("basic-wordcloud.jpg"),type:"wordcloud",used:!0},To={name:"VBasicGauge",alias:"\u57FA\u672C\u4EEA\u8868\u76D8",img:I("basic-gauge.png"),type:"gauge",used:!0},Lo={name:"VProgressCircle",alias:"\u8FDB\u5EA6\u73AF",img:I("pie-one-value.png"),type:"circle",used:!0},Ro={name:"VMainTitle",alias:"\u901A\u7528\u6807\u9898",img:I("main-title.png"),type:"info",used:!0},Io={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:I("number-title-flop.png"),type:"info",used:!0},No={name:"VTimer",alias:"\u65F6\u95F4\u5668",img:I("timer.png"),type:"info",used:!0},zo={name:"VSelect",alias:"\u4E0B\u62C9\u63A7\u4EF6",img:I("number-title-flop.png"),type:"control",used:!0},Uo={name:"VBgBox",alias:"\u80CC\u666F\u5757",img:I("bg-box.png"),type:"media",used:!0},Ao={name:"VBorderBox",alias:"\u8FB9\u6846",img:I("border-box.png"),type:"media",used:!0},Eo={name:"VDecoration",alias:"\u88C5\u9970\u5668",img:I("decoration.png"),type:"media",used:!0},jo={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:I("img.png"),type:"media",used:!0},Oo={name:"VScrollTable",alias:"\u57FA\u7840\u8868\u683C",img:I("scroll-table.jpg"),type:"table",used:!0},be=[{type:"bar",name:"\u67F1\u56FE",icon:"barchart",data:[ho,_o,go]},{type:"line",name:"\u7EBF\u56FE",icon:"linechart",data:[bo,yo]},{type:"pie",name:"\u997C\u56FE",icon:"piechart",data:[xo,Co]},{type:"radar",name:"\u96F7\u8FBE\u56FE",icon:"radarchart",data:[wo]},{type:"scatter",name:"\u6563\u70B9\u56FE",icon:"pointmap",data:[Vo,Mo]},{type:"map",name:"\u5730\u56FE",icon:"location",data:[So,ko]},{type:"other",name:"\u5176\u4ED6\u56FE\u8868",icon:"ungroup",data:[$o,Do,Bo,To,Lo]},{type:"table",name:"\u8868\u683C",icon:"table",data:[Oo]},{type:"info",name:"\u4FE1\u606F",icon:"info-circle",data:[Ro,Io,No,zo]},{type:"media",name:"\u5A92\u4F53",icon:"Youtube",data:[Uo,Ao,Eo,jo]}];function Ho(o){for(let t=0;t<be.length;t++){const a=be[t];for(let e=0;e<a.data.length;e++){const d=a.data[e];if(d.name===o)return{classification:a,com:d}}}return null}const Yo={name:"components-panel",setup(){const{schemaStore:o,storeToRefs:t}=N(),{pageConfig:a,toolbar:e,selectedCom:d}=t(o),l=L(0),c=M(()=>be[l.value].data);return{toolbar:e,activeIndex:l,componentsList:be,comps:c,changeComp:v=>{o.toggleCompsPanel(!0),l.value=v},dragStart:(v,u)=>{v.dataTransfer.setData("text",u)},toAddCom:async(v,u)=>{if(u){const w=We(v);if(w.attr.x=Math.floor((a.value.width-w.attr.w)/2),w.attr.y=Math.floor((a.value.height-w.attr.h)/2),o.addCom({component:w}),o.selectCom(w),w.apiData&&w.apiData.type===Ve.static&&w.apiData.staticPath){const{data:_}=await Pe(w.id,w.apiData.staticPath);d.value.apiData.config.data=JSON.stringify(_)}}else console.log("\u6B63\u5728\u5F00\u53D1\u4E2D\u3002\u3002\u3002")},dragOver:v=>{v.preventDefault(),v.stopPropagation(),v.dataTransfer.dropEffect="none"},closePanel:()=>{e.value.components&&o.toggleCompsPanel(!1)}}}},Xo={class:"components-panel-wp"},Wo={class:"components-panel"},Ko=n("div",{class:"panel-title"},[n("span",{class:"panel-text"},"\u7EC4\u4EF6")],-1),Po={class:"components-type"},Fo=["onClick"],Jo={class:"com-tab-title"},qo={class:"p10"},Go=["title","draggable","onDragstart","onClick"],Zo={class:"comp-item-text"};function Qo(o,t,a,e,d,l){const c=y("b-icon"),i=y("b-scrollbar"),s=Oe("click-outside");return h(),C("div",Xo,[n("div",Wo,[Ko,n("div",{class:"components-panel-content",onDragover:t[0]||(t[0]=(...r)=>e.dragOver&&e.dragOver(...r))},[n("div",Po,[m(i,{native:""},{default:g(()=>[(h(!0),C(Y,null,te(e.componentsList,(r,p)=>(h(),C("div",{class:D(["components-item",{active:e.activeIndex===p}]),key:p,onClick:f=>e.changeComp(p)},[m(c,{class:"com-tab-icon",name:r.icon},null,8,["name"]),n("span",Jo,Z(r.name),1)],10,Fo))),128))]),_:1})]),ue((h(),C("div",{class:D(["components-list",{"is-hide":!e.toolbar.components}])},[m(i,{native:""},{default:g(()=>[n("div",qo,[(h(!0),C(Y,null,te(e.comps,(r,p)=>(h(),C("div",{class:"comp-item",key:p,title:r.alias,draggable:r.used,onDragstart:f=>e.dragStart(f,r.name),onClick:f=>e.toAddCom(r.name,r.used)},[n("div",Zo,Z(r.alias),1),n("div",{class:"comp-item-img",style:U(`background-image: url(${r.img});`)},null,4)],40,Go))),128))])]),_:1})],2)),[[s,e.closePanel]])],32)])])}var en=H(Yo,[["render",Qo]]);const Ie=o=>`${o}px`,Ne=(o,t,a,e)=>{const d=o!=null?o:document.createElement("canvas");d.width=t*e,d.height=a*e,d.style.width=Ie(t),d.style.height=Ie(a);const l=d.getContext("2d");return l&&l.setTransform(e,0,0,e,0,0),d};class ze{constructor(t,a){this.el=t,this.options={direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2,...a},this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:a}=this,{direction:e,width:d,height:l,ratio:c}=a,i=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,d),s=l;this.ruler.width=i,this.ruler.height=s;const r=Ne(null,i,s,c);vt(r,"canvas-ruler"),t.appendChild(r),this.canvas=r,this.ctx=r.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:a,ruler:e}=this,{width:d,height:l}=e;t.beginPath(),t.fillStyle=a.bgColor,t.fillRect(0,0,d,l),t.closePath(),t.beginPath(),t.font=`${a.fontSize} ${a.fontFamily}`,t.textAlign="left",t.fillStyle=a.fontColor,t.strokeStyle=a.strokeStyle,t.lineWidth=a.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:a,ruler:e}=this,{width:d,height:l}=e,{offset:c,scale:i}=a,s=0,r=l/1.5,p=l/1.2;for(let f=0;f<=d;f+=1){const v=f-c;if(v<0)continue;let u=-1,w=-1;v%50===0?(u=Math.floor(v/i),w=s):v%25===0?w=r:v%5===0&&(w=p),w>=0&&(t.moveTo(f+.5,l+.5),t.lineTo(f+.5,w),u>-1&&t.fillText(`${u}`,f+2.5,l/1.5))}}setSize(t,a,e){const{el:d,options:l}=this;l.width=t,l.height=a,l.scale=e;const{direction:c,width:i,height:s,ratio:r}=l,p=Math.max(c==="TB"?d.offsetWidth:d.offsetHeight,i),f=s;this.ruler.width=p,this.ruler.height=f,Ne(this.canvas,p,f,r),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const tn={name:"ruler",setup(){const{schemaStore:o,storeToRefs:t}=N(),{canvas:a}=t(o),e=L(null),d=L(null),l=L(null),c=L(null),i=L(!0),s=L(0),r=L(0),p=document.documentElement.clientWidth;nt(()=>{if(e.value&&d.value){const v=Math.max(a.value.width,p);l.value?l.value.setSize(v,18,a.value.scale):l.value=new ze(e.value,{direction:"TB",width:v,scale:a.value.scale}),c.value?c.value.setSize(a.value.height,18,a.value.scale):c.value=new ze(d.value,{direction:"LR",width:a.value.height,scale:a.value.scale})}});const f=v=>{const u=v.target;s.value=u.scrollLeft,r.value=u.scrollTop};return fe(()=>{const v=document.getElementById("canvas-wp");v==null||v.addEventListener("scroll",f)}),at(()=>{const v=document.getElementById("canvas-wp");v==null||v.removeEventListener("scroll",f)}),{visible:i,hRulerWpRef:e,vRulerWpRef:d,vScroll:r,hScroll:s}}},on=o=>(pe("data-v-5f454e16"),o=o(),he(),o),nn={class:"canvas-ruler-wp"},an=on(()=>n("div",{class:"ruler-corner"},null,-1));function ln(o,t,a,e,d,l){return h(),C("div",nn,[n("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:U(`transform: translateX(-${e.hScroll}px);`)},null,4),n("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:U(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),an])}var sn=H(tn,[["render",ln],["__scopeId","data-v-5f454e16"]]);function Ue(o){if(o={...o},o.rotate!==0){const t=o.width*Le(o.rotate)+o.height*Re(o.rotate),a=(o.width-t)/2;o.left+=a,o.right=o.left+t;const e=o.height*Le(o.rotate)+o.width*Re(o.rotate),d=(e-o.height)/2;o.top-=d,o.bottom=o.top+e,o.width=t,o.height=e}else o.bottom=o.top+o.height,o.right=o.left+o.width;return o}const cn=5,rn={name:"mark-line",setup(){const{schemaStore:o,storeToRefs:t}=N(),{comps:a,selectedCom:e,canvas:d,toolbox:l}=t(o),c=L([]),i=L(["xt","xc","xb","yl","yc","yr"]),s=L({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),r=()=>{Object.keys(s.value).forEach(b=>{s.value[b]=!1})};function p({key:b,value:T}){const S={left:"x",top:"y"};o.setShapeSingleStyle({key:S[b],value:T})}const f=(b,T)=>{const S=c.value,X=e.value,ne=a.value.filter(B=>!B.hided),ie=d.value.scale,A=Ue(w(X.attr)),W=A.width/2,G=A.height/2;r(),ne.forEach(B=>{if(B.id===X.id||B.locked||B.hided)return;const{top:k,left:z,bottom:V,right:O,width:K,height:Q}=Ue(w(B.attr)),J=K/2,$=Q/2,ce={top:[{isNearly:_(A.top,k),lineNode:S.xt,line:"xt",dragShift:k,lineShift:k},{isNearly:_(A.bottom,k),lineNode:S.xt,line:"xt",dragShift:k-A.height,lineShift:k},{isNearly:_(A.top+G,k+$),lineNode:S.xc,line:"xc",dragShift:k+$-G,lineShift:k+$},{isNearly:_(A.top,V),lineNode:S.xb,line:"xb",dragShift:V,lineShift:V},{isNearly:_(A.bottom,V),lineNode:S.xb,line:"xb",dragShift:V-A.height,lineShift:V}],left:[{isNearly:_(A.left,z),lineNode:S.yl,line:"yl",dragShift:z,lineShift:z},{isNearly:_(A.right,z),lineNode:S.yl,line:"yl",dragShift:z-A.width,lineShift:z},{isNearly:_(A.left+W,z+J),lineNode:S.yc,line:"yc",dragShift:z+J-W,lineShift:z+J},{isNearly:_(A.left,O),lineNode:S.yr,line:"yr",dragShift:O,lineShift:O},{isNearly:_(A.right,O),lineNode:S.yr,line:"yr",dragShift:O-A.width,lineShift:O}]},me=[],{rotate:xe}=A;Object.keys(ce).forEach(le=>{ce[le].forEach(oe=>{if(!oe.isNearly)return;const _e=xe!==0?v(le,oe,A):oe.dragShift;p({key:le,value:_e}),oe.lineNode.style[le]=`${oe.lineShift*ie+60}px`,me.push(oe.line)})}),me.length&&u(me,b,T)})},v=(b,T,S)=>{const{w:X,h:ne}=e.value.attr;return Math.round(b==="top"?T.dragShift-(ne-S.height)/2:T.dragShift-(X-S.width)/2)},u=(b,T,S)=>{S?b.includes("yr")?s.value.yr=!0:b.includes("yc")?s.value.yc=!0:b.includes("yl")&&(s.value.yl=!0):b.includes("yl")?s.value.yl=!0:b.includes("yc")?s.value.yc=!0:b.includes("yr")&&(s.value.yr=!0),T?b.includes("xb")?s.value.xb=!0:b.includes("xc")?s.value.xc=!0:b.includes("xt")&&(s.value.xt=!0):b.includes("xt")?s.value.xt=!0:b.includes("xc")?s.value.xc=!0:b.includes("xb")&&(s.value.xb=!0)},w=b=>({left:b.x,top:b.y,width:b.w,height:b.h,rotate:b.rotate}),_=(b,T)=>Math.abs(b-T)<=cn;return fe(()=>{se.on("move",({isDownward:b,isRightward:T})=>{l.value.markLine&&f(b,T)}),se.on("unmove",()=>{r()})}),ye(()=>{se.off("move"),se.off("unmove")}),{lineRefs:c,lines:i,lineStatus:s}}},dn={class:"mark-line"};function un(o,t,a,e,d,l){return h(),C("div",dn,[(h(!0),C(Y,null,te(e.lines,c=>ue((h(),C("div",{key:c,class:D(["line",[c.includes("x")?"xline":"yline",c]]),ref_for:!0,ref:i=>{e.lineRefs[c]=i}},null,2)),[[He,e.lineStatus[c]||!1]])),128))])}var mn=H(rn,[["render",un],["__scopeId","data-v-00d4450a"]]);const{schemaStore:Je}=N(),vn=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],Ae=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],fn=o=>{const t=(o+360)%360,a={};let e=-1;return vn.forEach(d=>{const l=(d.angle+t)%360,c=Ae.length,i=0;for(;i<c;){e=(e+1)%c;const s=Ae[e];if(l<23||l>=338){a[d.direction]="nwse-resize";break}if(s.start<=l&&l<s.end){a[d.direction]=s.cursor;break}}}),a};function pn(o,t,a,e,d,l){o==="t"?(l.h=Math.round(t.h+(a.y-e.y)/d),l.y=Math.round(t.y+(e.y-a.y)/d),l.h=Math.max(l.h,20)):o==="rt"?(l.h=Math.round(t.h+(a.y-e.y)/d),l.w=Math.round(t.w+(e.x-a.x)/d),l.y=Math.round(t.y+(e.y-a.y)/d),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):o==="r"?(l.w=Math.round(t.w+(e.x-a.x)/d),l.w=Math.max(l.w,20)):o==="rb"?(l.h=Math.round(t.h+(e.y-a.y)/d),l.w=Math.round(t.w+(e.x-a.x)/d),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):o==="b"?(l.h=Math.round(t.h+(e.y-a.y)/d),l.h=Math.max(l.h,20)):o==="lb"?(l.h=Math.round(t.h+(e.y-a.y)/d),l.w=Math.round(t.w+(a.x-e.x)/d),l.x=Math.round(t.x+(e.x-a.x)/d),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):o==="l"?(l.w=Math.round(t.w+(a.x-e.x)/d),l.x=Math.round(t.x+(e.x-a.x)/d),l.w=Math.max(l.w,20)):o==="lt"&&(l.h=Math.round(t.h+(a.y-e.y)/d),l.w=Math.round(t.w+(a.x-e.x)/d),l.x=Math.round(t.x+(e.x-a.x)/d),l.y=Math.round(t.y+(e.y-a.y)/d),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20))}const qe=(o,t,a,e,d)=>{const l={...a.attr},c=Object.create(null),i=o.clientX,s=o.clientY;let r=!1;const p=v=>{r=!0;const u=v.clientX,w=v.clientY;t?pn(t,l,{x:i,y:s},{x:u,y:w},e,c):(c.x=l.x+Math.round((u-i)/e/d)*d,c.y=l.y+Math.round((w-s)/e/d)*d),a.attr={...a.attr,...c},ge().then(()=>{se.emit("move",{isDownward:w-s>0,isRightward:u-i>0})})},f=()=>{se.emit("unmove"),r&&Je.recordSnapshot(),F(document,"mousemove",p),F(document,"mouseup",f)};P(document,"mousemove",p),P(document,"mouseup",f)},hn=(o,t,a,e)=>{qe(o,null,t,a,e)},_n=(o,t,a,e)=>{qe(o,t,a,e)},gn=(o,t,a)=>{const e=t.getBoundingClientRect(),d=e.left+e.width/2,l=e.top+e.height/2,c=Math.atan2(l-o.clientY,d-o.clientX)*180/Math.PI-a.attr.rotate;let i=!1;const s=p=>{i=!0;const f=Math.atan2(l-p.clientY,d-p.clientX)*180/Math.PI-c,v=Math.round(f%360);a.attr.rotate=v<0?v+360:v},r=()=>{i&&Je.recordSnapshot(),F(document,"mousemove",s),F(document,"mouseup",r)};P(document,"mousemove",s),P(document,"mouseup",r)},bn={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(o){const t=M(()=>({height:`${o.attr.y+60/o.scale}px`,borderLeftWidth:`${.9/o.scale}px`})),a=M(()=>({width:`${o.attr.x+60/o.scale}px`,borderTopWidth:`${.9/o.scale}px`})),e=M(()=>({fontSize:`${12/o.scale}px`,top:`-${6/o.scale}px`,left:`-${6/o.scale}px`}));return{topLineStyle:t,leftLineStyle:a,accountStyle:e}}},yn={class:"nav-line"};function xn(o,t,a,e,d,l){return h(),C("div",yn,[n("div",{class:"nav-line-top",style:U(e.topLineStyle)},null,4),n("div",{class:"nav-line-left",style:U(e.leftLineStyle)},null,4),n("div",{class:"nav-line-account",style:U(e.accountStyle)},Z(a.attr.x)+", "+Z(a.attr.y),5)])}var Cn=H(bn,[["render",xn]]);const wn={name:"dv-transform",components:{ReferLine:Cn},props:{data:{type:Object,required:!0}},setup(o){const t=lt(),{showMenu:a}=$e(),{schemaStore:e,storeToRefs:d}=N(),{canvas:l,comps:c,pageConfig:i,selectedCom:s,hoveredComId:r,toolbox:p,spaceDown:f,multiSelect:v,multipleComs:u}=d(e),w=M(()=>r.value===o.data.id),_=M(()=>v.value?!1:!ke(s.value)&&s.value.id===o.data.id),b=M(()=>v.value?u.value.map($=>$.id).includes(o.data.id):!1),T=M(()=>({locked:o.data.locked,selected:_.value})),S=M(()=>({top:0,left:0,width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`,transform:`translate(${o.data.attr.x}px, ${o.data.attr.y}px)`})),X=M(()=>({"is-hide":!_.value||o.data.locked})),ne=M(()=>({cursor:"move",transform:`rotate(${o.data.attr.rotate}deg)`})),ie=M(()=>({width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`})),A=M(()=>({display:o.data.hided?"none":"block"})),W=M(()=>fn(o.data.attr.rotate)),G=M(()=>l.value.scale),B=M(()=>{const $=`scale(${1/G.value}, ${1/G.value})`;return{t:{name:"top",style:{cursor:W.value.t,transform:$}},rt:{name:"top-right",style:{cursor:W.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:$}},r:{name:"right",style:{cursor:W.value.r,transform:$}},rb:{name:"bottom-right",style:{cursor:W.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:$}},b:{name:"bottom",style:{cursor:W.value.b,transform:$}},lb:{name:"bottom-left",style:{cursor:W.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:$}},l:{name:"left",style:{cursor:W.value.l,transform:$}},lt:{name:"top-left",style:{cursor:W.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:$}}}}),k=()=>e.hoverCom(o.data.id),z=()=>e.hoverCom(""),V=()=>{e.selectCom(o.data)},O=$=>{f.value||($.stopPropagation(),$.preventDefault(),V(),hn($,o.data,G.value,i.value.grid))},K=($,ce)=>{V(),_n($,ce,o.data,G.value)},Q=$=>{gn($,t.vnode.el,o.data)};function J(){V(),s.value.locked=!1}return{comps:c,selectedCom:s,hoveredComId:r,toolbox:p,isHovered:w,isSelected:_,isMultiSelted:b,hideStyle:A,transformClass:T,transformStyle:S,handlerClass:X,handlerStyle:ne,wrapperStyle:ie,onEnter:k,onLeave:z,onMove:O,onZoom:K,onRotate:Q,points:B,scale:G,showMenu:a,unLock:J}}},Sn={class:"dv-com"},kn=["onMousedown"],Vn=["onMousedown"],Mn=n("div",{class:"transform-bg"},null,-1);function $n(o,t,a,e,d,l){const c=y("refer-line");return h(),C("div",{class:D(["dv-transform",e.transformClass]),style:U(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(h(),E(c,{key:0,attr:a.data.attr,scale:e.scale},null,8,["attr","scale"])):q("",!0),n("div",{class:D(["dv-scale",{hovered:e.isHovered}]),style:U(e.hideStyle),onMouseenter:t[2]||(t[2]=(...i)=>e.onEnter&&e.onEnter(...i)),onMouseleave:t[3]||(t[3]=(...i)=>e.onLeave&&e.onLeave(...i)),onMousedown:t[4]||(t[4]=(...i)=>e.onMove&&e.onMove(...i))},[n("div",{class:D(["transform-handler",e.handlerClass]),style:U(e.handlerStyle)},[n("div",Sn,[Ye(o.$slots,"default"),n("div",{class:"dv-event-disable",style:U(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...i)=>e.showMenu&&e.showMenu(...i))},null,36)]),(h(!0),C(Y,null,te(e.points,(i,s)=>(h(),C(Y,{key:s},[i.rotateStyle?(h(),C("i",{key:0,class:D(`${i.name}-handler`),"data-html2canvas-ignore":""},[n("span",{class:"rotate-handler",style:U(i.rotateStyle),onMousedown:t[1]||(t[1]=ee((...r)=>e.onRotate&&e.onRotate(...r),["prevent","stop"]))},[n("span",{class:"control-point",style:U(i.style),onMousedown:ee(r=>e.onZoom(r,s),["prevent","stop"])},null,44,kn)],36)],2)):(h(),C("i",{key:1,class:D(`${i.name}-handler`),"data-html2canvas-ignore":""},[n("span",{class:"control-point",style:U(i.style),onMousedown:ee(r=>e.onZoom(r,s),["prevent","stop"])},null,44,Vn)],2))],64))),128)),Mn],6)],38),a.data.locked?(h(),C("i",{key:1,class:"b-iconfont b-icon-lock",title:"\u89E3\u9501",onClick:t[5]||(t[5]=ee((...i)=>e.unLock&&e.unLock(...i),["stop"]))})):q("",!0)],6)}var Dn=H(wn,[["render",$n]]);const Bn=["onClick"],Tn=["onClick"],Ln={__name:"index",setup(o){const{schemaStore:t}=N(),a=M(()=>t.toolbar.config?{right:"332px"}:{right:0}),e=()=>t.undo(),d=()=>t.redo();return(l,c)=>(h(),C("div",{class:"action-bar-wrap",style:U(x(a))},[n("i",{class:"action-btn b-iconfont b-icon-aim",title:"\u6700\u4F73\u753B\u5E03\u6BD4\u4F8B",onClick:c[0]||(c[0]=ee(i=>x(t).autoCanvasScale(),["stop"]))}),n("i",{class:"action-btn b-iconfont b-icon-icon-test",title:"1:1\u753B\u5E03\u5927\u5C0F",onClick:c[1]||(c[1]=ee(i=>x(t).setCanvasScale(100),["stop"]))}),n("i",{class:"action-btn b-iconfont b-icon-rollback",title:"\u64A4\u9500",onClick:ee(e,["stop"])},null,8,Bn),n("i",{class:"action-btn b-iconfont b-icon-rollback",title:"\u91CD\u505A",onClick:ee(d,["stop"]),style:{transform:"rotateY(180deg)"}},null,8,Tn)],4))}};var Rn=H(Ln,[["__scopeId","data-v-1c712a36"]]);const In={__name:"index",props:{x:Number,y:Number,width:Number,height:Number,showArea:Boolean},setup(o){return(t,a)=>ue((h(),C("div",{style:U({left:o.x+"px",top:o.y+"px",width:o.width+"px",height:o.height+"px"}),class:"area"},null,4)),[[He,o.showArea]])}};var Nn=H(In,[["__scopeId","data-v-0a9d9fbb"]]);const zn={class:"canvas-main"},Un=["onMousedown"],An={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=N(),{pageConfig:e,spaceDown:d,canvas:l,selectedCom:c,comps:i,toolbox:s,getPanelOffsetLeft:r,getPanelOffsetTop:p,editorEL:f,areaData:v}=a(t),u=L(null),w=we({drag:!1,startX:0,startY:0});let _=0,b=0;const T=M(()=>({width:`${l.value.width}px`,height:`${l.value.height}px`})),S=M(()=>({position:"absolute",width:`${e.value.width}px`,height:`${e.value.height}px`,transform:`scale(${l.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${e.value.bgImage})`,backgroundColor:e.value.bgColor})),X=ft(t.autoCanvasScale,50),ne=async k=>{k.preventDefault();try{const z=k.dataTransfer.getData("text");if(z){const V=We(z),{scale:O}=l.value,K=(k.clientX-r.value+u.value.scrollLeft)/O,Q=(k.clientY-p.value+u.value.scrollTop)/O;if(V.attr.x=Math.round(K-V.attr.w/2),V.attr.y=Math.round(Q-V.attr.h/2),t.addCom({component:V}),t.selectCom(V),V.apiData&&V.apiData.type===Ve.static&&V.apiData.staticPath){const{data:J}=await Pe(V.id,V.apiData.staticPath);c.value.apiData.config.data=JSON.stringify(J)}}}catch(z){console.warn(z)}},ie=k=>{k.preventDefault(),k.stopPropagation(),k.dataTransfer.dropEffect="copy"};function A(k){d.value||t.selectCom(),w.drag=!0;const z=k.clientX,V=k.clientY,O=l.value.scale,{scrollLeft:K,scrollTop:Q,clientWidth:J,scrollWidth:$,clientHeight:ce,scrollHeight:me}=u.value,xe=J<$||ce<me,le={left:K,top:Q},oe=Be=>{if(!d.value||!w.drag||!xe)return;const Qe=Be.clientX,et=Be.clientY,tt=Math.round((Qe-z)/O),ot=Math.round((et-V)/O);u.value.scrollLeft=le.left-tt,u.value.scrollTop=le.top-ot},_e=()=>{w.drag=!1,F(document,"mousemove",oe),F(document,"mouseup",_e)};P(document,"mousemove",oe),P(document,"mouseup",_e)}function W(k){if(c.value||k.preventDefault(),B(),d.value)return;const z=f.value.getBoundingClientRect();_=z.x,b=z.y;const V=k.clientX,O=k.clientY;v.value.showArea=!0;const K=l.value.scale;v.value.x=(V-_)/K,v.value.y=(O-b)/K;const Q=$=>{v.value.width=Math.abs(($.clientX-V)/K),v.value.height=Math.abs(($.clientY-O)/K),$.clientX<V&&(v.value.x=($.clientX-_)/K),$.clientY<O&&(v.value.y=($.clientY-b)/K)},J=$=>{if(F(document,"mousemove",Q),F(document,"mouseup",J),$.clientX===V&&$.clientY===O){B();return}G()};P(document,"mousemove",Q),P(document,"mouseup",J)}function G(){const k=pt(v.value,i.value);if(k.length===0){B();return}if(k.length===1){t.selectCom(k[0]),B();return}t.multiSelectComs(k)}function B(){v.value.showArea=!1,v.value.width=0,v.value.height=0}return fe(()=>{P(window,"resize",X),se.on("hideArea",B),t.getEditor(),X()}),ye(()=>{F(window,"resize",X)}),(k,z)=>(h(),C("div",zn,[n("div",{id:"canvas-wp",ref_key:"canvasWpRef",ref:u,class:"canvas-panel-wrap",onMousedown:ee(A,["stop"])},[n("div",{class:"screen-shot",style:U(x(T))},[x(s).markLine?(h(),E(mn,{key:0,style:U(x(T))},null,8,["style"])):q("",!0),m(Rn),m(sn),n("div",{id:"canvas-components",class:"canvas-panel",style:U(x(S)),onDragover:ie,onDrop:ne,onMousedown:W},[(h(!0),C(Y,null,te(x(i),V=>(h(),E(Dn,{key:V.id,data:V},{default:g(()=>[(h(),E(Xe(V.name),{data:V,style:U({width:V.attr.w+"px",height:V.attr.h+"px",opacity:V.attr.opacity,transform:"translateZ(0px)"}),id:`component_${V.id}`},null,8,["data","style","id"]))]),_:2},1032,["data"]))),128)),m(Nn,st(it(x(v))),null,16)],36)],4)],40,Un)]))}};const En={name:"page-config",setup(){const{schemaStore:o,storeToRefs:t}=N(),{pageConfig:a}=t(o),e=L(""),d=()=>{a.value.bgColor="#0d2a42",a.value.bgImage=""},l=()=>o.autoCanvasScale(),c=i=>{if(i!=="custom"){const s=i.split("x"),r=+s[0],p=+s[1];o.setScreenSize({width:r,height:p})}};return de([()=>a.value.width,()=>a.value.height],()=>{const{width:i,height:s}=a.value;i===1920&&s===1080||i===2560&&s===1080||i===3440&&s===1080||i===3440&&s===1440||i===414&&s===736||i===375&&s===667||i===375&&s===812?e.value=`${i}x${s}`:e.value="custom"},{immediate:!0}),{screenLabel:e,onSizeChange:l,resetBGImage:d,pageConfig:a,pageMap:[{group:"web\u7AEF",data:ht.map(i=>({value:`${i.width}x${i.height}`,label:i.label}))},{group:"\u79FB\u52A8\u8BBE\u5907",data:_t.map(i=>({value:`${i.width}x${i.height}`,label:i.label}))},{group:"\u5176\u4ED6",data:[{value:"custom",label:"\u81EA\u5B9A\u4E49"}]}],sizeChange:c}}},jn=o=>(pe("data-v-75712752"),o=o(),he(),o),On={class:"page-config-panel"},Hn=jn(()=>n("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),Yn={class:"page-config-content"},Xn={class:"page-config-wp"},Wn=R("\u6062\u590D\u9ED8\u8BA4\u80CC\u666F"),Kn={class:"page-config-wp"};function Pn(o,t,a,e,d,l){const c=y("g-group-select"),i=y("g-field"),s=y("g-input-number"),r=y("g-color-picker"),p=y("g-upload-img"),f=y("g-images-select"),v=y("b-button");return h(),C("div",On,[Hn,n("div",Yn,[n("div",Xn,[m(i,{label:"\u5C4F\u5E55\u8BBE\u7F6E",flat:""},{default:g(()=>[m(c,{modelValue:e.screenLabel,"onUpdate:modelValue":t[0]||(t[0]=u=>e.screenLabel=u),data:e.pageMap,onChange:e.sizeChange},null,8,["modelValue","data","onChange"])]),_:1}),m(i,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:g(()=>[m(s,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[1]||(t[1]=u=>e.pageConfig.width=u),label:"\u5BBD\u5EA6",min:375,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),m(s,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[2]||(t[2]=u=>e.pageConfig.height=u),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),m(i,{label:"\u80CC\u666F\u989C\u8272"},{default:g(()=>[m(r,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[3]||(t[3]=u=>e.pageConfig.bgColor=u)},null,8,["modelValue"])]),_:1}),m(i,{label:"\u80CC\u666F\u56FE",tooltip:"\u652F\u6301\u56FE\u7247\u5730\u5740\u3001\u9759\u6001\u8DEF\u5F84\u3001base64\u5B58\u50A8"},{default:g(()=>[m(p,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[4]||(t[4]=u=>e.pageConfig.bgImage=u)},null,8,["modelValue"])]),_:1}),m(i,{label:"\u80CC\u666F\u9884\u8BBE",tooltip:"\u53EF\u4EE5\u52A0\u8F7D\u5BF9\u5E94\u9884\u8BBE\u7684\u56FE\u7247\u80CC\u666F"},{default:g(()=>[m(f,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[5]||(t[5]=u=>e.pageConfig.bgImage=u),images:["bg"],"value-key":"src"},null,8,["modelValue"])]),_:1}),m(i,{label:"\u91CD\u7F6E"},{default:g(()=>[m(v,{type:"primary",size:"small",onClick:e.resetBGImage},{default:g(()=>[Wn]),_:1},8,["onClick"])]),_:1})]),n("div",Kn,[m(i,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:g(()=>[m(s,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[6]||(t[6]=u=>e.pageConfig.grid=u),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})])])])}var Fn=H(En,[["render",Pn],["__scopeId","data-v-75712752"]]);const Jn={name:"config-title",props:{comName:{type:String},comAlias:{type:String}},setup(o){const t=M(()=>{const e=Ho(o.comName);return e?e.com.name:o.comName});return{toSearch:()=>{window.open("https://echarts.apache.org/zh/option.html#title","_blank")},comTitle:t}}},Ge=o=>(pe("data-v-385fde02"),o=o(),he(),o),qn={class:"com-title-wp"},Gn={class:"com-title"},Zn={class:"title-name"},Qn={class:"alias-name"},ea={class:"version-tag"},ta=Ge(()=>n("i",{class:"b-iconfont b-icon-search"},null,-1)),oa=Ge(()=>n("span",null,"\u641C\u7D22\u914D\u7F6E",-1)),na=[ta,oa];function aa(o,t,a,e,d,l){return h(),C("div",qn,[n("div",Gn,[n("div",Zn,[n("span",Qn,Z(a.comAlias),1)]),n("div",ea,[n("span",null,Z(e.comTitle),1)])]),Ye(o.$slots,"default",{},()=>[n("div",{class:"search-config",onClick:t[0]||(t[0]=(...c)=>e.toSearch&&e.toSearch(...c)),title:"echarts option config"},na)],!0)])}var De=H(Jn,[["render",aa],["__scopeId","data-v-385fde02"]]);const la={name:"data-center-panel",components:{ConfigTitle:De,SourcePanel:gt(()=>ct(()=>import("./source-panel-f4dac05d.js"),["static/js/source-panel-f4dac05d.js","static/css/source-panel-9456a5cd.css","static/js/vendor-b7d265ee.js","static/css/vendor-2b79d43b.css","static/js/chunk-brace-b4ee70be.js","static/js/index-0df6ecd1.js","static/css/index-a2343449.css","static/js/chunk-bin-ui-next-925ea2c7.js","static/css/chunk-bin-ui-next-233b4550.css"]))},setup(){const{schemaStore:o,storeToRefs:t}=N(),{selectedCom:a}=t(o),e=M(()=>Object.keys(a.value.apiData));return{selectedCom:a,dataKeys:e}}},sa={class:"data-center-panel"},ia={class:"scroll-container"},ca={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"},ra=R("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E");function da(o,t,a,e,d,l){const c=y("config-title"),i=y("source-panel"),s=y("b-empty"),r=y("b-scrollbar");return h(),C("div",sa,[m(c,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),n("div",ia,[m(r,{native:""},{default:g(()=>[e.dataKeys.length>0?(h(),E(i,{key:0})):(h(),C("div",ca,[m(s,null,{default:g(()=>[ra]),_:1})]))]),_:1})])])}var ua=H(la,[["render",da]]);const ma={class:"basic-setting-wp"},va={style:{width:"50%"}},fa=R(" \u7EC4\u5408 "),pa=R(" \u62C6\u5206 "),Ze={__name:"basic-setting",props:{attr:{type:Object,required:!0},readonly:{type:Boolean,default:!1}},emits:["update:attr"],setup(o,{emit:t}){const a=o,e=M({get:()=>a.attr,set:s=>t("update:attr",s)}),{schemaStore:d,storeToRefs:l}=N(),{curComIsGroup:c,multiSelect:i}=l(d);return(s,r)=>{const p=y("g-input-number"),f=y("g-field"),v=y("b-button"),u=y("b-button-group"),w=y("g-slider");return h(),C("div",ma,[m(f,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{default:g(()=>[m(p,{modelValue:x(e).w,"onUpdate:modelValue":r[0]||(r[0]=_=>x(e).w=_),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),m(p,{modelValue:x(e).h,"onUpdate:modelValue":r[1]||(r[1]=_=>x(e).h=_),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),m(f,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:g(()=>[m(p,{modelValue:x(e).x,"onUpdate:modelValue":r[2]||(r[2]=_=>x(e).x=_),label:"X",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),m(p,{modelValue:x(e).y,"onUpdate:modelValue":r[3]||(r[3]=_=>x(e).y=_),label:"Y",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),x(i)?q("",!0):(h(),E(f,{key:0,label:"\u65CB\u8F6C\u89D2\u5EA6",flat:""},{default:g(()=>[m(p,{modelValue:x(e).rotate,"onUpdate:modelValue":r[4]||(r[4]=_=>x(e).rotate=_),min:0,max:360,step:1,inline:""},null,8,["modelValue"]),n("div",va,[m(u,null,{default:g(()=>[(h(!0),C(Y,null,te(x(Vt),_=>(h(),E(v,{key:_.value,size:"mini",title:_.label,onClick:b=>x(d).doRotate(_.value)},{default:g(()=>[n("i",{class:D(`b-iconfont b-icon-${_.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})])]),_:1})),x(i)||x(c)?q("",!0):(h(),E(f,{key:1,label:"\u900F\u660E\u5EA6"},{default:g(()=>[m(w,{modelValue:x(e).opacity,"onUpdate:modelValue":r[5]||(r[5]=_=>x(e).opacity=_),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})),x(i)?q("",!0):(h(),E(f,{key:2,label:"\u4F4D\u7F6E"},{default:g(()=>[m(u,null,{default:g(()=>[(h(!0),C(Y,null,te(x(Mt),_=>(h(),E(v,{key:_.value,size:"mini",title:_.label,onClick:b=>x(d).doAdsorption(_.value)},{default:g(()=>[n("i",{class:D(`iconfont-align b-icon-${_.value}-vs`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})),x(i)?(h(),E(f,{key:3,label:"\u5BF9\u9F50"},{default:g(()=>[m(u,null,{default:g(()=>[(h(!0),C(Y,null,te(x($t),_=>(h(),E(v,{key:_.value,size:"mini",title:_.label,onClick:b=>x(d).doAlign(_.value)},{default:g(()=>[n("i",{class:D(`iconfont-align b-icon-${_.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})):q("",!0),x(i)||x(c)?(h(),E(f,{key:4,label:"\u7EC4\u5408\u62C6\u5206"},{default:g(()=>[m(u,null,{default:g(()=>[m(v,{size:"mini",icon:"group",disabled:!x(i),onClick:r[6]||(r[6]=_=>x(d).group())},{default:g(()=>[fa]),_:1},8,["disabled"]),m(v,{size:"mini",icon:"ungroup",disabled:!x(c),onClick:r[7]||(r[7]=_=>x(d).ungroup())},{default:g(()=>[pa]),_:1},8,["disabled"])]),_:1})]),_:1})):q("",!0)])}}},ha={class:"setting-panel"},_a={class:"setting-panel-content"},ga={class:"scroll-container"},ba={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=N(),{selectedCom:e}=a(t);return(d,l)=>{const c=y("b-scrollbar");return h(),C("div",ha,[m(De,{"com-name":x(e).name,"com-alias":x(e).alias},null,8,["com-name","com-alias"]),n("div",_a,[n("div",ga,[m(c,null,{default:g(()=>[(h(),E(Ze,{key:`${x(e).id}'_basic-setting`,attr:x(e).attr},null,8,["attr"])),(h(),E(Xe(x(e).name+"Config"),{key:x(e).id,data:x(e)},null,8,["data"]))]),_:1})])])])}}},ya={class:"setting-panel"},xa=n("span",null,null,-1),Ca={class:"setting-panel-content"},wa={class:"scroll-container"},Sa={__name:"multi-setting",setup(o){const{schemaStore:t,storeToRefs:a}=N(),{areaData:e}=a(t),d=M(()=>e.value.showArea),l=M(()=>({x:e.value.x,y:e.value.y,w:e.value.width,h:e.value.height}));return(c,i)=>{const s=y("b-scrollbar");return h(),C("div",ya,[m(De,{"com-alias":"\u591A\u9009\u533A\u57DF"},{default:g(()=>[xa]),_:1}),n("div",Ca,[n("div",wa,[m(s,null,{default:g(()=>[m(Ze,{attr:x(l),readonly:x(d)},null,8,["attr","readonly"])]),_:1})])])])}}},ka={class:"config-panel"},Va={key:0,class:"page-config-panel"},Ma={class:"page-config-top"},$a={class:"tabs-wrapper"},Da={key:0,class:"page-config-content"},Ba={key:1,class:"page-config-content"},Ta={key:0,style:{height:"100%"}},La={key:1,style:{height:"100%"}},Ra={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=N(),{toolbar:e,selectedCom:d,multiSelect:l}=a(t),c=L(0),i=s=>{if(!(l.value&&s>0)){if(s===2){re.warning("\u6682\u672A\u5F00\u653E!");return}c.value!==s&&(c.value=s)}};return de(()=>d.value,()=>{c.value=0}),(s,r)=>{const p=y("b-icon"),f=y("b-tooltip");return h(),C("div",{class:D(["config-panel-wp",{"is-hide":!x(e).config}])},[n("div",ka,[x(d)||x(l)?(h(),C("div",Va,[n("div",Ma,[n("div",$a,[n("div",{class:D(["tab-item",{active:c.value===0}]),onClick:r[0]||(r[0]=v=>i(0))},[m(f,{content:"\u914D\u7F6E"},{default:g(()=>[m(p,{name:"control",size:"20"})]),_:1})],2),n("div",{class:D(["tab-item",{active:c.value===1}]),onClick:r[1]||(r[1]=v=>i(1))},[m(f,{content:"\u6570\u636E"},{default:g(()=>[m(p,{name:"cloud-server",size:"22"})]),_:1})],2),n("div",{class:D(["tab-item",{active:c.value===2}]),onClick:r[2]||(r[2]=v=>i(2))},[m(f,{content:"\u4E8B\u4EF6"},{default:g(()=>[m(p,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),x(l)?(h(),C("div",Da,[m(Sa)])):(h(),C("div",Ba,[c.value===0?(h(),C("div",Ta,[(h(),E(ba,{key:x(d).id}))])):q("",!0),c.value===1?(h(),C("div",La,[(h(),E(ua,{key:x(d).id}))])):q("",!0)]))])):(h(),E(Fn,{key:1}))])],2)}}},Ia={class:"toolbox-panel",flex:"main:justify"},Na={style:{width:"500px"},flex:""},za=n("i",{class:"action-btn b-iconfont b-icon-rollback"},null,-1),Ua=R(" \u64A4\u9500 "),Aa=n("i",{class:"action-btn b-iconfont b-icon-rollback",style:{transform:"rotateY(180deg)"}},null,-1),Ea=R(" \u91CD\u505A "),ja=n("div",null,null,-1),Oa={class:"btn-box"},Ha=R(" \u53C2\u8003\u7EBF\xA0\xA0 "),Ya={class:"btn-box"},Xa=R(" \u5BF9\u9F50\u7EBF\xA0\xA0 "),Wa={class:"ctrl-box"},Ka=R(" \xA0\xA0 "),Pa=R("\u6E05\u7A7A\u753B\u5E03"),Fa={__name:"index",setup(o){const{schemaStore:t,storeToRefs:a}=N(),{toolbar:e,toolbox:d}=a(t),l=()=>{Ke.confirm({type:"error",title:"\u786E\u8BA4\u6E05\u7A7A\u753B\u5E03\u5417\uFF1F\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"}).then(()=>{t.clearScreen()}).catch(()=>{})},c=()=>t.undo(),i=()=>t.redo();return(s,r)=>{const p=y("b-button"),f=y("b-switch");return h(),C("div",{class:D(["toolbox-panel-wp",{"is-hide":!x(e).toolbox}])},[n("div",Ia,[n("div",Na,[m(p,{size:"mini",onClick:c},{default:g(()=>[za,Ua]),_:1}),m(p,{size:"mini",onClick:i},{default:g(()=>[Aa,Ea]),_:1}),ja,n("div",Oa,[Ha,m(f,{modelValue:x(d).referLine,"onUpdate:modelValue":r[0]||(r[0]=v=>x(d).referLine=v),size:"small"},null,8,["modelValue"])]),n("div",Ya,[Xa,m(f,{modelValue:x(d).markLine,"onUpdate:modelValue":r[1]||(r[1]=v=>x(d).markLine=v),size:"small"},null,8,["modelValue"])])]),n("div",Wa,[Ka,m(p,{size:"mini",icon:"clear",onClick:l},{default:g(()=>[Pa]),_:1})])])],2)}}};const Ja={name:"shortcut",props:{modelValue:{type:Boolean}},emits:["update:modelValue"]},qa=o=>(pe("data-v-7e8e628e"),o=o(),he(),o),Ga=qa(()=>n("div",{class:"shortcut-wp"},[n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u57FA\u7840\u5FEB\u6377\u952E"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2190")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u914D\u7F6E\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u7EC4\u4EF6\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2191")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u5DE5\u5177\u680F"),n("div",{class:"shortcut-value"},"Ctrl + \u2193")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u590D\u5236\u9009\u4E2D\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Ctrl + C")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7C98\u8D34\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Ctrl + V")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u64A4\u9500\u64CD\u4F5C"),n("div",{class:"shortcut-value"},"Ctrl + Z")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4FDD\u5B58\u770B\u677F"),n("div",{class:"shortcut-value"},"Ctrl + S")])])]),n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u753B\u5E03\u64CD\u4F5C"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u6700\u4F73\u6BD4\u4F8B"),n("div",{class:"shortcut-value"},"Ctrl + A")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A1\uFF1A1"),n("div",{class:"shortcut-value"},"Ctrl + D")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u81EA\u7531\u7F29\u653E"),n("div",{class:"shortcut-value"},"Ctrl + \u9F20\u6807\u6EDA\u8F6E/\u6EDA\u52A8")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u753B\u5E03"),n("div",{class:"shortcut-value"},"Space + \u9F20\u6807\u5DE6\u952E/\u62D6\u52A8")])])]),n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u7EC4\u4EF6\u64CD\u4F5C"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u9876"),n("div",{class:"shortcut-value"},"Alt + Home")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u5E95"),n("div",{class:"shortcut-value"},"Alt + End")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4E0A\u79FB\u4E00\u5C42"),n("div",{class:"shortcut-value"},"Alt + \u2191")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4E0B\u79FB\u4E00\u5C42"),n("div",{class:"shortcut-value"},"Alt + \u2193")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF61\u50CF\u7D20"),n("div",{class:"shortcut-value"},"\u2191 \u2193 \u2190 \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF610\u50CF\u7D20"),n("div",{class:"shortcut-value"},"Shift + \u2191 \u2193 \u2190 \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u91CD\u547D\u540D"),n("div",{class:"shortcut-value"},"F2/\u53CC\u51FB\u56FE\u5C42")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5220\u9664\u9009\u4E2D\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Delete")])])])],-1));function Za(o,t,a,e,d,l){const c=y("b-modal");return h(),E(c,{title:"\u5FEB\u6377\u952E\u6307\u5357","model-value":a.modelValue,"append-to-body":"","custom-class":"schema-modal",onClose:t[0]||(t[0]=i=>o.$emit("update:modelValue",!1))},{default:g(()=>[Ga]),_:1},8,["model-value"])}var Qa=H(Ja,[["render",Za],["__scopeId","data-v-7e8e628e"]]);const el={name:"footer-panel",components:{Shortcut:Qa},setup(){const{schemaStore:o,storeToRefs:t}=N(),{pageConfig:a,canvas:e}=t(o),d=L([200,150,100,50]),l=L(20),c=L(20),i=L(!1),s=async r=>{r===-1?o.autoCanvasScale():o.setCanvasScale(r===0?l.value:r)};return de(()=>e.value.scale,r=>{const p=parseInt((r*100).toFixed(2));c.value=p,l.value=p}),{pageConfig:a,scaleList:d,inputScale:l,scale:c,submitScale:s,keycodeVisible:i}}},tl={class:"footer-panel"},ol={class:"screen-info",flex:"cross:center"},nl={class:"ml-8",style:{transform:"scale(0.9)"}},al={flex:"cross:center"},ll={class:"scale-input-wp"},sl=n("span",{class:"percent"},"%",-1),il=n("i",{class:"b-iconfont b-icon-down"},null,-1),cl=R("\u81EA\u9002\u5E94"),rl={class:"scale-slider-wp"};function dl(o,t,a,e,d,l){const c=y("b-icon"),i=y("b-tooltip"),s=y("b-dropdown-item"),r=y("b-dropdown-menu"),p=y("b-dropdown"),f=y("b-slider"),v=y("shortcut");return h(),C(Y,null,[n("div",tl,[n("div",ol,[m(i,{content:"\u5FEB\u6377\u952E\u63D0\u793A","open-delay":500},{default:g(()=>[m(c,{name:"read",size:"16",type:"button",onClick:t[0]||(t[0]=u=>e.keycodeVisible=!0)})]),_:1}),n("span",nl,Z(e.pageConfig.width)+" \u50CF\u7D20 * "+Z(e.pageConfig.height)+" \u50CF\u7D20",1)]),n("div",al,[m(p,{trigger:"click",onCommand:e.submitScale},{dropdown:g(()=>[m(r,null,{default:g(()=>[(h(!0),C(Y,null,te(e.scaleList,u=>(h(),E(s,{key:u,name:u},{default:g(()=>[R(Z(`${u}%`),1)]),_:2},1032,["name"]))),128)),m(s,{name:-1},{default:g(()=>[cl]),_:1})]),_:1})]),default:g(()=>[n("div",ll,[ue(n("input",{"onUpdate:modelValue":t[1]||(t[1]=u=>e.inputScale=u),type:"number",class:"scale-input",onKeydown:t[2]||(t[2]=je(u=>e.submitScale(0),["enter"]))},null,544),[[Se,e.inputScale]]),sl,il])]),_:1},8,["onCommand"]),n("div",rl,[m(f,{modelValue:e.scale,"onUpdate:modelValue":t[3]||(t[3]=u=>e.scale=u),min:10,max:200,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])]),m(v,{modelValue:e.keycodeVisible,"onUpdate:modelValue":t[4]||(t[4]=u=>e.keycodeVisible=u)},null,8,["modelValue"])],64)}var ul=H(el,[["render",dl]]);const ml={name:"context-menu",setup(){const{schemaStore:o,storeToRefs:t}=N(),{selectedCom:a}=t(o),{isLocked:e,isHided:d,contextMenu:l,contextMenuStyle:c}=$e(),i=S=>{a.value&&o.moveCom({id:a.value.id,moveType:S})},s=()=>i(ae.up),r=()=>i(ae.down),p=()=>i(ae.top),f=()=>i(ae.bottom),v=()=>{a.value&&(a.value.locked=!a.value.locked)},u=()=>{a.value&&(a.value.hided=!a.value.hided)},w=()=>{const S=a.value;S&&Ke.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{o.deleteCom(S.id)}).catch(()=>{})},_=()=>{const S=a.value;S&&o.renamingCom(S.id)},b=()=>{const S=a.value;S&&o.copyCom(S.id)},T=S=>S.preventDefault();return fe(()=>{P(document,"contextmenu",T)}),ye(()=>{F(document,"contextmenu",T)}),{contextMenu:l,contextMenuStyle:c,isLocked:e,isHided:d,moveUp:s,moveDown:r,moveTop:p,moveBottom:f,toDeleteCom:w,renameCom:_,toCopyCom:b,lockCom:v,hideCom:u}}},j=o=>(pe("data-v-68b5ef35"),o=o(),he(),o),vl=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),fl=R(" \u7F6E\u9876 "),pl=j(()=>n("span",{class:"key-code"},"Alt + Home",-1)),hl=[vl,fl,pl],_l=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),gl=R(" \u7F6E\u5E95 "),bl=j(()=>n("span",{class:"key-code"},"Alt + End",-1)),yl=[_l,gl,bl],xl=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),Cl=R(" \u4E0A\u79FB\u4E00\u5C42 "),wl=j(()=>n("span",{class:"key-code"},"Alt + \u2191",-1)),Sl=[xl,Cl,wl],kl=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),Vl=R(" \u4E0B\u79FB\u4E00\u5C42 "),Ml=j(()=>n("span",{class:"key-code"},"Alt + \u2193",-1)),$l=[kl,Vl,Ml],Dl=j(()=>n("div",{class:"context-menu-divider"},null,-1)),Bl=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),Tl=R(" \u89E3\u9501 "),Ll=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),Rl=R(" \u9501\u5B9A "),Il=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),Nl=R(" \u663E\u793A "),zl=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),Ul=R(" \u9690\u85CF "),Al=j(()=>n("div",{class:"context-menu-divider"},null,-1)),El=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),jl=R(" \u91CD\u547D\u540D "),Ol=j(()=>n("span",{class:"key-code"},"F2",-1)),Hl=[El,jl,Ol],Yl=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),Xl=R(" \u590D\u5236 "),Wl=j(()=>n("span",{class:"key-code"},"Ctrl + C,V",-1)),Kl=[Yl,Xl,Wl],Pl=j(()=>n("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),Fl=R(" \u5220\u9664 "),Jl=j(()=>n("span",{class:"key-code"},"Delete",-1)),ql=[Pl,Fl,Jl];function Gl(o,t,a,e,d,l){return h(),E(rt,{name:"zoom-in-top"},{default:g(()=>[e.contextMenu.show?(h(),C("div",{key:0,class:"context-menu-wrap",style:U(e.contextMenuStyle)},[n("div",{class:"context-menu-item",onClick:t[0]||(t[0]=(...c)=>e.moveTop&&e.moveTop(...c))},hl),n("div",{class:"context-menu-item",onClick:t[1]||(t[1]=(...c)=>e.moveBottom&&e.moveBottom(...c))},yl),n("div",{class:"context-menu-item",onClick:t[2]||(t[2]=(...c)=>e.moveUp&&e.moveUp(...c))},Sl),n("div",{class:"context-menu-item",onClick:t[3]||(t[3]=(...c)=>e.moveDown&&e.moveDown(...c))},$l),Dl,n("div",{class:"context-menu-item",onClick:t[4]||(t[4]=(...c)=>e.lockCom&&e.lockCom(...c))},[e.isLocked?(h(),C(Y,{key:0},[Bl,Tl],64)):(h(),C(Y,{key:1},[Ll,Rl],64))]),n("div",{class:"context-menu-item",onClick:t[5]||(t[5]=(...c)=>e.hideCom&&e.hideCom(...c))},[e.isHided?(h(),C(Y,{key:0},[Il,Nl],64)):(h(),C(Y,{key:1},[zl,Ul],64))]),Al,n("div",{class:"context-menu-item",onClick:t[6]||(t[6]=(...c)=>e.renameCom&&e.renameCom(...c))},Hl),n("div",{class:"context-menu-item",onClick:t[7]||(t[7]=(...c)=>e.toCopyCom&&e.toCopyCom(...c))},Kl),n("div",{class:"context-menu-item",onClick:t[8]||(t[8]=(...c)=>e.toDeleteCom&&e.toDeleteCom(...c))},ql)],4)):q("",!0)]),_:1})}var Zl=H(ml,[["render",Gl],["__scopeId","data-v-68b5ef35"]]);function Ql(){const o=Ce(),{schemaStore:t}=N(),a=L(!1),e=async l=>{try{a.value=!0;const c=await bt(l);if(c){const{id:i,name:s,pid:r,layout:p,components:f}=c,v={pageInfo:{id:i,name:s,pid:r},pageConfig:JSON.parse(p),comps:f.map(u=>JSON.parse(u.componentContent))};t.loadScreenData(v),await ge(),document.title=s}}catch(c){console.log(c)}a.value=!1},d=async()=>{try{a.value=!0;const l=await xt();if(l.tpl.length>0){const c=await kt(l.tpl);if(c){const i=JSON.parse(c.content),{comps:s,pageConfig:r}=i;t.loadScreenData({comps:s,pageConfig:r})}}else t.setScreenSize(l)}catch(l){console.log(l)}a.value=!1};return de(()=>o.path,async()=>{const{id:l}=o.query;l?await e(l):await d()},{immediate:!0}),{loading:a}}function es(){const o=L(null),t=L(null),{schemaStore:a,storeToRefs:e}=N(),{canvas:d,selectedCom:l}=e(a);let c=null;const i=f=>{const v=f.target;if(!["input","textarea"].includes(v.tagName.toLowerCase())){const u=f.key.toLowerCase();u==="delete"?(t.value&&t.value.toDeleteCom(),f.preventDefault()):u==="f2"&&(t.value&&t.value.renameCom(),f.preventDefault());const w=l.value;f.altKey&&(s("altKey"),u==="arrowup"?t.value&&t.value.moveUp():u==="arrowdown"?t.value&&t.value.moveDown():u==="home"?t.value&&t.value.moveTop():u==="end"&&t.value&&t.value.moveBottom(),f.preventDefault()),f.ctrlKey&&(s("ctrlKey"),u==="arrowup"?(a.toggleCompsPanel(),f.preventDefault()):u==="arrowdown"?(a.toggleToolbox(),f.preventDefault()):u==="arrowleft"?(a.toggleLayerPanel(),f.preventDefault()):u==="arrowright"?(a.toggleConfigPanel(),f.preventDefault()):u==="a"?(a.autoCanvasScale(),f.preventDefault()):u==="d"?(a.setCanvasScale(100),f.preventDefault()):u==="c"?(c=l.value,f.preventDefault()):u==="v"?(c&&a.copyCom(c.id),f.preventDefault()):u==="s"?(o.value&&o.value.handleSaveScreen(),f.preventDefault()):u==="z"&&(a.undo(),f.preventDefault())),f.shiftKey&&s("shiftKey"),f.keyCode===32&&(s("spaceKey"),f.preventDefault());const _=f.shiftKey?10:1;w&&!f.altKey&&(u==="arrowleft"?(w.attr.x-=_,f.preventDefault()):u==="arrowright"?(w.attr.x+=_,f.preventDefault()):u==="arrowup"?(w.attr.y-=_,f.preventDefault()):u==="arrowdown"&&(w.attr.y+=_,f.preventDefault()))}},s=f=>{a.toggleKey({key:f,status:!0})},r=()=>{a.resetKeyCode()},p=f=>{const v=parseInt((d.value.scale*100).toFixed(2)),u=(f.wheelDelta>0?1:-1)*5,w=Math.min(Math.max(v+u,20),200);a.setCanvasScale(w)};return fe(()=>{P(document,"keydown",i),P(document,"keyup",r)}),ye(()=>{F(document,"keydown",i),F(document,"keyup",r)}),{headerRef:o,contextMenuRef:t,ctrlMouseWheel:p}}const ts={name:"ScreenEditor",components:{ContextMenu:Zl,FooterPanel:ul,ToolboxPanel:Fa,CanvasMain:An,ConfigPanel:Ra,ComponentsPanel:en,LayerPanel:po,HeaderBar:Zt},setup(){return{...Ql(),...es()}}},os={key:0,flex:"main:center cross:center",class:"full-wrapper"},ns={key:1,class:"editor-main-wrapper"},as={class:"edit-main-wp"};function ls(o,t,a,e,d,l){const c=y("header-bar"),i=y("svg-loading"),s=y("components-panel"),r=y("layer-panel"),p=y("toolbox-panel"),f=y("canvas-main"),v=y("footer-panel"),u=y("config-panel"),w=y("context-menu");return h(),C("div",{class:"schema-screen-container",onWheel:t[0]||(t[0]=ee((..._)=>o.ctrlMouseWheel&&o.ctrlMouseWheel(..._),["ctrl","prevent"]))},[m(c,{ref:"headerRef","back-url":"/dashboard"},null,512),o.loading?(h(),C("div",os,[m(i,{name:"loading02"})])):(h(),C("div",ns,[m(s),m(r),n("div",as,[m(p),m(f),m(v)]),m(u)])),m(w,{ref:"contextMenuRef"},null,512)],32)}var fs=H(ts,[["render",ls]]);export{fs as default};
