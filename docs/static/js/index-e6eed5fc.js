import{N as C,u as $,l as I,C as N,O as u}from"./index-f0c9e2c9.js";import{aw as O,aL as z,a5 as B,l as E,a as p,g as R,v as q,b as m,c as D,F as G,O as L,h as f,o as i,e as P,M as F,G as J}from"./vendor-b7d265ee.js";import{l as T}from"./database.api-1a283e75.js";import"./chunk-bin-ui-next-925ea2c7.js";import"./chunk-brace-b4ee70be.js";const V={name:"Screen",components:{GLoading:C},setup(){const c=z(),l=B(),{schemaStore:d,storeToRefs:s}=$(),{pageConfig:a,comps:v}=s(d),r=E(!0),e=()=>{const o=document.querySelector("#app");if(!o)return;const n=a.value.width,t=document.documentElement.clientWidth/n;u(o,{transform:`scale(${t})`,transformOrigin:"left top",backgroundSize:"100%",backgroundRepeat:"no-repeat"})},h=async()=>{const o=l.params.screenId,n=l.name;if(!o){await c.push("/notfound");return}try{r.value=!0;let t={};if(n==="Preview")t=await T();else{const g=await I(o);if(g){const{id:w,name:y,pid:S,layout:b,components:x}=g;t={pageInfo:{id:w,name:y,pid:S},pageConfig:JSON.parse(b),comps:x.map(k=>JSON.parse(k.componentContent))}}}t&&(d.loadScreenData(t),_(t),setTimeout(()=>{r.value=!1},500),N(window,"resize",e))}catch{await c.push("/notfound")}},_=o=>{const n=document.querySelector("#app");if(!n)return;const{pageInfo:t}=o;document.title=t.name,document.querySelector('meta[name="viewport"]').setAttribute("content",`width=${a.value.width}`),u(document.documentElement,{overflowX:"hidden",overflowY:"visible"}),u(n,{width:`${a.value.width}px`,height:`${a.value.height}px`,backgroundImage:`url(${a.value.bgImage})`,backgroundColor:a.value.bgColor}),e()};return h(),{loading:r,comps:v}}},A={class:"screen-wrapper"},K={class:"dv-loading"},M={class:"scene"};function W(c,l,d,s,a,v){const r=J("g-loading");return i(),p("div",A,[R(m("div",K,[D(r,{spinning:""})],512),[[q,s.loading]]),m("div",{class:"dv-layout",style:f({visibility:s.loading?"hidden":"visible"})},[m("div",M,[(i(!0),p(G,null,L(s.comps,e=>(i(),p("div",{class:"dv-com absolute",key:e.id,style:f({left:e.attr.x+"px",top:e.attr.y+"px",width:e.attr.w+"px",height:e.attr.h+"px",opacity:e.attr.opacity,transform:`rotate(${e.attr.rotate}deg)`,pointerEvents:e.name==="Group"?"none":null})},[(i(),P(F(e.name),{data:e},null,8,["data"]))],4))),128))])],4)])}var U=O(V,[["render",W]]);export{U as default};
