var st=Object.defineProperty,it=Object.defineProperties;var ct=Object.getOwnPropertyDescriptors;var ke=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var Me=(n,t,o)=>t in n?st(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,W=(n,t)=>{for(var o in t||(t={}))rt.call(t,o)&&Me(n,o,t[o]);if(ke)for(var o of ke(t))dt.call(t,o)&&Me(n,o,t[o]);return n},Ve=(n,t)=>it(n,ct(t));import{S as mt}from"./index-afa28915.js";import{a4 as D,a5 as $e,g as S,o as _,A as g,D as k,f as L,n as pe,J as p,c as O,w as y,B as a,u as m,x as ge,q as I,a6 as Be,a7 as De,d as Q,X as be,F as U,y as ut,L as ft,E as $,K as Y,H as Ie,t as F,a as le,_ as ht,j as ee,Q as Te,a8 as se,a9 as ie,aL as vt,k as ye,z as xe,r as Le,I as ce,W as _t,O as ze,T as pt}from"./vendor-0fc4fabe.js";import{a as re,M as gt}from"./chunk-bin-ui-next-51eb6328.js";import{u as N}from"./useSchemaStore-a5915d07.js";import{p as Ne,q as bt,s as Z,v as G,M as X,w as R,x as te,C as ue,y as Ue,z as Re,A as yt,d as xt,c as Ct,B as Ee,D as wt,i as St,F as kt,G as Mt,I as Vt,K as $t,L as Bt}from"./index-a4e94847.js";import{b as Dt}from"./config-d3ec1598.js";import{m as It,b as Tt}from"./config-088dfe98.js";import{a as je,l as Lt}from"./database.api-9713b641.js";import"./chunk-brace-7fd40d4c.js";import"./colors-f71480cd.js";const zt={name:"HeadLoading",setup(){const n=$e();return{loading:S(()=>n.state.schema.toolbar.loading)}}};function Nt(n,t,o,e,i,l){return _(),g("div",{class:k(["loading-indicator",{loading:e.loading}])},null,2)}var Ut=D(zt,[["render",Nt],["__scopeId","data-v-5de99d01"]]);const Rt={name:"publish-screen",props:{projectId:{type:String,required:!0},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(n,t){const o=L(!1),{saveScreenData:e}=N(),i=S(()=>`${window.location.origin}/#/screen/${n.projectId}`),l=()=>{o.value=!1,t.emit("update:modelValue",!1)},c=()=>{ge(()=>{Ne(i.value)&&re.success("\u590D\u5236\u6210\u529F")})},s=async()=>{await e(),re.success("\u53D1\u5E03\u6210\u529F\uFF01")};return pe(()=>n.modelValue,r=>{o.value=r}),{visible:o,shareUrl:i,closeDialog:l,copyUrl:c,handlePublishDown:s}}},Et={style:{"padding-bottom":"24px"}},jt=a("div",{style:{color:"#fff","font-size":"14px","padding-bottom":"12px"}},"\u53D1\u5E03\u94FE\u63A5",-1),At={flex:""},Ht=I("\u590D\u5236"),Ot={class:"t-center"},Pt=I("\u53D1\u5E03\u5927\u5C4F");function Wt(n,t,o,e,i,l){const c=p("g-input"),s=p("b-button"),r=p("b-modal");return _(),O(r,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=d=>e.visible=d),"append-to-body":"",title:"\u53D1\u5E03",top:"200px","custom-class":"publish-modal",onClose:e.closeDialog},{default:y(()=>[a("div",Et,[jt,a("div",At,[m(c,{modelValue:e.shareUrl,"onUpdate:modelValue":t[0]||(t[0]=d=>e.shareUrl=d),readonly:"",type:"textarea",autosize:{minRows:3},style:{width:"80%","line-height":"22px",background:"#1d262e",cursor:"pointer","margin-right":"16px"}},null,8,["modelValue"]),m(s,{type:"text",onClick:e.copyUrl},{default:y(()=>[Ht]),_:1},8,["onClick"])])]),a("div",Ot,[m(s,{type:"primary",onClick:e.handlePublishDown,style:{width:"200px"}},{default:y(()=>[Pt]),_:1},8,["onClick"])])]),_:1},8,["modelValue","onClose"])}var Ft=D(Rt,[["render",Wt]]);const Yt={name:"header-bar",components:{PublishScreen:Ft,HeadLoading:Ut},props:{backUrl:{type:String},backTarget:{type:String,default:"_blank",validator:n=>["_self","_blank"].includes(n)},pageStatus:{type:Object,default:()=>({})}},setup(n){const t=Be(),o=De(),e=N(),i=L(!1),l=L(""),c=()=>{const u=n.backUrl||"/";if(n.backTarget==="_blank"){const h=t.resolve(u);window.open(h.href,n.backTarget)}else t.push(u)},s=async()=>{const{data:u}=await e.saveScreenData();await Ne(JSON.stringify(u)),bt.primary("\u5DF2\u62F7\u8D1D\u914D\u7F6E\u81F3\u526A\u5207\u677F\uFF01")},r=async()=>{const u=e.pageInfo.value.id,{data:h}=await e.saveScreenData();if(!u){let C=t.resolve({path:"/schema/screen",query:{id:h.pageInfo.id}});window.location.replace(C.href)}re.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0})},d=async()=>{const{data:u}=await e.saveScreenData();let h=t.resolve({path:`/screen/preview/${u.pageInfo.id}`,query:{}});window.open(h.href,"_blank")},f=()=>{i.value=!0,l.value=o.query.id};return Ve(W({},e),{publishVisible:i,publishAppId:l,copyCfg:s,handleBack:c,handleSave:r,handPreview:d,handlePublish:f})}},Xt={class:"header-container"},qt={class:"left-actions"},Kt={class:"screen-info"},Zt=a("span",null,"\u5DE5\u4F5C\u7A7A\u95F4",-1),Gt=a("span",{style:{padding:"0 6px 0 12px"}},"-",-1),Jt={class:"global-actions"};function Qt(n,t,o,e,i,l){const c=p("b-icon"),s=p("b-tooltip"),r=p("b-space"),d=p("head-loading"),f=p("publish-screen");return _(),g(U,null,[a("div",Xt,[a("div",qt,[m(r,{size:"mini"},{default:y(()=>[m(s,{content:"\u56FE\u5C42","open-delay":500},{default:y(()=>[a("div",{class:k(["head-btn",{active:n.toolbar.layer}]),onClick:t[0]||(t[0]=u=>n.toggleLayerPanel())},[m(c,{name:"container"})],2)]),_:1}),m(s,{content:"\u7EC4\u4EF6\u5217\u8868","open-delay":500},{default:y(()=>[a("div",{class:k(["head-btn",{active:n.toolbar.components}]),onClick:t[1]||(t[1]=u=>n.toggleCompsPanel())},[m(c,{name:"hourglass",class:k(["com-list-icon",{"is-rotate":!n.toolbar.components}])},null,8,["class"])],2)]),_:1}),m(s,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:y(()=>[a("div",{class:k(["head-btn",{active:n.toolbar.config}]),onClick:t[2]||(t[2]=u=>n.toggleConfigPanel())},[m(c,{name:"control"})],2)]),_:1}),m(s,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:y(()=>[a("div",{class:k(["head-btn",{active:n.toolbar.toolbox}]),onClick:t[3]||(t[3]=u=>n.toggleToolbox())},[m(c,{name:"shopping"})],2)]),_:1})]),_:1})]),a("div",Kt,[m(s,{content:"\u8FD4\u56DE","open-delay":500},{default:y(()=>[m(c,{name:"laptop",type:"button",onClick:e.handleBack},null,8,["onClick"])]),_:1}),Zt,Gt,Q(a("input",{class:"header-input",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",maxlength:"50",type:"text","onUpdate:modelValue":t[4]||(t[4]=u=>n.pageInfo.name=u)},null,512),[[be,n.pageInfo.name]])]),a("div",Jt,[m(r,{size:"mini"},{default:y(()=>[m(s,{content:"\u4FDD\u5B58\u5FEB\u7167","open-delay":500},{default:y(()=>[a("div",{class:"head-btn",onClick:t[5]||(t[5]=(...u)=>e.copyCfg&&e.copyCfg(...u))},[m(c,{name:"codelibrary"})])]),_:1}),m(s,{content:"\u4FDD\u5B58","open-delay":500},{default:y(()=>[a("div",{class:"head-btn",onClick:t[6]||(t[6]=(...u)=>e.handleSave&&e.handleSave(...u))},[m(c,{name:"save"})])]),_:1}),m(s,{content:"\u53D1\u5E03","open-delay":500},{default:y(()=>[a("div",{class:"head-btn",onClick:t[7]||(t[7]=(...u)=>e.handlePublish&&e.handlePublish(...u))},[m(c,{name:"send"})])]),_:1}),m(s,{content:"\u9884\u89C8","open-delay":500},{default:y(()=>[a("div",{class:"head-btn",onClick:t[8]||(t[8]=(...u)=>e.handPreview&&e.handPreview(...u))},[m(c,{name:"eye"})])]),_:1})]),_:1})])]),m(d),m(f,{modelValue:e.publishVisible,"onUpdate:modelValue":t[9]||(t[9]=u=>e.publishVisible=u),"project-id":e.publishAppId},null,8,["modelValue","project-id"])],64)}var en=D(Yt,[["render",Qt]]);const de=ut({x:0,y:0});function Ce(n={}){const t=$e(),o=S(()=>t.state.schema),e=S(()=>o.value.contextMenuInfo),i=S(()=>o.value.selectedCom),l=S(()=>{var h;return(h=i.value)==null?void 0:h.locked}),c=S(()=>{var h;return(h=i.value)==null?void 0:h.hided}),s=S(()=>o.value.renamingId),r=S(()=>({display:e.value.show?"block":"none",left:`${de.x+10}px`,top:`${de.y+10}px`,transform:document.documentElement.clientHeight-de.y<250?"translate(0px, -100%)":""})),d=h=>{h.preventDefault(),i.value&&(de.x=h.clientX,de.y=h.clientY,e.value.show=!0,Z(document,"click",f))},f=()=>{G(document,"click",f),n&&n.beforeClose&&n.beforeClose(),e.value.show=!1};return{contextMenu:e,showMenu:d,renamingId:s,renamingCom:h=>{t.dispatch("schema/renamingCom",h)},selectedCom:i,isLocked:l,isHided:c,contextMenuStyle:r}}const tn={name:"layer-panel",setup(){const{toolbar:n,toggleLayerPanel:t,comps:o,selectedCom:e,hoveredCom:i,onCompHovered:l,onCompSelected:c,onCompMoved:s}=N(),{showMenu:r,renamingId:d,renamingCom:f}=Ce(),u=S(()=>!!e.value),h=S(()=>({opacity:e.value?1:.3})),C=S(()=>{var M;return{enable:!!e.value,checked:(M=e.value)==null?void 0:M.locked}}),v=S(()=>{var M;return{enable:!!e.value,checked:(M=e.value)==null?void 0:M.hided}}),w=S(()=>[...o.value].reverse()),x=M=>{e.value&&s(e.value.id,M)};return{comps:o,toolbar:n,toggleLayerPanel:t,enableBtnClass:u,enableBtnStyle:h,moveUp:()=>x(X.up),moveDown:()=>x(X.down),moveTop:()=>x(X.top),moveBottom:()=>x(X.bottom),descComs:w,enableLockBtnClass:C,enableHideBtnClass:v,onEnter:M=>{l(M)},onLeave:()=>{l("")},selectCom:M=>{const H=o.value.find(P=>P.id===M);H&&c(H)},hoveredCom:i,selectedCom:e,showMenu:r,cancelSelectCom:()=>{c()},renamingId:d,renamingCom:f}}},nn={class:"layer-panel"},on={class:"layer-top"},an=a("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),ln=a("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),sn=[ln],cn={class:"layer-toolbar layer-toolbar-top"},rn={class:"layer-manager-wrap"},dn=["title","onMousedown","onMouseenter"],mn=["onUpdate:modelValue"],un={key:1,class:"layer-item-span"},fn={class:"layer-item-text"},hn=["onClick"],vn=["onClick"];function _n(n,t,o,e,i,l){const c=p("b-icon"),s=ft("focus");return _(),g("div",{class:k(["layer-panel-wp",{"is-hide":!e.toolbar.layer}])},[a("div",nn,[a("div",on,[an,a("div",{class:"layer-action",onClick:t[0]||(t[0]=r=>e.toggleLayerPanel(!1))},sn)]),a("div",cn,[a("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:k(["b-iconfont b-icon-arrowup toolbar-icon standard",e.enableBtnClass]),style:$(e.enableBtnStyle),onClick:t[1]||(t[1]=(...r)=>e.moveUp&&e.moveUp(...r))},null,6),a("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:k(["b-iconfont b-icon-arrowdown toolbar-icon standard",e.enableBtnClass]),style:$(e.enableBtnStyle),onClick:t[2]||(t[2]=(...r)=>e.moveDown&&e.moveDown(...r))},null,6),a("i",{title:"\u7F6E\u9876",class:k(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:$(W({transform:"rotate(180deg)"},e.enableBtnStyle)),onClick:t[3]||(t[3]=(...r)=>e.moveTop&&e.moveTop(...r))},null,6),a("i",{title:"\u7F6E\u5E95",class:k(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:$(e.enableBtnStyle),onClick:t[4]||(t[4]=(...r)=>e.moveBottom&&e.moveBottom(...r))},null,6)]),a("div",rn,[(_(!0),g(U,null,Y(e.descComs,r=>(_(),g("div",{key:r.id,title:r.alias,class:k(["layer-manager-item",[{hided:r.hided,locked:r.locked,hovered:r.id===e.hoveredCom,selected:e.selectedCom&&r.id===e.selectedCom.id}]]),onMousedown:d=>e.selectCom(r.id),onMouseenter:d=>e.onEnter(r.id),onMouseleave:t[7]||(t[7]=(...d)=>e.onLeave&&e.onLeave(...d)),onContextmenu:t[8]||(t[8]=d=>e.showMenu(d))},[m(c,{name:r.icon},null,8,["name"]),r.id===e.renamingId?Q((_(),g("input",{key:0,"onUpdate:modelValue":d=>r.alias=d,class:"layer-item-input",onBlur:t[5]||(t[5]=d=>e.renamingCom("")),onKeydown:t[6]||(t[6]=Ie(d=>e.renamingCom(""),["enter"]))},null,40,mn)),[[be,r.alias,void 0,{trim:!0}],[s]]):(_(),g("span",un,[a("span",fn,F(r.alias),1)])),r.hided?(_(),g("i",{key:2,class:"b-iconfont b-icon-eye show-toggle-btn",onClick:d=>r.hided=!1},null,8,hn)):le("",!0),r.locked?(_(),g("i",{key:3,class:"b-iconfont b-icon-lock show-toggle-btn",onClick:d=>r.locked=!1},null,8,vn)):le("",!0)],42,dn))),128)),a("div",{class:"last-flex-item",onClick:t[9]||(t[9]=(...r)=>e.cancelSelectCom&&e.cancelSelectCom(...r))})])])],2)}var pn=D(tn,[["render",_n]]);const Ae={name:"VBasicBar",alias:"\u57FA\u672C\u67F1\u56FE",img:R("basic-bar.png"),type:"bar",used:!0},He={name:"VHorizontalBar",alias:"\u57FA\u672C\u6761\u5F62\u56FE",img:R("hori-basic-bar.png"),type:"bar",used:!1},Oe={name:"VBasicLine",alias:"\u57FA\u672C\u6298\u7EBF\u56FE",img:R("basic-line.png"),type:"line",used:!1},Pe={name:"VBasicArea",alias:"\u57FA\u672C\u533A\u57DF\u56FE",img:R("basic-area.png"),type:"line",used:!1},We={name:"VBasicPie",alias:"\u57FA\u672C\u997C\u56FE",img:R("basic-pie.png"),type:"pie",used:!1},gn={name:"VBasicMap",alias:"\u57FA\u672C\u5730\u56FE",img:R("2d-china.png"),type:"map",used:!1},Fe={name:"VMainTitle",alias:"\u901A\u7528\u6807\u9898",img:R("main-title.png"),type:"info",used:!0},bn={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:R("number-title-flop.png"),type:"info",used:!0},yn={name:"VBgBox",alias:"\u80CC\u666F\u5757",img:R("bg-box.png"),type:"media",used:!0},xn={name:"VBorderBox",alias:"\u8FB9\u6846",img:R("border-box.png"),type:"media",used:!0},Cn={name:"VDecoration",alias:"\u88C5\u9970\u5668",img:R("decoration.png"),type:"media",used:!0},wn={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:R("img.png"),type:"media",used:!0},Sn={name:"VCrossTable",alias:"\u4EA4\u53C9\u8868",img:R("carousel-table.png"),type:"table",used:!1},fe=[{type:"normal",name:"\u5E38\u7528",icon:"star",data:[Ae,He,Oe,Pe,We,Fe]},{type:"bar",name:"\u67F1\u56FE",icon:"barchart",data:[Ae,He]},{type:"line",name:"\u7EBF\u56FE",icon:"linechart",data:[Oe,Pe]},{type:"pie",name:"\u997C\u56FE",icon:"piechart",data:[We]},{type:"map",name:"\u5730\u56FE",icon:"location",data:[gn]},{type:"info",name:"\u4FE1\u606F",icon:"info-circle",data:[Fe,bn]},{type:"media",name:"\u5A92\u4F53",icon:"Youtube",data:[yn,xn,Cn,wn]},{type:"table",name:"\u8868\u683C",icon:"table",data:[Sn]}];function kn(n){for(let t=0;t<fe.length;t++){const o=fe[t];for(let e=0;e<o.data.length;e++){const i=o.data[e];if(i.name===n)return{classification:o,com:i}}}return null}const Mn=[te("title",{description:"\u6807\u9898\u503C",optional:!0}),te("url",{description:"\u8D85\u94FE\u63A5url",optional:!0})],Vn={alias:"\u901A\u7528\u6807\u9898",icon:"file-word",type:ue.com,attr:{w:300,h:48},config:{title:"\u6211\u662F\u6807\u9898\u6570\u636E",textStyle:{fontFamily:"Microsoft Yahei",fontSize:24,color:"#fff",fontWeight:"normal"},textAlign:"center",writingMode:"horizontal-tb",backgroundStyle:{show:!1,bgColor:"#008bff",borderRadius:15,borderColor:"#fff",borderStyle:"solid",borderWidth:1},ellipsis:!1,urlConfig:{url:"",isBlank:!1}},apis:Ue({fields:Object.assign({},...Mn)}),apiData:Re({staticPath:"text/main-title"}),events:{},actions:{}},$n=[te("title",{description:"\u6807\u9898",optional:!0}),te("value",{description:"\u7FFB\u724C\u5668\u6570\u503C"}),te("prefix",{description:"\u7FFB\u724C\u5668\u524D\u7F00",optional:!0}),te("suffix",{description:"\u7FFB\u724C\u5668\u540E\u7F00",optional:!0})],Bn={alias:"\u6570\u5B57\u6307\u6807",icon:"orderedlist",type:ue.com,attr:{w:300,h:74},config:{global:{fontFamily:"Microsoft Yahei",arrangement:"top",distance:0},title:{content:"\u6570\u5B57\u6307\u6807\u6807\u9898",textStyle:{fontSize:18,color:"#79daff",fontWeight:"normal",textAlign:"flex-start"}},counter:{textStyle:{fontFamily:"Microsoft Yahei",fontSize:36,color:"#0a73ff",fontWeight:"bold",textAlign:"left"},value:1234567,duration:1e3,autoplay:!0,decimals:2,decimal:".",separator:",",prefix:"\uFFE5",suffix:""}},apis:Ue({fields:Object.assign({},...$n)}),apiData:Re({staticPath:"text/number-title-flop"}),events:{},actions:{}},Dn={alias:"\u88C5\u9970\u5668",icon:"pushpin",type:ue.com,attr:{w:200,h:200},config:{img:"decoration10"},apis:{},apiData:{},events:{},actions:{}},In={alias:"\u8FB9\u6846",icon:"gateway",type:ue.com,attr:{w:300,h:180},config:{img:"box1"},apis:{},apiData:{},events:{},actions:{}},Tn={id:"",name:"",alias:"",type:"",locked:!1,hided:!1,attr:{x:0,y:0,w:100,h:100,rotate:0,opacity:1},apiData:{},apis:{},events:{}};function ne(n,t){const o=yt(xt(Tn),t||{});return o.id=`${n}_${Ct()}`,o.name=`V${n}`,o.apiData.source&&(o.apiData.source.comId=o.id),o}function Ye(n){switch(n.substr(1)){case"BasicBar":return ne("BasicBar",Dt);case"MainTitle":return ne("MainTitle",Vn);case"NumberTitleFlop":return ne("NumberTitleFlop",Bn);case"BorderBox":return ne("BorderBox",In);case"Decoration":return ne("Decoration",Dn);case"MainImg":return ne("MainImg",It);default:throw Error(`Unknown component type: ${n}.`)}}const Ln={name:"components-panel",setup(){const{toggleCompsPanel:n,pageConfig:t,toolbar:o,addCom:e,onCompSelected:i,selectedCom:l}=N(),c=L(0),s=S(()=>fe[c.value].data);return{toolbar:o,toggleCompsPanel:n,activeIndex:c,componentsList:fe,comps:s,changeComp:h=>{n(!0),c.value=h},dragStart:(h,C)=>{h.dataTransfer.setData("text",C)},toAddCom:async(h,C)=>{if(C){const v=Ye(h);if(v.attr.x=Math.floor((t.value.width-v.attr.w)/2),v.attr.y=Math.floor((t.value.height-v.attr.h)/2),await e({component:v}),await i(v),v.apiData.source&&v.apiData.source.type===Ee.static&&v.apiData.source.staticPath){const{data:w}=await je(v.id,v.apiData.source.staticPath);l.value.apiData.source.config.data=JSON.stringify(w)}}else console.log("\u6B63\u5728\u5F00\u53D1\u4E2D\u3002\u3002\u3002")},dragOver:h=>{h.preventDefault(),h.stopPropagation(),h.dataTransfer.dropEffect="none"}}}},zn={class:"components-panel"},Nn={class:"panel-title"},Un={class:"components-type"},Rn=["onClick"],En={class:"com-tab-title"},jn={class:"components-list p10"},An=["title","draggable","onDragstart","onClick"],Hn={class:"comp-item-text"};function On(n,t,o,e,i,l){const c=p("b-icon"),s=p("b-scrollbar");return _(),g("div",{class:k(["components-panel-wp",{"is-hide":!e.toolbar.components}])},[a("div",zn,[a("div",Nn,[a("span",{class:"panel-text",onClick:t[0]||(t[0]=r=>e.toggleCompsPanel(!0))},F(e.toolbar.components?"\u5168\u90E8\u7EC4\u4EF6":"\u7EC4\u4EF6"),1),a("i",{class:"b-iconfont b-icon-left comps-action",title:"\u6536\u8D77",onClick:t[1]||(t[1]=r=>e.toggleCompsPanel(!1))})]),a("div",{class:"components-panel-content",onDragover:t[2]||(t[2]=(...r)=>e.dragOver&&e.dragOver(...r))},[a("div",Un,[m(s,null,{default:y(()=>[(_(!0),g(U,null,Y(e.componentsList,(r,d)=>(_(),g("div",{class:k(["components-item",{active:e.activeIndex===d}]),key:d,onClick:f=>e.changeComp(d)},[m(c,{class:"com-tab-icon",name:r.icon,size:"16"},null,8,["name"]),a("span",En,F(r.name),1)],10,Rn))),128))]),_:1})]),a("div",jn,[(_(!0),g(U,null,Y(e.comps,(r,d)=>(_(),g("div",{class:"comp-item",key:d,title:r.alias,draggable:r.used,onDragstart:f=>e.dragStart(f,r.name),onClick:f=>e.toAddCom(r.name,r.used)},[a("div",Hn,F(r.alias),1),a("div",{class:"comp-item-img",style:$(`background-image: url(${r.img});`)},null,4)],40,An))),128))])],32)])],2)}var Pn=D(Ln,[["render",On]]);const Xe=n=>`${n}px`,qe=(n,t,o,e)=>{const i=n!=null?n:document.createElement("canvas");i.width=t*e,i.height=o*e,i.style.width=Xe(t),i.style.height=Xe(o);const l=i.getContext("2d");return l&&l.setTransform(e,0,0,e,0,0),i};class Ke{constructor(t,o){this.el=t,this.options=W({direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2},o),this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:o}=this,{direction:e,width:i,height:l,ratio:c}=o,s=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,i),r=l;this.ruler.width=s,this.ruler.height=r;const d=qe(null,s,r,c);wt(d,"canvas-ruler"),t.appendChild(d),this.canvas=d,this.ctx=d.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:o,ruler:e}=this,{width:i,height:l}=e;t.beginPath(),t.fillStyle=o.bgColor,t.fillRect(0,0,i,l),t.closePath(),t.beginPath(),t.font=`${o.fontSize} ${o.fontFamily}`,t.textAlign="left",t.fillStyle=o.fontColor,t.strokeStyle=o.strokeStyle,t.lineWidth=o.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:o,ruler:e}=this,{width:i,height:l}=e,{offset:c,scale:s}=o,r=0,d=l/1.5,f=l/1.2;for(let u=0;u<=i;u+=1){const h=u-c;if(h<0)continue;let C=-1,v=-1;h%50==0?(C=Math.floor(h/s),v=r):h%25==0?v=d:h%5==0&&(v=f),v>=0&&(t.moveTo(u+.5,l+.5),t.lineTo(u+.5,v),C>-1&&t.fillText(`${C}`,u+2.5,l/1.5))}}setSize(t,o,e){const{el:i,options:l}=this;l.width=t,l.height=o,l.scale=e;const{direction:c,width:s,height:r,ratio:d}=l,f=Math.max(c==="TB"?i.offsetWidth:i.offsetHeight,s),u=r;this.ruler.width=f,this.ruler.height=u,qe(this.canvas,f,u,d),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const Wn={name:"ruler",setup(){const{canvas:n}=N(),t=L(null),o=L(null),e=L(null),i=L(null),l=L(!0),c=L(0),s=L(0),r=document.documentElement.clientWidth;ht(()=>{if(t.value&&o.value){const f=Math.max(n.value.width,r);e.value?e.value.setSize(f,20,n.value.scale):e.value=new Ke(t.value,{direction:"TB",width:f,scale:n.value.scale}),i.value?i.value.setSize(n.value.height,20,n.value.scale):i.value=new Ke(o.value,{direction:"LR",width:n.value.height,scale:n.value.scale})}});const d=f=>{const u=f.target;c.value=u.scrollLeft,s.value=u.scrollTop};return ee(()=>{const f=document.getElementById("canvas-wp");f==null||f.addEventListener("scroll",d)}),Te(()=>{const f=document.getElementById("canvas-wp");f==null||f.removeEventListener("scroll",d)}),{visible:l,hRulerWpRef:t,vRulerWpRef:o,vScroll:s,hScroll:c}}},Fn=n=>(se("data-v-d5375d52"),n=n(),ie(),n),Yn={class:"canvas-ruler-wp"},Xn=Fn(()=>a("div",{class:"ruler-corner"},null,-1));function qn(n,t,o,e,i,l){return _(),g("div",Yn,[a("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:$(`transform: translateX(-${e.hScroll}px);`)},null,4),a("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:$(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),Xn])}var Kn=D(Wn,[["render",qn],["__scopeId","data-v-d5375d52"]]);const oe=vt();function Ze(n){return n*Math.PI/180}function Ge(n){return Math.abs(Math.sin(Ze(n)))}function Je(n){return Math.abs(Math.cos(Ze(n)))}function Qe(n){if(n=W({},n),n.rotate!==0){const t=n.width*Je(n.rotate)+n.height*Ge(n.rotate),o=(n.width-t)/2;n.left+=o,n.right=n.left+t;const e=n.height*Je(n.rotate)+n.width*Ge(n.rotate),i=(e-n.height)/2;n.top-=i,n.bottom=n.top+e,n.width=t,n.height=e}else n.bottom=n.top+n.height,n.right=n.left+n.width;return n}const Zn=5,Gn={name:"mark-line",setup(){const{comps:n,selectedCom:t,canvas:o,setSingleComAttr:e,toolbox:i}=N(),l=L([]),c=L(["xt","xc","xb","yl","yc","yr"]),s=L({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),r=()=>{Object.keys(s.value).forEach(v=>{s.value[v]=!1})},d=(v,w)=>{const x=l.value,V=t.value,B=n.value.filter(K=>!K.hided),T=o.value.scale,b=Qe(h(V.attr)),A=b.width/2,q=b.height/2;r(),B.forEach(K=>{if(K.id===V.id)return;const{top:j,left:M,bottom:H,right:P,width:we,height:z}=Qe(h(K.attr)),ae=we/2,ve=z/2,Se={top:[{isNearly:C(b.top,j),lineNode:x.xt,line:"xt",dragShift:j,lineShift:j*T+60},{isNearly:C(b.bottom,j),lineNode:x.xt,line:"xt",dragShift:j-b.height,lineShift:j*T+60},{isNearly:C(b.top+q,j+ve),lineNode:x.xc,line:"xc",dragShift:j+ve-q,lineShift:(j+ve)*T+60},{isNearly:C(b.top,H),lineNode:x.xb,line:"xb",dragShift:H,lineShift:H*T+60},{isNearly:C(b.bottom,H),lineNode:x.xb,line:"xb",dragShift:H-b.height,lineShift:H*T+60}],left:[{isNearly:C(b.left,M),lineNode:x.yl,line:"yl",dragShift:M,lineShift:M*T+60},{isNearly:C(b.right,M),lineNode:x.yl,line:"yl",dragShift:M-b.width,lineShift:M*T+60},{isNearly:C(b.left+A,M+ae),lineNode:x.yc,line:"yc",dragShift:M+ae-A,lineShift:(M+ae)*T+60},{isNearly:C(b.left,P),lineNode:x.yr,line:"yr",dragShift:P,lineShift:P*T+60},{isNearly:C(b.right,P),lineNode:x.yr,line:"yr",dragShift:P-b.width,lineShift:P*T+60}]},_e=[],{rotate:at}=b;Object.keys(Se).forEach(me=>{Se[me].forEach(J=>{if(!J.isNearly)return;const lt=at!==0?f(me,J,b):J.dragShift;e({key:me,value:lt}),J.lineNode.style[me]=`${J.lineShift}px`,_e.push(J.line)})}),_e.length&&u(_e,v,w)})},f=(v,w,x)=>{const{width:V,height:B}=x;return Math.round(v==="top"?w.dragShift-(B-x.height)/2:w.dragShift-(V-x.width)/2)},u=(v,w,x)=>{x?v.includes("yr")?s.value.yr=!0:v.includes("yc")?s.value.yc=!0:v.includes("yl")&&(s.value.yl=!0):v.includes("yl")?s.value.yl=!0:v.includes("yc")?s.value.yc=!0:v.includes("yr")&&(s.value.yr=!0),w?v.includes("xb")?s.value.xb=!0:v.includes("xc")?s.value.xc=!0:v.includes("xt")&&(s.value.xt=!0):v.includes("xt")?s.value.xt=!0:v.includes("xc")?s.value.xc=!0:v.includes("xb")&&(s.value.xb=!0)},h=v=>({left:v.x,top:v.y,width:v.w,height:v.h,rotate:v.rotate}),C=(v,w)=>Math.abs(v-w)<=Zn;return ee(()=>{oe.on("move",({isDownward:v,isRightward:w})=>{i.value.markLine&&d(v,w)}),oe.on("unmove",()=>{r()})}),ye(()=>{oe.off("move"),oe.off("unmove")}),{lineRefs:l,lines:c,lineStatus:s}}},Jn={class:"mark-line"};function Qn(n,t,o,e,i,l){return _(),g("div",Jn,[(_(!0),g(U,null,Y(e.lines,c=>Q((_(),g("div",{key:c,class:k(["line",[c.includes("x")?"xline":"yline",c]]),ref:s=>{e.lineRefs[c]=s}},null,2)),[[xe,e.lineStatus[c]||!1]])),128))])}var eo=D(Gn,[["render",Qn],["__scopeId","data-v-0e7539c7"]]);const to=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],et=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],no=n=>{const t=(n+360)%360,o={};let e=-1;return to.forEach(i=>{const l=(i.angle+t)%360,c=et.length,s=0;for(;s<c;){e=(e+1)%c;const r=et[e];if(l<23||l>=338){o[i.direction]="nwse-resize";break}if(r.start<=l&&l<r.end){o[i.direction]=r.cursor;break}}}),o};function oo(n,t,o,e,i,l){n==="t"?(l.h=Math.round(t.h+(o.y-e.y)/i),l.y=Math.round(t.y+(e.y-o.y)/i),l.h=Math.max(l.h,20)):n==="rt"?(l.h=Math.round(t.h+(o.y-e.y)/i),l.w=Math.round(t.w+(e.x-o.x)/i),l.y=Math.round(t.y+(e.y-o.y)/i),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):n==="r"?(l.w=Math.round(t.w+(e.x-o.x)/i),l.w=Math.max(l.w,20)):n==="rb"?(l.h=Math.round(t.h+(e.y-o.y)/i),l.w=Math.round(t.w+(e.x-o.x)/i),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):n==="b"?(l.h=Math.round(t.h+(e.y-o.y)/i),l.h=Math.max(l.h,20)):n==="lb"?(l.h=Math.round(t.h+(e.y-o.y)/i),l.w=Math.round(t.w+(o.x-e.x)/i),l.x=Math.round(t.x+(e.x-o.x)/i),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):n==="l"?(l.w=Math.round(t.w+(o.x-e.x)/i),l.x=Math.round(t.x+(e.x-o.x)/i),l.w=Math.max(l.w,20)):n==="lt"&&(l.h=Math.round(t.h+(o.y-e.y)/i),l.w=Math.round(t.w+(o.x-e.x)/i),l.x=Math.round(t.x+(e.x-o.x)/i),l.y=Math.round(t.y+(e.y-o.y)/i),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20))}const tt=(n,t,o,e,i)=>{const l=W({},o.attr),c=Object.create(null),s=n.clientX,r=n.clientY,d=u=>{const h=u.clientX,C=u.clientY;t?oo(t,l,{x:s,y:r},{x:h,y:C},e,c):(c.x=l.x+Math.round((h-s)/e/i)*i,c.y=l.y+Math.round((C-r)/e/i)*i),o.attr=W(W({},o.attr),c),ge().then(()=>{oe.emit("move",{isDownward:C-r>0,isRightward:h-s>0})})},f=()=>{oe.emit("unmove"),G(document,"mousemove",d),G(document,"mouseup",f)};Z(document,"mousemove",d),Z(document,"mouseup",f)},ao=(n,t,o,e)=>{tt(n,null,t,o,e)},lo=(n,t,o,e)=>{tt(n,t,o,e)},so=(n,t,o)=>{const e=t.getBoundingClientRect(),i=e.left+e.width/2,l=e.top+e.height/2,c=Math.atan2(l-n.clientY,i-n.clientX)*180/Math.PI-o.attr.rotate,s=d=>{const f=Math.atan2(l-d.clientY,i-d.clientX)*180/Math.PI-c,u=Math.round(f%360);o.attr.rotate=u<0?u+360:u},r=()=>{G(document,"mousemove",s),G(document,"mouseup",r)};Z(document,"mousemove",s),Z(document,"mouseup",r)},io={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(n){const t=S(()=>({height:`${n.attr.y+60/n.scale}px`,borderLeftWidth:`${.9/n.scale}px`})),o=S(()=>({width:`${n.attr.x+60/n.scale}px`,borderTopWidth:`${.9/n.scale}px`})),e=S(()=>({fontSize:`${12/n.scale}px`,top:`-${6/n.scale}px`,left:`-${6/n.scale}px`}));return{topLineStyle:t,leftLineStyle:o,accountStyle:e}}},co={class:"nav-line"};function ro(n,t,o,e,i,l){return _(),g("div",co,[a("div",{class:"nav-line-top",style:$(e.topLineStyle)},null,4),a("div",{class:"nav-line-left",style:$(e.leftLineStyle)},null,4),a("div",{class:"nav-line-account",style:$(e.accountStyle)},F(o.attr.x)+", "+F(o.attr.y),5)])}var mo=D(io,[["render",ro]]);const uo={name:"dv-transform",components:{ReferLine:mo},props:{data:{type:Object,required:!0}},setup(n,t){const o=_t(),{canvas:e,comps:i,pageConfig:l,selectedCom:c,hoveredCom:s,onCompHovered:r,onCompSelected:d,toolbox:f}=N(),{showMenu:u}=Ce(),h=S(()=>s.value===n.data.id),C=S(()=>!St(c.value)&&c.value.id===n.data.id),v=S(()=>({locked:n.data.locked,selected:C.value})),w=S(()=>({top:0,left:0,width:`${n.data.attr.w}px`,height:`${n.data.attr.h}px`,transform:`translate(${n.data.attr.x}px, ${n.data.attr.y}px)`})),x=S(()=>({"is-hide":!C.value||n.data.locked})),V=S(()=>({cursor:"move",transform:`rotate(${n.data.attr.rotate}deg)`})),B=S(()=>({width:`${n.data.attr.w}px`,height:`${n.data.attr.h}px`})),T=S(()=>({display:n.data.hided?"none":"block"})),b=S(()=>no(n.data.attr.rotate)),A=S(()=>e.value.scale),q=S(()=>{const z=`scale(${1/A.value}, ${1/A.value})`;return{t:{name:"top",style:{cursor:b.value.t,transform:z}},rt:{name:"top-right",style:{cursor:b.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:z}},r:{name:"right",style:{cursor:b.value.r,transform:z}},rb:{name:"bottom-right",style:{cursor:b.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:z}},b:{name:"bottom",style:{cursor:b.value.b,transform:z}},lb:{name:"bottom-left",style:{cursor:b.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:z}},l:{name:"left",style:{cursor:b.value.l,transform:z}},lt:{name:"top-left",style:{cursor:b.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:z}}}}),K=()=>{r(n.data.id)},j=()=>{r("")},M=()=>{C.value||d(n.data)};return{comps:i,selectedCom:c,hoveredCom:s,toolbox:f,isHovered:h,isSelected:C,hideStyle:T,transformClass:v,transformStyle:w,handlerClass:x,handlerStyle:V,wrapperStyle:B,onEnter:K,onLeave:j,onMove:z=>{M(),ao(z,n.data,A.value,l.value.grid)},onZoom:(z,ae)=>{M(),lo(z,ae,n.data,A.value)},onRotate:z=>{so(z,o.vnode.el,n.data)},points:q,scale:A,showMenu:u}}},fo={class:"dv-com"},ho=["onMousedown"],vo=["onMousedown"],_o=a("div",{class:"transform-bg"},null,-1);function po(n,t,o,e,i,l){const c=p("refer-line");return _(),g("div",{class:k(["dv-transform",e.transformClass]),style:$(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(_(),O(c,{key:0,attr:o.data.attr,scale:e.scale},null,8,["attr","scale"])):le("",!0),a("div",{class:k(["dv-scale",{hovered:e.isHovered}]),style:$(e.hideStyle),onMouseenter:t[2]||(t[2]=(...s)=>e.onEnter&&e.onEnter(...s)),onMouseleave:t[3]||(t[3]=(...s)=>e.onLeave&&e.onLeave(...s)),onMousedown:t[4]||(t[4]=ce((...s)=>e.onMove&&e.onMove(...s),["prevent","stop"]))},[a("div",{class:k(["transform-handler",e.handlerClass]),style:$(e.handlerStyle)},[a("div",fo,[Le(n.$slots,"default"),a("div",{class:"dv-event-disable",style:$(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...s)=>e.showMenu&&e.showMenu(...s))},null,36)]),(_(!0),g(U,null,Y(e.points,(s,r)=>(_(),g(U,{key:r},[s.rotateStyle?(_(),g("i",{key:0,class:k(`${s.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"rotate-handler",style:$(s.rotateStyle),onMousedown:t[1]||(t[1]=ce((...d)=>e.onRotate&&e.onRotate(...d),["prevent","stop"]))},[a("span",{class:"control-point",style:$(s.style),onMousedown:ce(d=>e.onZoom(d,r),["prevent","stop"])},null,44,ho)],36)],2)):(_(),g("i",{key:1,class:k(`${s.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"control-point",style:$(s.style),onMousedown:ce(d=>e.onZoom(d,r),["prevent","stop"])},null,44,vo)],2))],64))),128)),_o],6)],38)],6)}var go=D(uo,[["render",po]]);const bo={name:"canvas-main",components:{MarkLine:eo,DvTransform:go,Ruler:Kn},setup(){const{canvas:n,pageConfig:t,autoCanvasScale:o,comps:e,onCompSelected:i,getPanelOffsetLeft:l,getPanelOffsetTop:c,selectedCom:s,addCom:r,toolbox:d}=N(),f=S(()=>({width:`${n.value.width}px`,height:`${n.value.height}px`})),u=S(()=>({position:"absolute",width:`${t.value.width}px`,height:`${t.value.height}px`,transform:`scale(${n.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${t.value.bgImage})`,backgroundColor:t.value.bgColor})),h=kt(o,200),C=async x=>{x.preventDefault();try{const V=x.dataTransfer.getData("text");if(V){const B=Ye(V),{scale:T}=n.value,b=(x.clientX-l.value)/T,A=(x.clientY-c.value)/T;if(B.attr.x=Math.round(b-B.attr.w/2),B.attr.y=Math.round(A-B.attr.h/2),await r({component:B}),await i(B),B.apiData.source&&B.apiData.source.type===Ee.static&&B.apiData.source.staticPath){const{data:q}=await je(B.id,B.apiData.source.staticPath);s.value.apiData.source.config.data=JSON.stringify(q)}}}catch(V){console.warn(V)}},v=()=>{i()},w=x=>{x.preventDefault(),x.stopPropagation(),x.dataTransfer.dropEffect="copy"};return ee(()=>{Z(window,"resize",h),h()}),ye(()=>{G(window,"resize",h)}),{screenShotStyle:f,canvasPanelStyle:u,comps:e,toolbox:d,cancelSelectCom:v,dropToAddCom:C,dragOver:w}}},yo={class:"canvas-main"};function xo(n,t,o,e,i,l){const c=p("mark-line"),s=p("ruler"),r=p("dv-transform");return _(),g("div",yo,[a("div",{id:"canvas-wp",class:"canvas-panel-wrap",onMousedown:t[2]||(t[2]=ce((...d)=>e.cancelSelectCom&&e.cancelSelectCom(...d),["stop"]))},[a("div",{class:"screen-shot",style:$(e.screenShotStyle)},[e.toolbox.markLine?(_(),O(c,{key:0,style:$(e.screenShotStyle)},null,8,["style"])):le("",!0),m(s),a("div",{id:"canvas-components",class:"canvas-panel",style:$(e.canvasPanelStyle),onDragover:t[0]||(t[0]=(...d)=>e.dragOver&&e.dragOver(...d)),onDrop:t[1]||(t[1]=(...d)=>e.dropToAddCom&&e.dropToAddCom(...d))},[(_(!0),g(U,null,Y(e.comps,d=>(_(),O(r,{key:d.id,data:d},{default:y(()=>[(_(),O(ze(d.name),{data:d,style:$({transform:"translateZ(0px)",opacity:d.attr.opacity})},null,8,["data","style"]))]),_:2},1032,["data"]))),128))],36)],4)],32)])}var Co=D(bo,[["render",xo]]);const wo={name:"page-config",setup(){const{pageConfig:n,autoCanvasScale:t}=N();return{onSizeChange:async()=>{await t()},resetBGImage:()=>{n.value.bgColor="#0d2a42",n.value.bgImage=Mt("bg.png")},backgroundImages:Tt,pageConfig:n}}},So=n=>(se("data-v-2b18d640"),n=n(),ie(),n),ko={class:"page-config-panel"},Mo=So(()=>a("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),Vo={class:"page-config-content"},$o={class:"page-config-wp"},Bo=I("\u6062\u590D\u9ED8\u8BA4\u80CC\u666F"),Do={class:"page-config-wp"};function Io(n,t,o,e,i,l){const c=p("g-input-number"),s=p("g-field"),r=p("g-color-picker"),d=p("g-upload-img"),f=p("g-images-select"),u=p("b-button");return _(),g("div",ko,[Mo,a("div",Vo,[a("div",$o,[m(s,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:y(()=>[m(c,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[0]||(t[0]=h=>e.pageConfig.width=h),label:"\u5BBD\u5EA6",min:1e3,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),m(c,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[1]||(t[1]=h=>e.pageConfig.height=h),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),m(s,{label:"\u80CC\u666F\u989C\u8272"},{default:y(()=>[m(r,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[2]||(t[2]=h=>e.pageConfig.bgColor=h)},null,8,["modelValue"])]),_:1}),m(s,{label:"\u80CC\u666F\u56FE",tooltip:"\u652F\u6301\u56FE\u7247\u5730\u5740\u3001\u9759\u6001\u8DEF\u5F84\u3001base64\u5B58\u50A8"},{default:y(()=>[m(d,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[3]||(t[3]=h=>e.pageConfig.bgImage=h)},null,8,["modelValue"])]),_:1}),m(s,{label:"\u80CC\u666F\u9884\u8BBE",tooltip:"\u53EF\u4EE5\u52A0\u8F7D\u5BF9\u5E94\u9884\u8BBE\u7684\u56FE\u7247\u80CC\u666F"},{default:y(()=>[m(f,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[4]||(t[4]=h=>e.pageConfig.bgImage=h),images:e.backgroundImages,"value-key":"src"},null,8,["modelValue","images"])]),_:1}),m(s,{label:"\u91CD\u7F6E"},{default:y(()=>[m(u,{type:"primary",size:"small",onClick:e.resetBGImage},{default:y(()=>[Bo]),_:1},8,["onClick"])]),_:1})]),a("div",Do,[m(s,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:y(()=>[m(c,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[5]||(t[5]=h=>e.pageConfig.grid=h),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})])])])}var To=D(wo,[["render",Io],["__scopeId","data-v-2b18d640"]]);const Lo={name:"config-title",props:{comName:{type:String,required:!0},comAlias:{type:String,required:!0}},setup(n){const t=S(()=>{const e=kn(n.comName);return e==null?void 0:e.com.name});return{toSearch:()=>{window.open("https://echarts.apache.org/zh/option.html#title","_blank")},comTitle:t}}},nt=n=>(se("data-v-5bc1a558"),n=n(),ie(),n),zo={class:"com-title-wp"},No={class:"com-title"},Uo={class:"title-name"},Ro={class:"alias-name"},Eo={class:"version-tag"},jo=nt(()=>a("i",{class:"b-iconfont b-icon-search"},null,-1)),Ao=nt(()=>a("span",null,"\u641C\u7D22\u914D\u7F6E",-1)),Ho=[jo,Ao];function Oo(n,t,o,e,i,l){return _(),g("div",zo,[a("div",No,[a("div",Uo,[a("span",Ro,F(o.comAlias),1)]),a("div",Eo,[a("span",null,F(e.comTitle),1)])]),Le(n.$slots,"default",{},()=>[a("div",{class:"search-config",onClick:t[0]||(t[0]=(...c)=>e.toSearch&&e.toSearch(...c)),title:"echarts option config"},Ho)],!0)])}var ot=D(Lo,[["render",Oo],["__scopeId","data-v-5bc1a558"]]);const Po={name:"data-center-panel",components:{ConfigTitle:ot,SourcePanel:Vt(()=>$t(()=>import("./source-panel-287dcf7a.js"),["static/js/source-panel-287dcf7a.js","static/css/source-panel-8438f192.css","static/js/index-a4e94847.js","static/css/index-74cdb240.css","static/js/vendor-0fc4fabe.js","static/js/chunk-brace-7fd40d4c.js","static/js/chunk-bin-ui-next-51eb6328.js","static/css/chunk-bin-ui-next-d2edf0dc.css","static/js/useSchemaStore-a5915d07.js","static/js/database.api-9713b641.js","static/js/field-type-icon-e90083b8.js","static/css/field-type-icon-d3ae34ac.css"]))},setup(){const{selectedCom:n}=N(),t=S(()=>Object.keys(n.value.apis));return{com:n,dataKeys:t}}},Wo={class:"data-center-panel"},Fo={class:"scroll-container"},Yo={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"},Xo=I("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E");function qo(n,t,o,e,i,l){const c=p("config-title"),s=p("source-panel"),r=p("b-empty"),d=p("b-scrollbar");return _(),g("div",Wo,[m(c,{"com-name":e.com.name,"com-alias":e.com.alias},null,8,["com-name","com-alias"]),a("div",Fo,[m(d,{native:""},{default:y(()=>[(_(!0),g(U,null,Y(e.dataKeys,f=>(_(),O(s,{key:f,"api-name":f,"active-name":e.dataKeys[0],collapse:e.dataKeys.length>1},null,8,["api-name","active-name","collapse"]))),128)),e.dataKeys.length>0?(_(),g(U,{key:0},[],64)):(_(),g("div",Yo,[m(r,null,{default:y(()=>[Xo]),_:1})]))]),_:1})])])}var Ko=D(Po,[["render",qo]]);const Zo={name:"basic-setting",props:{attr:{type:Object,required:!0}}},Go={class:"basic-setting-wp"},Jo={style:{width:"50%"}},Qo=I("\u91CD\u7F6E\u65CB\u8F6C");function ea(n,t,o,e,i,l){const c=p("g-input-number"),s=p("g-field"),r=p("b-button"),d=p("g-slider");return _(),g("div",Go,[m(s,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{default:y(()=>[m(c,{modelValue:o.attr.w,"onUpdate:modelValue":t[0]||(t[0]=f=>o.attr.w=f),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px"},null,8,["modelValue"]),m(c,{modelValue:o.attr.h,"onUpdate:modelValue":t[1]||(t[1]=f=>o.attr.h=f),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px"},null,8,["modelValue"])]),_:1}),m(s,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:y(()=>[m(c,{modelValue:o.attr.x,"onUpdate:modelValue":t[2]||(t[2]=f=>o.attr.x=f),label:"offsetX",inline:"",suffix:"px"},null,8,["modelValue"]),m(c,{modelValue:o.attr.y,"onUpdate:modelValue":t[3]||(t[3]=f=>o.attr.y=f),label:"offsetY",inline:"",suffix:"px"},null,8,["modelValue"])]),_:1}),m(s,{label:"\u65CB\u8F6C\u89D2\u5EA6",flat:""},{default:y(()=>[m(c,{modelValue:o.attr.rotate,"onUpdate:modelValue":t[4]||(t[4]=f=>o.attr.rotate=f),min:0,max:360,step:1,inline:""},null,8,["modelValue"]),a("div",Jo,[m(r,{size:"small",onClick:t[5]||(t[5]=f=>o.attr.rotate=0)},{default:y(()=>[Qo]),_:1})])]),_:1}),m(s,{label:"\u900F\u660E\u5EA6"},{default:y(()=>[m(d,{modelValue:o.attr.opacity,"onUpdate:modelValue":t[6]||(t[6]=f=>o.attr.opacity=f),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})])}var ta=D(Zo,[["render",ea]]);const na={name:"setting-panel",components:{BasicSetting:ta,ConfigTitle:ot},setup(){const{selectedCom:n}=N();return{selectedCom:n}}},oa={class:"setting-panel"},aa={class:"setting-panel-content"},la={class:"scroll-container"};function sa(n,t,o,e,i,l){const c=p("config-title"),s=p("basic-setting"),r=p("b-scrollbar");return _(),g("div",oa,[m(c,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),a("div",aa,[a("div",la,[m(r,null,{default:y(()=>[m(s,{key:`${e.selectedCom.id}'_basic-setting`,attr:e.selectedCom.attr},null,8,["attr"]),(_(),O(ze(e.selectedCom.name+"Config"),{key:e.selectedCom.id,data:e.selectedCom},null,8,["data"]))]),_:1})])])])}var ia=D(na,[["render",sa]]);const ca={name:"config-panel",components:{SettingPanel:ia,DataCenterPanel:Ko,PageConfig:To},setup(){const{toolbar:n,selectedCom:t,toggleConfigPanel:o}=N(),e=L(0);return{toolbar:n,selectedCom:t,toggleConfigPanel:o,curTabIndex:e,changeTab:l=>{if(l===2){re.warning("\u6682\u672A\u5F00\u653E!");return}e.value!==l&&(e.value=l)}}}},ra={class:"config-panel"},da={key:1,class:"page-config-panel"},ma={class:"page-config-top"},ua={class:"tabs-wrapper"},fa={class:"page-config-content"},ha={style:{height:"100%"}},va={style:{height:"100%"}};function _a(n,t,o,e,i,l){const c=p("page-config"),s=p("b-icon"),r=p("b-tooltip"),d=p("setting-panel"),f=p("data-center-panel");return _(),g("div",{class:k(["config-panel-wp",{"is-hide":!e.toolbar.config}])},[a("div",ra,[e.selectedCom?(_(),g("div",da,[a("div",ma,[a("div",ua,[a("div",{class:k(["tab-item",{active:e.curTabIndex===0}]),onClick:t[0]||(t[0]=u=>e.changeTab(0))},[m(r,{content:"\u914D\u7F6E"},{default:y(()=>[m(s,{name:"control",size:"20"})]),_:1})],2),a("div",{class:k(["tab-item",{active:e.curTabIndex===1}]),onClick:t[1]||(t[1]=u=>e.changeTab(1))},[m(r,{content:"\u6570\u636E"},{default:y(()=>[m(s,{name:"cloud-server",size:"22"})]),_:1})],2),a("div",{class:k(["tab-item",{active:e.curTabIndex===2}]),onClick:t[2]||(t[2]=u=>e.changeTab(2))},[m(r,{content:"\u4EA4\u4E92"},{default:y(()=>[m(s,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),a("div",fa,[Q(a("div",ha,[m(d,{key:e.selectedCom.id})],512),[[xe,e.curTabIndex===0]]),Q(a("div",va,[m(f,{key:e.selectedCom.id})],512),[[xe,e.curTabIndex===1]])])])):(_(),O(c,{key:0}))])],2)}var pa=D(ca,[["render",_a]]);const ga={name:"toolbox-panel",setup(){const{toolbar:n,toolbox:t}=N();return{toolbar:n,toolbox:t}}},ba={class:"toolbox-panel"},ya={class:"btn-box"},xa=I("\u53C2\u8003\u7EBF\xA0\xA0 "),Ca={class:"btn-box"},wa=I("\u5BF9\u9F50\u7EBF\xA0\xA0 ");function Sa(n,t,o,e,i,l){const c=p("b-switch");return _(),g("div",{class:k(["toolbox-panel-wp",{"is-hide":!e.toolbar.toolbox}])},[a("div",ba,[a("div",ya,[xa,m(c,{modelValue:e.toolbox.referLine,"onUpdate:modelValue":t[0]||(t[0]=s=>e.toolbox.referLine=s),size:"small"},null,8,["modelValue"])]),a("div",Ca,[wa,m(c,{modelValue:e.toolbox.markLine,"onUpdate:modelValue":t[1]||(t[1]=s=>e.toolbox.markLine=s),size:"small"},null,8,["modelValue"])])])],2)}var ka=D(ga,[["render",Sa]]);const Ma={name:"footer-panel",setup(){const{canvas:n,autoCanvasScale:t,setCanvasScale:o,toggleLayerPanel:e,toggleCompsPanel:i,toggleConfigPanel:l,pageInfo:c,saveScreenData:s}=N(),r=Be(),d=L([150,100,75,50]),f=L(20),u=L(20),h=async w=>{w===-1?await t():await o(w===0?f.value:w)};pe(()=>n.value.scale,w=>{const x=parseInt((w*100).toFixed(2));u.value=x,f.value=x});const C=w=>{const x=w.target;if(!["input","textarea"].includes(x.tagName.toLowerCase())&&w.ctrlKey){const V=w.key.toLowerCase();V==="arrowleft"?e():V==="arrowup"?i():V==="arrowright"?l():V==="a"?t():V==="d"?h(100):V==="s"&&v(),w.preventDefault()}},v=async()=>{const w=c.value.id,{data:x}=await s();if(!w){let V=r.resolve({path:"/schema/screen",query:{id:x.pageInfo.id}});window.location.replace(V.href)}re.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0})};return ee(()=>{document.addEventListener("keydown",C,!1)}),Te(()=>{document.removeEventListener("keydown",C,!1)}),{scaleList:d,inputScale:f,scale:u,submitScale:h}}},he=n=>(se("data-v-ab1454a8"),n=n(),ie(),n),Va={class:"footer-panel"},$a=he(()=>a("i",{class:"b-iconfont b-icon-codelibrary",style:{"font-size":"18px"}},null,-1)),Ba=he(()=>a("div",{class:"shortcut-wp"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + \u2190")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5207\u6362\u7EC4\u4EF6\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + \u2191")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5207\u6362\u53F3\u4FA7\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u5230\u6700\u4F73\u4F4D\u7F6E"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + a")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A100%"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + d")])],-1)),Da={class:"scale-input-wp"},Ia=he(()=>a("span",{class:"percent"},"%",-1)),Ta=he(()=>a("i",{class:"b-iconfont b-icon-down"},null,-1)),La=I("\u81EA\u9002\u5E94"),za={class:"scale-slider-wp"};function Na(n,t,o,e,i,l){const c=p("b-popover"),s=p("b-dropdown-item"),r=p("b-dropdown-menu"),d=p("b-dropdown"),f=p("b-slider");return _(),g("div",Va,[m(c,{width:"235",placement:"top",trigger:"hover","popper-class":"editor-popover","show-arrow":!1},{content:y(()=>[Ba]),default:y(()=>[$a]),_:1}),m(d,{trigger:"click",onCommand:e.submitScale},{dropdown:y(()=>[m(r,null,{default:y(()=>[(_(!0),g(U,null,Y(e.scaleList,u=>(_(),O(s,{key:u,name:u},{default:y(()=>[I(F(`${u}%`),1)]),_:2},1032,["name"]))),128)),m(s,{name:-1},{default:y(()=>[La]),_:1})]),_:1})]),default:y(()=>[a("div",Da,[Q(a("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>e.inputScale=u),type:"number",class:"scale-input",onKeydown:t[1]||(t[1]=Ie(u=>e.submitScale(0),["enter"]))},null,544),[[be,e.inputScale]]),Ia,Ta])]),_:1},8,["onCommand"]),a("div",za,[m(f,{modelValue:e.scale,"onUpdate:modelValue":t[2]||(t[2]=u=>e.scale=u),min:10,max:150,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])}var Ua=D(Ma,[["render",Na],["__scopeId","data-v-ab1454a8"]]);const Ra={name:"context-menu",setup(){const{onCompMoved:n,deleteCom:t,copyCom:o}=N(),{contextMenu:e,selectedCom:i,isLocked:l,isHided:c,contextMenuStyle:s,renamingCom:r}=Ce(),d=b=>{i.value&&n(i.value.id,b)},f=()=>d(X.up),u=()=>d(X.down),h=()=>d(X.top),C=()=>d(X.bottom),v=()=>{i.value&&(i.value.locked=!i.value.locked)},w=()=>{i.value&&(i.value.hided=!i.value.hided)},x=()=>{const b=i.value;b&&gt.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{t(b.id)}).catch(()=>{})},V=()=>{const b=i.value;b&&r(b.id)},B=()=>{const b=i.value;b&&o(b.id)},T=b=>b.preventDefault();return ee(()=>{Z(document,"contextmenu",T)}),ye(()=>{G(document,"contextmenu",T)}),{contextMenu:e,contextMenuStyle:s,isLocked:l,isHided:c,moveUp:f,moveDown:u,moveTop:h,moveBottom:C,toDeleteCom:x,renameCom:V,toCopyCom:B,lockCom:v,hideCom:w}}},E=n=>(se("data-v-4f88cc77"),n=n(),ie(),n),Ea=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),ja=I("\u7F6E\u9876 "),Aa=[Ea,ja],Ha=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),Oa=I("\u7F6E\u5E95 "),Pa=[Ha,Oa],Wa=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),Fa=I("\u4E0A\u79FB\u4E00\u5C42 "),Ya=[Wa,Fa],Xa=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),qa=I("\u4E0B\u79FB\u4E00\u5C42 "),Ka=[Xa,qa],Za=E(()=>a("div",{class:"context-menu-divider"},null,-1)),Ga=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),Ja=I("\u89E3\u9501 "),Qa=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),el=I("\u9501\u5B9A "),tl=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),nl=I("\u663E\u793A "),ol=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),al=I("\u9690\u85CF "),ll=E(()=>a("div",{class:"context-menu-divider"},null,-1)),sl=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),il=I("\u91CD\u547D\u540D "),cl=[sl,il],rl=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),dl=I("\u590D\u5236 "),ml=[rl,dl],ul=E(()=>a("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),fl=I("\u5220\u9664 "),hl=[ul,fl];function vl(n,t,o,e,i,l){return _(),O(pt,{name:"zoom-in-top"},{default:y(()=>[e.contextMenu.show?(_(),g("div",{key:0,class:"context-menu-wrap",style:$(e.contextMenuStyle)},[a("div",{class:"context-menu-item",onClick:t[0]||(t[0]=(...c)=>e.moveTop&&e.moveTop(...c))},Aa),a("div",{class:"context-menu-item",onClick:t[1]||(t[1]=(...c)=>e.moveBottom&&e.moveBottom(...c))},Pa),a("div",{class:"context-menu-item",onClick:t[2]||(t[2]=(...c)=>e.moveUp&&e.moveUp(...c))},Ya),a("div",{class:"context-menu-item",onClick:t[3]||(t[3]=(...c)=>e.moveDown&&e.moveDown(...c))},Ka),Za,a("div",{class:"context-menu-item",onClick:t[4]||(t[4]=(...c)=>e.lockCom&&e.lockCom(...c))},[e.isLocked?(_(),g(U,{key:0},[Ga,Ja],64)):(_(),g(U,{key:1},[Qa,el],64))]),a("div",{class:"context-menu-item",onClick:t[5]||(t[5]=(...c)=>e.hideCom&&e.hideCom(...c))},[e.isHided?(_(),g(U,{key:0},[tl,nl],64)):(_(),g(U,{key:1},[ol,al],64))]),ll,a("div",{class:"context-menu-item",onClick:t[6]||(t[6]=(...c)=>e.renameCom&&e.renameCom(...c))},cl),a("div",{class:"context-menu-item",onClick:t[7]||(t[7]=(...c)=>e.toCopyCom&&e.toCopyCom(...c))},ml),a("div",{class:"context-menu-item",onClick:t[8]||(t[8]=(...c)=>e.toDeleteCom&&e.toDeleteCom(...c))},hl)],4)):le("",!0)]),_:1})}var _l=D(Ra,[["render",vl],["__scopeId","data-v-4f88cc77"]]);function pl(){const n=De(),{loadScreenData:t}=N(),o=L(!1),e=async i=>{try{o.value=!0;const l=await Lt(i);l.data&&(await t(l.data),await ge(),document.title=l.data.pageInfo.name)}catch(l){console.log(l)}o.value=!1};return pe(()=>n.path,async()=>{const{id:i}=n.query;i&&await e(i)},{immediate:!0}),{loading:o}}const gl={name:"ScreenEditor",components:{ContextMenu:_l,FooterPanel:Ua,ToolboxPanel:ka,CanvasMain:Co,ConfigPanel:pa,ComponentsPanel:Pn,LayerPanel:pn,HeaderBar:en,SvgLoading:mt},setup(){const n=pl();return ee(()=>{Bt("data-schema","screen-editor")}),W({},n)}},bl={class:"schema-screen-container"},yl={key:0,flex:"main:center cross:center",class:"full-wrapper"},xl={key:1,class:"editor-main-wrapper"},Cl={class:"edit-main-wp"};function wl(n,t,o,e,i,l){const c=p("header-bar"),s=p("svg-loading"),r=p("layer-panel"),d=p("components-panel"),f=p("toolbox-panel"),u=p("canvas-main"),h=p("footer-panel"),C=p("config-panel"),v=p("context-menu");return _(),g("div",bl,[m(c,{"back-url":"/dashboardDemo"}),n.loading?(_(),g("div",yl,[m(s,{name:"loading02"})])):(_(),g("div",xl,[m(r),m(d),a("div",Cl,[m(f),m(u),m(h)]),m(C)])),m(v)])}var Nl=D(gl,[["render",wl]]);export{Nl as default};
