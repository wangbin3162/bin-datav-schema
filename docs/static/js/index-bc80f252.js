import{V as C,e as $,n as I,D as z,W as p}from"./index-d19419d6.js";import{cL as R,dd as B,cw as D,r as E,c as u,z as N,A as q,h as m,v as L,F as O,d as P,n as f,I as V,K as A,b as i,k as F,m as G}from"./vendor-9f17a1dc.js";import{l as J}from"./database.api-8e539299.js";import"./chunk-bin-ui-next-79ffd1f6.js";import"./chunk-echarts-f96fa6f1.js";import"./chunk-brace-b1f520b9.js";import"./chunk-bin-datav-a4d94f3b.js";import"./chunk-particles.vue3-d045b215.js";import"./chunk-mockjs-9e1335a8.js";const K={name:"Screen",components:{GLoading:C},setup(){const c=B(),d=D(),{schemaStore:l,storeToRefs:r}=$(),{pageConfig:o,comps:v}=r(l),s=E(!0);V("RenderModel","runtime");const e=()=>{const a=document.querySelector("#app");if(!a)return;const n=o.value.width,t=document.documentElement.clientWidth/n;p(a,{transform:`scale(${t})`,transformOrigin:"left top",backgroundSize:"100%",backgroundRepeat:"no-repeat"})},h=async()=>{const a=d.params.screenId,n=d.name;if(!a){await c.push("/notfound");return}try{s.value=!0;let t={};if(n==="Preview")t=await J();else{const g=await I(a);if(g){const{id:w,name:y,pid:S,layout:b,components:x}=g;t={pageInfo:{id:w,name:y,pid:S},pageConfig:JSON.parse(b),comps:x.map(k=>JSON.parse(k.componentContent))}}}t&&(l.loadScreenData(t),_(t),setTimeout(()=>{s.value=!1},500),z(window,"resize",e))}catch{await c.push("/notfound")}},_=a=>{const n=document.querySelector("#app");if(!n)return;const{pageInfo:t}=a;document.title=t.name,document.querySelector('meta[name="viewport"]').setAttribute("content",`width=${o.value.width}`),p(document.documentElement,{overflowX:"hidden",overflowY:"visible"}),p(n,{width:`${o.value.width}px`,height:`${o.value.height}px`,backgroundImage:`url(${o.value.bgImage})`,backgroundColor:o.value.bgColor}),e()};return h(),{loading:s,comps:v}}},T={class:"screen-wrapper"},W={class:"dv-loading"},M={class:"scene"};function X(c,d,l,r,o,v){const s=A("g-loading");return i(),u("div",T,[N(m("div",W,[L(s,{spinning:""})],512),[[q,r.loading]]),m("div",{class:"dv-layout",style:f({visibility:r.loading?"hidden":"visible"})},[m("div",M,[(i(!0),u(O,null,P(r.comps,e=>(i(),u("div",{class:"dv-com absolute",key:e.id,style:f({left:e.attr.x+"px",top:e.attr.y+"px",width:e.attr.w+"px",height:e.attr.h+"px",opacity:e.attr.opacity,transform:`rotate(${e.attr.rotate}deg)`,pointerEvents:e.name==="Group"?"none":null})},[(i(),F(G(e.name),{data:e},null,8,["data"]))],4))),128))])],4)])}var ae=R(K,[["render",X]]);export{ae as default};
