import{ai as q,ah as E,r as F,L as O,R as X,b as w,c as b,z as Y,A as D,h as _,M as L,F as P,d as T,n as $,k as V,q as A,N as x,m as J,e as j}from"./vendor-c1103bdb.js";import{x as R,a1 as K,l as W,L as Z,a2 as C}from"./index-71bcd248.js";import{l as G}from"./database.api-5878d93e.js";import{b as H,a as Q}from"./animations-4c752358.js";import"./chunk-brace-0dab6832.js";import"./chunk-bin-ui-design-9314e876.js";import"./chunk-bin-datav-6a4e943a.js";import"./chunk-particles.vue3-91e644a5.js";import"./chunk-three-06bdd351.js";import"./chunk-gsap-ecfb8fd4.js";import"./chunk-mockjs-03499d26.js";async function U(g,f){const s=g.initScript,i={};f.forEach(v=>{i[v.id]=v});const h=["components"];await K(s.scriptStr,...h)(i)}async function ee(){const{schemaStore:g,storeToRefs:f}=R(),{pageConfig:s,comps:i}=f(g);console.log(s.value);const{initScript:h}=s.value;console.log(h),h.enable&&await U(s.value,i.value)}const te={class:"screen-wrapper"},oe={class:"dv-loading"},ae={class:"scene"},he=Object.assign({name:"Screen"},{__name:"index",setup(g){const f=q(),s=E(),{schemaStore:i,storeToRefs:h}=R(),{pageConfig:r,comps:v}=h(i),y=F(!0);O("RenderModel","runtime");const k=()=>{const o=document.querySelector("#app");if(!o)return;const a=r.value.width,t=document.documentElement.clientWidth/a;C(o,{transform:`scale(${t})`,transformOrigin:"left top",backgroundSize:"100%",backgroundRepeat:"no-repeat"})};function z(o){const{x:a,y:t,w:e,h:c,rotate:l,rotateX:d,rotateY:u,perspective:p}=o.attr,n={left:a+"px",top:t+"px",width:e+"px",height:c+"px",transform:`rotateZ(${l}deg)`};return(u!==0||d!==0)&&(n["transform-style"]="preserve-3d",n.perspective=`${p}px`,n.overflow="visible"),n}const B=async()=>{const o=s.params.screenId,a=s.name;if(!o){await f.push("/notfound");return}try{y.value=!0;let t={};if(a==="Preview")t=await G();else{const e=await W(o);if(e){const{id:c,name:l,pid:d,layout:u,components:p}=e;t={pageInfo:{id:c,name:l,pid:d},pageConfig:JSON.parse(u),comps:p.map(n=>JSON.parse(n.componentContent))}}}t&&(i.loadScreenData(t),I(t),ee(),setTimeout(()=>{y.value=!1},500),Z(window,"resize",k))}catch{await f.push("/notfound")}},I=o=>{const a=document.querySelector("#app");if(!a)return;const{pageInfo:t}=o;document.title=t.name,document.querySelector('meta[name="viewport"]').setAttribute("content",`width=${r.value.width}`);const{filterShow:e,blendMode:c,hueRotate:l,saturate:d,contrast:u,brightness:p,opacity:n}=r.value.styles;C(document.documentElement,{overflowX:"hidden",overflowY:"visible"});const m={width:`${r.value.width}px`,height:`${r.value.height}px`,backgroundImage:`url(${r.value.bgImage})`,backgroundColor:r.value.bgColor};e&&(m.mixBlendMode=c,m.opacity=n,m.filter=`saturate(${d}) contrast(${u}) hue-rotate(${l}deg) brightness(${p})`),C(a,m),k()};B();function M(o){const{w:a,h:t,rotateX:e,rotateY:c,filterShow:l,blendMode:d,hueRotate:u,saturate:p,contrast:n,brightness:m,opacity:N}=o.attr,S={width:`${a}px`,height:`${t}px`,transform:`rotateX(${e}deg) rotateY(${c}deg) `,mixBlendMode:d};return l&&(S.opacity=N,S.filter=`saturate(${p}) contrast(${n}) hue-rotate(${u}deg) brightness(${m})`),S}return(o,a)=>{const t=X("g-loading");return w(),b("div",te,[Y(_("div",oe,[L(t,{spinning:"",type:"dna"})],512),[[D,y.value]]),_("div",{class:"dv-layout",style:$({visibility:y.value?"hidden":"visible"})},[_("div",ae,[(w(!0),b(P,null,T(x(v),e=>(w(),b("div",{class:"dv-com absolute",key:e.id,style:$(z(e))},[e.hided?j("",!0):(w(),V(J(e.name),{key:0,data:e,class:A(x(H)(e.animation)),style:$({...M(e),...x(Q)(e.animation)})},null,8,["data","class","style"]))],4))),128))])],4)])}}});export{he as default};
