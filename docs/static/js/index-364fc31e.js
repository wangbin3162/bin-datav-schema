import{N as C,u as $,l as I,C as N,O as u}from"./index-e6a17aa2.js";import{at as O,aI as z,a5 as B,m as R,H as D,o as i,a as p,k as E,v as P,b as m,c as F,F as J,O as L,h as f,f as T,M as V}from"./vendor-38ba0469.js";import{l as q}from"./database.api-48cee5a9.js";import"./chunk-bin-ui-next-c6419b41.js";import"./chunk-brace-a5f4a3e9.js";const A={name:"Screen",components:{GLoading:C},setup(){const c=z(),d=B(),{schemaStore:l,storeToRefs:n}=$(),{pageConfig:t,comps:v}=n(l),s=R(!0),e=()=>{const a=t.value.width,r=document.documentElement.clientWidth/a;u(document.body,{transform:`scale(${r})`,transformOrigin:"left top",backgroundSize:"100%",backgroundRepeat:"no-repeat"})},h=async()=>{const a=d.params.screenId,r=d.name;if(!a){await c.push("/notfound");return}try{s.value=!0;let o={};if(r==="Preview")o=await q();else{const g=await I(a);if(g){const{id:w,name:y,pid:b,layout:x,components:S}=g;o={pageInfo:{id:w,name:y,pid:b},pageConfig:JSON.parse(x),comps:S.map(k=>JSON.parse(k.componentContent))}}}o&&(l.loadScreenData(o),_(o),setTimeout(()=>{s.value=!1},500),N(window,"resize",e))}catch{await c.push("/notfound")}},_=a=>{const{pageInfo:r}=a;document.title=r.name,document.querySelector('meta[name="viewport"]').setAttribute("content",`width=${t.value.width}`),u(document.documentElement,{overflowX:"hidden",overflowY:"visible"}),u(document.body,{width:`${t.value.width}px`,height:`${t.value.height}px`,backgroundImage:`url(${t.value.bgImage})`,backgroundColor:t.value.bgColor}),e()};return h(),{loading:s,comps:v}}},G={class:"screen-wrapper"},H={class:"dv-loading"},K={class:"scene"};function M(c,d,l,n,t,v){const s=D("g-loading");return i(),p("div",G,[E(m("div",H,[F(s,{spinning:""})],512),[[P,n.loading]]),m("div",{class:"dv-layout",style:f({visibility:n.loading?"hidden":"visible"})},[m("div",K,[(i(!0),p(J,null,L(n.comps,e=>(i(),p("div",{class:"dv-com absolute",key:e.id,style:f({left:e.attr.x+"px",top:e.attr.y+"px",width:e.attr.w+"px",height:e.attr.h+"px",opacity:e.attr.opacity,transform:`rotate(${e.attr.rotate}deg)`})},[(i(),T(V(e.name),{data:e},null,8,["data"]))],4))),128))])],4)])}var U=O(A,[["render",M]]);export{U as default};
