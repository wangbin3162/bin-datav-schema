var he=Object.defineProperty,ue=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var ae=(t,d,v)=>d in t?he(t,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):t[d]=v,z=(t,d)=>{for(var v in d||(d={}))me.call(d,v)&&ae(t,v,d[v]);if(oe)for(var v of oe(d))ge.call(d,v)&&ae(t,v,d[v]);return t},Y=(t,d)=>ue(t,_e(d));import{M as j,a as ee}from"./chunk-bin-ui-next-c6b728c8.js";import{h as be,t as D,m as ve,r as fe,i as we,w as S,j as U,k as ye,l as $e,s as ke,p as Ce,n as xe}from"./index-0ca6328d.js";import{B as I,G as Ve,as as te,aC as le,l as Z,H as k,o as b,e as Q,w as $,c as g,b as e,f as K,a1 as i,t as m,a as y,O as M,F as B,az as se,aA as ne,m as T,q as De,j as de,g as F,v as X,N as Ie,L as ie}from"./vendor-1e0971ef.js";import{_ as Se}from"./logo-39114ead.js";import{d as je,s as Be}from"./database.api-f0f62620.js";import{g as Ne,r as ze}from"./template.api-b094fad2.js";import"./chunk-brace-269ffce0.js";const G={pid:"1",name:"\u7F3A\u7701\u76EE\u5F55",directory:"Y"};function Ke(){const t=I({selectedPid:G.pid,selectedName:G.name,folderList:[],adding:!1}),d=({id:n,name:a})=>{t.selectedPid=n,t.selectedName=a},v=n=>{if(!t.adding)return;(n.target.value||"").trim()||(t.adding=!1)},C=async n=>{if(!t.adding)return;const a=(n.target.value||"").trim();if(a)try{await be(Y(z({},G),{name:a})),t.adding=!1,u(),j.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(w){D("useModelFolder/addGroup",w)}else t.adding=!1},s=(n,a)=>{if(!a.editing)return;const w=(n.target.value||"").trim();(!w||a.name===w)&&(a.editing=!1)},p=async(n,a)=>{if(!a.editing)return;const w=(n.target.value||"").trim();if(w&&a.name!==w){try{await ve({id:a.id,name:w}),a.name=w,d({id:a.id,name:w}),j.success("\u4FEE\u6539\u6210\u529F\uFF01")}catch(L){D("useModelFolder/editGroup",L)}a.editing=!1}else a.editing=!1},_=({id:n,name:a})=>{ee.confirm({type:"error",title:`\u786E\u5B9A\u8981\u5220\u9664 [ ${a} ] \u5417\uFF1F`}).then(async()=>{try{await fe(n),d({id:G.pid,name:G.name}),u(),j.success("\u5220\u9664\u6210\u529F\uFF01")}catch(w){D("useModelFolder/confirmDeleteGroup",w)}}).catch(()=>{})},u=()=>{we().then(n=>{t.folderList=(n.children||[]).map(a=>({id:a.id,name:a.text}))})};return u(),Y(z({},Ve(t)),{toggleProject:d,confirmDeleteGroup:_,onAddInputBlur:v,onEditInputBlur:s,editGroup:p,addGroup:C})}var Le="/bin-datav-schema/static/png/new-project-b5c06121.png";const x=t=>(se("data-v-5bde0b16"),t=t(),ne(),t),Pe=x(()=>e("h2",{class:"title-bar"},"\u9884\u8BBE",-1)),Ge={class:"preset-wp"},Me=x(()=>e("i",{class:"b-iconfont b-icon-laptop"},null,-1)),Fe={class:"label-title"},Te={class:"h2"},Oe={class:"h4"},Ae={flex:"main:justify",style:{width:"180px"}},Ee=x(()=>e("i",{class:"b-iconfont b-icon-mobile"},null,-1)),qe={class:"label-title"},Re={class:"h2"},Ue={class:"h4"},He={flex:"main:justify",style:{width:"180px"}},Je=x(()=>e("i",{class:"b-iconfont b-icon-gateway"},null,-1)),We=x(()=>e("p",{class:"mb-5"},"\u81EA\u5B9A\u4E49\u5927\u5C0F",-1)),Ye={class:"custom-input"},Qe=x(()=>e("span",{class:"mr-5"},"W:",-1)),Xe=x(()=>e("span",{class:"ml-5 mr-5"},"H:",-1)),Ze=x(()=>e("div",{style:{width:"24px"}},null,-1)),et=x(()=>e("h2",{class:"title-bar"},"\u6A21\u677F",-1)),tt={class:"template-list"},st=["onClick"],nt={class:"template-image"},ot={class:"preview-image"},at=["src"],it={class:"tpl-remove"},lt={class:"template-info"},dt={class:"template-name"},ct={class:"template-size"},rt=x(()=>e("p",null,"\u753B\u5E03\u5C3A\u5BF8",-1)),pt=T("\u53D6\u6D88"),ht=T("\u5F00\u59CB\u521B\u4F5C"),ut={setup(t,{expose:d}){const v=le(),C=Z(!1),s=I(z({},je)),p=I({label:S[0].label,width:S[0].width,height:S[0].height}),_=I({label:U[0].label,width:U[0].width,height:U[0].height}),u=I({width:1920,height:1080}),n=Z([]),a=()=>{C.value=!1},w=()=>{s.label=S[0].label,s.width=S[0].width,s.height=S[0].height,s.type="web",s.tpl="",A(),C.value=!0},L=o=>{s.type="tpl",s.tpl=o.id},O=({width:o,height:r})=>{s.label="\u81EA\u5B9A\u4E49",s.width=o,s.height=r,s.tpl=""},H=o=>{p.label=o.label,p.width=o.width,p.height=o.height,s.label=o.label,s.type=o.type,s.width=o.width,s.height=o.height,s.tpl=""},J=o=>{_.label=o.label,_.width=o.width,_.height=o.height,s.label=o.label,s.type=o.type,s.width=o.width,s.height=o.height,s.tpl=""},A=()=>{Ne().then(o=>{n.value=(o.rows||[]).map(r=>{let V={};try{V=JSON.parse(r.content)}catch{V={pageConfig:{}}}return{id:r.id,name:r.name,pageConfig:V.pageConfig}})})},W=o=>{ee.confirm({type:"error",title:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u6A21\u677F\u5417\uFF1F"}).then(async()=>{try{await ze(o.id),A(),j.success("\u79FB\u9664\u6A21\u677F\u6210\u529F\uFF01")}catch(r){D("create-screen/removeTpl",r)}}).catch(()=>{})},c=o=>{o==="web"?(s.label=p.label,s.width=p.width,s.height=p.height):o==="mobile"?(s.label=_.label,s.width=_.width,s.height=_.height):o==="custom"&&(s.label="\u81EA\u5B9A\u4E49",s.width=u.width,s.height=u.height),s.type=o,s.tpl=""},h=async()=>{a(),await Be(s),await v.push({path:"/schema/screen"})};return d({openCreate:w}),(o,r)=>{const V=k("b-icon"),P=k("b-dropdown-item"),E=k("b-dropdown-menu"),q=k("b-dropdown"),R=k("b-input-number"),f=k("b-button"),N=k("b-modal");return b(),Q(N,{modelValue:C.value,"onUpdate:modelValue":r[7]||(r[7]=l=>C.value=l),title:"\u521B\u5EFA\u770B\u677F",width:"1000px","custom-class":"schema-modal","destroy-on-close":""},{footer:$(()=>[g(f,{onClick:a},{default:$(()=>[pt]),_:1}),g(f,{type:"primary",onClick:h},{default:$(()=>[ht]),_:1})]),default:$(()=>[e("div",null,[Pe,e("div",Ge,[e("div",{class:K(["preset-item web-box",{selected:i(s).type==="web"}]),onClick:r[0]||(r[0]=l=>c("web"))},[Me,e("div",Fe,[e("div",Te,m(i(p).label),1),e("div",Oe,m(i(p).width)+"x"+m(i(p).height),1)]),g(q,{trigger:"click",placement:"bottom-end",style:{width:"24px",height:"46px","line-height":"46px"},onCommand:H},{dropdown:$(()=>[g(E,null,{default:$(()=>[(b(!0),y(B,null,M(i(S),l=>(b(),Q(P,{key:l.label,name:l},{default:$(()=>[e("div",Ae,[e("span",null,m(l.label),1),e("span",null,m(l.width)+"x"+m(l.height),1)])]),_:2},1032,["name"]))),128))]),_:1})]),default:$(()=>[g(V,{name:"down",type:"button"})]),_:1})],2),e("div",{class:K(["preset-item mobile-box",{selected:i(s).type==="mobile"}]),onClick:r[1]||(r[1]=l=>c("mobile"))},[Ee,e("div",qe,[e("div",Re,m(i(_).label),1),e("div",Ue,m(i(_).width)+"x"+m(i(_).height),1)]),g(q,{trigger:"click",placement:"bottom-end",style:{width:"24px",height:"46px","line-height":"46px"},onCommand:J},{dropdown:$(()=>[g(E,null,{default:$(()=>[(b(!0),y(B,null,M(i(U),l=>(b(),Q(P,{key:l.label,name:l},{default:$(()=>[e("div",He,[e("span",null,m(l.label),1),e("span",null,m(l.width)+"x"+m(l.height),1)])]),_:2},1032,["name"]))),128))]),_:1})]),default:$(()=>[g(V,{name:"down",type:"button"})]),_:1})],2),e("div",{class:K(["preset-item custom-box",{selected:i(s).type==="custom"}]),onClick:r[6]||(r[6]=l=>c("custom"))},[Je,e("div",null,[We,e("p",Ye,[Qe,g(R,{modelValue:i(u).width,"onUpdate:modelValue":r[2]||(r[2]=l=>i(u).width=l),min:100,step:1,precision:0,size:"mini",onChange:r[3]||(r[3]=l=>O(i(u)))},null,8,["modelValue"]),Xe,g(R,{modelValue:i(u).height,"onUpdate:modelValue":r[4]||(r[4]=l=>i(u).height=l),min:100,step:1,precision:0,size:"mini",onChange:r[5]||(r[5]=l=>O(i(u)))},null,8,["modelValue"])])]),Ze],2)]),et,e("div",tt,[(b(!0),y(B,null,M(n.value,l=>(b(),y("div",{class:"template-grid",key:l.id},[e("div",{class:K(["template-item",{selected:i(s).type==="tpl"&&i(s).tpl===l.id}]),onClick:pe=>L(l)},[e("div",nt,[e("div",ot,[e("img",{src:l.pageConfig.bgImage,alt:""},null,8,at)]),e("div",it,[g(f,{type:"text","text-color":"#f5222d",title:"\u79FB\u9664\u6A21\u677F",icon:"delete",onClick:pe=>W(l)},null,8,["onClick"])])]),e("div",lt,[e("div",dt,m(l.name),1),e("div",ct,[rt,e("p",null,m(l.pageConfig.width)+"x"+m(l.pageConfig.height)+"px",1)])])],10,st)]))),128))])])]),_:1},8,["modelValue"])}}};var _t=te(ut,[["__scopeId","data-v-5bde0b16"]]);const ce=t=>(se("data-v-42c91df2"),t=t(),ne(),t),mt={class:"kanban-list-wp"},gt=ce(()=>e("img",{src:Le},null,-1)),bt=ce(()=>e("span",{class:"text-title ellipsis"},"\u65B0\u5EFA\u770B\u677F",-1)),vt=[gt,bt],ft={class:"list-header"},wt={class:"title"},yt={class:"header-manager"},$t={key:0,class:"list-wrap"},kt={class:"list-item-inner"},Ct={class:"list-item-img"},xt={class:"preview-image"},Vt=["src"],Dt={key:1,src:Se,alt:"default",style:{width:"147px",height:"147px"}},It={class:"list-item-mask"},St={class:"action"},jt=T("\u7F16\u8F91\u770B\u677F"),Bt={class:"icon-ctrl pt-10"},Nt=["onClick"],zt=["onClick"],Kt={class:"icon-box"},Lt=["onClick"],Pt=["onClick"],Gt={class:"list-item-info"},Mt={class:"item-title","t-ellipsis":""},Ft={style:{height:"200px"},flex:"main:center cross:center"},Tt=T("\u8BE5\u5206\u7EC4\u4E0B\u6CA1\u6709\u770B\u677F"),Ot={class:"t-center pb-24"},At={props:{group:{type:Object,default:()=>({})}},setup(t){const d=t,v=le(),C=Z(null),s=I({name:"",page:1,size:20}),p=I({rows:[],total:0,loading:!1}),_=I({id:"",pid:"",name:"",directory:"N"}),u=async()=>{try{p.loading=!0;const c=await ye(z({pid:d.group.pid},s));console.log(c),p.rows=(c.rows||[]).map(h=>{let o={};try{o=JSON.parse(h.layout)}catch{o={}}return{id:h.id,name:h.name,status:h.status,pageConfig:o}}),p.total=c.total}catch(c){D("kanban-list/getSearchList",c)}p.loading=!1},n=async c=>{s.page=c,await u()},a=c=>{let h=v.resolve({path:`/screen/${c.id}`});window.open(h.href,"_blank")},w=()=>{_.pid="",_.name="",_.directory="N"},L=c=>{let h=v.resolve({path:"/schema/screen",query:{id:c}});window.open(h.href,"_blank")},O=()=>{C.value&&C.value.openCreate()},H=c=>{w(),_.id=c.id,_.pid=c.pid,_.name=c.name,_.directory=c.directory,L(c.id)},J=async c=>{try{const h=await $e(c.id);h.name=`${h.name}_copy`,delete h.id,await ke(h),await u(),j.success("\u590D\u5236\u6210\u529F\uFF01")}catch(h){D("kanban-list/handleCopy",h)}},A=async c=>{if(c.status!=="audited")try{await Ce(c.id),await u(),j.success("\u53D1\u5E03\u6210\u529F\uFF01")}catch(h){D("kanban-list/handlePublish",h)}},W=c=>{ee.confirm({type:"error",title:"\u5220\u9664\u540E\u65E0\u6CD5\u6062\u590D\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F"}).then(async()=>{try{await xe(c),await u(),j.success("\u5220\u9664\u6210\u529F\uFF01")}catch(h){D("kanban-list/removeDashboard",h)}}).catch(()=>{})};return De(()=>d.group,()=>{s.page=1,u()},{immediate:!0,deep:!0}),(c,h)=>{const o=k("b-input"),r=k("b-button"),V=k("iconfont"),P=k("b-tag"),E=k("svg-loading"),q=k("b-empty"),R=k("b-page");return b(),y(B,null,[e("div",mt,[e("div",{class:"new-box",onClick:O},vt),e("div",ft,[e("div",wt,[e("h2",null,m(t.group?t.group.name:"")+" ("+m(i(p).total)+")",1)]),e("div",yt,[g(o,{modelValue:i(s).name,"onUpdate:modelValue":h[0]||(h[0]=f=>i(s).name=f),size:"small",placeholder:"\u641C\u7D22",search:"",onSearch:u},null,8,["modelValue"])])]),i(p).loading?de("",!0):(b(),y("ul",$t,[(b(!0),y(B,null,M(i(p).rows,f=>(b(),y("li",{key:f.id,class:"base-list-item"},[e("div",kt,[e("div",Ct,[e("div",xt,[f.pageConfig.bgImage?(b(),y("img",{key:0,src:f.pageConfig.bgImage,alt:""},null,8,Vt)):(b(),y("img",Dt))]),e("div",It,[e("div",St,[g(r,{type:"primary",icon:"edit-square",onClick:N=>H(f)},{default:$(()=>[jt]),_:2},1032,["onClick"]),e("div",Bt,[e("i",{class:"b-iconfont b-icon-file-copy",onClick:N=>J(f),title:"\u590D\u5236"},null,8,Nt),e("i",{class:"b-iconfont b-icon-delete",onClick:N=>W(f.id),title:"\u5220\u9664"},null,8,zt)])]),e("div",Kt,[e("i",{class:"b-iconfont b-icon-View",onClick:N=>a(f),title:"\u9884\u89C8"},null,8,Lt),e("i",{class:"b-iconfont b-icon-send",onClick:N=>A(f),title:"\u53D1\u5E03"},null,8,Pt)])])]),e("div",Gt,[e("div",Mt,[g(V,{icon:"linechart"}),e("span",null,m(f.name),1)]),g(P,{type:f.status==="audited"?"success":"primary",dot:"","tag-style":{color:"#999"}},{default:$(()=>[T(m(f.status==="audited"?"\u5DF2\u53D1\u5E03":"\u5F85\u53D1\u5E03"),1)]),_:2},1032,["type"])])])]))),128))])),F(e("div",Ft,[g(E,{name:"loading02",width:100})],512),[[X,i(p).loading]]),F(g(q,null,{default:$(()=>[Tt]),_:1},512),[[X,!i(p).loading&&i(p).rows.length===0]]),F(e("div",Ot,[g(R,{total:i(p).total,current:i(s).page,"page-size":i(s).size,onChange:n},null,8,["total","current","page-size"])],512),[[X,!i(p).loading&&i(p).total>i(s).size]])]),g(_t,{ref_key:"createRef",ref:C},null,512)],64)}}};var Et=te(At,[["__scopeId","data-v-42c91df2"]]);const qt={name:"AnalysisDashboard",components:{KanbanList:Et},setup(){return z({},Ke())}},re=t=>(se("data-v-abf4d4dc"),t=t(),ne(),t),Rt={class:"kanban-wrapper"},Ut={class:"kanban-main"},Ht={class:"folder-manage"},Jt={class:"folder-manage-group"},Wt=re(()=>e("span",null,"\u770B\u677F\u5206\u7EC4",-1)),Yt={class:"folder-manage-main"},Qt=re(()=>e("span",null,"\u7F3A\u7701\u76EE\u5F55",-1)),Xt=[Qt],Zt={key:0,class:"folder-item new-group"},es=["onClick"],ts=["default-value","onBlur","onKeyup"],ss={class:"folder-name"},ns={class:"group-btns"},os=["onClick"],as=["onClick"],is={class:"right-list"};function ls(t,d,v,C,s,p){const _=k("kanban-list"),u=Ie("focus");return b(),y("div",Rt,[e("div",Ut,[e("div",Ht,[e("div",Jt,[Wt,e("i",{class:"b-iconfont b-icon-plus btn-add-icon",title:"\u65B0\u589E\u6587\u4EF6\u5939",onClick:d[0]||(d[0]=n=>t.adding=!0)})]),e("div",Yt,[e("div",{class:K(["folder-item folder-all",{"folder-item-checked-color":t.selectedPid==="1"}]),onClick:d[1]||(d[1]=n=>t.toggleProject({id:"1",name:"\u7F3A\u7701\u76EE\u5F55"}))},Xt,2),t.adding?(b(),y("div",Zt,[F(e("input",{class:"edit-input",onBlur:d[2]||(d[2]=(...n)=>t.onAddInputBlur&&t.onAddInputBlur(...n)),onKeyup:d[3]||(d[3]=ie((...n)=>t.addGroup&&t.addGroup(...n),["enter"]))},null,544),[[u]])])):de("",!0),(b(!0),y(B,null,M(t.folderList,n=>(b(),y("div",{key:n.id,class:K(["folder-item",{"folder-item-checked-color":t.selectedPid===n.id}]),onClick:a=>t.toggleProject(n)},[n.editing?F((b(),y("input",{key:0,"default-value":n.name,class:"edit-input",onBlur:a=>t.onEditInputBlur(a,n),onKeyup:ie(a=>t.editGroup(a,n),["enter"])},null,40,ts)),[[u]]):(b(),y(B,{key:1},[e("span",ss,m(n.name),1),e("span",ns,[e("i",{class:"b-iconfont b-icon-edit",title:"\u7F16\u8F91",onClick:a=>n.editing=!0},null,8,os),e("i",{class:"b-iconfont b-icon-delete",title:"\u5220\u9664",onClick:a=>t.confirmDeleteGroup(n)},null,8,as)])],64))],10,es))),128))])]),e("div",is,[g(_,{group:{pid:t.selectedPid,name:t.selectedName}},null,8,["group"])])])])}var gs=te(qt,[["render",ls],["__scopeId","data-v-abf4d4dc"]]);export{gs as default};
