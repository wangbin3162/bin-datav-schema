import{ax as F,l as I,o as g,a as S,g as E,a5 as Se,aM as ct,m as T,G as pe,n as fe,H as k,f as z,w as x,c as u,F as X,e as N,j as P,b as a,t as Z,A as he,a1 as f,O as ge,h as W,k as le,Y as it,M as ye,S as $t,a3 as rt,aO as Vt,P as oe,ac as Mt,z as Dt,I as It,s as te,d as Ne,v as ze,az as $e,$ as Tt,E as be,V as Bt,aI as Ce,aJ as xe,D as Ve,C as Lt,N as dt,a0 as Rt,aP as Nt,aQ as zt,a6 as Et,T as Ot,u as We}from"./vendor-302fa4a4.js";import{e as Y,z as Me,A as Ee,s as Ut,t as Oe,v as At,j as Gt,B as Ue,q as ue,D as Q,E as ee,M as ie,F as J,u as Pt,b as De,f as Ae,G as ut,H as Fe,J as qe,K as Yt,L as Ze,N as Qe,O as re,a as jt,P as Kt,w as Xt,k as Jt,Q as Ht,R as Wt,T as Ft,U as qt,n as Zt}from"./index-435da3e0.js";import{M as H,a as me,s as Qt,b as eo}from"./chunk-bin-ui-next-e3768e6e.js";import{a as to,g as mt,b as oo}from"./database.api-0cf32549.js";import{d as ao,a as no}from"./file-helper-e95db66d.js";import{s as so,l as lo}from"./template.api-1901bd93.js";import{d as Ge,a as co,u as io,r as ro,g as uo,m as mo,b as po,c as vo}from"./images.api-1928ae0c.js";import{p as _o,m as fo}from"./select-options-04fab100.js";import"./chunk-brace-b1f520b9.js";const ho={name:"HeadLoading",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{toolbar:n}=t(o);return{loading:I(()=>n.value.loading)}}};function go(o,t,n,e,l,s){return g(),S("div",{class:E(["loading-indicator",{loading:e.loading}])},null,2)}var yo=F(ho,[["render",go],["__scopeId","data-v-5475ad30"]]);function Pe(){const o=Se(),{schemaStore:t,storeToRefs:n}=Y(),{pageInfo:e,pageConfig:l,comps:s}=n(t);async function d(r="edit"){const c={id:e.value.id||o.query.id,name:e.value.name,pid:e.value.pid,status:r,layout:JSON.stringify(l.value),components:s.value.map(m=>Me(m.apiData)?{name:m.alias,componentType:m.componentType,componentContent:JSON.stringify(m),componentDataType:Ee.static,modelId:"",x:[],y:[],drill:[],filters:[]}:{name:m.alias,componentType:m.componentType,componentDataType:m.apiData.type,modelId:m.apiData.config.modelId,componentContent:JSON.stringify(m),x:m.apiData.config.x,y:m.apiData.config.y,drill:[],filters:[]})};try{return await Ut(c)}catch(m){Oe("userSchemaStore/saveScreenData",m)}return""}async function i(){let r={};try{t.setGlobalLoading(!0);const c={pageInfo:{id:e.value.id,name:e.value.name||"\u770B\u677F\u9884\u89C8",pid:e.value.pid||"1"},pageConfig:l.value,comps:s.value};r=await to(c)}catch{r={}}return t.setGlobalLoading(!1),r}return{saveScreenData:d,previewScreen:i}}const bo={name:"save-screen",props:{modelValue:{type:Boolean},status:{type:String,default:"edit",validator:o=>["edit","audited"].includes(o)}},emits:["update:modelValue"],setup(o,t){const n=I({get:()=>o.modelValue,set:C=>t.emit("update:modelValue",C)}),{schemaStore:e,storeToRefs:l}=Y(),{pageInfo:s}=l(e),{saveScreenData:d}=Pe(),i=ct(),r=Se(),c=T([]),m=T(null),h=T(!1),p=I(()=>window.location.origin+At(`/#/screen/${r.query.id}`));Gt().then(C=>{c.value=C.data?[C.data]:[]});const _=I(()=>o.status==="edit"?"\u4FDD\u5B58\u770B\u677F":"\u53D1\u5E03\u770B\u677F"),y=()=>{m.value.validate(async C=>{if(C){let $="";try{h.value=!0,$=await d(o.status)}catch(w){Oe("save-screes/saveKanban",w)}s.value.id=$,h.value=!1,n.value=!1,H.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0});let b=i.resolve({path:"/schema/screen",query:{id:$}});window.location.replace(b.href)}})},v=()=>{fe(()=>{Ue(p.value)&&H.success("\u590D\u5236\u53D1\u5E03\u5730\u5740\u6210\u529F!")})};return pe(()=>o.modelValue,C=>{C&&fe(()=>{m.value&&m.value.resetFields()})}),{formRef:m,pageInfo:s,dirTree:c,loading:h,visible:n,saveKanban:y,btnText:_,shareUrl:p,copyUrl:v}}},Co={class:"t-center"};function xo(o,t,n,e,l,s){const d=k("b-input"),i=k("b-form-item"),r=k("g-input"),c=k("b-button"),m=k("b-form"),h=k("b-modal");return g(),z(h,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=p=>e.visible=p),"append-to-body":"",title:e.btnText,top:"200px","custom-class":"schema-modal",onClose:t[3]||(t[3]=p=>e.visible=!1)},{default:x(()=>[u(m,{"label-width":"80px",ref:"formRef",model:e.pageInfo,"label-suffix":":"},{default:x(()=>[u(i,{label:"\u770B\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u770B\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:x(()=>[u(d,{modelValue:e.pageInfo.name,"onUpdate:modelValue":t[0]||(t[0]=p=>e.pageInfo.name=p)},null,8,["modelValue"])]),_:1}),n.status==="audited"&&o.$route.query.id?(g(),S(X,{key:0},[u(i,{label:"\u9884\u89C8\u5730\u5740"},{default:x(()=>[u(r,{modelValue:e.shareUrl,"onUpdate:modelValue":t[1]||(t[1]=p=>e.shareUrl=p),readonly:"",type:"textarea",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),u(i,null,{default:x(()=>[u(c,{type:"text",onClick:e.copyUrl},{default:x(()=>[N("\u590D\u5236\u9884\u89C8\u5730\u5740")]),_:1},8,["onClick"])]),_:1})],64)):P("",!0)]),_:1},8,["model"]),a("div",Co,[u(c,{type:"primary",onClick:e.saveKanban,loading:e.loading,style:{width:"200px"}},{default:x(()=>[N(Z(e.btnText),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["modelValue","title"])}var wo=F(bo,[["render",xo]]);const ko={name:"save-template",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,t){const{schemaStore:n,storeToRefs:e}=Y(),{pageConfig:l,comps:s}=e(n),d=T(null),i=he({loading:!1,id:`temp_${ue()}`,name:""}),r=I({get:()=>o.modelValue,set:p=>t.emit("update:modelValue",p)}),c=I(()=>({template:{id:i.id,name:i.name},pageConfig:l.value,comps:s.value})),m=()=>{d.value&&d.value.validate(async p=>{if(p){const _=c.value,y=JSON.stringify(_);ao(y,`${_.template.id}.json`),H.success({message:"\u6A21\u677F\u6587\u4EF6\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})},h=async()=>{d.value&&d.value.validate(async p=>{if(p){try{i.loading=!0;const _=c.value,y=_.template.name,v=JSON.stringify(_);await so({name:y,content:v})}catch(_){Oe("save-template/saveAsTemplate",_)}i.loading=!1,r.value=!1,H.success({message:"\u6A21\u677F\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})};return pe(()=>o.modelValue,p=>{p&&(d.value&&d.value.resetFields(),i.id=`temp_${ue()}`)}),{formRef:d,formStatus:i,visible:r,downloadCfg:m,saveAsTemplate:h}}},So={class:"t-center"};function $o(o,t,n,e,l,s){const d=k("b-input"),i=k("b-form-item"),r=k("b-form"),c=k("b-button"),m=k("b-modal");return g(),z(m,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=h=>e.visible=h),"append-to-body":"",title:"\u4FDD\u5B58\u4E3A\u6A21\u677F",top:"200px","custom-class":"schema-modal",onClose:t[2]||(t[2]=h=>e.visible=!1)},{default:x(()=>[u(r,{"label-width":"80px",ref:"formRef",model:e.formStatus,"label-suffix":":"},{default:x(()=>[u(i,{label:"\u6A21\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:x(()=>[u(d,{modelValue:e.formStatus.name,"onUpdate:modelValue":t[0]||(t[0]=h=>e.formStatus.name=h)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a("div",So,[u(c,{type:"primary",icon:"vertical-align-botto",transparent:"",style:{width:"120px"},onClick:e.downloadCfg},{default:x(()=>[N(" \u914D\u7F6E\u6587\u4EF6 ")]),_:1},8,["onClick"]),u(c,{type:"primary",icon:"save",style:{width:"120px"},loading:e.formStatus.loading,onClick:e.saveAsTemplate},{default:x(()=>[N(" \u4FDD\u5B58\u6A21\u677F ")]),_:1},8,["loading","onClick"])])]),_:1},8,["modelValue"])}var Vo=F(ko,[["render",$o]]);const Mo={class:"header-container"},Do={class:"left-actions"},Io={class:"screen-info"},To=a("span",null,"\u5206\u6790\u770B\u677F",-1),Bo=a("span",{style:{padding:"0 8px"}},"-",-1),Lo={class:"global-actions"},Ro={class:"head-btn"},No={__name:"index",props:{backUrl:{type:String},backTarget:{type:String,default:"_self",validator:o=>["_self","_blank"].includes(o)},pageStatus:{type:Object,default:()=>({})}},setup(o,{expose:t}){const n=o,e=ct(),{schemaStore:l,storeToRefs:s}=Y(),{pageInfo:d,toolbar:i}=s(l),{previewScreen:r}=Pe(),c=T(!1),m=T("edit"),h=T(!1),p=()=>{const $=n.backUrl||"/";if(n.backTarget==="_blank"){const b=e.resolve($);window.open(b.href,n.backTarget)}else me.confirm({type:"warning",title:"\u786E\u5B9A\u8FD4\u56DE\u5217\u8868\u5417\uFF1F"}).then(()=>{e.push($),l.clearStore()}).catch(()=>{})},_=$=>$.type!=="application/json"?(H.warning("\u8BF7\u9009\u62E9\u6B63\u786E\u7684json\u914D\u7F6E\u6587\u4EF6"),!1):(no($).then(b=>{try{const w=JSON.parse(b),{comps:V,pageConfig:O}=w;l.loadScreenData({comps:V,pageConfig:O})}catch{console.warn("The imported file could not be converted to the correct JSON!")}}),!1),y=()=>{m.value="edit",c.value=!0},v=()=>{m.value="audited",c.value=!0},C=async()=>{const $=await r();let b=e.resolve({path:`/screen/preview/${$.pageInfo.id}`});window.open(b.href,"_blank")};return t({handleSaveScreen:y,handlePublish:v,handPreview:C}),($,b)=>{const w=k("b-icon"),V=k("b-tooltip"),O=k("b-space"),L=k("b-upload");return g(),S(X,null,[a("div",Mo,[a("div",Do,[u(O,{size:"mini"},{default:x(()=>[u(V,{content:"\u7EC4\u4EF6","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:f(i).components}]),onClick:b[0]||(b[0]=U=>f(l).toggleCompsPanel())},[u(w,{name:"hourglass",class:E(["com-list-icon",{"is-rotate":!f(i).components}])},null,8,["class"])],2)]),_:1}),u(V,{content:"\u56FE\u5C42","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:f(i).layer}]),onClick:b[1]||(b[1]=U=>f(l).toggleLayerPanel())},[u(w,{name:"container"})],2)]),_:1}),u(V,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:f(i).config}]),onClick:b[2]||(b[2]=U=>f(l).toggleConfigPanel())},[u(w,{name:"control"})],2)]),_:1}),u(V,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:f(i).toolbox}]),onClick:b[3]||(b[3]=U=>f(l).toggleToolbox())},[u(w,{name:"shopping"})],2)]),_:1})]),_:1})]),a("div",Io,[u(V,{content:"\u8FD4\u56DE","open-delay":500},{default:x(()=>[u(w,{name:"laptop",type:"button",onClick:p})]),_:1}),To,Bo,a("span",null,Z(f(d).name),1)]),a("div",Lo,[u(O,{size:"mini"},{default:x(()=>[u(V,{content:"\u5BFC\u5165json (\u4F1A\u8986\u76D6\u6240\u6709\u5185\u5BB9\uFF01)","open-delay":500},{default:x(()=>[u(L,{action:"/","show-upload-list":!1,"before-upload":_},{default:x(()=>[a("div",Ro,[u(w,{name:"Import"})])]),_:1})]),_:1}),u(V,{content:"\u4FDD\u5B58\u6A21\u677F","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:b[4]||(b[4]=U=>h.value=!0)},[u(w,{name:"Storedprocedure"})])]),_:1}),u(V,{content:"\u4FDD\u5B58","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:y},[u(w,{name:"save"})])]),_:1}),u(V,{content:"\u53D1\u5E03","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:v},[u(w,{name:"send"})])]),_:1}),u(V,{content:"\u9884\u89C8","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:C},[u(w,{name:"View"})])]),_:1})]),_:1})])]),u(yo),u(wo,{modelValue:c.value,"onUpdate:modelValue":b[5]||(b[5]=U=>c.value=U),status:m.value},null,8,["modelValue","status"]),u(Vo,{modelValue:h.value,"onUpdate:modelValue":b[6]||(b[6]=U=>h.value=U)},null,8,["modelValue"])],64)}}},_e=he({x:0,y:0});function Ye(o={}){const{schemaStore:t,storeToRefs:n}=Y(),{contextMenu:e,selectedCom:l}=n(t),s=I(()=>{var m;return(m=l.value)==null?void 0:m.locked}),d=I(()=>{var m;return(m=l.value)==null?void 0:m.hided}),i=I(()=>({display:e.value.show?"block":"none",left:`${_e.x+10}px`,top:`${_e.y+10}px`,transform:document.documentElement.clientHeight-_e.y<250?"translate(0px, -100%)":""})),r=m=>{m.preventDefault(),l.value&&(_e.x=m.clientX,_e.y=m.clientY,e.value.show=!0,Q(document,"click",c))},c=()=>{ee(document,"click",c),o&&o.beforeClose&&o.beforeClose(),e.value.show=!1};return{showMenu:r,isLocked:s,isHided:d,contextMenu:e,contextMenuStyle:i}}const zo={class:"layer-panel"},Eo={class:"layer-top"},Oo=a("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),Uo=a("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),Ao=[Uo],Go={class:"layer-toolbar layer-toolbar-top"},Po={class:"layer-manager-wrap"},Yo=["title","onMousedown","onMouseenter","onDblclick"],jo=["onUpdate:modelValue"],Ko={key:1,class:"layer-item-span"},Xo={class:"layer-item-text"},Jo=["title","onClick"],Ho=["title","onClick"],Wo={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{comps:e,toolbar:l,hoveredComId:s,selectedCom:d,renamingComId:i,isMultiSelect:r,selectedComs:c}=n(t),{showMenu:m}=Ye(),h=I(()=>!!d.value),p=I(()=>({opacity:d.value?1:.3}));function _(j){return r.value?c.value.map(D=>D.id).includes(j.id):!Me(d.value)&&d.value.id===j.id}const y=I({get:()=>[...e.value].reverse(),set:j=>e.value=j.reverse()}),v=j=>{d.value&&t.moveCom({id:d.value.id,moveType:j})},C=()=>v(ie.up),$=()=>v(ie.down),b=()=>v(ie.top),w=()=>v(ie.bottom),V=j=>t.hoverCom(j),O=()=>t.hoverCom(""),L=j=>{const D=e.value.find(A=>A.id===j);D&&t.selectCom(D)},U=()=>t.selectCom();return(j,D)=>{const A=k("b-icon"),B=ge("focus");return g(),S("div",{class:E(["layer-panel-wp",{"is-hide":!f(l).layer}])},[a("div",zo,[a("div",Eo,[Oo,a("div",{class:"layer-action",onClick:D[0]||(D[0]=M=>f(t).toggleLayerPanel(!1))},Ao)]),a("div",Go,[a("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:E(["b-iconfont b-icon-arrowup toolbar-icon standard",f(h)]),style:W(f(p)),onClick:C},null,6),a("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:E(["b-iconfont b-icon-arrowdown toolbar-icon standard",f(h)]),style:W(f(p)),onClick:$},null,6),a("i",{title:"\u7F6E\u9876",class:E(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",f(h)]),style:W({transform:"rotate(180deg)",...f(p)}),onClick:b},null,6),a("i",{title:"\u7F6E\u5E95",class:E(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",f(h)]),style:W(f(p)),onClick:w},null,6)]),a("div",Po,[u(f(Vt),$t({modelValue:f(y),"onUpdate:modelValue":D[4]||(D[4]=M=>rt(y)?y.value=M:null),class:"drag-area","item-key":"id"},{animation:200}),{item:x(({element:M})=>[a("div",{title:M.alias,class:E(["layer-manager-item",[{hided:M.hided,locked:M.locked,hovered:M.id===f(s),selected:_(M)}]]),onMousedown:R=>L(M.id),onMouseenter:R=>V(M.id),onMouseleave:O,onDblclick:R=>f(t).renamingCom(M.id),onContextmenu:D[3]||(D[3]=R=>f(m)(R))},[u(A,{name:M.icon,size:"18"},null,8,["name"]),M.id===f(i)?le((g(),S("input",{key:0,"onUpdate:modelValue":R=>M.alias=R,class:"layer-item-input",onBlur:D[1]||(D[1]=R=>f(t).renamingCom("")),onKeydown:D[2]||(D[2]=ye(R=>f(t).renamingCom(""),["enter"]))},null,40,jo)),[[it,M.alias,void 0,{trim:!0}],[B]]):(g(),S("span",Ko,[a("span",Xo,Z(M.alias),1)])),a("i",{class:E(["b-iconfont",`b-icon-${M.hided?"eye-close":"eye"}`,"show-toggle-btn"]),title:M.hided?"\u663E\u793A":"\u9690\u85CF",onClick:R=>M.hided=!M.hided},null,10,Jo),a("i",{class:E(["b-iconfont",`b-icon-${M.locked?"lock":"unlock"}`,"show-toggle-btn"]),title:M.locked?"\u89E3\u9501":"\u9501\u5B9A",onClick:R=>M.locked=!M.locked},null,10,Ho)],42,Yo)]),_:1},16,["modelValue"]),a("div",{class:"last-flex-item",onClick:U})])])],2)}}},Fo={name:"VBasicBar",alias:"\u67F1\u56FE",img:J("basic-bar.svg")},qo={name:"VHorizontalBar",alias:"\u6761\u5F62\u56FE",img:J("hori-basic-bar.svg")},Zo={name:"VCapsuleBar",alias:"\u80F6\u56CA\u67F1\u56FE",img:J("capsule-bar.svg")},Qo={name:"VBasicLine",alias:"\u6298\u7EBF\u56FE",img:J("basic-line.svg")},ea={name:"VBasicArea",alias:"\u533A\u57DF\u56FE",img:J("basic-area.svg")},ta={name:"VBasicPie",alias:"\u997C\u56FE",img:J("basic-pie.svg")},oa={name:"VBasicRing",alias:"\u73AF\u56FE",img:J("basic-ring.svg")},aa={name:"VBasicRadar",alias:"\u96F7\u8FBE\u56FE",img:J("basic-radar.svg")},na={name:"VBasicMap",alias:"\u4E2D\u56FD\u5730\u56FE",img:J("2d-china.svg")},sa={name:"VBasicMapEvo",alias:"\u6CB3\u5317\u7701\u5730\u56FE",img:J("basic-map-evo.svg")},la={name:"VBasicScatter",alias:"\u6563\u70B9\u56FE",img:J("basic-scatter.svg")},ca={name:"VLineBasicScatter",alias:"\u6563\u70B9\u7EBF\u56FE",img:J("line-basic-scatter.svg")},ia={name:"VBasicBoxplot",alias:"\u76D2\u987B\u56FE",img:J("basic-boxplot.svg")},ra={name:"VBasicFunnel",alias:"\u68AF\u5EA6\u56FE",img:J("basic-funnel.svg")},da={name:"VBasicWordCloud",alias:"\u8BCD\u4E91\u56FE",img:J("basic-wordcloud.svg")},ua={name:"VBasicGauge",alias:"\u4EEA\u8868\u76D8",img:J("basic-gauge.svg")},ma={name:"VProgressCircle",alias:"\u8FDB\u5EA6\u73AF",img:J("pie-one-value.svg")},pa={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:J("number-title-flop.svg")},va={name:"VTimer",alias:"\u65F6\u95F4\u5668",img:J("timer.svg")},_a={name:"VSelect",alias:"\u4E0B\u62C9\u63A7\u4EF6",img:J("select.svg")},fa={name:"VMainTitle",alias:"\u6807\u9898",img:J("main-title.svg")},ha={name:"VBgBox",alias:"\u80CC\u666F\u5757",img:J("bg-box.svg")},ga={name:"VBorderBox",alias:"\u8FB9\u6846",img:J("border-box.svg")},ya={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:J("img.svg")},ba={name:"VScrollTable",alias:"\u6EDA\u52A8\u8868\u683C",img:J("scroll-table.svg")},ke=[{type:"basic",name:"\u57FA\u7840",icon:"block",group:[],comps:[fa,ha,ya,ga]},{type:"analysis",name:"\u5206\u6790",icon:"barchart",group:[{name:"\u6307\u6807",comps:[pa,ma]},{name:"\u67F1\u56FE",comps:[Fo,qo,Zo]},{name:"\u7EBF\u56FE",comps:[Qo,ea]},{name:"\u997C\u56FE",comps:[ta,oa]},{name:"\u6563\u70B9\u56FE",comps:[la,ca]},{name:"\u96F7\u8FBE\u56FE",comps:[aa]},{name:"\u5730\u56FE",comps:[na,sa]},{name:"\u5176\u4ED6\u56FE\u8868",comps:[ia,ra,da,ua]}],comps:[]},{type:"control",name:"\u63A7\u4EF6",icon:"edit-square",group:[],comps:[_a,va]},{type:"table",name:"\u8868\u683C",icon:"table",group:[],comps:[ba]},{type:"images",name:"\u56FE\u7247",icon:"image",group:[],comps:[]},{type:"comps",name:"\u7EC4\u4EF6",icon:"CodeSandbox",group:[],comps:[]}];function Ca(o){const t=[];return ke.forEach(n=>{t.push(...n.comps),n.group.forEach(e=>{t.push(...e.comps)})}),t.find(n=>n.name===o)}const xa={key:0,class:"comp-wrap"},wa=["title"],ka={class:"inner"},Sa=["onDragstart","onClick"],$a=["src"],Va={class:"comp-item-text"},Ma={__name:"comps",props:{comps:{type:Array,default:()=>[]}},emits:["dragstart","click"],setup(o,{emit:t}){const n=(l,s)=>t("dragstart",l,s),e=l=>t("click",l);return(l,s)=>o.comps.length>0?(g(),S("div",xa,[(g(!0),S(X,null,oe(o.comps,(d,i)=>(g(),S("div",{class:"comp-item",key:i,title:d.alias},[a("div",ka,[a("div",{class:"comp-item-img",draggable:!0,onDragstart:r=>n(r,d.name),onClick:r=>e(d.name)},[a("img",{src:d.img},null,8,$a)],40,Sa),a("div",Va,Z(d.alias),1)])],8,wa))),128))])):P("",!0)}};var et=F(Ma,[["__scopeId","data-v-23a6401e"]]);function je(){const o=Mt(),t=T("");function n(e){t.value===e?t.value="":t.value=e}o.on("item-click",n),Dt("collapse",{activeGroupKey:t,collapseMitt:o})}function Da(o){const t=It("collapse"),n=t==null?void 0:t.collapseMitt,e=I(()=>(t==null?void 0:t.activeGroupKey.value)===o.name);function l(s){n==null||n.emit("item-click",s)}return{isActive:e,triggerClick:l}}const Ia={class:"collapse-group"},Ta={class:"name"},Ba={class:"wrap-label"},La={key:1},Ra={key:0,class:"wrap-edit"},Na=["onClick"],za=["onClick"],Ea={class:"content"},Oa={__name:"collapse",props:{title:{type:String,required:!0},name:{type:[String,Number,Object],required:!0},canEdit:{type:Boolean,default:!1}},emits:["edit","remove"],setup(o,{emit:t}){const n=o,{isActive:e,triggerClick:l}=Da(n),s=T(!1),d=T("");let i="";function r(){l(n.name)}function c(){s.value=!0,d.value=n.title,i=n.title}function m(y){const v=(y.target.value||"").trim();(!v||v===i)&&(s.value=!1)}function h(y){(y.target.value||"").trim()?p():s.value=!1}function p(){s.value=!1,t("edit",d.value)}const _=()=>t("remove");return(y,v)=>{const C=k("b-input"),$=k("b-icon"),b=k("b-collapse-transition"),w=ge("focus");return g(),S("div",Ia,[a("div",{class:E(["header",[{active:f(e)}]]),flex:"cross:center",onClick:r},[a("div",Ta,[a("div",Ba,[s.value?(g(),S("div",{key:0,class:"create-box",onClick:v[1]||(v[1]=te(()=>{},["stop"]))},[le(u(C,{modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=V=>d.value=V),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"mini",style:{width:"150px",top:"-2px"},onBlur:m,onKeyup:ye(h,["enter"])},null,8,["modelValue","onKeyup"]),[[w]])])):(g(),S("div",La,Z(o.title),1))]),o.canEdit&&!s.value?(g(),S("span",Ra,[a("i",{class:"b-iconfont b-icon-edit",onClick:te(c,["stop"])},null,8,Na),a("i",{class:"b-iconfont b-icon-delete",onClick:te(_,["stop"])},null,8,za)])):P("",!0),a("span",{class:E(["wrap-arrow",[{active:f(e)}]])},[u($,{name:"right",size:"12"})],2)])],2),u(b,null,{default:x(()=>[le(a("div",Ea,[Ne(y.$slots,"default",{},void 0,!0)],512),[[ze,f(e)]])]),_:3})])}}};var Ke=F(Oa,[["__scopeId","data-v-ead41a62"]]);const Ua={class:"group-comps"},Aa={class:"comp-wrap"},Ga={key:0,class:"comp-item img-add"},Pa={class:"inner"},Ya={class:"comp-item-img"},ja={class:"inner"},Ka=["onDragstart","onClick"],Xa={key:0,class:"hover-layer"},Ja=["onClick"],Ha=["title"],Wa={__name:"images-item",props:{groupId:{type:String,required:!0}},emits:["dragstart","click"],setup(o,{emit:t}){const n=o,e=T([]),l=I(()=>!Ge.includes(n.groupId)),s=()=>co(n.groupId).then(m=>e.value=m);s();async function d(m){try{const h=m.map(p=>({group:n.groupId,name:p.name,attr:{w:p.width,h:p.height},src:p.image}));await io(h),s()}catch(h){console.log(h)}}async function i({group:m,id:h}){try{await ro(m,h),s()}catch(p){console.log(p)}}const r=(m,h)=>t("dragstart",m,h),c=m=>t("click",m);return(m,h)=>{const p=k("g-upload"),_=ge("lazy");return g(),S("div",Ua,[a("div",Aa,[f(l)?(g(),S("div",Ga,[a("div",Pa,[a("div",Ya,[u(p,{onUpload:d,multiple:""})])])])):P("",!0),(g(!0),S(X,null,oe(e.value,(y,v)=>(g(),S("div",{class:"comp-item",key:v},[a("div",ja,[a("div",{class:E(["comp-item-img",{"can-edit":f(l)}]),draggable:!0,onDragstart:C=>r(C,y),onClick:C=>c(y)},[le(a("img",null,null,512),[[_,y.src]]),f(l)?(g(),S("div",Xa,[a("i",{class:"b-iconfont b-icon-delete-fill",title:"\u5220\u9664\u56FE\u7247",onClick:te(C=>i(y),["stop"])},null,8,Ja)])):P("",!0)],42,Ka),a("div",{class:"comp-item-text",title:JSON.stringify(y,null,2)},Z(y.name),9,Ha)])]))),128))])])}}};var Fa=F(Wa,[["__scopeId","data-v-a4ed4280"]]);const qa={class:"group-wrap"},Za={class:"group-list"},Qa={key:0,class:"create-box"},en={class:"create-group"},tn={__name:"images-list",emits:["dragstart","click"],setup(o,{emit:t}){const n=T([]);je();const e=T({key:"",value:""}),l=he({create:!1,edit:!1}),s=()=>uo().then(_=>n.value=_);s();function d(){e.value={key:`group_images_${ue()}`,value:""},l.create=!0}function i(_){if(!l.create)return;(_.target.value||"").trim()?m():l.create=!1}async function r(_,y){try{const v={key:_.key,value:y};await mo(v),s(),H.success("\u4FEE\u6539\u6210\u529F")}catch(v){console.log(v)}}async function c(_){try{await me.confirm({type:"error",title:"\u786E\u5B9A\u79FB\u9664\u5F53\u524D\u56FE\u7247\u5206\u7EC4\u5417\uFF1F"}),await po(_.key),s(),H.success("\u5220\u9664\u6210\u529F\uFF01")}catch(y){console.log(y)}}async function m(){try{await vo(e.value),s(),l.create=!1,H.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(_){console.log(_)}}const h=(_,y)=>t("dragstart",_,y),p=_=>t("click",_);return(_,y)=>{const v=k("b-input"),C=k("b-scrollbar"),$=k("b-button"),b=ge("focus");return g(),S("div",qa,[a("div",Za,[u(C,{native:""},{default:x(()=>[(g(!0),S(X,null,oe(n.value,w=>(g(),z(Ke,{key:w.key,name:w.key,title:w.value,"can-edit":!f(Ge).includes(w.key),onEdit:V=>r(w,V),onRemove:V=>c(w)},{default:x(()=>[u(Fa,{"group-id":w.key,onDragstart:h,onClick:p},null,8,["group-id"])]),_:2},1032,["name","title","can-edit","onEdit","onRemove"]))),128)),l.create?(g(),S("div",Qa,[le(u(v,{modelValue:e.value.value,"onUpdate:modelValue":y[0]||(y[0]=w=>e.value.value=w),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"small",onBlur:i,onKeyup:ye(i,["enter"])},null,8,["modelValue","onKeyup"]),[[b]])])):P("",!0)]),_:1})]),a("div",en,[u($,{type:"primary",transparent:"",onClick:d},{default:x(()=>[N("\u521B\u5EFA\u56FE\u7247\u5206\u7EC4")]),_:1})])])}}};var on=F(tn,[["__scopeId","data-v-a34a578e"]]);const pt=[];pt.map(o=>o.key);const vt="COMPS_GROUP",_t="COMPS_LIB",Ie=async()=>$e.getItem(vt),Te=async o=>$e.setItem(vt,De(o)),Xe=async()=>$e.getItem(_t),Re=async o=>$e.setItem(_t,De(o));async function ft(){try{const o=await Ie();if(o)return o;const t=De(pt);return await Te(t),t}catch{return[]}}async function an(o){try{const t=await Ie();return t?(t.push(o),await Te(t),!0):!1}catch{return!1}}async function nn(o){try{const t=await Ie();if(t){const n=Ae(t,o.key,"key");return t[n].value=o.value,await Te(t),o.key}return!1}catch{return!1}}async function sn(o){try{const t=await Ie();if(t){const n=Ae(t,o,"key");return t.splice(n,1),await Te(t),!0}return!1}catch{return!1}}async function ln(o,t){try{const n={id:Pt(),group:o,comp:t},e=await Xe();return e?(e.push(n),await Re(e),!0):(await Re([n]),!1)}catch{return!1}}async function cn(o){try{const t=await Xe();return t?t.filter(n=>n.group===o):[]}catch{return[]}}async function rn(o,t){try{const n=await Xe();if(n){const e=n.filter(s=>s.group===o),l=Ae(e,t);return e.splice(l,1),await Re(e),!0}return!1}catch{return!1}}const dn={class:"group-comps"},un={key:1,class:"comp-wrap"},mn={class:"inner"},pn=["onDragstart","onClick"],vn={class:"hover-layer"},_n=["onClick"],fn={class:"comp-item-text"},hn={__name:"comp-item",props:{groupId:{type:String,required:!0}},emits:["dragstart","click"],setup(o,{emit:t}){const n=o,e=T([]),l=()=>cn(n.groupId).then(r=>e.value=r);l();async function s({group:r,id:c}){try{await rn(r,c),l()}catch(m){console.log(m)}}const d=(r,c)=>t("dragstart",r,c),i=r=>t("click",r);return(r,c)=>{const m=k("b-empty"),h=k("b-icon");return g(),S("div",dn,[e.value.length===0?(g(),z(m,{key:0},{default:x(()=>[N("\u6682\u65E0\u7EC4\u4EF6")]),_:1})):(g(),S("div",un,[(g(!0),S(X,null,oe(e.value,(p,_)=>(g(),S("div",{class:"comp-item",key:_},[a("div",mn,[a("div",{class:"comp-item-img",draggable:!0,onDragstart:y=>d(y,p.comp),onClick:y=>i(p.comp)},[u(h,{name:p.comp.icon,size:"25"},null,8,["name"]),a("div",vn,[a("i",{class:"b-iconfont b-icon-delete-fill",title:"\u5220\u9664\u56FE\u7247",onClick:te(y=>s(p),["stop"])},null,8,_n)])],40,pn),a("div",fn,Z(p.comp.alias),1)])]))),128))]))])}}};var gn=F(hn,[["__scopeId","data-v-7a2d079b"]]);const yn={class:"group-wrap"},bn={class:"group-list"},Cn={key:1,class:"create-box"},xn={class:"create-group"},wn={__name:"comp-list",emits:["dragstart","click"],setup(o,{emit:t}){const n=T([]);je();const e=T({key:"",value:""}),l=he({create:!1,edit:!1}),s=()=>ft().then(_=>n.value=_);s();function d(){e.value={key:`group_comp_${ue()}`,value:""},l.create=!0}function i(_){if(!l.create)return;(_.target.value||"").trim()?m():l.create=!1}async function r(_,y){try{const v={key:_.key,value:y};await nn(v),s(),H.success("\u4FEE\u6539\u6210\u529F")}catch(v){console.log(v)}}async function c(_){try{await me.confirm({type:"error",title:"\u786E\u5B9A\u79FB\u9664\u5F53\u524D\u7EC4\u4EF6\u5E93\u5417\uFF1F"}),await sn(_.key),s(),H.success("\u5220\u9664\u6210\u529F\uFF01")}catch(y){console.log(y)}}async function m(){try{await an(e.value),s(),l.create=!1,H.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(_){console.log(_)}}const h=(_,y)=>t("dragstart",_,y),p=_=>t("click",_);return(_,y)=>{const v=k("b-empty"),C=k("b-input"),$=k("b-scrollbar"),b=k("b-button"),w=ge("focus");return g(),S("div",yn,[a("div",bn,[u($,{native:""},{default:x(()=>[n.value.length===0?(g(),z(v,{key:0},{default:x(()=>[N("\u6682\u65E0\u7EC4\u4EF6\u5E93")]),_:1})):P("",!0),(g(!0),S(X,null,oe(n.value,V=>(g(),z(Ke,{key:V.key,name:V.key,title:V.value,"can-edit":!f(Ge).includes(V.key),onEdit:O=>r(V,O),onRemove:O=>c(V)},{default:x(()=>[u(gn,{"group-id":V.key,onDragstart:h,onClick:p},null,8,["group-id"])]),_:2},1032,["name","title","can-edit","onEdit","onRemove"]))),128)),l.create?(g(),S("div",Cn,[le(u(C,{modelValue:e.value.value,"onUpdate:modelValue":y[0]||(y[0]=V=>e.value.value=V),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"small",onBlur:i,onKeyup:ye(i,["enter"])},null,8,["modelValue","onKeyup"]),[[w]])])):P("",!0)]),_:1})]),a("div",xn,[u(b,{type:"primary",transparent:"",onClick:d},{default:x(()=>[N("\u521B\u5EFA\u7EC4\u4EF6\u5E93")]),_:1})])])}}};var kn=F(wn,[["__scopeId","data-v-2cb89c32"]]);const Sn={class:"components-panel-wp"},$n={class:"components-panel"},Vn=a("div",{class:"panel-title"},[a("span",{class:"panel-text"},"\u7EC4\u4EF6")],-1),Mn={class:"components-type"},Dn=["onClick"],In={class:"com-tab-title"},Tn=a("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),Bn=[Tn],Ln={class:"components-list-content"},Rn={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,toolbar:l,selectedCom:s}=n(t),d=T(-1);je();const i=I(()=>d.value===-1?[]:ke[d.value].group),r=I(()=>d.value===-1?[]:ke[d.value].comps);function c(b){t.toggleCompsPanel(!0),d.value=b}function m(b,w){b.dataTransfer.setData("normal-comp",w)}async function h(b){try{const w=ut(b);if(w.attr.x=Math.floor((e.value.width-w.attr.w)/2),w.attr.y=Math.floor((e.value.height-w.attr.h)/2),t.addCom({component:w}),t.selectCom(w),w.apiData&&w.apiData.type===Ee.static&&w.apiData.staticPath){const{data:V}=await mt(w.id,w.apiData.staticPath);s.value.apiData.config.data=JSON.stringify(V)}}catch(w){console.log(w)}}function p(b,w){b.dataTransfer.setData("image-comp",JSON.stringify(Fe(w)))}function _(b){const w=Fe(b);w.attr.x=Math.floor((e.value.width-w.attr.w)/2),w.attr.y=Math.floor((e.value.height-w.attr.h)/2),t.addCom({component:w}),t.selectCom(w)}function y(b,w){b.dataTransfer.setData("custom-comp",JSON.stringify(qe(w)))}function v(b){const w=qe(b);t.addCom({component:w}),t.selectCom(w)}function C(b){b.preventDefault(),b.stopPropagation(),b.dataTransfer.dropEffect="none"}function $(){l.value.components&&(t.toggleCompsPanel(!1),d.value=-1)}return(b,w)=>{const V=k("b-icon"),O=k("b-scrollbar");return g(),S("div",Sn,[a("div",$n,[Vn,a("div",{class:"components-panel-content",onDragover:C},[a("div",Mn,[u(O,{native:""},{default:x(()=>[(g(!0),S(X,null,oe(f(ke),(L,U)=>(g(),S("div",{class:E(["components-item",{active:d.value===U}]),key:U,onClick:j=>c(U)},[u(V,{class:"com-tab-icon",name:L.icon},null,8,["name"]),a("span",In,Z(L.name),1)],10,Dn))),128))]),_:1})])],32),a("div",{class:E(["components-list",{"is-hide":!f(l).components}])},[a("div",{class:"components-list-top"},[a("div",{class:"action",onClick:$},Bn)]),a("div",Ln,[u(O,{native:""},{default:x(()=>[(g(!0),S(X,null,oe(f(i),(L,U)=>(g(),z(Ke,{key:U,name:U,title:L.name},{default:x(()=>[u(et,{comps:L.comps,onDragstart:m,onClick:h},null,8,["comps"])]),_:2},1032,["name","title"]))),128)),u(et,{comps:f(r),onDragstart:m,onClick:h},null,8,["comps"]),d.value===4?(g(),z(on,{key:0,onDragstart:p,onClick:_})):P("",!0),d.value===5?(g(),z(kn,{key:1,onDragstart:y,onClick:v})):P("",!0)]),_:1})])],2)])])}}},tt=o=>`${o}px`,ot=(o,t,n,e)=>{const l=o!=null?o:document.createElement("canvas");l.width=t*e,l.height=n*e,l.style.width=tt(t),l.style.height=tt(n);const s=l.getContext("2d");return s&&s.setTransform(e,0,0,e,0,0),l};class at{constructor(t,n){this.el=t,this.options={direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2,...n},this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:n}=this,{direction:e,width:l,height:s,ratio:d}=n,i=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,l),r=s;this.ruler.width=i,this.ruler.height=r;const c=ot(null,i,r,d);Yt(c,"canvas-ruler"),t.appendChild(c),this.canvas=c,this.ctx=c.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:n,ruler:e}=this,{width:l,height:s}=e;t.beginPath(),t.fillStyle=n.bgColor,t.fillRect(0,0,l,s),t.closePath(),t.beginPath(),t.font=`${n.fontSize} ${n.fontFamily}`,t.textAlign="left",t.fillStyle=n.fontColor,t.strokeStyle=n.strokeStyle,t.lineWidth=n.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:n,ruler:e}=this,{width:l,height:s}=e,{offset:d,scale:i}=n,r=0,c=s/1.5,m=s/1.2;for(let h=0;h<=l;h+=1){const p=h-d;if(p<0)continue;let _=-1,y=-1;p%50===0?(_=Math.floor(p/i),y=r):p%25===0?y=c:p%5===0&&(y=m),y>=0&&(t.moveTo(h+.5,s+.5),t.lineTo(h+.5,y),_>-1&&t.fillText(`${_}`,h+2.5,s/1.5))}}setSize(t,n,e){const{el:l,options:s}=this;s.width=t,s.height=n,s.scale=e;const{direction:d,width:i,height:r,ratio:c}=s,m=Math.max(d==="TB"?l.offsetWidth:l.offsetHeight,i),h=r;this.ruler.width=m,this.ruler.height=h,ot(this.canvas,m,h,c),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const Nn={name:"ruler",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{canvas:n}=t(o),e=T(null),l=T(null),s=T(null),d=T(null),i=T(!0),r=T(0),c=T(0),m=document.documentElement.clientWidth;Tt(()=>{if(e.value&&l.value){const p=Math.max(n.value.width,m);s.value?s.value.setSize(p,18,n.value.scale):s.value=new at(e.value,{direction:"TB",width:p,scale:n.value.scale}),d.value?d.value.setSize(n.value.height,18,n.value.scale):d.value=new at(l.value,{direction:"LR",width:n.value.height,scale:n.value.scale})}});const h=p=>{const _=p.target;r.value=_.scrollLeft,c.value=_.scrollTop};return be(()=>{const p=document.getElementById("canvas-wp");p==null||p.addEventListener("scroll",h)}),Bt(()=>{const p=document.getElementById("canvas-wp");p==null||p.removeEventListener("scroll",h)}),{visible:i,hRulerWpRef:e,vRulerWpRef:l,vScroll:c,hScroll:r}}},zn=o=>(Ce("data-v-5f454e16"),o=o(),xe(),o),En={class:"canvas-ruler-wp"},On=zn(()=>a("div",{class:"ruler-corner"},null,-1));function Un(o,t,n,e,l,s){return g(),S("div",En,[a("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:W(`transform: translateX(-${e.hScroll}px);`)},null,4),a("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:W(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),On])}var An=F(Nn,[["render",Un],["__scopeId","data-v-5f454e16"]]);function nt(o){if(o={...o},o.rotate!==0){const t=o.width*Ze(o.rotate)+o.height*Qe(o.rotate),n=(o.width-t)/2;o.left+=n,o.right=o.left+t;const e=o.height*Ze(o.rotate)+o.width*Qe(o.rotate),l=(e-o.height)/2;o.top-=l,o.bottom=o.top+e,o.width=t,o.height=e}else o.bottom=o.top+o.height,o.right=o.left+o.width;return o}const Gn=5,Pn={name:"mark-line",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{comps:n,selectedCom:e,canvas:l,toolbox:s}=t(o),d=T([]),i=T(["xt","xc","xb","yl","yc","yr"]),r=T({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),c=()=>{Object.keys(r.value).forEach(C=>{r.value[C]=!1})};function m({key:C,value:$}){const b={left:"x",top:"y"};o.setShapeSingleStyle({key:b[C],value:$})}const h=(C,$)=>{const b=d.value,w=e.value,V=n.value.filter(D=>!D.hided),O=l.value.scale,L=nt(y(w.attr)),U=L.width/2,j=L.height/2;c(),V.forEach(D=>{if(D.id===w.id||D.locked||D.hided)return;const{top:A,left:B,bottom:M,right:R,width:G,height:K}=nt(y(D.attr)),ne=G/2,ce=K/2,ae={top:[{isNearly:v(L.top,A),lineNode:b.xt,line:"xt",dragShift:A,lineShift:A},{isNearly:v(L.bottom,A),lineNode:b.xt,line:"xt",dragShift:A-L.height,lineShift:A},{isNearly:v(L.top+j,A+ce),lineNode:b.xc,line:"xc",dragShift:A+ce-j,lineShift:A+ce},{isNearly:v(L.top,M),lineNode:b.xb,line:"xb",dragShift:M,lineShift:M},{isNearly:v(L.bottom,M),lineNode:b.xb,line:"xb",dragShift:M-L.height,lineShift:M}],left:[{isNearly:v(L.left,B),lineNode:b.yl,line:"yl",dragShift:B,lineShift:B},{isNearly:v(L.right,B),lineNode:b.yl,line:"yl",dragShift:B-L.width,lineShift:B},{isNearly:v(L.left+U,B+ne),lineNode:b.yc,line:"yc",dragShift:B+ne-U,lineShift:B+ne},{isNearly:v(L.left,R),lineNode:b.yr,line:"yr",dragShift:R,lineShift:R},{isNearly:v(L.right,R),lineNode:b.yr,line:"yr",dragShift:R-L.width,lineShift:R}]},ve=[],{rotate:Le}=L;Object.keys(ae).forEach(de=>{ae[de].forEach(se=>{if(!se.isNearly)return;const we=Le!==0?p(de,se,L):se.dragShift;m({key:de,value:we}),se.lineNode.style[de]=`${se.lineShift*O+60}px`,ve.push(se.line)})}),ve.length&&_(ve,C,$)})},p=(C,$,b)=>{const{w,h:V}=e.value.attr;return Math.round(C==="top"?$.dragShift-(V-b.height)/2:$.dragShift-(w-b.width)/2)},_=(C,$,b)=>{b?C.includes("yr")?r.value.yr=!0:C.includes("yc")?r.value.yc=!0:C.includes("yl")&&(r.value.yl=!0):C.includes("yl")?r.value.yl=!0:C.includes("yc")?r.value.yc=!0:C.includes("yr")&&(r.value.yr=!0),$?C.includes("xb")?r.value.xb=!0:C.includes("xc")?r.value.xc=!0:C.includes("xt")&&(r.value.xt=!0):C.includes("xt")?r.value.xt=!0:C.includes("xc")?r.value.xc=!0:C.includes("xb")&&(r.value.xb=!0)},y=C=>({left:C.x,top:C.y,width:C.w,height:C.h,rotate:C.rotate}),v=(C,$)=>Math.abs(C-$)<=Gn;return be(()=>{re.on("move",({isDownward:C,isRightward:$})=>{s.value.markLine&&h(C,$)}),re.on("unmove",()=>{c()})}),Ve(()=>{re.off("move"),re.off("unmove")}),{lineRefs:d,lines:i,lineStatus:r}}},Yn={class:"mark-line"};function jn(o,t,n,e,l,s){return g(),S("div",Yn,[(g(!0),S(X,null,oe(e.lines,d=>le((g(),S("div",{key:d,class:E(["line",[d.includes("x")?"xline":"yline",d]]),ref_for:!0,ref:i=>{e.lineRefs[d]=i}},null,2)),[[ze,e.lineStatus[d]||!1]])),128))])}var Kn=F(Pn,[["render",jn],["__scopeId","data-v-00d4450a"]]);const{schemaStore:ht}=Y(),Xn=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],st=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],Jn=o=>{const t=(o+360)%360,n={};let e=-1;return Xn.forEach(l=>{const s=(l.angle+t)%360,d=st.length,i=0;for(;i<d;){e=(e+1)%d;const r=st[e];if(s<23||s>=338){n[l.direction]="nwse-resize";break}if(r.start<=s&&s<r.end){n[l.direction]=r.cursor;break}}}),n};function Hn(o,t,n,e,l,s){o==="t"?(s.h=Math.round(t.h+(n.y-e.y)/l),s.y=Math.round(t.y+(e.y-n.y)/l),s.h=Math.max(s.h,20)):o==="rt"?(s.h=Math.round(t.h+(n.y-e.y)/l),s.w=Math.round(t.w+(e.x-n.x)/l),s.y=Math.round(t.y+(e.y-n.y)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20)):o==="r"?(s.w=Math.round(t.w+(e.x-n.x)/l),s.w=Math.max(s.w,20)):o==="rb"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.w=Math.round(t.w+(e.x-n.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20)):o==="b"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.h=Math.max(s.h,20)):o==="lb"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.w=Math.round(t.w+(n.x-e.x)/l),s.x=Math.round(t.x+(e.x-n.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20)):o==="l"?(s.w=Math.round(t.w+(n.x-e.x)/l),s.x=Math.round(t.x+(e.x-n.x)/l),s.w=Math.max(s.w,20)):o==="lt"&&(s.h=Math.round(t.h+(n.y-e.y)/l),s.w=Math.round(t.w+(n.x-e.x)/l),s.x=Math.round(t.x+(e.x-n.x)/l),s.y=Math.round(t.y+(e.y-n.y)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20))}const gt=(o,t,n,e,l)=>{const s={...n.attr},d=Object.create(null),i=o.clientX,r=o.clientY;let c=!1;const m=p=>{const _=p.clientX,y=p.clientY,v=Math.round((_-i)/e/l)*l,C=Math.round((y-r)/e/l)*l;c=Math.abs(v)>=1||Math.abs(C)>=1,t?Hn(t,s,{x:i,y:r},{x:_,y},e,d):(d.x=s.x+v,d.y=s.y+C),n.attr={...n.attr,...d},fe().then(()=>{re.emit("move",{isDownward:y-r>0,isRightward:_-i>0})})},h=()=>{re.emit("unmove"),c&&ht.recordSnapshot(),ee(document,"mousemove",m),ee(document,"mouseup",h)};Q(document,"mousemove",m),Q(document,"mouseup",h)},Wn=(o,t,n,e)=>{gt(o,null,t,n,e)},Fn=(o,t,n,e,l)=>{gt(o,t,n,e,l)},qn=(o,t,n)=>{const e=t.getBoundingClientRect(),l=e.left+e.width/2,s=e.top+e.height/2,d=Math.atan2(s-o.clientY,l-o.clientX)*180/Math.PI-n.attr.rotate;let i=!1;const r=m=>{i=!0;const h=Math.atan2(s-m.clientY,l-m.clientX)*180/Math.PI-d,p=Math.round(h%360);n.attr.rotate=p<0?p+360:p},c=()=>{i&&ht.recordSnapshot(),ee(document,"mousemove",r),ee(document,"mouseup",c)};Q(document,"mousemove",r),Q(document,"mouseup",c)},Zn={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(o){const t=I(()=>({height:`${o.attr.y+60/o.scale}px`,borderLeftWidth:`${.9/o.scale}px`})),n=I(()=>({width:`${o.attr.x+60/o.scale}px`,borderTopWidth:`${.9/o.scale}px`})),e=I(()=>({fontSize:`${12/o.scale}px`,top:`-${6/o.scale}px`,left:`-${6/o.scale}px`}));return{topLineStyle:t,leftLineStyle:n,accountStyle:e}}},Qn={class:"nav-line"};function es(o,t,n,e,l,s){return g(),S("div",Qn,[a("div",{class:"nav-line-top",style:W(e.topLineStyle)},null,4),a("div",{class:"nav-line-left",style:W(e.leftLineStyle)},null,4),a("div",{class:"nav-line-account",style:W(e.accountStyle)},Z(n.attr.x)+", "+Z(n.attr.y),5)])}var ts=F(Zn,[["render",es]]);const os={name:"dv-transform",components:{ReferLine:ts},props:{data:{type:Object,required:!0}},setup(o){const t=Lt(),{showMenu:n}=Ye(),{schemaStore:e,storeToRefs:l}=Y(),{canvas:s,comps:d,pageConfig:i,selectedCom:r,hoveredComId:c,toolbox:m,spaceDown:h,isMultiSelect:p}=l(e),_=I(()=>c.value===o.data.id),y=I(()=>p.value?!1:!Me(r.value)&&r.value.id===o.data.id),v=I(()=>({locked:o.data.locked,selected:y.value})),C=I(()=>({top:0,left:0,width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`,transform:`translate(${o.data.attr.x}px, ${o.data.attr.y}px)`})),$=I(()=>({"is-hide":!y.value||o.data.locked})),b=I(()=>({transform:`rotate(${o.data.attr.rotate}deg)`})),w=I(()=>({width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`})),V=I(()=>({display:o.data.hided?"none":"block"})),O=I(()=>Jn(o.data.attr.rotate)),L=I(()=>s.value.scale),U=I(()=>{const G=`scale(${1/L.value}, ${1/L.value})`;return{t:{name:"top",style:{cursor:O.value.t,transform:G}},rt:{name:"top-right",style:{cursor:O.value.rt,transform:G}},r:{name:"right",style:{cursor:O.value.r,transform:G}},rb:{name:"bottom-right",style:{cursor:O.value.rb,transform:G}},b:{name:"bottom",style:{cursor:O.value.b,transform:G}},lb:{name:"bottom-left",style:{cursor:O.value.lb,transform:G}},l:{name:"left",style:{cursor:O.value.l,transform:G}},lt:{name:"top-left",style:{cursor:O.value.lt,transform:G}}}}),j=()=>e.hoverCom(o.data.id),D=()=>e.hoverCom(""),A=()=>{e.selectCom(o.data)};return{comps:d,selectedCom:r,hoveredComId:c,toolbox:m,isHovered:_,isSelected:y,hideStyle:V,transformClass:v,transformStyle:C,handlerClass:$,handlerStyle:b,wrapperStyle:w,onEnter:j,onLeave:D,onMove:G=>{h.value||(G.stopPropagation(),G.preventDefault(),A(),!o.data.locked&&Wn(G,o.data,L.value,i.value.grid))},onZoom:(G,K)=>{A(),Fn(G,K,o.data,L.value,i.value.grid)},onRotate:G=>{qn(G,t.vnode.el,o.data)},points:U,scale:L,showMenu:n}}},as={class:"dv-com"},ns=["onMousedown"],ss=["onMousedown"],ls=a("div",{class:"transform-bg"},null,-1),cs={key:1,class:"b-iconfont b-icon-lock",title:"\u89E3\u9501"};function is(o,t,n,e,l,s){const d=k("refer-line");return g(),S("div",{class:E(["dv-transform",e.transformClass]),style:W(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(g(),z(d,{key:0,attr:n.data.attr,scale:e.scale},null,8,["attr","scale"])):P("",!0),a("div",{class:E(["dv-scale",{hovered:e.isHovered}]),style:W(e.hideStyle),onMouseenter:t[2]||(t[2]=(...i)=>e.onEnter&&e.onEnter(...i)),onMouseleave:t[3]||(t[3]=(...i)=>e.onLeave&&e.onLeave(...i)),onMousedown:t[4]||(t[4]=(...i)=>e.onMove&&e.onMove(...i))},[a("div",{class:E(["transform-handler",e.handlerClass]),style:W(e.handlerStyle)},[a("div",as,[Ne(o.$slots,"default"),a("div",{class:"dv-event-disable",style:W(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...i)=>e.showMenu&&e.showMenu(...i))},null,36)]),(g(!0),S(X,null,oe(e.points,(i,r)=>(g(),S(X,{key:r},[i.rotateStyle?(g(),S("i",{key:0,class:E(`${i.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"rotate-handler",style:W(i.rotateStyle),onMousedown:t[1]||(t[1]=te((...c)=>e.onRotate&&e.onRotate(...c),["prevent","stop"]))},[a("span",{class:"control-point",style:W(i.style),onMousedown:te(c=>e.onZoom(c,r),["prevent","stop"])},null,44,ns)],36)],2)):(g(),S("i",{key:1,class:E(`${i.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"control-point",style:W(i.style),onMousedown:te(c=>e.onZoom(c,r),["prevent","stop"])},null,44,ss)],2))],64))),128)),ls],6)],38),n.data.locked?(g(),S("i",cs)):P("",!0)],6)}var rs=F(os,[["render",is]]);const ds=["onClick"],us=["onClick"],ms={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{undoDisable:e,redoDisable:l}=n(t),s=I(()=>t.toolbar.config?{right:"330px"}:{right:0}),d=()=>t.undo(),i=()=>t.redo();return(r,c)=>(g(),S("div",{class:"action-bar-wrap",style:W(f(s))},[a("i",{class:"action-btn b-iconfont b-icon-aim",title:"\u6700\u4F73\u753B\u5E03\u6BD4\u4F8B",onClick:c[0]||(c[0]=te(m=>f(t).autoCanvasScale(),["stop"]))}),a("i",{class:"action-btn b-iconfont b-icon-icon-test",title:"1:1\u753B\u5E03\u5927\u5C0F",onClick:c[1]||(c[1]=te(m=>f(t).setCanvasScale(100),["stop"]))}),a("i",{class:E(["action-btn b-iconfont b-icon-rollback",{disabled:f(e)}]),title:"\u64A4\u9500",onClick:te(d,["stop"])},null,10,ds),a("i",{class:E(["action-btn b-iconfont b-icon-rollback",{disabled:f(l)}]),title:"\u91CD\u505A",onClick:te(i,["stop"]),style:{transform:"rotateY(180deg)"}},null,10,us)],4))}};var ps=F(ms,[["__scopeId","data-v-293a1cf3"]]);const vs=["onMousedown"],_s={__name:"index",props:{x:Number,y:Number,width:Number,height:Number,showArea:Boolean},setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,canvas:l,selectedComs:s,areaData:d}=n(t);function i(r){let c=!1;const m={x:d.value.x,y:d.value.y},h=s.value.map(V=>V.attr),p=Object.create(null),_=[],y=r.clientX,v=r.clientY,C=l.value.scale,$=e.value.grid,b=V=>{const O=V.clientX,L=V.clientY,U=Math.round((O-y)/C/$)*$,j=Math.round((L-v)/C/$)*$;c=Math.abs(U)>=1||Math.abs(j)>=1,p.x=m.x+U,p.y=m.y+j,d.value={...d.value,...p},s.value.forEach((D,A)=>{_[A]={x:h[A].x+U,y:h[A].y+j},D.attr={...D.attr,..._[A]}})},w=()=>{c&&t.recordSnapshot(),ee(document,"mousemove",b),ee(document,"mouseup",w)};Q(document,"mousemove",b),Q(document,"mouseup",w)}return(r,c)=>le((g(),S("div",{style:W({left:o.x+"px",top:o.y+"px",width:o.width+"px",height:o.height+"px"}),class:"select-area",onMousedown:te(i,["stop"])},null,44,vs)),[[ze,o.showArea]])}};var fs=F(_s,[["__scopeId","data-v-8dc9f1ea"]]);const hs={class:"canvas-main"},gs=["onMousedown"],ys={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,spaceDown:l,canvas:s,selectedCom:d,comps:i,toolbox:r,getPanelOffsetLeft:c,getPanelOffsetTop:m,editorEL:h,areaData:p}=n(t),_=T(null),y=he({drag:!1,startX:0,startY:0});let v=0,C=0;const $=I(()=>({width:`${s.value.width}px`,height:`${s.value.height}px`})),b=I(()=>({position:"absolute",width:`${e.value.width}px`,height:`${e.value.height}px`,transform:`scale(${s.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${e.value.bgImage})`,backgroundColor:e.value.bgColor})),w=jt(t.autoCanvasScale,50);async function V(B){B.preventDefault();try{const M=B.dataTransfer.getData("image-comp");if(M){const K=JSON.parse(M);O(B,K);return}const R=B.dataTransfer.getData("custom-comp");if(R){const K=JSON.parse(R);O(B,K);return}const G=B.dataTransfer.getData("normal-comp");if(G){const K=ut(G);if(O(B,K),K.apiData&&K.apiData.type===Ee.static&&K.apiData.staticPath){const{data:ne}=await mt(K.id,K.apiData.staticPath);d.value.apiData.config.data=JSON.stringify(ne)}}}catch(M){console.warn(M)}}function O(B,M){const{scale:R}=s.value,G=(B.clientX-c.value+_.value.scrollLeft)/R,K=(B.clientY-m.value+_.value.scrollTop)/R;M.attr.x=Math.round(G-M.attr.w/2),M.attr.y=Math.round(K-M.attr.h/2),t.addCom({component:M}),t.selectCom(M)}function L(B){B.preventDefault(),B.stopPropagation(),B.dataTransfer.dropEffect="copy"}function U(B){if(l.value){y.drag=!0;const M=B.clientX,R=B.clientY,G=s.value.scale,{scrollLeft:K,scrollTop:ne,clientWidth:ce,scrollWidth:ae,clientHeight:ve,scrollHeight:Le}=_.value,de=ce<ae||ve<Le,se={left:K,top:ne},we=He=>{if(de){const xt=He.clientX,wt=He.clientY,kt=Math.round((xt-M)/G),St=Math.round((wt-R)/G);_.value.scrollLeft=se.left-kt,_.value.scrollTop=se.top-St}},Je=()=>{y.drag=!1,ee(document,"mousemove",we),ee(document,"mouseup",Je)};Q(document,"mousemove",we),Q(document,"mouseup",Je)}else t.selectCom()}function j(B){if(d.value||B.preventDefault(),l.value||B.target.className==="select-area")return;A();const M=h.value.getBoundingClientRect();v=M.x,C=M.y;const R=B.clientX,G=B.clientY;p.value.showArea=!0;const K=s.value.scale;p.value.x=(R-v)/K,p.value.y=(G-C)/K;const ne=ae=>{p.value.width=Math.abs((ae.clientX-R)/K),p.value.height=Math.abs((ae.clientY-G)/K),ae.clientX<R&&(p.value.x=(ae.clientX-v)/K),ae.clientY<G&&(p.value.y=(ae.clientY-C)/K)},ce=ae=>{if(ee(document,"mousemove",ne),ee(document,"mouseup",ce),ae.clientX===R&&ae.clientY===G){A();return}D()};Q(document,"mousemove",ne),Q(document,"mouseup",ce)}function D(){const B=Kt(p.value,i.value);if(B.length===0){A();return}if(B.length===1){t.selectCom(B[0]),A();return}t.multiSelectComs(B)}function A(){p.value.showArea=!1,p.value.width=0,p.value.height=0}return be(()=>{Q(window,"resize",w),re.on("hideArea",A),t.getEditor(),w()}),Ve(()=>{ee(window,"resize",w)}),(B,M)=>(g(),S("div",hs,[a("div",{id:"canvas-wp",ref_key:"canvasWpRef",ref:_,class:"canvas-panel-wrap",onMousedown:te(U,["stop"])},[a("div",{class:"screen-shot",style:W(f($))},[f(r).markLine?(g(),z(Kn,{key:0,style:W(f($))},null,8,["style"])):P("",!0),u(ps),u(An),a("div",{id:"canvas-components",class:"canvas-panel",style:W(f(b)),onDragover:L,onDrop:V,onMousedown:j},[(g(!0),S(X,null,oe(f(i),R=>(g(),z(rs,{key:R.id,data:R},{default:x(()=>[(g(),z(dt(R.name),{data:R,style:W({width:R.attr.w+"px",height:R.attr.h+"px",opacity:R.attr.opacity,transform:"translateZ(0px)"}),id:`component_${R.id}`},null,8,["data","style","id"]))]),_:2},1032,["data"]))),128)),u(fs,Rt(Nt(f(p))),null,16)],36)],4)],40,gs)]))}};async function lt(o){try{return await zt(o,{quality:.7})}catch(t){return console.error(t),""}}const bs={name:"page-config",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{pageConfig:n}=t(o),e=T(""),l=T(!1),s=()=>{n.value.bgColor="#0d2a42",n.value.bgImage=""},d=()=>o.autoCanvasScale(),i=c=>{if(c!=="custom"){const m=c.split("x"),h=+m[0],p=+m[1];o.setScreenSize({width:h,height:p})}};async function r(){H.warning("\u6B63\u5728\u622A\u53D6\u753B\u5E03\u7F29\u7565\u56FE\uFF0C\u8BF7\u52FF\u8FDB\u884C\u5176\u4ED6\u64CD\u4F5C\uFF01"),l.value=!0;const c=document.getElementById("canvas-components");c.style.top=0,c.style.left=0,o.setCanvasScale(100),setTimeout(async()=>{try{const m=await lt(c);n.value.thumbnail=m,H.success("\u622A\u53D6\u7F29\u7565\u56FE\u6210\u529F\uFF01")}catch(m){console.log(m)}c.style.top="60px",c.style.left="60px",o.autoCanvasScale(),l.value=!1},300)}return pe([()=>n.value.width,()=>n.value.height],()=>{const{width:c,height:m}=n.value;c===1920&&m===1080||c===2560&&m===1080||c===3440&&m===1080||c===3440&&m===1440||c===414&&m===736||c===375&&m===667||c===375&&m===812?e.value=`${c}x${m}`:e.value="custom"},{immediate:!0}),{screenLabel:e,onSizeChange:d,resetBGImage:s,pageConfig:n,pageMap:[{group:"web\u7AEF",data:Xt.map(c=>({value:`${c.width}x${c.height}`,label:c.label}))},{group:"\u79FB\u52A8\u8BBE\u5907",data:Jt.map(c=>({value:`${c.width}x${c.height}`,label:c.label}))},{group:"\u5176\u4ED6",data:[{value:"custom",label:"\u81EA\u5B9A\u4E49"}]}],sizeChange:i,createPreviewThumb:lt,createThumb:r,thumbLoading:l}}},yt=o=>(Ce("data-v-fb327818"),o=o(),xe(),o),Cs={class:"page-config-panel"},xs=yt(()=>a("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),ws={class:"page-config-content"},ks={class:"page-config-wp"},Ss={class:"page-config-wp"},$s={class:"page-config-wp"},Vs={class:"image-thumb-wrap"},Ms=["src"],Ds={key:1,class:"tip",flex:"dir:top main:center cross:center"},Is=yt(()=>a("p",null,"\u6682\u672A\u622A\u53D6\u7F29\u7565\u56FE",-1)),Ts={class:"pt-5"};function Bs(o,t,n,e,l,s){const d=k("g-group-select"),i=k("g-field"),r=k("g-input-number"),c=k("g-color-picker"),m=k("g-image"),h=k("b-button"),p=k("b-icon"),_=k("b-scrollbar");return g(),S("div",Cs,[xs,a("div",ws,[u(_,null,{default:x(()=>[a("div",ks,[u(i,{label:"\u5C4F\u5E55\u8BBE\u7F6E"},{default:x(()=>[u(d,{modelValue:e.screenLabel,"onUpdate:modelValue":t[0]||(t[0]=y=>e.screenLabel=y),data:e.pageMap,onChange:e.sizeChange},null,8,["modelValue","data","onChange"])]),_:1}),u(i,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:x(()=>[u(r,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[1]||(t[1]=y=>e.pageConfig.width=y),label:"\u5BBD\u5EA6",min:375,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),u(r,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[2]||(t[2]=y=>e.pageConfig.height=y),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),u(i,{label:"\u80CC\u666F\u989C\u8272"},{default:x(()=>[u(c,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[3]||(t[3]=y=>e.pageConfig.bgColor=y)},null,8,["modelValue"])]),_:1}),u(i,{label:"\u80CC\u666F\u9884\u8BBE",tooltip:"\u53EF\u4EE5\u52A0\u8F7D\u5BF9\u5E94\u9884\u8BBE\u7684\u56FE\u7247\u80CC\u666F"},{default:x(()=>[u(m,{"ignore-group-keys":["header","box","decoration","widget"],"show-resize":!1,modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[4]||(t[4]=y=>e.pageConfig.bgImage=y)},null,8,["modelValue"])]),_:1}),u(i,{label:"\u91CD\u7F6E"},{default:x(()=>[u(h,{type:"primary",size:"small",onClick:e.resetBGImage},{default:x(()=>[N("\u6062\u590D\u9ED8\u8BA4\u80CC\u666F")]),_:1},8,["onClick"])]),_:1})]),a("div",Ss,[u(i,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:x(()=>[u(r,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[5]||(t[5]=y=>e.pageConfig.grid=y),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})]),a("div",$s,[u(i,{label:"\u7F29\u7565\u56FE",tooltip:"\u622A\u53D6\u5F53\u524D\u753B\u5E03\u5B58\u4E3A\u7F29\u7565\u56FE"},{default:x(()=>[a("div",Vs,[e.pageConfig.thumbnail?(g(),S("img",{key:0,src:e.pageConfig.thumbnail,alt:""},null,8,Ms)):(g(),S("div",Ds,[u(p,{name:"image",size:"52"}),Is]))]),a("div",Ts,[u(h,{type:"primary",size:"small",loading:e.thumbLoading,onClick:e.createThumb},{default:x(()=>[N(" \u622A\u53D6 ")]),_:1},8,["loading","onClick"]),u(h,{size:"small",loading:e.thumbLoading,onClick:t[6]||(t[6]=y=>e.pageConfig.thumbnail="")},{default:x(()=>[N(" \u6E05\u9664 ")]),_:1},8,["loading"])])]),_:1})])]),_:1})])])}var Ls=F(bs,[["render",Bs],["__scopeId","data-v-fb327818"]]);const{schemaStore:bt,storeToRefs:Rs}=Y(),{selectedCom:Ns}=Rs(bt),zs={name:"config-title",props:{comName:{type:String},comAlias:{type:String},com:{type:Object,default:()=>({})},showCfg:{type:Boolean,default:!1}},emits:["update:com"],setup(o){const t=T(!1),n=T(""),e=I(()=>{const r=Ca(o.comName);return r?r.name:o.comName}),l=()=>{t.value=!0,n.value=JSON.stringify(o.com,null,2)},s=()=>{Ue(JSON.stringify(o.com)),H.success("\u5DF2\u590D\u5236\u914D\u7F6E\u9879\u81F3\u526A\u5207\u677F"),t.value=!1},d=()=>{try{const r=JSON.parse(n.value);n.value=JSON.stringify(r,null,2),i(r),H.success("\u56FE\u8868\u5E94\u7528\u6210\u529F\uFF01"),t.value=!1}catch{H.error("\u914D\u7F6E\u9879\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u68C0\u67E5\u540E\u518D\u5E94\u7528\u914D\u7F6E\uFF01")}};function i(r){const c=Ns.value.id;bt.replaceCom(c,r)}return{openDetail:l,compJson:n,comTitle:e,copyCom:s,putJson:d,detailVisible:t}}},Es=o=>(Ce("data-v-133b1084"),o=o(),xe(),o),Os={class:"com-title-wp"},Us={class:"com-title"},As={class:"title-name"},Gs={class:"alias-name"},Ps={class:"version-tag"},Ys=Es(()=>a("span",null,"\u914D\u7F6E\u9879",-1)),js={class:"data-editor",style:{margin:"0"}},Ks={class:"t-right pt-8"};function Xs(o,t,n,e,l,s){const d=k("b-icon"),i=k("b-ace-editor"),r=k("b-button"),c=k("b-modal");return g(),S("div",Os,[a("div",Us,[a("div",As,[a("span",Gs,Z(n.comAlias),1)]),a("div",Ps,[a("span",null,Z(e.comTitle),1)])]),Ne(o.$slots,"default",{},()=>[n.showCfg?(g(),S("div",{key:0,class:"search-config",onClick:t[0]||(t[0]=(...m)=>e.openDetail&&e.openDetail(...m)),title:"\u67E5\u770B\u914D\u7F6E\u9879"},[u(d,{name:"filesearch",size:"14"}),Ys])):P("",!0)],!0),u(c,{modelValue:e.detailVisible,"onUpdate:modelValue":t[2]||(t[2]=m=>e.detailVisible=m),title:`[${n.comAlias}] \u914D\u7F6E\u9879 `,"append-to-body":"",top:"60px","custom-class":"schema-modal"},{default:x(()=>[a("div",js,[u(i,{modelValue:e.compJson,"onUpdate:modelValue":t[1]||(t[1]=m=>e.compJson=m),theme:"tomorrow_night",wrap:"",styles:{border:"none"}},null,8,["modelValue"])]),a("div",Ks,[u(r,{size:"small",type:"primary",icon:"snippets",onClick:e.putJson},{default:x(()=>[N("\u5E94\u7528\u914D\u7F6E\u9879")]),_:1},8,["onClick"]),u(r,{size:"small",type:"primary",icon:"file-copy",onClick:e.copyCom},{default:x(()=>[N(" \u590D\u5236\u914D\u7F6E\u9879 ")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"])])}var Be=F(zs,[["render",Xs],["__scopeId","data-v-133b1084"]]);const Js={name:"data-center-panel",components:{ConfigTitle:Be,SourcePanel:Ht(()=>Et(()=>import("./source-panel-0013fbc8.js"),["static/js/source-panel-0013fbc8.js","static/css/source-panel-9456a5cd.css","static/js/vendor-302fa4a4.js","static/css/vendor-2b79d43b.css","static/js/chunk-brace-b1f520b9.js","static/js/index-435da3e0.js","static/css/index-8c23cec7.css","static/js/chunk-bin-ui-next-e3768e6e.js","static/css/chunk-bin-ui-next-233b4550.css"]))},setup(){const{schemaStore:o,storeToRefs:t}=Y(),{selectedCom:n}=t(o),e=I(()=>Object.keys(n.value.apiData));return{selectedCom:n,dataKeys:e}}},Hs={class:"data-center-panel"},Ws={class:"scroll-container"},Fs={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"};function qs(o,t,n,e,l,s){const d=k("config-title"),i=k("source-panel"),r=k("b-empty"),c=k("b-scrollbar");return g(),S("div",Hs,[u(d,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),a("div",Ws,[u(c,{native:""},{default:x(()=>[e.dataKeys.length>0?(g(),z(i,{key:0})):(g(),S("div",Fs,[u(r,null,{default:x(()=>[N("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E")]),_:1})]))]),_:1})])])}var Zs=F(Js,[["render",qs]]);const Qs={class:"basic-setting-wp"},Ct={__name:"basic-setting",props:{attr:{type:Object,required:!0},readonly:{type:Boolean,default:!1}},emits:["update:attr"],setup(o,{emit:t}){const n=o,e=I({get:()=>n.attr,set:r=>t("update:attr",r)}),{schemaStore:l,storeToRefs:s}=Y(),{curComIsGroup:d,isMultiSelect:i}=s(l);return(r,c)=>{const m=k("g-input-number"),h=k("g-field"),p=k("g-slider"),_=k("b-button"),y=k("b-button-group");return g(),S("div",Qs,[u(h,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{default:x(()=>[u(m,{modelValue:f(e).w,"onUpdate:modelValue":c[0]||(c[0]=v=>f(e).w=v),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(m,{modelValue:f(e).h,"onUpdate:modelValue":c[1]||(c[1]=v=>f(e).h=v),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),u(h,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:x(()=>[u(m,{modelValue:f(e).x,"onUpdate:modelValue":c[2]||(c[2]=v=>f(e).x=v),label:"X",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(m,{modelValue:f(e).y,"onUpdate:modelValue":c[3]||(c[3]=v=>f(e).y=v),label:"Y",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),f(i)?P("",!0):(g(),z(h,{key:0,label:"\u65CB\u8F6C\u89D2\u5EA6"},{default:x(()=>[u(p,{modelValue:f(e).rotate,"onUpdate:modelValue":c[4]||(c[4]=v=>f(e).rotate=v),min:0,max:360,step:1},null,8,["modelValue"])]),_:1})),f(i)||f(d)?P("",!0):(g(),z(h,{key:1,label:"\u900F\u660E\u5EA6"},{default:x(()=>[u(p,{modelValue:f(e).opacity,"onUpdate:modelValue":c[5]||(c[5]=v=>f(e).opacity=v),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})),f(i)?P("",!0):(g(),z(h,{key:2,label:"\u4F4D\u7F6E"},{default:x(()=>[u(y,null,{default:x(()=>[(g(!0),S(X,null,oe(f(_o),v=>(g(),z(_,{key:v.value,size:"mini",title:v.label,onClick:C=>f(l).doAdsorption(v.value)},{default:x(()=>[a("i",{class:E(`iconfont-align b-icon-${v.value}-vs`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})),f(i)?(g(),z(h,{key:3,label:"\u5BF9\u9F50"},{default:x(()=>[u(y,null,{default:x(()=>[(g(!0),S(X,null,oe(f(fo),v=>(g(),z(_,{key:v.value,size:"mini",title:v.label,onClick:C=>f(l).doAlign(v.value)},{default:x(()=>[a("i",{class:E(`iconfont-align b-icon-${v.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})):P("",!0),f(i)||f(d)?(g(),z(h,{key:4,label:"\u7EC4\u5408\u62C6\u5206"},{default:x(()=>[u(y,null,{default:x(()=>[u(_,{size:"mini",icon:"group",disabled:!f(i),onClick:c[6]||(c[6]=v=>f(l).group())},{default:x(()=>[N(" \u7EC4\u5408 ")]),_:1},8,["disabled"]),u(_,{size:"mini",icon:"ungroup",disabled:!f(d),onClick:c[7]||(c[7]=v=>f(l).ungroup())},{default:x(()=>[N(" \u62C6\u5206 ")]),_:1},8,["disabled"])]),_:1})]),_:1})):P("",!0)])}}},el={class:"setting-panel"},tl={class:"setting-panel-content"},ol={class:"scroll-container"},al={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{selectedCom:e}=n(t);return(l,s)=>{const d=k("b-scrollbar");return g(),S("div",el,[u(Be,{"com-name":f(e).name,"com-alias":f(e).alias,com:f(e),"show-cfg":""},null,8,["com-name","com-alias","com"]),a("div",tl,[a("div",ol,[u(d,null,{default:x(()=>[(g(),z(Ct,{key:`${f(e).id}'_basic-setting`,attr:f(e).attr},null,8,["attr"])),(g(),z(dt(f(e).name+"Config"),{key:f(e).id,data:f(e)},null,8,["data"]))]),_:1})])])])}}},nl={class:"setting-panel"},sl={class:"setting-panel-content"},ll={class:"scroll-container"},cl={__name:"multi-setting",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{areaData:e}=n(t),l=I(()=>e.value.showArea),s=I(()=>({x:e.value.x,y:e.value.y,w:e.value.width,h:e.value.height}));return(d,i)=>{const r=k("b-scrollbar");return g(),S("div",nl,[u(Be,{"com-alias":"\u591A\u9009\u533A\u57DF"}),a("div",sl,[a("div",ll,[u(r,null,{default:x(()=>[u(Ct,{attr:f(s),readonly:f(l)},null,8,["attr","readonly"])]),_:1})])])])}}},il={style:{margin:"-16px",padding:"10px"}},rl={__name:"EventParamsModal",props:{modelValue:{type:Boolean,default:!1},params:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:t}){const n=o,e=I({get:()=>n.modelValue,set:s=>t("update:modelValue",s)}),l=[{title:"\u53C2\u6570\u540D",key:"desc"},{title:"\u53C2\u6570Key",key:"name"},{title:"\u53C2\u6570\u7C7B\u578B",key:"type"}];return(s,d)=>{const i=k("b-table"),r=k("b-modal");return g(),z(r,{modelValue:f(e),"onUpdate:modelValue":d[0]||(d[0]=c=>rt(e)?e.value=c:null),title:"\u53C2\u6570\u4FE1\u606F",width:"750px","append-to-body":"","custom-class":"schema-modal"},{default:x(()=>[a("div",il,[u(i,{columns:l,data:o.params,size:"small",border:""},null,8,["data"])])]),_:1},8,["modelValue"])}}},dl={flex:"main:justify cross:center"},ul={__name:"trigger-config",props:{eventList:{type:Array,default:()=>Wt},events:{type:Object,default:()=>({})}},setup(o){const t=o,n=I(()=>t.events),e=I(()=>{let i=!1;return t.eventList.forEach(r=>{if(!Me(n.value[r])){i=!0;return}}),i}),l=T([]),s=T(!1);function d(i){l.value=i,s.value=!0}return(i,r)=>{const c=k("b-checkbox"),m=k("b-button"),h=k("g-field"),p=k("g-field-collapse");return f(e)?(g(),z(p,{key:0,label:"\u89E6\u53D1\u4E8B\u4EF6","default-open":""},{default:x(()=>[(g(!0),S(X,null,oe(o.eventList,_=>(g(),S(X,{key:_},[f(n)[_]?(g(),z(h,{key:0,label:f(n)[_].name},{default:x(()=>[a("div",dl,[u(c,{modelValue:f(n)[_].enable,"onUpdate:modelValue":y=>f(n)[_].enable=y},null,8,["modelValue","onUpdate:modelValue"]),u(m,{type:"text",title:"\u67E5\u770B\u4E8B\u4EF6\u53C2\u6570",onClick:y=>d(f(n)[_].params)},{default:x(()=>[N(" \u67E5\u770B ")]),_:2},1032,["onClick"])])]),_:2},1032,["label"])):P("",!0)],64))),128)),u(rl,{modelValue:s.value,"onUpdate:modelValue":r[0]||(r[0]=_=>s.value=_),params:l.value},null,8,["modelValue","params"])]),_:1})):P("",!0)}}},ml={class:"series-title",style:{top:"-8px"}},pl={style:{width:"50%","padding-right":"8px"}},vl={style:{width:"50%","padding-right":"8px"}},_l={key:0,style:{"min-height":"80px"},flex:"main:center cross:center"},fl={__name:"response-config",props:{compId:{type:String,default:""},events:{type:Object,default:()=>({})}},setup(o){const t=o,n=I(()=>t.events),e=I(()=>Object.keys(n.value).includes("onEvents")),l=I(()=>Ft.value.filter(h=>h.compId!==t.compId).map(h=>({value:h.compId,label:h.compName}))),s=I(()=>{const h=n.value.actions;return Object.keys(h).map(p=>({value:p,label:h[p].title}))});function d(h){return qt.value.filter(p=>p.eventName.includes(h)).map(p=>({value:p.eventName,label:p.title}))}function i(){n.value.onEvents.push({eventSource:"",eventName:"",actionName:"",actionParams:[],register:!1})}function r(h){if(h.eventSource===""){H.warning("\u8BF7\u9009\u62E9\u4E8B\u4EF6\u6E90\uFF01");return}if(h.eventName===""){H.warning("\u8BF7\u7ED1\u5B9A\u4E8B\u4EF6\uFF01");return}if(h.actionName===""){H.warning("\u8BF7\u7ED1\u5B9A\u52A8\u4F5C\uFF01");return}h.register=!0}function c(h,p){p.register?p.register=!1:n.value.onEvents.splice(h,1)}function m(h,p){const _=n.value.actions[h];_&&(p.actionParams=De(_.params))}return(h,p)=>{const _=k("b-icon"),y=k("b-button"),v=k("g-select"),C=k("g-field"),$=k("g-field-collapse");return f(e)?(g(),z($,{key:0,label:"\u54CD\u5E94\u4E8B\u4EF6","default-open":""},{add:x(()=>[u(y,{type:"text",title:"\u65B0\u589E\u4E00\u4E2A\u54CD\u5E94\u4E8B\u4EF6",onClick:i},{default:x(()=>[u(_,{name:"plus",size:"16"})]),_:1})]),default:x(()=>[(g(!0),S(X,null,oe(f(n).onEvents,(b,w)=>(g(),z(C,{key:w,label:"\u4E8B\u4EF6","label-width":"85px",flat:""},{label:x(()=>[a("div",ml,[a("span",null,"\u4E8B\u4EF6"+Z(w+1),1)])]),default:x(()=>[u(v,{modelValue:b.eventSource,"onUpdate:modelValue":V=>b.eventSource=V,data:f(l),disabled:b.register,label:"\u4E8B\u4EF6\u6E90"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),b.eventSource!==""?(g(),S(X,{key:0},[u(v,{modelValue:b.eventName,"onUpdate:modelValue":V=>b.eventName=V,data:d(b.eventSource),disabled:b.register,inline:"",label:"\u7ED1\u5B9A\u4E8B\u4EF6"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),u(v,{modelValue:b.actionName,"onUpdate:modelValue":V=>b.actionName=V,data:f(s),disabled:b.register,inline:"",label:"\u7ED1\u5B9A\u52A8\u4F5C",onChange:V=>m(b.actionName,b)},null,8,["modelValue","onUpdate:modelValue","data","disabled","onChange"])],64)):P("",!0),a("span",pl,[u(y,{size:"small",style:{width:"100%"},type:"primary",disabled:b.register,onClick:V=>r(b)},{default:x(()=>[N(" \u6CE8\u518C\u4E8B\u4EF6 ")]),_:2},1032,["disabled","onClick"])]),a("span",vl,[u(y,{size:"small",style:{width:"100%"},onClick:V=>c(w,b)},{default:x(()=>[N(Z(b.register?"\u53D6\u6D88":"\u5220\u9664"),1)]),_:2},1032,["onClick"])])]),_:2},1024))),128)),f(n).onEvents.length===0?(g(),S("div",_l," \u6682\u65E0\u54CD\u5E94\u4E8B\u4EF6 ")):P("",!0)]),_:1})):P("",!0)}}},hl={class:"events-panel"},gl={class:"events-panel-content"},yl=a("div",{class:"data-result-title"},"\u4E8B\u4EF6\u914D\u7F6E",-1),bl={class:"scroll-container"},Cl={class:"setting-panel-gui"},xl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{selectedCom:e}=n(t),l=I(()=>e.value.events);return(s,d)=>{const i=k("b-scrollbar");return g(),S("div",hl,[u(Be,{"com-name":f(e).name,"com-alias":f(e).alias,com:f(e)},null,8,["com-name","com-alias","com"]),a("div",gl,[yl,a("div",bl,[u(i,null,{default:x(()=>[a("div",Cl,[u(ul,{events:f(l)},null,8,["events"]),u(fl,{events:f(l),"comp-id":f(e).id},null,8,["events","comp-id"])])]),_:1})])])])}}},wl={class:"config-panel"},kl={key:0,class:"page-config-panel"},Sl={class:"page-config-top"},$l={class:"tabs-wrapper"},Vl={key:0,class:"page-config-content"},Ml={key:1,class:"page-config-content"},Dl={style:{height:"100%"}},Il={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{toolbar:e,selectedCom:l,isMultiSelect:s}=n(t),d=T(0),i=r=>{s.value&&r>0||d.value!==r&&(d.value=r)};return pe(()=>l.value,()=>{d.value=0}),(r,c)=>{const m=k("b-icon"),h=k("b-tooltip");return g(),S("div",{class:E(["config-panel-wp",{"is-hide":!f(e).config}])},[a("div",wl,[f(l)||f(s)?(g(),S("div",kl,[a("div",Sl,[a("div",$l,[a("div",{class:E(["tab-item",{active:d.value===0}]),onClick:c[0]||(c[0]=p=>i(0))},[u(h,{content:"\u914D\u7F6E"},{default:x(()=>[u(m,{name:"control",size:"20"})]),_:1})],2),a("div",{class:E(["tab-item",{active:d.value===1}]),onClick:c[1]||(c[1]=p=>i(1))},[u(h,{content:"\u6570\u636E"},{default:x(()=>[u(m,{name:"cloud-server",size:"22"})]),_:1})],2),a("div",{class:E(["tab-item",{active:d.value===2}]),onClick:c[2]||(c[2]=p=>i(2))},[u(h,{content:"\u4E8B\u4EF6"},{default:x(()=>[u(m,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),f(s)?(g(),S("div",Vl,[u(cl)])):(g(),S("div",Ml,[a("div",Dl,[d.value===0?(g(),z(al,{key:f(l).id})):P("",!0),d.value===1?(g(),z(Zs,{key:f(l).id})):P("",!0),d.value===2?(g(),z(xl,{key:f(l).id})):P("",!0)])]))])):(g(),z(Ls,{key:1}))])],2)}}};const Tl={class:"toolbox-panel",flex:"main:justify"},Bl={style:{width:"500px"},flex:""},Ll=a("i",{class:"action-btn b-iconfont b-icon-rollback"},null,-1),Rl=a("i",{class:"action-btn b-iconfont b-icon-rollback",style:{transform:"rotateY(180deg)"}},null,-1),Nl=a("div",null,null,-1),zl={class:"btn-box"},El={class:"btn-box"},Ol={class:"ctrl-box",flex:"cross:center"},Ul={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{toolbar:e,toolbox:l,undoDisable:s,redoDisable:d}=n(t),i=T(!1),r=T(null),c=()=>{me.confirm({type:"error",title:"\u786E\u8BA4\u6E05\u7A7A\u753B\u5E03\u5417\uFF1F\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"}).then(()=>{t.clearScreen()}).catch(()=>{})},m=()=>t.undo(),h=()=>t.redo();function p(){i.value=!0,fe(()=>{r.value&&r.value.addEventListener("paste",_),r.value.focus(),r.value.placeholder="\u7C98\u8D34\u56FE\u8868\u914D\u7F6E"})}function _(y){const v=y.clipboardData.getData("Text");try{const C=JSON.parse(v);((C==null?void 0:C.type)==="com"||(C==null?void 0:C.type)==="group")&&(C.id=`${C.name}_${ue()}`,C.name==="Group"&&C.components.forEach($=>{$.id=`${$.name}_${ue()}`}),t.addCom({component:C}),H.success("\u7C98\u8D34\u56FE\u8868\u6210\u529F\uFF01"))}catch(C){console.log(C),H.error("\u7C98\u8D34\u7684\u5185\u5BB9\u4E0D\u662F\u56FE\u8868\u7EC4\u4EF6\uFF01")}setTimeout(()=>{r.value.value="",i.value=!1,r.value.removeEventListener("paste",_)},100)}return(y,v)=>{const C=k("b-button"),$=k("b-switch");return g(),S("div",{class:E(["toolbox-panel-wp",{"is-hide":!f(e).toolbox}])},[a("div",Tl,[a("div",Bl,[u(C,{size:"mini",disabled:f(s),onClick:m},{default:x(()=>[Ll,N(" \u64A4\u9500 ")]),_:1},8,["disabled"]),u(C,{size:"mini",disabled:f(d),onClick:h},{default:x(()=>[Rl,N(" \u91CD\u505A ")]),_:1},8,["disabled"]),Nl,a("div",zl,[N(" \u53C2\u8003\u7EBF\xA0\xA0 "),u($,{modelValue:f(l).referLine,"onUpdate:modelValue":v[0]||(v[0]=b=>f(l).referLine=b),size:"small"},null,8,["modelValue"])]),a("div",El,[N(" \u5BF9\u9F50\u7EBF\xA0\xA0 "),u($,{modelValue:f(l).markLine,"onUpdate:modelValue":v[1]||(v[1]=b=>f(l).markLine=b),size:"small"},null,8,["modelValue"])])]),a("div",Ol,[N(" \xA0\xA0 "),i.value?(g(),S("textarea",{key:0,class:"paste-inner",ref_key:"textpasteRef",ref:r},null,512)):(g(),z(C,{key:1,size:"mini",icon:"diff",onClick:p},{default:x(()=>[N("\u7C98\u8D34\u56FE\u8868")]),_:1})),u(C,{size:"mini",icon:"clear",onClick:c},{default:x(()=>[N("\u6E05\u7A7A\u753B\u5E03")]),_:1})])])],2)}}};const Al={name:"shortcut",props:{modelValue:{type:Boolean}},emits:["update:modelValue"]},Gl=o=>(Ce("data-v-7e8e628e"),o=o(),xe(),o),Pl=Gl(()=>a("div",{class:"shortcut-wp"},[a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u57FA\u7840\u5FEB\u6377\u952E"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2190")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u914D\u7F6E\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u7EC4\u4EF6\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2191")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u5DE5\u5177\u680F"),a("div",{class:"shortcut-value"},"Ctrl + \u2193")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u590D\u5236\u9009\u4E2D\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Ctrl + C")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7C98\u8D34\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Ctrl + V")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u64A4\u9500\u64CD\u4F5C"),a("div",{class:"shortcut-value"},"Ctrl + Z")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4FDD\u5B58\u770B\u677F"),a("div",{class:"shortcut-value"},"Ctrl + S")])])]),a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u753B\u5E03\u64CD\u4F5C"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u6700\u4F73\u6BD4\u4F8B"),a("div",{class:"shortcut-value"},"Ctrl + A")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A1\uFF1A1"),a("div",{class:"shortcut-value"},"Ctrl + D")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u81EA\u7531\u7F29\u653E"),a("div",{class:"shortcut-value"},"Ctrl + \u9F20\u6807\u6EDA\u8F6E/\u6EDA\u52A8")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u753B\u5E03"),a("div",{class:"shortcut-value"},"Space + \u9F20\u6807\u5DE6\u952E/\u62D6\u52A8")])])]),a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u7EC4\u4EF6\u64CD\u4F5C"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u9876"),a("div",{class:"shortcut-value"},"Alt + Home")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u5E95"),a("div",{class:"shortcut-value"},"Alt + End")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4E0A\u79FB\u4E00\u5C42"),a("div",{class:"shortcut-value"},"Alt + \u2191")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4E0B\u79FB\u4E00\u5C42"),a("div",{class:"shortcut-value"},"Alt + \u2193")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF61\u50CF\u7D20"),a("div",{class:"shortcut-value"},"\u2191 \u2193 \u2190 \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF610\u50CF\u7D20"),a("div",{class:"shortcut-value"},"Shift + \u2191 \u2193 \u2190 \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u91CD\u547D\u540D"),a("div",{class:"shortcut-value"},"F2/\u53CC\u51FB\u56FE\u5C42")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5220\u9664\u9009\u4E2D\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Delete")])])])],-1));function Yl(o,t,n,e,l,s){const d=k("b-modal");return g(),z(d,{title:"\u5FEB\u6377\u952E\u6307\u5357","model-value":n.modelValue,"append-to-body":"","custom-class":"schema-modal",onClose:t[0]||(t[0]=i=>o.$emit("update:modelValue",!1))},{default:x(()=>[Pl]),_:1},8,["model-value"])}var jl=F(Al,[["render",Yl],["__scopeId","data-v-7e8e628e"]]);const Kl={name:"footer-panel",components:{Shortcut:jl},setup(){const{schemaStore:o,storeToRefs:t}=Y(),{pageConfig:n,canvas:e}=t(o),l=T([200,150,100,50]),s=T(20),d=T(20),i=T(!1),r=async c=>{c===-1?o.autoCanvasScale():o.setCanvasScale(c===0?s.value:c)};return pe(()=>e.value.scale,c=>{const m=parseInt((c*100).toFixed(2));d.value=m,s.value=m}),{pageConfig:n,scaleList:l,inputScale:s,scale:d,submitScale:r,keycodeVisible:i}}},Xl={class:"footer-panel"},Jl={class:"screen-info",flex:"cross:center"},Hl={class:"ml-8",style:{transform:"scale(0.9)"}},Wl={flex:"cross:center"},Fl={class:"scale-input-wp"},ql=a("span",{class:"percent"},"%",-1),Zl=a("i",{class:"b-iconfont b-icon-down"},null,-1),Ql={class:"scale-slider-wp"};function ec(o,t,n,e,l,s){const d=k("b-icon"),i=k("b-tooltip"),r=k("b-dropdown-item"),c=k("b-dropdown-menu"),m=k("b-dropdown"),h=k("b-slider"),p=k("shortcut");return g(),S(X,null,[a("div",Xl,[a("div",Jl,[u(i,{content:"\u5FEB\u6377\u952E\u63D0\u793A","open-delay":500},{default:x(()=>[u(d,{name:"read",size:"16",type:"button",onClick:t[0]||(t[0]=_=>e.keycodeVisible=!0)})]),_:1}),a("span",Hl,Z(e.pageConfig.width)+" \u50CF\u7D20 * "+Z(e.pageConfig.height)+" \u50CF\u7D20",1)]),a("div",Wl,[u(m,{trigger:"click",onCommand:e.submitScale},{dropdown:x(()=>[u(c,null,{default:x(()=>[(g(!0),S(X,null,oe(e.scaleList,_=>(g(),z(r,{key:_,name:_},{default:x(()=>[N(Z(`${_}%`),1)]),_:2},1032,["name"]))),128)),u(r,{name:-1},{default:x(()=>[N("\u81EA\u9002\u5E94")]),_:1})]),_:1})]),default:x(()=>[a("div",Fl,[le(a("input",{"onUpdate:modelValue":t[1]||(t[1]=_=>e.inputScale=_),type:"number",class:"scale-input",onKeydown:t[2]||(t[2]=ye(_=>e.submitScale(0),["enter"]))},null,544),[[it,e.inputScale]]),ql,Zl])]),_:1},8,["onCommand"]),a("div",Ql,[u(h,{modelValue:e.scale,"onUpdate:modelValue":t[3]||(t[3]=_=>e.scale=_),min:10,max:200,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])]),u(p,{modelValue:e.keycodeVisible,"onUpdate:modelValue":t[4]||(t[4]=_=>e.keycodeVisible=_)},null,8,["modelValue"])],64)}var tc=F(Kl,[["render",ec]]);const q=o=>(Ce("data-v-2fef22de"),o=o(),xe(),o),oc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),ac=q(()=>a("span",{class:"key-code"},"Alt + Home",-1)),nc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),sc=q(()=>a("span",{class:"key-code"},"Alt + End",-1)),lc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),cc=q(()=>a("span",{class:"key-code"},"Alt + \u2191",-1)),ic=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),rc=q(()=>a("span",{class:"key-code"},"Alt + \u2193",-1)),dc=q(()=>a("div",{class:"context-menu-divider"},null,-1)),uc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),mc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),pc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),vc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),_c=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-save"},null,-1)),fc=q(()=>a("div",{class:"context-menu-divider"},null,-1)),hc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),gc=q(()=>a("span",{class:"key-code"},"F2",-1)),yc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),bc=q(()=>a("span",{class:"key-code"},"Ctrl + C,V",-1)),Cc=q(()=>a("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),xc=q(()=>a("span",{class:"key-code"},"Delete",-1)),wc={__name:"index",setup(o,{expose:t}){const n=T([]),e=T({}),l=()=>ft().then(D=>n.value=D),{schemaStore:s,storeToRefs:d}=Y(),{selectedCom:i,selectedComs:r}=d(s),{isLocked:c,isHided:m,contextMenu:h,contextMenuStyle:p}=Ye(),_=D=>{i.value&&s.moveCom({id:i.value.id,moveType:D})},y=()=>_(ie.up),v=()=>_(ie.down),C=()=>_(ie.top),$=()=>_(ie.bottom),b=()=>{i.value&&(i.value.locked=!i.value.locked)},w=()=>{i.value&&(i.value.hided=!i.value.hided)},V=async()=>{e.value=n.value[0].key,me({title:"\u6307\u5B9A\u7EC4\u4EF6\u5E93",message:We(eo,{modelValue:e.value,onChange:D=>e.value=D},()=>n.value.map(D=>We(Qt,{label:D.value,value:D.key}))),showCancelButton:!0,confirmText:"\u4FDD\u5B58",cancelText:"\u53D6\u6D88",beforeClose:async(D,A,B)=>{if(D==="confirm"){try{await ln(e.value,i.value),A.confirmButtonLoading=!0}catch(M){console.log(M)}A.confirmButtonLoading=!1,B()}else B()}}).then(()=>H.success("\u4FDD\u5B58\u6210\u529F!")).catch(()=>{})},O=()=>{const D=i.value;D&&me.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{s.deleteCom(D.id)}).catch(()=>{})},L=()=>{const D=i.value;D&&s.renamingCom(D.id)},U=()=>{s.copyComs(r.value)},j=D=>{D.preventDefault(),l()};return be(()=>{Q(document,"contextmenu",j)}),Ve(()=>{ee(document,"contextmenu",j)}),t({moveUp:y,moveBottom:$,moveDown:v,moveTop:C,lockCom:b,hideCom:w,toDeleteCom:O,renameCom:L,toCopyCom:U}),(D,A)=>(g(),z(Ot,{name:"zoom-in-top"},{default:x(()=>[f(h).show?(g(),S("div",{key:0,class:"context-menu-wrap",style:W(f(p))},[a("div",{class:"context-menu-item",onClick:C},[oc,N(" \u7F6E\u9876 "),ac]),a("div",{class:"context-menu-item",onClick:$},[nc,N(" \u7F6E\u5E95 "),sc]),a("div",{class:"context-menu-item",onClick:y},[lc,N(" \u4E0A\u79FB\u4E00\u5C42 "),cc]),a("div",{class:"context-menu-item",onClick:v},[ic,N(" \u4E0B\u79FB\u4E00\u5C42 "),rc]),dc,a("div",{class:"context-menu-item",onClick:b},[f(c)?(g(),S(X,{key:0},[uc,N(" \u89E3\u9501 ")],64)):(g(),S(X,{key:1},[mc,N(" \u9501\u5B9A ")],64))]),a("div",{class:"context-menu-item",onClick:w},[f(m)?(g(),S(X,{key:0},[pc,N(" \u663E\u793A ")],64)):(g(),S(X,{key:1},[vc,N(" \u9690\u85CF ")],64))]),n.value.length?(g(),S("div",{key:0,class:"context-menu-item",onClick:V},[_c,N(" \u4FDD\u5B58 ")])):P("",!0),fc,a("div",{class:"context-menu-item",onClick:L},[hc,N(" \u91CD\u547D\u540D "),gc]),a("div",{class:"context-menu-item",onClick:U},[yc,N(" \u590D\u5236 "),bc]),a("div",{class:"context-menu-item",onClick:O},[Cc,N(" \u5220\u9664 "),xc])],4)):P("",!0)]),_:1}))}};var kc=F(wc,[["__scopeId","data-v-2fef22de"]]);function Sc(){const o=Se(),{schemaStore:t}=Y(),n=T(!1),e=async s=>{try{n.value=!0;const d=await Zt(s);if(d){const{id:i,name:r,pid:c,layout:m,components:h}=d,p={pageInfo:{id:i,name:r,pid:c},pageConfig:JSON.parse(m),comps:h.map(_=>JSON.parse(_.componentContent))};t.loadScreenData(p),await fe(),document.title=r}}catch(d){console.log(d)}n.value=!1},l=async()=>{try{n.value=!0;const s=await oo();if(s.tpl.length>0){const d=await lo(s.tpl);if(d){const i=JSON.parse(d.content),{comps:r,pageConfig:c}=i;t.loadScreenData({comps:r,pageConfig:c})}}else t.setScreenSize(s)}catch(s){console.log(s)}n.value=!1};return pe(()=>o.path,async()=>{const{id:s}=o.query;s?await e(s):await l()},{immediate:!0}),{loading:n}}function $c(){const o=T(null),t=T(null),{saveScreenData:n}=Pe(),{schemaStore:e,storeToRefs:l}=Y(),{pageInfo:s,canvas:d,selectedCom:i,selectedComs:r}=l(e),c=Se();let m=null;const h=v=>{const C=v.target;if(!["input","textarea"].includes(C.tagName.toLowerCase())){const $=v.key.toLowerCase();$==="delete"?(t.value&&t.value.toDeleteCom(),v.preventDefault()):$==="f2"&&(t.value&&t.value.renameCom(),v.preventDefault());const b=i.value;v.altKey&&(p("altKey"),$==="arrowup"?t.value&&t.value.moveUp():$==="arrowdown"?t.value&&t.value.moveDown():$==="home"?t.value&&t.value.moveTop():$==="end"&&t.value&&t.value.moveBottom(),v.preventDefault()),v.ctrlKey&&(p("ctrlKey"),$==="arrowup"?(e.toggleCompsPanel(),v.preventDefault()):$==="arrowdown"?(e.toggleToolbox(),v.preventDefault()):$==="arrowleft"?(e.toggleLayerPanel(),v.preventDefault()):$==="arrowright"?(e.toggleConfigPanel(),v.preventDefault()):$==="a"?(e.autoCanvasScale(),v.preventDefault()):$==="d"?(e.setCanvasScale(100),v.preventDefault()):$==="c"?(m=r.value,console.log(m),Ue(JSON.stringify(m)),v.preventDefault()):$==="v"?(m&&e.copyComs(m),v.preventDefault()):$==="s"?(s.value.id||c.query.id?(H("\u6B63\u5728\u4FDD\u5B58..."),n("edit").then(()=>H.success("\u4FDD\u5B58\u6210\u529F\uFF01"))):o.value&&o.value.handleSaveScreen(),v.preventDefault()):$==="z"&&(e.undo(),v.preventDefault())),v.shiftKey&&p("shiftKey"),v.keyCode===32&&(p("spaceKey"),v.preventDefault());const w=v.shiftKey?10:1;b&&!v.altKey&&($==="arrowleft"?(b.attr.x-=w,e.recordSnapshot(),v.preventDefault()):$==="arrowright"?(b.attr.x+=w,e.recordSnapshot(),v.preventDefault()):$==="arrowup"?(b.attr.y-=w,e.recordSnapshot(),v.preventDefault()):$==="arrowdown"&&(b.attr.y+=w,e.recordSnapshot(),v.preventDefault()))}},p=v=>{e.toggleKey({key:v,status:!0})},_=()=>{e.resetKeyCode()},y=v=>{const C=parseInt((d.value.scale*100).toFixed(2)),$=(v.wheelDelta>0?1:-1)*5,b=Math.min(Math.max(C+$,20),200);e.setCanvasScale(b)};return be(()=>{Q(document,"keydown",h),Q(document,"keyup",_)}),Ve(()=>{ee(document,"keydown",h),ee(document,"keyup",_)}),{headerRef:o,contextMenuRef:t,ctrlMouseWheel:y}}const Vc={name:"ScreenEditor",components:{ContextMenu:kc,FooterPanel:tc,ToolboxPanel:Ul,CanvasMain:ys,ConfigPanel:Il,ComponentsPanel:Rn,LayerPanel:Wo,HeaderBar:No},setup(){return{...Sc(),...$c()}}},Mc={key:0,flex:"main:center cross:center",class:"full-wrapper"},Dc={key:1,class:"editor-main-wrapper"},Ic={class:"edit-main-wp"};function Tc(o,t,n,e,l,s){const d=k("header-bar"),i=k("svg-loading"),r=k("components-panel"),c=k("layer-panel"),m=k("toolbox-panel"),h=k("canvas-main"),p=k("footer-panel"),_=k("config-panel"),y=k("context-menu");return g(),S("div",{class:"schema-screen-container",onWheel:t[0]||(t[0]=te((...v)=>o.ctrlMouseWheel&&o.ctrlMouseWheel(...v),["ctrl","prevent"]))},[u(d,{ref:"headerRef","back-url":"/dashboard"},null,512),o.loading?(g(),S("div",Mc,[u(i,{name:"loading02"})])):(g(),S("div",Dc,[u(r),u(c),a("div",Ic,[u(m),u(h),u(p)]),u(_)])),u(y,{ref:"contextMenuRef"},null,512)],32)}var Gc=F(Vc,[["render",Tc]]);export{Gc as default};
