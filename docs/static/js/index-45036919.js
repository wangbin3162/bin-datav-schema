var lt=Object.defineProperty,st=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var ke=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable;var Me=(n,t,o)=>t in n?lt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,W=(n,t)=>{for(var o in t||(t={}))ct.call(t,o)&&Me(n,o,t[o]);if(ke)for(var o of ke(t))rt.call(t,o)&&Me(n,o,t[o]);return n},Ve=(n,t)=>st(n,it(t));import{S as dt}from"./index-afa28915.js";import{a4 as B,a5 as $e,g as w,o as v,A as g,D as S,f as I,n as pe,J as _,c as O,w as x,B as a,u,x as _e,q as T,a6 as mt,a7 as Be,d as Q,X as ge,F as N,y as ut,L as ft,E as M,K as Y,H as De,t as F,a as le,_ as ht,j as ee,Q as Ie,a8 as se,a9 as ie,aL as vt,k as be,z as ye,r as Te,I as ce,W as pt,O as Le,T as _t}from"./vendor-0fc4fabe.js";import{a as me,M as gt}from"./chunk-bin-ui-next-51eb6328.js";import{u as z}from"./useSchemaStore-e0ca2070.js";import{p as ze,q as bt,s as Z,v as G,M as X,w as E,x as te,C as xe,y as Ne,z as Ue,A as yt,B as xt,d as Ct,c as wt,D as St,F as kt,G as Re,I as Mt,i as Vt,K as $t,g as Bt,L as Dt,N as It,O as Tt}from"./index-89bf360d.js";import{b as Lt}from"./config-2f657bd4.js";import{a as je,l as zt}from"./database.api-f55d9a49.js";import"./chunk-brace-7fd40d4c.js";import"./colors-f71480cd.js";const Nt={name:"HeadLoading",setup(){const n=$e();return{loading:w(()=>n.state.schema.toolbar.loading)}}};function Ut(n,t,o,e,i,l){return v(),g("div",{class:S(["loading-indicator",{loading:e.loading}])},null,2)}var Rt=B(Nt,[["render",Ut],["__scopeId","data-v-5de99d01"]]);const jt={name:"publish-screen",props:{projectId:{type:String,required:!0},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(n,t){const o=I(!1),{saveScreenData:e}=z(),i=w(()=>`${window.location.origin}/#/screen/${n.projectId}`),l=()=>{o.value=!1,t.emit("update:modelValue",!1)},c=()=>{_e(()=>{ze(i.value)&&me.success("\u590D\u5236\u6210\u529F")})},s=async()=>{await e(),me.success("\u53D1\u5E03\u6210\u529F\uFF01")};return pe(()=>n.modelValue,r=>{o.value=r}),{visible:o,shareUrl:i,closeDialog:l,copyUrl:c,handlePublishDown:s}}},Et={style:{"padding-bottom":"24px"}},At=a("div",{style:{color:"#fff","font-size":"14px","padding-bottom":"12px"}},"\u53D1\u5E03\u94FE\u63A5",-1),Ht={flex:""},Ot=T("\u590D\u5236"),Pt={class:"t-center"},Wt=T("\u53D1\u5E03\u5927\u5C4F");function Ft(n,t,o,e,i,l){const c=_("g-input"),s=_("b-button"),r=_("b-modal");return v(),O(r,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=d=>e.visible=d),"append-to-body":"",title:"\u53D1\u5E03",top:"200px","custom-class":"publish-modal",onClose:e.closeDialog},{default:x(()=>[a("div",Et,[At,a("div",Ht,[u(c,{modelValue:e.shareUrl,"onUpdate:modelValue":t[0]||(t[0]=d=>e.shareUrl=d),readonly:"",type:"textarea",autosize:{minRows:3},style:{width:"80%","line-height":"22px",background:"#1d262e",cursor:"pointer","margin-right":"16px"}},null,8,["modelValue"]),u(s,{type:"text",onClick:e.copyUrl},{default:x(()=>[Ot]),_:1},8,["onClick"])])]),a("div",Pt,[u(s,{type:"primary",onClick:e.handlePublishDown,style:{width:"200px"}},{default:x(()=>[Wt]),_:1},8,["onClick"])])]),_:1},8,["modelValue","onClose"])}var Yt=B(jt,[["render",Ft]]);const Xt={name:"header-bar",components:{PublishScreen:Yt,HeadLoading:Rt},props:{backUrl:{type:String},backTarget:{type:String,default:"_blank",validator:n=>["_self","_blank"].includes(n)},pageStatus:{type:Object,default:()=>({})}},setup(n){const t=mt(),o=Be(),e=z(),i=I(!1),l=I(""),c=()=>{const m=n.backUrl||"/";if(n.backTarget==="_blank"){const h=t.resolve(m);window.open(h.href,n.backTarget)}else t.push(m)},s=async()=>{const{data:m}=await e.saveScreenData();await ze(JSON.stringify(m)),bt.primary("\u5DF2\u62F7\u8D1D\u914D\u7F6E\u81F3\u526A\u5207\u677F\uFF01")},r=async()=>{const m=e.pageInfo.value.id,{data:h}=await e.saveScreenData();if(!m){let b=t.resolve({path:"/schema/screen",query:{id:h.pageInfo.id}});window.location.replace(b.href)}me.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0})},d=async()=>{const{data:m}=await e.saveScreenData();let h=t.resolve({path:`/screen/preview/${m.pageInfo.id}`,query:{}});window.open(h.href,"_blank")},f=()=>{i.value=!0,l.value=o.query.id};return Ve(W({},e),{publishVisible:i,publishAppId:l,copyCfg:s,handleBack:c,handleSave:r,handPreview:d,handlePublish:f})}},qt={class:"header-container"},Kt={class:"left-actions"},Zt={class:"screen-info"},Gt=a("span",null,"\u5DE5\u4F5C\u7A7A\u95F4",-1),Jt=a("span",{style:{padding:"0 6px 0 12px"}},"-",-1),Qt={class:"global-actions"};function en(n,t,o,e,i,l){const c=_("b-icon"),s=_("b-tooltip"),r=_("b-space"),d=_("head-loading"),f=_("publish-screen");return v(),g(N,null,[a("div",qt,[a("div",Kt,[u(r,{size:"mini"},{default:x(()=>[u(s,{content:"\u56FE\u5C42","open-delay":500},{default:x(()=>[a("div",{class:S(["head-btn",{active:n.toolbar.layer}]),onClick:t[0]||(t[0]=m=>n.toggleLayerPanel())},[u(c,{name:"container"})],2)]),_:1}),u(s,{content:"\u7EC4\u4EF6\u5217\u8868","open-delay":500},{default:x(()=>[a("div",{class:S(["head-btn",{active:n.toolbar.components}]),onClick:t[1]||(t[1]=m=>n.toggleCompsPanel())},[u(c,{name:"hourglass",class:S(["com-list-icon",{"is-rotate":!n.toolbar.components}])},null,8,["class"])],2)]),_:1}),u(s,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:x(()=>[a("div",{class:S(["head-btn",{active:n.toolbar.config}]),onClick:t[2]||(t[2]=m=>n.toggleConfigPanel())},[u(c,{name:"control"})],2)]),_:1}),u(s,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:x(()=>[a("div",{class:S(["head-btn",{active:n.toolbar.toolbox}]),onClick:t[3]||(t[3]=m=>n.toggleToolbox())},[u(c,{name:"shopping"})],2)]),_:1})]),_:1})]),a("div",Zt,[u(s,{content:"\u8FD4\u56DE","open-delay":500},{default:x(()=>[u(c,{name:"laptop",type:"button",onClick:e.handleBack},null,8,["onClick"])]),_:1}),Gt,Jt,Q(a("input",{class:"header-input",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",maxlength:"50",type:"text","onUpdate:modelValue":t[4]||(t[4]=m=>n.pageInfo.name=m)},null,512),[[ge,n.pageInfo.name]])]),a("div",Qt,[u(r,{size:"mini"},{default:x(()=>[u(s,{content:"\u4FDD\u5B58\u5FEB\u7167","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:t[5]||(t[5]=(...m)=>e.copyCfg&&e.copyCfg(...m))},[u(c,{name:"codelibrary"})])]),_:1}),u(s,{content:"\u4FDD\u5B58","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:t[6]||(t[6]=(...m)=>e.handleSave&&e.handleSave(...m))},[u(c,{name:"save"})])]),_:1}),u(s,{content:"\u53D1\u5E03","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:t[7]||(t[7]=(...m)=>e.handlePublish&&e.handlePublish(...m))},[u(c,{name:"send"})])]),_:1}),u(s,{content:"\u9884\u89C8","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:t[8]||(t[8]=(...m)=>e.handPreview&&e.handPreview(...m))},[u(c,{name:"eye"})])]),_:1})]),_:1})])]),u(d),u(f,{modelValue:e.publishVisible,"onUpdate:modelValue":t[9]||(t[9]=m=>e.publishVisible=m),"project-id":e.publishAppId},null,8,["modelValue","project-id"])],64)}var tn=B(Xt,[["render",en]]);const re=ut({x:0,y:0});function Ce(n={}){const t=$e(),o=w(()=>t.state.schema),e=w(()=>o.value.contextMenuInfo),i=w(()=>o.value.selectedCom),l=w(()=>{var h;return(h=i.value)==null?void 0:h.locked}),c=w(()=>{var h;return(h=i.value)==null?void 0:h.hided}),s=w(()=>o.value.renamingId),r=w(()=>({display:e.value.show?"block":"none",left:`${re.x+10}px`,top:`${re.y+10}px`,transform:document.documentElement.clientHeight-re.y<250?"translate(0px, -100%)":""})),d=h=>{h.preventDefault(),i.value&&(re.x=h.clientX,re.y=h.clientY,e.value.show=!0,Z(document,"click",f))},f=()=>{G(document,"click",f),n&&n.beforeClose&&n.beforeClose(),e.value.show=!1};return{contextMenu:e,showMenu:d,renamingId:s,renamingCom:h=>{t.dispatch("schema/renamingCom",h)},selectedCom:i,isLocked:l,isHided:c,contextMenuStyle:r}}const nn={name:"layer-panel",setup(){const{toolbar:n,toggleLayerPanel:t,comps:o,selectedCom:e,hoveredCom:i,onCompHovered:l,onCompSelected:c,onCompMoved:s}=z(),{showMenu:r,renamingId:d,renamingCom:f}=Ce(),m=w(()=>!!e.value),h=w(()=>({opacity:e.value?1:.3})),b=w(()=>{var k;return{enable:!!e.value,checked:(k=e.value)==null?void 0:k.locked}}),p=w(()=>{var k;return{enable:!!e.value,checked:(k=e.value)==null?void 0:k.hided}}),V=w(()=>[...o.value].reverse()),C=k=>{e.value&&s(e.value.id,k)};return{comps:o,toolbar:n,toggleLayerPanel:t,enableBtnClass:m,enableBtnStyle:h,moveUp:()=>C(X.up),moveDown:()=>C(X.down),moveTop:()=>C(X.top),moveBottom:()=>C(X.bottom),descComs:V,enableLockBtnClass:b,enableHideBtnClass:p,onEnter:k=>{l(k)},onLeave:()=>{l("")},selectCom:k=>{const H=o.value.find(P=>P.id===k);H&&c(H)},hoveredCom:i,selectedCom:e,showMenu:r,cancelSelectCom:()=>{c()},renamingId:d,renamingCom:f}}},on={class:"layer-panel"},an={class:"layer-top"},ln=a("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),sn=a("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),cn=[sn],rn={class:"layer-toolbar layer-toolbar-top"},dn={class:"layer-manager-wrap"},mn=["title","onMousedown","onMouseenter"],un=["onUpdate:modelValue"],fn={key:1,class:"layer-item-span"},hn={class:"layer-item-text"},vn=["onClick"],pn=["onClick"];function _n(n,t,o,e,i,l){const c=_("b-icon"),s=ft("focus");return v(),g("div",{class:S(["layer-panel-wp",{"is-hide":!e.toolbar.layer}])},[a("div",on,[a("div",an,[ln,a("div",{class:"layer-action",onClick:t[0]||(t[0]=r=>e.toggleLayerPanel(!1))},cn)]),a("div",rn,[a("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:S(["b-iconfont b-icon-arrowup toolbar-icon standard",e.enableBtnClass]),style:M(e.enableBtnStyle),onClick:t[1]||(t[1]=(...r)=>e.moveUp&&e.moveUp(...r))},null,6),a("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:S(["b-iconfont b-icon-arrowdown toolbar-icon standard",e.enableBtnClass]),style:M(e.enableBtnStyle),onClick:t[2]||(t[2]=(...r)=>e.moveDown&&e.moveDown(...r))},null,6),a("i",{title:"\u7F6E\u9876",class:S(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:M(W({transform:"rotate(180deg)"},e.enableBtnStyle)),onClick:t[3]||(t[3]=(...r)=>e.moveTop&&e.moveTop(...r))},null,6),a("i",{title:"\u7F6E\u5E95",class:S(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:M(e.enableBtnStyle),onClick:t[4]||(t[4]=(...r)=>e.moveBottom&&e.moveBottom(...r))},null,6)]),a("div",dn,[(v(!0),g(N,null,Y(e.descComs,r=>(v(),g("div",{key:r.id,title:r.alias,class:S(["layer-manager-item",[{hided:r.hided,locked:r.locked,hovered:r.id===e.hoveredCom,selected:e.selectedCom&&r.id===e.selectedCom.id}]]),onMousedown:d=>e.selectCom(r.id),onMouseenter:d=>e.onEnter(r.id),onMouseleave:t[7]||(t[7]=(...d)=>e.onLeave&&e.onLeave(...d)),onContextmenu:t[8]||(t[8]=d=>e.showMenu(d))},[u(c,{name:r.icon},null,8,["name"]),r.id===e.renamingId?Q((v(),g("input",{key:0,"onUpdate:modelValue":d=>r.alias=d,class:"layer-item-input",onBlur:t[5]||(t[5]=d=>e.renamingCom("")),onKeydown:t[6]||(t[6]=De(d=>e.renamingCom(""),["enter"]))},null,40,un)),[[ge,r.alias,void 0,{trim:!0}],[s]]):(v(),g("span",fn,[a("span",hn,F(r.alias),1)])),r.hided?(v(),g("i",{key:2,class:"b-iconfont b-icon-eye show-toggle-btn",onClick:d=>r.hided=!1},null,8,vn)):le("",!0),r.locked?(v(),g("i",{key:3,class:"b-iconfont b-icon-lock show-toggle-btn",onClick:d=>r.locked=!1},null,8,pn)):le("",!0)],42,mn))),128)),a("div",{class:"last-flex-item",onClick:t[9]||(t[9]=(...r)=>e.cancelSelectCom&&e.cancelSelectCom(...r))})])])],2)}var gn=B(nn,[["render",_n]]);const Ee={name:"VBasicBar",alias:"\u57FA\u672C\u67F1\u56FE",img:E("basic-bar.png"),type:"bar",used:!0},Ae={name:"VHorizontalBar",alias:"\u57FA\u672C\u6761\u5F62\u56FE",img:E("hori-basic-bar.png"),type:"bar",used:!1},He={name:"VBasicLine",alias:"\u57FA\u672C\u6298\u7EBF\u56FE",img:E("basic-line.png"),type:"line",used:!1},Oe={name:"VBasicArea",alias:"\u57FA\u672C\u533A\u57DF\u56FE",img:E("basic-area.png"),type:"line",used:!1},Pe={name:"VBasicPie",alias:"\u57FA\u672C\u997C\u56FE",img:E("basic-pie.png"),type:"pie",used:!1},bn={name:"VBasicMap",alias:"\u57FA\u672C\u5730\u56FE",img:E("2d-china.png"),type:"map",used:!1},We={name:"VMainTitle",alias:"\u901A\u7528\u6807\u9898",img:E("main-title.png"),type:"info",used:!0},yn={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:E("number-title-flop.png"),type:"info",used:!0},xn={name:"VBorderBox",alias:"\u8FB9\u6846",img:E("border-box.png"),type:"media",used:!0},Cn={name:"VDecoration",alias:"\u88C5\u9970\u5668",img:E("decoration.png"),type:"media",used:!0},wn={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:E("img.png"),type:"media",used:!0},Sn={name:"VCrossTable",alias:"\u4EA4\u53C9\u8868",img:E("carousel-table.png"),type:"table",used:!1},ue=[{type:"normal",name:"\u5E38\u7528",icon:"star",data:[Ee,Ae,He,Oe,Pe,We]},{type:"bar",name:"\u67F1\u56FE",icon:"barchart",data:[Ee,Ae]},{type:"line",name:"\u7EBF\u56FE",icon:"linechart",data:[He,Oe]},{type:"pie",name:"\u997C\u56FE",icon:"piechart",data:[Pe]},{type:"map",name:"\u5730\u56FE",icon:"location",data:[bn]},{type:"info",name:"\u4FE1\u606F",icon:"info-circle",data:[We,yn]},{type:"media",name:"\u5A92\u4F53",icon:"Youtube",data:[xn,Cn,wn]},{type:"table",name:"\u8868\u683C",icon:"table",data:[Sn]}];function kn(n){for(let t=0;t<ue.length;t++){const o=ue[t];for(let e=0;e<o.data.length;e++){const i=o.data[e];if(i.name===n)return{classification:o,com:i}}}return null}const Mn=[te("title",{description:"\u6807\u9898\u503C",optional:!0}),te("url",{description:"\u8D85\u94FE\u63A5url",optional:!0})],Vn={alias:"\u901A\u7528\u6807\u9898",icon:"file-word",type:xe.com,attr:{w:300,h:48},config:{title:"\u6211\u662F\u6807\u9898\u6570\u636E",textStyle:{fontFamily:"Microsoft Yahei",fontSize:24,color:"#fff",fontWeight:"normal"},textAlign:"center",writingMode:"horizontal-tb",backgroundStyle:{show:!1,bgColor:"#008bff",borderRadius:15,borderColor:"#fff",borderStyle:"solid",borderWidth:1},ellipsis:!1,urlConfig:{url:"",isBlank:!1}},apis:Ne({fields:Object.assign({},...Mn)}),apiData:Ue({staticPath:"text/main-title"}),events:{},actions:{}},$n=[te("title",{description:"\u6807\u9898",optional:!0}),te("value",{description:"\u7FFB\u724C\u5668\u6570\u503C"}),te("prefix",{description:"\u7FFB\u724C\u5668\u524D\u7F00",optional:!0}),te("suffix",{description:"\u7FFB\u724C\u5668\u540E\u7F00",optional:!0})],Bn={alias:"\u6570\u5B57\u6307\u6807",icon:"orderedlist",type:xe.com,attr:{w:300,h:74},config:{global:{fontFamily:"Microsoft Yahei",arrangement:"top",distance:0},title:{content:"\u6570\u5B57\u6307\u6807\u6807\u9898",textStyle:{fontSize:18,color:"#79daff",fontWeight:"normal",textAlign:"flex-start"}},counter:{textStyle:{fontFamily:"Microsoft Yahei",fontSize:36,color:"#0a73ff",fontWeight:"bold",textAlign:"left"},value:1234567,duration:1e3,autoplay:!0,decimals:2,decimal:".",separator:",",prefix:"\uFFE5",suffix:""}},apis:Ne({fields:Object.assign({},...$n)}),apiData:Ue({staticPath:"text/number-title-flop"}),events:{},actions:{}},Dn={alias:"\u5355\u5F20\u56FE\u7247",icon:"image",type:xe.com,attr:{w:300,h:180},config:{backgroundImage:yt("title.jpg"),repeat:"no-repeat",radius:2,urlConfig:{url:"",ifBlank:!1}},apis:{},apiData:{},events:{},actions:{}},In={id:"",name:"",alias:"",type:"",locked:!1,hided:!1,attr:{x:0,y:0,w:100,h:100,rotate:0,opacity:1},apiData:{},apis:{},events:{}};function ne(n,t){const o=xt(Ct(In),t||{});return o.id=`${n}_${wt()}`,o.name=`V${n}`,o.apiData.source&&(o.apiData.source.comId=o.id),o}function Fe(n){switch(n.substr(1)){case"BasicBar":return ne("BasicBar",Lt);case"MainTitle":return ne("MainTitle",Vn);case"NumberTitleFlop":return ne("NumberTitleFlop",Bn);case"BorderBox":return ne("BorderBox",kt);case"Decoration":return ne("Decoration",St);case"MainImg":return ne("MainImg",Dn);default:throw Error(`Unknown component type: ${n}.`)}}const Tn={name:"components-panel",setup(){const{toggleCompsPanel:n,pageConfig:t,toolbar:o,addCom:e,onCompSelected:i,selectedCom:l}=z(),c=I(0),s=w(()=>ue[c.value].data);return{toolbar:o,toggleCompsPanel:n,activeIndex:c,componentsList:ue,comps:s,changeComp:h=>{n(!0),c.value=h},dragStart:(h,b)=>{h.dataTransfer.setData("text",b)},toAddCom:async(h,b)=>{if(b){const p=Fe(h);if(p.attr.x=Math.floor((t.value.width-p.attr.w)/2),p.attr.y=Math.floor((t.value.height-p.attr.h)/2),await e({component:p}),await i(p),p.apiData.source&&p.apiData.source.type===Re.static&&p.apiData.source.staticPath){const{data:V}=await je(p.id,p.apiData.source.staticPath);l.value.apiData.source.config.data=JSON.stringify(V)}}else console.log("\u6B63\u5728\u5F00\u53D1\u4E2D\u3002\u3002\u3002")},dragOver:h=>{h.preventDefault(),h.stopPropagation(),h.dataTransfer.dropEffect="none"}}}},Ln={class:"components-panel"},zn={class:"panel-title"},Nn={class:"components-type"},Un=["onClick"],Rn={class:"com-tab-title"},jn={class:"components-list p10"},En=["title","draggable","onDragstart","onClick"],An={class:"comp-item-text"};function Hn(n,t,o,e,i,l){const c=_("b-icon"),s=_("b-scrollbar");return v(),g("div",{class:S(["components-panel-wp",{"is-hide":!e.toolbar.components}])},[a("div",Ln,[a("div",zn,[a("span",{class:"panel-text",onClick:t[0]||(t[0]=r=>e.toggleCompsPanel(!0))},F(e.toolbar.components?"\u5168\u90E8\u7EC4\u4EF6":"\u7EC4\u4EF6"),1),a("i",{class:"b-iconfont b-icon-left comps-action",title:"\u6536\u8D77",onClick:t[1]||(t[1]=r=>e.toggleCompsPanel(!1))})]),a("div",{class:"components-panel-content",onDragover:t[2]||(t[2]=(...r)=>e.dragOver&&e.dragOver(...r))},[a("div",Nn,[u(s,null,{default:x(()=>[(v(!0),g(N,null,Y(e.componentsList,(r,d)=>(v(),g("div",{class:S(["components-item",{active:e.activeIndex===d}]),key:d,onClick:f=>e.changeComp(d)},[u(c,{class:"com-tab-icon",name:r.icon,size:"16"},null,8,["name"]),a("span",Rn,F(r.name),1)],10,Un))),128))]),_:1})]),a("div",jn,[(v(!0),g(N,null,Y(e.comps,(r,d)=>(v(),g("div",{class:"comp-item",key:d,title:r.alias,draggable:r.used,onDragstart:f=>e.dragStart(f,r.name),onClick:f=>e.toAddCom(r.name,r.used)},[a("div",An,F(r.alias),1),a("div",{class:"comp-item-img",style:M(`background-image: url(${r.img});`)},null,4)],40,En))),128))])],32)])],2)}var On=B(Tn,[["render",Hn]]);const Ye=n=>`${n}px`,Xe=(n,t,o,e)=>{const i=n!=null?n:document.createElement("canvas");i.width=t*e,i.height=o*e,i.style.width=Ye(t),i.style.height=Ye(o);const l=i.getContext("2d");return l&&l.setTransform(e,0,0,e,0,0),i};class qe{constructor(t,o){this.el=t,this.options=W({direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2},o),this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:o}=this,{direction:e,width:i,height:l,ratio:c}=o,s=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,i),r=l;this.ruler.width=s,this.ruler.height=r;const d=Xe(null,s,r,c);Mt(d,"canvas-ruler"),t.appendChild(d),this.canvas=d,this.ctx=d.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:o,ruler:e}=this,{width:i,height:l}=e;t.beginPath(),t.fillStyle=o.bgColor,t.fillRect(0,0,i,l),t.closePath(),t.beginPath(),t.font=`${o.fontSize} ${o.fontFamily}`,t.textAlign="left",t.fillStyle=o.fontColor,t.strokeStyle=o.strokeStyle,t.lineWidth=o.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:o,ruler:e}=this,{width:i,height:l}=e,{offset:c,scale:s}=o,r=0,d=l/1.5,f=l/1.2;for(let m=0;m<=i;m+=1){const h=m-c;if(h<0)continue;let b=-1,p=-1;h%50==0?(b=Math.floor(h/s),p=r):h%25==0?p=d:h%5==0&&(p=f),p>=0&&(t.moveTo(m+.5,l+.5),t.lineTo(m+.5,p),b>-1&&t.fillText(`${b}`,m+2.5,l/1.5))}}setSize(t,o,e){const{el:i,options:l}=this;l.width=t,l.height=o,l.scale=e;const{direction:c,width:s,height:r,ratio:d}=l,f=Math.max(c==="TB"?i.offsetWidth:i.offsetHeight,s),m=r;this.ruler.width=f,this.ruler.height=m,Xe(this.canvas,f,m,d),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const Pn={name:"ruler",setup(){const{canvas:n}=z(),t=I(null),o=I(null),e=I(null),i=I(null),l=I(!0),c=I(0),s=I(0),r=document.documentElement.clientWidth;ht(()=>{if(t.value&&o.value){const f=Math.max(n.value.width,r);e.value?e.value.setSize(f,20,n.value.scale):e.value=new qe(t.value,{direction:"TB",width:f,scale:n.value.scale}),i.value?i.value.setSize(n.value.height,20,n.value.scale):i.value=new qe(o.value,{direction:"LR",width:n.value.height,scale:n.value.scale})}});const d=f=>{const m=f.target;c.value=m.scrollLeft,s.value=m.scrollTop};return ee(()=>{const f=document.getElementById("canvas-wp");f==null||f.addEventListener("scroll",d)}),Ie(()=>{const f=document.getElementById("canvas-wp");f==null||f.removeEventListener("scroll",d)}),{visible:l,hRulerWpRef:t,vRulerWpRef:o,vScroll:s,hScroll:c}}},Wn=n=>(se("data-v-d5375d52"),n=n(),ie(),n),Fn={class:"canvas-ruler-wp"},Yn=Wn(()=>a("div",{class:"ruler-corner"},null,-1));function Xn(n,t,o,e,i,l){return v(),g("div",Fn,[a("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:M(`transform: translateX(-${e.hScroll}px);`)},null,4),a("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:M(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),Yn])}var qn=B(Pn,[["render",Xn],["__scopeId","data-v-d5375d52"]]);const oe=vt();function Ke(n){return n*Math.PI/180}function Ze(n){return Math.abs(Math.sin(Ke(n)))}function Ge(n){return Math.abs(Math.cos(Ke(n)))}function Je(n){if(n=W({},n),n.rotate!==0){const t=n.width*Ge(n.rotate)+n.height*Ze(n.rotate),o=(n.width-t)/2;n.left+=o,n.right=n.left+t;const e=n.height*Ge(n.rotate)+n.width*Ze(n.rotate),i=(e-n.height)/2;n.top-=i,n.bottom=n.top+e,n.width=t,n.height=e}else n.bottom=n.top+n.height,n.right=n.left+n.width;return n}const Kn=5,Zn={name:"mark-line",setup(){const{comps:n,selectedCom:t,canvas:o,setSingleComAttr:e,toolbox:i}=z(),l=I([]),c=I(["xt","xc","xb","yl","yc","yr"]),s=I({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),r=()=>{Object.keys(s.value).forEach(p=>{s.value[p]=!1})},d=(p,V)=>{const C=l.value,U=t.value,$=n.value.filter(K=>!K.hided),D=o.value.scale,y=Je(h(U.attr)),A=y.width/2,q=y.height/2;r(),$.forEach(K=>{if(K.id===U.id)return;const{top:j,left:k,bottom:H,right:P,width:we,height:L}=Je(h(K.attr)),ae=we/2,he=L/2,Se={top:[{isNearly:b(y.top,j),lineNode:C.xt,line:"xt",dragShift:j,lineShift:j*D+60},{isNearly:b(y.bottom,j),lineNode:C.xt,line:"xt",dragShift:j-y.height,lineShift:j*D+60},{isNearly:b(y.top+q,j+he),lineNode:C.xc,line:"xc",dragShift:j+he-q,lineShift:(j+he)*D+60},{isNearly:b(y.top,H),lineNode:C.xb,line:"xb",dragShift:H,lineShift:H*D+60},{isNearly:b(y.bottom,H),lineNode:C.xb,line:"xb",dragShift:H-y.height,lineShift:H*D+60}],left:[{isNearly:b(y.left,k),lineNode:C.yl,line:"yl",dragShift:k,lineShift:k*D+60},{isNearly:b(y.right,k),lineNode:C.yl,line:"yl",dragShift:k-y.width,lineShift:k*D+60},{isNearly:b(y.left+A,k+ae),lineNode:C.yc,line:"yc",dragShift:k+ae-A,lineShift:(k+ae)*D+60},{isNearly:b(y.left,P),lineNode:C.yr,line:"yr",dragShift:P,lineShift:P*D+60},{isNearly:b(y.right,P),lineNode:C.yr,line:"yr",dragShift:P-y.width,lineShift:P*D+60}]},ve=[],{rotate:ot}=y;Object.keys(Se).forEach(de=>{Se[de].forEach(J=>{if(!J.isNearly)return;const at=ot!==0?f(de,J,y):J.dragShift;e({key:de,value:at}),J.lineNode.style[de]=`${J.lineShift}px`,ve.push(J.line)})}),ve.length&&m(ve,p,V)})},f=(p,V,C)=>{const{width:U,height:$}=C;return Math.round(p==="top"?V.dragShift-($-C.height)/2:V.dragShift-(U-C.width)/2)},m=(p,V,C)=>{C?p.includes("yr")?s.value.yr=!0:p.includes("yc")?s.value.yc=!0:p.includes("yl")&&(s.value.yl=!0):p.includes("yl")?s.value.yl=!0:p.includes("yc")?s.value.yc=!0:p.includes("yr")&&(s.value.yr=!0),V?p.includes("xb")?s.value.xb=!0:p.includes("xc")?s.value.xc=!0:p.includes("xt")&&(s.value.xt=!0):p.includes("xt")?s.value.xt=!0:p.includes("xc")?s.value.xc=!0:p.includes("xb")&&(s.value.xb=!0)},h=p=>({left:p.x,top:p.y,width:p.w,height:p.h,rotate:p.rotate}),b=(p,V)=>Math.abs(p-V)<=Kn;return ee(()=>{oe.on("move",({isDownward:p,isRightward:V})=>{i.value.markLine&&d(p,V)}),oe.on("unmove",()=>{r()})}),be(()=>{oe.off("move"),oe.off("unmove")}),{lineRefs:l,lines:c,lineStatus:s}}},Gn={class:"mark-line"};function Jn(n,t,o,e,i,l){return v(),g("div",Gn,[(v(!0),g(N,null,Y(e.lines,c=>Q((v(),g("div",{key:c,class:S(["line",[c.includes("x")?"xline":"yline",c]]),ref:s=>{e.lineRefs[c]=s}},null,2)),[[ye,e.lineStatus[c]||!1]])),128))])}var Qn=B(Zn,[["render",Jn],["__scopeId","data-v-0e7539c7"]]);const eo=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],Qe=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],to=n=>{const t=(n+360)%360,o={};let e=-1;return eo.forEach(i=>{const l=(i.angle+t)%360,c=Qe.length,s=0;for(;s<c;){e=(e+1)%c;const r=Qe[e];if(l<23||l>=338){o[i.direction]="nwse-resize";break}if(r.start<=l&&l<r.end){o[i.direction]=r.cursor;break}}}),o};function no(n,t,o,e,i,l){n==="t"?(l.h=Math.round(t.h+(o.y-e.y)/i),l.y=Math.round(t.y+(e.y-o.y)/i),l.h=Math.max(l.h,20)):n==="rt"?(l.h=Math.round(t.h+(o.y-e.y)/i),l.w=Math.round(t.w+(e.x-o.x)/i),l.y=Math.round(t.y+(e.y-o.y)/i),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):n==="r"?(l.w=Math.round(t.w+(e.x-o.x)/i),l.w=Math.max(l.w,20)):n==="rb"?(l.h=Math.round(t.h+(e.y-o.y)/i),l.w=Math.round(t.w+(e.x-o.x)/i),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):n==="b"?(l.h=Math.round(t.h+(e.y-o.y)/i),l.h=Math.max(l.h,20)):n==="lb"?(l.h=Math.round(t.h+(e.y-o.y)/i),l.w=Math.round(t.w+(o.x-e.x)/i),l.x=Math.round(t.x+(e.x-o.x)/i),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20)):n==="l"?(l.w=Math.round(t.w+(o.x-e.x)/i),l.x=Math.round(t.x+(e.x-o.x)/i),l.w=Math.max(l.w,20)):n==="lt"&&(l.h=Math.round(t.h+(o.y-e.y)/i),l.w=Math.round(t.w+(o.x-e.x)/i),l.x=Math.round(t.x+(e.x-o.x)/i),l.y=Math.round(t.y+(e.y-o.y)/i),l.w=Math.max(l.w,20),l.h=Math.max(l.h,20))}const et=(n,t,o,e,i)=>{const l=W({},o.attr),c=Object.create(null),s=n.clientX,r=n.clientY,d=m=>{const h=m.clientX,b=m.clientY;t?no(t,l,{x:s,y:r},{x:h,y:b},e,c):(c.x=l.x+Math.round((h-s)/e/i)*i,c.y=l.y+Math.round((b-r)/e/i)*i),o.attr=W(W({},o.attr),c),_e().then(()=>{oe.emit("move",{isDownward:b-r>0,isRightward:h-s>0})})},f=()=>{oe.emit("unmove"),G(document,"mousemove",d),G(document,"mouseup",f)};Z(document,"mousemove",d),Z(document,"mouseup",f)},oo=(n,t,o,e)=>{et(n,null,t,o,e)},ao=(n,t,o,e)=>{et(n,t,o,e)},lo=(n,t,o)=>{const e=t.getBoundingClientRect(),i=e.left+e.width/2,l=e.top+e.height/2,c=Math.atan2(l-n.clientY,i-n.clientX)*180/Math.PI-o.attr.rotate,s=d=>{const f=Math.atan2(l-d.clientY,i-d.clientX)*180/Math.PI-c,m=Math.round(f%360);o.attr.rotate=m<0?m+360:m},r=()=>{G(document,"mousemove",s),G(document,"mouseup",r)};Z(document,"mousemove",s),Z(document,"mouseup",r)},so={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(n){const t=w(()=>({height:`${n.attr.y+60/n.scale}px`,borderLeftWidth:`${.9/n.scale}px`})),o=w(()=>({width:`${n.attr.x+60/n.scale}px`,borderTopWidth:`${.9/n.scale}px`})),e=w(()=>({fontSize:`${12/n.scale}px`,top:`-${6/n.scale}px`,left:`-${6/n.scale}px`}));return{topLineStyle:t,leftLineStyle:o,accountStyle:e}}},io={class:"nav-line"};function co(n,t,o,e,i,l){return v(),g("div",io,[a("div",{class:"nav-line-top",style:M(e.topLineStyle)},null,4),a("div",{class:"nav-line-left",style:M(e.leftLineStyle)},null,4),a("div",{class:"nav-line-account",style:M(e.accountStyle)},F(o.attr.x)+", "+F(o.attr.y),5)])}var ro=B(so,[["render",co]]);const mo={name:"dv-transform",components:{ReferLine:ro},props:{data:{type:Object,required:!0}},setup(n,t){const o=pt(),{canvas:e,comps:i,pageConfig:l,selectedCom:c,hoveredCom:s,onCompHovered:r,onCompSelected:d,toolbox:f}=z(),{showMenu:m}=Ce(),h=w(()=>s.value===n.data.id),b=w(()=>!Vt(c.value)&&c.value.id===n.data.id),p=w(()=>({locked:n.data.locked,selected:b.value})),V=w(()=>({top:0,left:0,width:`${n.data.attr.w}px`,height:`${n.data.attr.h}px`,transform:`translate(${n.data.attr.x}px, ${n.data.attr.y}px)`})),C=w(()=>({"is-hide":!b.value||n.data.locked})),U=w(()=>({cursor:"move",transform:`rotate(${n.data.attr.rotate}deg)`})),$=w(()=>({width:`${n.data.attr.w}px`,height:`${n.data.attr.h}px`})),D=w(()=>({display:n.data.hided?"none":"block"})),y=w(()=>to(n.data.attr.rotate)),A=w(()=>e.value.scale),q=w(()=>{const L=`scale(${1/A.value}, ${1/A.value})`;return{t:{name:"top",style:{cursor:y.value.t,transform:L}},rt:{name:"top-right",style:{cursor:y.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:L}},r:{name:"right",style:{cursor:y.value.r,transform:L}},rb:{name:"bottom-right",style:{cursor:y.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:L}},b:{name:"bottom",style:{cursor:y.value.b,transform:L}},lb:{name:"bottom-left",style:{cursor:y.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:L}},l:{name:"left",style:{cursor:y.value.l,transform:L}},lt:{name:"top-left",style:{cursor:y.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:L}}}}),K=()=>{r(n.data.id)},j=()=>{r("")},k=()=>{b.value||d(n.data)};return{comps:i,selectedCom:c,hoveredCom:s,toolbox:f,isHovered:h,isSelected:b,hideStyle:D,transformClass:p,transformStyle:V,handlerClass:C,handlerStyle:U,wrapperStyle:$,onEnter:K,onLeave:j,onMove:L=>{k(),oo(L,n.data,A.value,l.value.grid)},onZoom:(L,ae)=>{k(),ao(L,ae,n.data,A.value)},onRotate:L=>{lo(L,o.vnode.el,n.data)},points:q,scale:A,showMenu:m}}},uo={class:"dv-com"},fo=["onMousedown"],ho=["onMousedown"],vo=a("div",{class:"transform-bg"},null,-1);function po(n,t,o,e,i,l){const c=_("refer-line");return v(),g("div",{class:S(["dv-transform",e.transformClass]),style:M(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(v(),O(c,{key:0,attr:o.data.attr,scale:e.scale},null,8,["attr","scale"])):le("",!0),a("div",{class:S(["dv-scale",{hovered:e.isHovered}]),style:M(e.hideStyle),onMouseenter:t[2]||(t[2]=(...s)=>e.onEnter&&e.onEnter(...s)),onMouseleave:t[3]||(t[3]=(...s)=>e.onLeave&&e.onLeave(...s)),onMousedown:t[4]||(t[4]=ce((...s)=>e.onMove&&e.onMove(...s),["prevent","stop"]))},[a("div",{class:S(["transform-handler",e.handlerClass]),style:M(e.handlerStyle)},[a("div",uo,[Te(n.$slots,"default"),a("div",{class:"dv-event-disable",style:M(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...s)=>e.showMenu&&e.showMenu(...s))},null,36)]),(v(!0),g(N,null,Y(e.points,(s,r)=>(v(),g(N,{key:r},[s.rotateStyle?(v(),g("i",{key:0,class:S(`${s.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"rotate-handler",style:M(s.rotateStyle),onMousedown:t[1]||(t[1]=ce((...d)=>e.onRotate&&e.onRotate(...d),["prevent","stop"]))},[a("span",{class:"control-point",style:M(s.style),onMousedown:ce(d=>e.onZoom(d,r),["prevent","stop"])},null,44,fo)],36)],2)):(v(),g("i",{key:1,class:S(`${s.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"control-point",style:M(s.style),onMousedown:ce(d=>e.onZoom(d,r),["prevent","stop"])},null,44,ho)],2))],64))),128)),vo],6)],38)],6)}var _o=B(mo,[["render",po]]);const go={name:"canvas-main",components:{MarkLine:Qn,DvTransform:_o,Ruler:qn},setup(){const{canvas:n,pageConfig:t,autoCanvasScale:o,comps:e,onCompSelected:i,getPanelOffsetLeft:l,getPanelOffsetTop:c,selectedCom:s,addCom:r,toolbox:d}=z(),f=w(()=>({width:`${n.value.width}px`,height:`${n.value.height}px`})),m=w(()=>({position:"absolute",width:`${t.value.width}px`,height:`${t.value.height}px`,transform:`scale(${n.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${t.value.bgImage})`,backgroundColor:t.value.bgColor})),h=$t(o,200),b=async C=>{C.preventDefault();try{const U=C.dataTransfer.getData("text");if(U){const $=Fe(U),{scale:D}=n.value,y=(C.clientX-l.value)/D,A=(C.clientY-c.value)/D;if($.attr.x=Math.round(y-$.attr.w/2),$.attr.y=Math.round(A-$.attr.h/2),await r({component:$}),await i($),$.apiData.source&&$.apiData.source.type===Re.static&&$.apiData.source.staticPath){const{data:q}=await je($.id,$.apiData.source.staticPath);s.value.apiData.source.config.data=JSON.stringify(q)}}}catch(U){console.warn(U)}},p=()=>{i()},V=C=>{C.preventDefault(),C.stopPropagation(),C.dataTransfer.dropEffect="copy"};return ee(()=>{Z(window,"resize",h),h()}),be(()=>{G(window,"resize",h)}),{screenShotStyle:f,canvasPanelStyle:m,comps:e,toolbox:d,cancelSelectCom:p,dropToAddCom:b,dragOver:V}}},bo={class:"canvas-main"};function yo(n,t,o,e,i,l){const c=_("mark-line"),s=_("ruler"),r=_("dv-transform");return v(),g("div",bo,[a("div",{id:"canvas-wp",class:"canvas-panel-wrap",onMousedown:t[2]||(t[2]=ce((...d)=>e.cancelSelectCom&&e.cancelSelectCom(...d),["stop"]))},[a("div",{class:"screen-shot",style:M(e.screenShotStyle)},[e.toolbox.markLine?(v(),O(c,{key:0,style:M(e.screenShotStyle)},null,8,["style"])):le("",!0),u(s),a("div",{id:"canvas-components",class:"canvas-panel",style:M(e.canvasPanelStyle),onDragover:t[0]||(t[0]=(...d)=>e.dragOver&&e.dragOver(...d)),onDrop:t[1]||(t[1]=(...d)=>e.dropToAddCom&&e.dropToAddCom(...d))},[(v(!0),g(N,null,Y(e.comps,d=>(v(),O(r,{key:d.id,data:d},{default:x(()=>[(v(),O(Le(d.name),{data:d,style:M({transform:"translateZ(0px)",opacity:d.attr.opacity})},null,8,["data","style"]))]),_:2},1032,["data"]))),128))],36)],4)],32)])}var xo=B(go,[["render",yo]]);const Co={name:"page-config",setup(){const{pageConfig:n,autoCanvasScale:t}=z(),o=w(()=>[{name:"\u9ED8\u8BA4\u80CC\u666F",path:"bg.png",folder:"bg"},{name:"\u80CC\u666F\u4E00",path:"bg0.jpg",folder:"bg"},{name:"\u80CC\u666F\u4E8C",path:"bg1.jpg",folder:"bg"},{name:"\u80CC\u666F\u4E09",path:"bg2.jpg",folder:"bg"}]);return{onSizeChange:async()=>{await t()},resetBGImage:()=>{n.value.bgColor="#0d2a42",n.value.bgImage=Bt(o.value[0].path,o.value[0].folder||"")},bgImages:o,pageConfig:n}}},wo=n=>(se("data-v-0b5c2a82"),n=n(),ie(),n),So={class:"page-config-panel"},ko=wo(()=>a("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),Mo={class:"page-config-content"},Vo={class:"page-config-wp"},$o=T("\u6062\u590D\u9ED8\u8BA4\u80CC\u666F"),Bo={class:"page-config-wp"};function Do(n,t,o,e,i,l){const c=_("g-input-number"),s=_("g-field"),r=_("g-color-picker"),d=_("g-upload-img"),f=_("b-button");return v(),g("div",So,[ko,a("div",Mo,[a("div",Vo,[u(s,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:x(()=>[u(c,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[0]||(t[0]=m=>e.pageConfig.width=m),label:"\u5BBD\u5EA6",min:1e3,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),u(c,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[1]||(t[1]=m=>e.pageConfig.height=m),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),u(s,{label:"\u80CC\u666F\u989C\u8272"},{default:x(()=>[u(r,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[2]||(t[2]=m=>e.pageConfig.bgColor=m)},null,8,["modelValue"])]),_:1}),u(s,{label:"\u80CC\u666F\u56FE",tooltip:"\u652F\u6301\u56FE\u7247\u5730\u5740\u3001\u9759\u6001\u8DEF\u5F84\u3001base64\u5B58\u50A8"},{default:x(()=>[u(d,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[3]||(t[3]=m=>e.pageConfig.bgImage=m),"show-preset":"","show-suffix":"",images:e.bgImages},null,8,["modelValue","images"])]),_:1}),u(s,{label:"\u91CD\u7F6E"},{default:x(()=>[u(f,{type:"primary",size:"small",onClick:e.resetBGImage},{default:x(()=>[$o]),_:1},8,["onClick"])]),_:1})]),a("div",Bo,[u(s,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:x(()=>[u(c,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[4]||(t[4]=m=>e.pageConfig.grid=m),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})])])])}var Io=B(Co,[["render",Do],["__scopeId","data-v-0b5c2a82"]]);const To={name:"config-title",props:{comName:{type:String,required:!0},comAlias:{type:String,required:!0}},setup(n){const t=w(()=>{const e=kn(n.comName);return e==null?void 0:e.com.name});return{toSearch:()=>{window.open("https://echarts.apache.org/zh/option.html#title","_blank")},comTitle:t}}},tt=n=>(se("data-v-5bc1a558"),n=n(),ie(),n),Lo={class:"com-title-wp"},zo={class:"com-title"},No={class:"title-name"},Uo={class:"alias-name"},Ro={class:"version-tag"},jo=tt(()=>a("i",{class:"b-iconfont b-icon-search"},null,-1)),Eo=tt(()=>a("span",null,"\u641C\u7D22\u914D\u7F6E",-1)),Ao=[jo,Eo];function Ho(n,t,o,e,i,l){return v(),g("div",Lo,[a("div",zo,[a("div",No,[a("span",Uo,F(o.comAlias),1)]),a("div",Ro,[a("span",null,F(e.comTitle),1)])]),Te(n.$slots,"default",{},()=>[a("div",{class:"search-config",onClick:t[0]||(t[0]=(...c)=>e.toSearch&&e.toSearch(...c)),title:"echarts option config"},Ao)],!0)])}var nt=B(To,[["render",Ho],["__scopeId","data-v-5bc1a558"]]);const Oo={name:"data-center-panel",components:{ConfigTitle:nt,SourcePanel:Dt(()=>It(()=>import("./source-panel-ad1fac72.js"),["static/js/source-panel-ad1fac72.js","static/css/source-panel-8438f192.css","static/js/index-89bf360d.js","static/css/index-74cdb240.css","static/js/vendor-0fc4fabe.js","static/js/chunk-brace-7fd40d4c.js","static/js/chunk-bin-ui-next-51eb6328.js","static/css/chunk-bin-ui-next-d2edf0dc.css","static/js/useSchemaStore-e0ca2070.js","static/js/database.api-f55d9a49.js","static/js/field-type-icon-28ea7076.js","static/css/field-type-icon-d3ae34ac.css"]))},setup(){const{selectedCom:n}=z(),t=w(()=>Object.keys(n.value.apis));return{com:n,dataKeys:t}}},Po={class:"data-center-panel"},Wo={class:"scroll-container"},Fo={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"},Yo=T("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E");function Xo(n,t,o,e,i,l){const c=_("config-title"),s=_("source-panel"),r=_("b-empty"),d=_("b-scrollbar");return v(),g("div",Po,[u(c,{"com-name":e.com.name,"com-alias":e.com.alias},null,8,["com-name","com-alias"]),a("div",Wo,[u(d,{native:""},{default:x(()=>[(v(!0),g(N,null,Y(e.dataKeys,f=>(v(),O(s,{key:f,"api-name":f,"active-name":e.dataKeys[0],collapse:e.dataKeys.length>1},null,8,["api-name","active-name","collapse"]))),128)),e.dataKeys.length>0?(v(),g(N,{key:0},[],64)):(v(),g("div",Fo,[u(r,null,{default:x(()=>[Yo]),_:1})]))]),_:1})])])}var qo=B(Oo,[["render",Xo]]);const Ko={name:"basic-setting",props:{attr:{type:Object,required:!0}}},Zo={class:"basic-setting-wp"};function Go(n,t,o,e,i,l){const c=_("g-input-number"),s=_("g-field"),r=_("g-slider");return v(),g("div",Zo,[u(s,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{default:x(()=>[u(c,{modelValue:o.attr.w,"onUpdate:modelValue":t[0]||(t[0]=d=>o.attr.w=d),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px"},null,8,["modelValue"]),u(c,{modelValue:o.attr.h,"onUpdate:modelValue":t[1]||(t[1]=d=>o.attr.h=d),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:x(()=>[u(c,{modelValue:o.attr.x,"onUpdate:modelValue":t[2]||(t[2]=d=>o.attr.x=d),label:"offsetX",inline:"",suffix:"px"},null,8,["modelValue"]),u(c,{modelValue:o.attr.y,"onUpdate:modelValue":t[3]||(t[3]=d=>o.attr.y=d),label:"offsetY",inline:"",suffix:"px"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u65CB\u8F6C\u89D2\u5EA6",flat:""},{default:x(()=>[u(c,{modelValue:o.attr.rotate,"onUpdate:modelValue":t[4]||(t[4]=d=>o.attr.rotate=d),min:0,max:360,step:1,inline:""},null,8,["modelValue"])]),_:1}),u(s,{label:"\u900F\u660E\u5EA6"},{default:x(()=>[u(r,{modelValue:o.attr.opacity,"onUpdate:modelValue":t[5]||(t[5]=d=>o.attr.opacity=d),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})])}var Jo=B(Ko,[["render",Go]]);const Qo={name:"setting-panel",components:{BasicSetting:Jo,ConfigTitle:nt},setup(){const{selectedCom:n}=z();return{selectedCom:n}}},ea={class:"setting-panel"},ta={class:"setting-panel-content"},na={class:"scroll-container"};function oa(n,t,o,e,i,l){const c=_("config-title"),s=_("basic-setting"),r=_("b-scrollbar");return v(),g("div",ea,[u(c,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),a("div",ta,[a("div",na,[u(r,null,{default:x(()=>[u(s,{key:`${e.selectedCom.id}'_basic-setting`,attr:e.selectedCom.attr},null,8,["attr"]),(v(),O(Le(e.selectedCom.name+"Config"),{key:e.selectedCom.id,data:e.selectedCom},null,8,["data"]))]),_:1})])])])}var aa=B(Qo,[["render",oa]]);const la={name:"config-panel",components:{SettingPanel:aa,DataCenterPanel:qo,PageConfig:Io},setup(){const{toolbar:n,selectedCom:t,toggleConfigPanel:o}=z(),e=I(0);return{toolbar:n,selectedCom:t,toggleConfigPanel:o,curTabIndex:e,changeTab:l=>{if(l===2){me.warning("\u6682\u672A\u5F00\u653E!");return}e.value!==l&&(e.value=l)}}}},sa={class:"config-panel"},ia={key:1,class:"page-config-panel"},ca={class:"page-config-top"},ra={class:"tabs-wrapper"},da={class:"page-config-content"},ma={style:{height:"100%"}},ua={style:{height:"100%"}};function fa(n,t,o,e,i,l){const c=_("page-config"),s=_("b-icon"),r=_("b-tooltip"),d=_("setting-panel"),f=_("data-center-panel");return v(),g("div",{class:S(["config-panel-wp",{"is-hide":!e.toolbar.config}])},[a("div",sa,[e.selectedCom?(v(),g("div",ia,[a("div",ca,[a("div",ra,[a("div",{class:S(["tab-item",{active:e.curTabIndex===0}]),onClick:t[0]||(t[0]=m=>e.changeTab(0))},[u(r,{content:"\u914D\u7F6E"},{default:x(()=>[u(s,{name:"control",size:"20"})]),_:1})],2),a("div",{class:S(["tab-item",{active:e.curTabIndex===1}]),onClick:t[1]||(t[1]=m=>e.changeTab(1))},[u(r,{content:"\u6570\u636E"},{default:x(()=>[u(s,{name:"cloud-server",size:"22"})]),_:1})],2),a("div",{class:S(["tab-item",{active:e.curTabIndex===2}]),onClick:t[2]||(t[2]=m=>e.changeTab(2))},[u(r,{content:"\u4EA4\u4E92"},{default:x(()=>[u(s,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),a("div",da,[Q(a("div",ma,[u(d,{key:e.selectedCom.id})],512),[[ye,e.curTabIndex===0]]),Q(a("div",ua,[u(f,{key:e.selectedCom.id})],512),[[ye,e.curTabIndex===1]])])])):(v(),O(c,{key:0}))])],2)}var ha=B(la,[["render",fa]]);const va={name:"toolbox-panel",setup(){const{toolbar:n,toolbox:t}=z();return{toolbar:n,toolbox:t}}},pa={class:"toolbox-panel"},_a={class:"btn-box"},ga=T("\u53C2\u8003\u7EBF\xA0\xA0 "),ba={class:"btn-box"},ya=T("\u5BF9\u9F50\u7EBF\xA0\xA0 ");function xa(n,t,o,e,i,l){const c=_("b-switch");return v(),g("div",{class:S(["toolbox-panel-wp",{"is-hide":!e.toolbar.toolbox}])},[a("div",pa,[a("div",_a,[ga,u(c,{modelValue:e.toolbox.referLine,"onUpdate:modelValue":t[0]||(t[0]=s=>e.toolbox.referLine=s),size:"small"},null,8,["modelValue"])]),a("div",ba,[ya,u(c,{modelValue:e.toolbox.markLine,"onUpdate:modelValue":t[1]||(t[1]=s=>e.toolbox.markLine=s),size:"small"},null,8,["modelValue"])])])],2)}var Ca=B(va,[["render",xa]]);const wa={name:"footer-panel",setup(){const{canvas:n,autoCanvasScale:t,setCanvasScale:o,toggleLayerPanel:e,toggleCompsPanel:i,toggleConfigPanel:l}=z(),c=I([150,100,75,50]),s=I(20),r=I(20),d=async m=>{m===-1?await t():await o(m===0?s.value:m)};pe(()=>n.value.scale,m=>{const h=parseInt((m*100).toFixed(2));r.value=h,s.value=h});const f=m=>{const h=m.target;if(!["input","textarea"].includes(h.tagName.toLowerCase())&&m.ctrlKey){const b=m.key.toLowerCase();b==="arrowleft"?e():b==="arrowup"?i():b==="arrowright"?l():b==="a"?t():b==="s"&&d(100),m.preventDefault()}};return ee(()=>{document.addEventListener("keydown",f,!1)}),Ie(()=>{document.removeEventListener("keydown",f,!1)}),{scaleList:c,inputScale:s,scale:r,submitScale:d}}},fe=n=>(se("data-v-77f3b191"),n=n(),ie(),n),Sa={class:"footer-panel"},ka=fe(()=>a("i",{class:"b-iconfont b-icon-codelibrary",style:{"font-size":"18px"}},null,-1)),Ma=fe(()=>a("div",{class:"shortcut-wp"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + \u2190")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5207\u6362\u7EC4\u4EF6\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + \u2191")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5207\u6362\u53F3\u4FA7\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u5230\u6700\u4F73\u4F4D\u7F6E"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + a")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A100%"),a("div",{class:"shortcut-value"},"Ctrl/Cmd + s")])],-1)),Va={class:"scale-input-wp"},$a=fe(()=>a("span",{class:"percent"},"%",-1)),Ba=fe(()=>a("i",{class:"b-iconfont b-icon-down"},null,-1)),Da=T("\u81EA\u9002\u5E94"),Ia={class:"scale-slider-wp"};function Ta(n,t,o,e,i,l){const c=_("b-popover"),s=_("b-dropdown-item"),r=_("b-dropdown-menu"),d=_("b-dropdown"),f=_("b-slider");return v(),g("div",Sa,[u(c,{width:"235",placement:"top",trigger:"hover","popper-class":"editor-popover","show-arrow":!1},{content:x(()=>[Ma]),default:x(()=>[ka]),_:1}),u(d,{trigger:"click",onCommand:e.submitScale},{dropdown:x(()=>[u(r,null,{default:x(()=>[(v(!0),g(N,null,Y(e.scaleList,m=>(v(),O(s,{key:m,name:m},{default:x(()=>[T(F(`${m}%`),1)]),_:2},1032,["name"]))),128)),u(s,{name:-1},{default:x(()=>[Da]),_:1})]),_:1})]),default:x(()=>[a("div",Va,[Q(a("input",{"onUpdate:modelValue":t[0]||(t[0]=m=>e.inputScale=m),type:"number",class:"scale-input",onKeydown:t[1]||(t[1]=De(m=>e.submitScale(0),["enter"]))},null,544),[[ge,e.inputScale]]),$a,Ba])]),_:1},8,["onCommand"]),a("div",Ia,[u(f,{modelValue:e.scale,"onUpdate:modelValue":t[2]||(t[2]=m=>e.scale=m),min:10,max:150,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])}var La=B(wa,[["render",Ta],["__scopeId","data-v-77f3b191"]]);const za={name:"context-menu",setup(){const{onCompMoved:n,deleteCom:t,copyCom:o}=z(),{contextMenu:e,selectedCom:i,isLocked:l,isHided:c,contextMenuStyle:s,renamingCom:r}=Ce(),d=y=>{i.value&&n(i.value.id,y)},f=()=>d(X.up),m=()=>d(X.down),h=()=>d(X.top),b=()=>d(X.bottom),p=()=>{i.value&&(i.value.locked=!i.value.locked)},V=()=>{i.value&&(i.value.hided=!i.value.hided)},C=()=>{const y=i.value;y&&gt.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{t(y.id)}).catch(()=>{})},U=()=>{const y=i.value;y&&r(y.id)},$=()=>{const y=i.value;y&&o(y.id)},D=y=>y.preventDefault();return ee(()=>{Z(document,"contextmenu",D)}),be(()=>{G(document,"contextmenu",D)}),{contextMenu:e,contextMenuStyle:s,isLocked:l,isHided:c,moveUp:f,moveDown:m,moveTop:h,moveBottom:b,toDeleteCom:C,renameCom:U,toCopyCom:$,lockCom:p,hideCom:V}}},R=n=>(se("data-v-4f88cc77"),n=n(),ie(),n),Na=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),Ua=T("\u7F6E\u9876 "),Ra=[Na,Ua],ja=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),Ea=T("\u7F6E\u5E95 "),Aa=[ja,Ea],Ha=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),Oa=T("\u4E0A\u79FB\u4E00\u5C42 "),Pa=[Ha,Oa],Wa=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),Fa=T("\u4E0B\u79FB\u4E00\u5C42 "),Ya=[Wa,Fa],Xa=R(()=>a("div",{class:"context-menu-divider"},null,-1)),qa=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),Ka=T("\u89E3\u9501 "),Za=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),Ga=T("\u9501\u5B9A "),Ja=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),Qa=T("\u663E\u793A "),el=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),tl=T("\u9690\u85CF "),nl=R(()=>a("div",{class:"context-menu-divider"},null,-1)),ol=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),al=T("\u91CD\u547D\u540D "),ll=[ol,al],sl=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),il=T("\u590D\u5236 "),cl=[sl,il],rl=R(()=>a("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),dl=T("\u5220\u9664 "),ml=[rl,dl];function ul(n,t,o,e,i,l){return v(),O(_t,{name:"zoom-in-top"},{default:x(()=>[e.contextMenu.show?(v(),g("div",{key:0,class:"context-menu-wrap",style:M(e.contextMenuStyle)},[a("div",{class:"context-menu-item",onClick:t[0]||(t[0]=(...c)=>e.moveTop&&e.moveTop(...c))},Ra),a("div",{class:"context-menu-item",onClick:t[1]||(t[1]=(...c)=>e.moveBottom&&e.moveBottom(...c))},Aa),a("div",{class:"context-menu-item",onClick:t[2]||(t[2]=(...c)=>e.moveUp&&e.moveUp(...c))},Pa),a("div",{class:"context-menu-item",onClick:t[3]||(t[3]=(...c)=>e.moveDown&&e.moveDown(...c))},Ya),Xa,a("div",{class:"context-menu-item",onClick:t[4]||(t[4]=(...c)=>e.lockCom&&e.lockCom(...c))},[e.isLocked?(v(),g(N,{key:0},[qa,Ka],64)):(v(),g(N,{key:1},[Za,Ga],64))]),a("div",{class:"context-menu-item",onClick:t[5]||(t[5]=(...c)=>e.hideCom&&e.hideCom(...c))},[e.isHided?(v(),g(N,{key:0},[Ja,Qa],64)):(v(),g(N,{key:1},[el,tl],64))]),nl,a("div",{class:"context-menu-item",onClick:t[6]||(t[6]=(...c)=>e.renameCom&&e.renameCom(...c))},ll),a("div",{class:"context-menu-item",onClick:t[7]||(t[7]=(...c)=>e.toCopyCom&&e.toCopyCom(...c))},cl),a("div",{class:"context-menu-item",onClick:t[8]||(t[8]=(...c)=>e.toDeleteCom&&e.toDeleteCom(...c))},ml)],4)):le("",!0)]),_:1})}var fl=B(za,[["render",ul],["__scopeId","data-v-4f88cc77"]]);function hl(){const n=Be(),{loadScreenData:t}=z(),o=I(!1),e=async i=>{try{o.value=!0;const l=await zt(i);l.data&&(await t(l.data),await _e(),document.title=l.data.pageInfo.name)}catch(l){console.log(l)}o.value=!1};return pe(()=>n.path,async()=>{const{id:i}=n.query;i&&await e(i)},{immediate:!0}),{loading:o}}const vl={name:"ScreenEditor",components:{ContextMenu:fl,FooterPanel:La,ToolboxPanel:Ca,CanvasMain:xo,ConfigPanel:ha,ComponentsPanel:On,LayerPanel:gn,HeaderBar:tn,SvgLoading:dt},setup(){const n=hl();return ee(()=>{Tt("data-schema","screen-editor")}),W({},n)}},pl={class:"schema-screen-container"},_l={key:0,flex:"main:center cross:center",class:"full-wrapper"},gl={key:1,class:"editor-main-wrapper"},bl={class:"edit-main-wp"};function yl(n,t,o,e,i,l){const c=_("header-bar"),s=_("svg-loading"),r=_("layer-panel"),d=_("components-panel"),f=_("toolbox-panel"),m=_("canvas-main"),h=_("footer-panel"),b=_("config-panel"),p=_("context-menu");return v(),g("div",pl,[u(c,{"back-url":"/dashboardDemo"}),n.loading?(v(),g("div",_l,[u(s,{name:"loading02"})])):(v(),g("div",gl,[u(r),u(d),a("div",bl,[u(f),u(m),u(h)]),u(b)])),u(p)])}var Il=B(vl,[["render",yl]]);export{Il as default};
