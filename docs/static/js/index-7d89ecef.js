import{u as k}from"./useSchemaStore-f69e9a12.js";import{as as $,aC as C,a5 as z,f as B,J as I,o as i,A as l,d as N,z as E,B as u,u as O,F as D,K as J,E as f,c as L,O as P}from"./vendor-95729a87.js";import{l as R}from"./database.api-ac0587f8.js";import{L as A,l as F,y as K,N as p}from"./index-e100dc50.js";import"./chunk-brace-269ffce0.js";import"./chunk-bin-ui-next-c6363b96.js";const V={name:"Screen",components:{GLoading:A},setup(){const d=C(),c=z(),{loadScreenData:m,pageConfig:t,comps:g}=k(),s=B(!0),r=()=>{const a=t.value.width,n=document.documentElement.clientWidth/a;p(document.body,{transform:`scale(${n})`,transformOrigin:"left top",backgroundSize:"100%",backgroundRepeat:"no-repeat"})},e=async()=>{const a=c.params.screenId,n=c.name;if(!a){await d.push("/notfound");return}try{s.value=!0;let o={};if(n==="Preview")o=await R();else{const v=await F(a);if(v){const{id:_,name:w,pid:y,layout:b,components:x}=v;o={pageInfo:{id:_,name:w,pid:y},pageConfig:JSON.parse(b),comps:x.map(S=>JSON.parse(S.componentContent))}}}o&&(await m(o),h(o),setTimeout(()=>{s.value=!1},500),K(window,"resize",r))}catch{await d.push("/notfound")}},h=a=>{const{pageInfo:n}=a;document.title=n.name,document.querySelector('meta[name="viewport"]').setAttribute("content",`width=${t.value.width}`),p(document.documentElement,{overflowX:"hidden",overflowY:"visible"}),p(document.body,{width:`${t.value.width}px`,height:`${t.value.height}px`,backgroundImage:`url(${t.value.bgImage})`,backgroundColor:t.value.bgColor}),r()};return e(),{loading:s,comps:g}}},q={class:"screen-wrapper"},G={class:"dv-loading"},T={class:"scene"};function W(d,c,m,t,g,s){const r=I("g-loading");return i(),l("div",q,[N(u("div",G,[O(r,{spinning:""})],512),[[E,t.loading]]),u("div",{class:"dv-layout",style:f({visibility:t.loading?"hidden":"visible"})},[u("div",T,[(i(!0),l(D,null,J(t.comps,e=>(i(),l("div",{class:"dv-com absolute",key:e.id,style:f({left:e.attr.x+"px",top:e.attr.y+"px",width:e.attr.w+"px",height:e.attr.h+"px",opacity:e.attr.opacity,transform:`rotate(${e.attr.rotate}deg)`})},[(i(),L(P(e.name),{data:e},null,8,["data"]))],4))),128))])],4)])}var U=$(V,[["render",W]]);export{U as default};
