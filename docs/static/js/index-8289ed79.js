var ze=Object.defineProperty,Ee=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var ge=(e,n,a)=>n in e?ze(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,O=(e,n)=>{for(var a in n||(n={}))Ke.call(n,a)&&ge(e,a,n[a]);if(ye)for(var a of ye(n))je.call(n,a)&&ge(e,a,n[a]);return e},J=(e,n)=>Ee(e,Ve(n));import{a6 as we,a7 as Re,y as X,n as re,j as ke,a4 as R,J as p,o as u,c as Q,w as m,u as i,q as B,t as C,B as o,f as Y,G as ee,h as ce,g as U,A as b,E as H,d as fe,z as Be,r as _e,a as D,s as me,D as se,I as Ue,a8 as oe,a9 as ae,p as Ie,F as q,K as P,X as We,L as Se,k as Oe}from"./vendor-0fc4fabe.js";import{a as te,M as Ye}from"./chunk-bin-ui-next-51eb6328.js";import{f as ie,g as He,a as Ge}from"./field-type-icon-e90083b8.js";import{d as K,h as be,t as Te,i as Z,J as Ce,j as qe,k as Je,m as Qe,n as Pe,r as Ze}from"./index-a4e94847.js";import{S as Xe}from"./index-afa28915.js";import"./chunk-brace-7fd40d4c.js";function et(){const e=we(),n=Re(),a=X({id:"",workspaceId:"",datasetName:"\u672A\u547D\u540D",datasourceName:"\u63A2\u7D22\u7A7A\u95F4"}),t=r=>{e.push(r||"/")},l=()=>{te.success(`\u4FDD\u5B58 [ ${a.datasetName} ] \u6210\u529F`)},h=()=>{a.datasetName=a.id==="dataset_0001"?"\u6570\u636E\u96C6\uFF08\u7A7A\uFF09":"\u6570\u636E\u96C6",a.datasourceName="\u63A2\u7D22\u7A7A\u95F4"};return re(()=>n.path,r=>{if(r!=="/schema/cube")return;const{id:c,workspaceId:f}=n.query;c&&f?(a.id=c,a.workspaceId=f,h()):te.error({message:"\u6CA1\u6709\u8BF7\u6C42\u53C2\u6570\uFF0C\u5373\u5C06\u5173\u95ED\u6B64\u9875\u9762\uFF01",onClose:window.close})},{immediate:!0}),ke(()=>{document.title=a.datasetName}),{dataset:a,handleSave:l,handleBack:t}}const tt={name:"setting-dropdown",props:{data:{type:Object,default:()=>({})}},emits:["command"],methods:{handleCommand(e){this.$emit("command",{name:e,node:this.data})}}},nt=o("i",{class:"b-iconfont b-icon-setting setting-action",style:{cursor:"pointer"}},null,-1),ot=B("\u7F16\u8F91"),at=B("\u5220\u9664");function lt(e,n,a,t,l,h){const r=p("b-dropdown-item"),c=p("b-dropdown-menu"),f=p("b-dropdown");return u(),Q(f,{trigger:"click",appendToBody:"",placement:"bottom-start",onCommand:h.handleCommand},{dropdown:m(()=>[i(c,null,{default:m(()=>[i(r,{icon:"edit-square",name:"edit"},{default:m(()=>[ot]),_:1}),i(r,{icon:"swap",name:"convert"},{default:m(()=>[B(C(`\u8F6C\u6362\u4E3A${a.data.type==="M"?"\u7EF4\u5EA6":"\u5EA6\u91CF"}`),1)]),_:1}),i(r,{icon:"delete",name:"delete"},{default:m(()=>[at]),_:1})]),_:1})]),default:m(()=>[nt]),_:1},8,["onCommand"])}var Ne=R(tt,[["render",lt]]);function st(e){const n=Y(null),a=Y(null),t=Y([]),l=X({stateTree:{},flatState:[],dragging:!1,loading:!1,dimensionTree:{},dimensionTreeFlats:[],dimensionFields:[],measureTree:{},measureTreeFlats:[],measureFields:[]}),h=Y(-1),r=Y(-1),c=X({fieldModal:!1,filedNode:{}});function f(_){const y=l.flatState[_].node;h.value=_,n.value&&n.value.open(e,y)}function d(_,y){l.flatState[_].node.fields.forEach(T=>{T._checked=y.includes(T.field)}),w()}function s(_){d(h.value,_)}function g(_,y,v){const{joinType:T,joinKeys:z}=v;d(r.value,_),d(h.value,y);const V=l.flatState[h.value].node;V.joinType=T,V.joinKeys=K(z)}function k(_,y){const v=l.flatState[_].node,T=l.flatState[y].node;h.value=_,r.value=y,a.value&&a.value.open(e,v,T)}function I(_,y){const v=l.flatState[_].node;if(v.nodeKey===0){l.stateTree={},x();return}const T=l.flatState[y].node,z=T.children.indexOf(v);T.children.splice(z,1),x(),w()}function $(_,y){const v=l.flatState[_].node,{fields:T}=v,z=t.value.find(pe=>pe.id===y),{id:V,title:j,tableName:Me,fields:ue}=z;if(!z)return;const he=v.children||[],ve=[];T.length&&ue.length&&ve.push({sourceKey:T[0].field,targetKey:ue[0].field}),he.push({id:V,title:j,tableName:Me,fields:ue.map(pe=>J(O({},pe),{_checked:!0})),joinType:"LEFT_OUTER_JOIN",joinKeys:ve}),v.children=he,x(),w()}function F(_){const y=t.value.find(j=>j.id===_),{id:v,title:T,tableName:z,fields:V}=y;!y||(l.stateTree={id:v,title:T,tableName:z,fields:V.map(j=>J(O({},j),{_checked:!0}))},x(),w())}function A({root:_,node:y,data:v}){const T=[ce("span",{class:`${v.type} t-ellipsis`,style:{width:"calc(100% - 24px)"},flex:"cross:center",title:`${v.title}-(${v.field})`},[v.nodeType!=="root"?ce(ie,{type:v.dataType,style:{marginRight:"4px"}}):null,v.title])];return v.nodeType!=="root"&&T.push(ce(Ne,{data:v,onCommand:E})),ce("span",{style:{width:"100%",fontSize:"12px"},flex:"main:justify"},T)}function E({name:_,node:y}){_==="edit"?(c.fieldModal=!0,c.filedNode={field:y.field,title:y.title,nodeKey:y.nodeKey,type:y.type}):_==="convert"?S(y):_==="delete"&&N(y)}function L(){const{title:_,type:y,nodeKey:v}=c.filedNode,T=y==="D"?l.dimensionTreeFlats[v].node:l.measureTreeFlats[v].node;T.title=_,c.fieldModal=!1}function S(_){if(_.type==="D"){const y=l.dimensionTreeFlats[_.nodeKey].parent,v=l.dimensionTreeFlats[y].node;if(v!==void 0){const z=v.children.indexOf(_);v.children.splice(z,1)}const T=l.measureTree.children||[];T.push({fieldId:_.fieldId,tableId:_.tableId,field:_.field,title:_.title,dataType:_.dataType,nodeType:"attribute",type:"M"}),l.measureTree.children=T,l.measureTree=K(l.measureTree)}else{const y=l.measureTreeFlats[_.nodeKey].parent,v=l.measureTreeFlats[y].node;if(v!==void 0){const z=v.children.indexOf(_);v.children.splice(z,1)}const T=l.dimensionTree.children||[];T.push({fieldId:_.fieldId,tableId:_.tableId,field:_.field,title:_.title,dataType:_.dataType,nodeType:"attribute",type:"D"}),l.dimensionTree.children=T,l.dimensionTree=K(l.dimensionTree)}W({dimension:l.dimensionTree,measure:l.measureTree})}function N(_){const{tableId:y,fieldId:v}=_,T=l.flatState.find(j=>j.node.id===y),z=T.nodeKey,V=T.node.fields.filter(j=>j._checked&&j.fieldId!==v).map(j=>j.field);d(z,V)}const x=()=>{l.flatState=be(l.stateTree)},w=()=>{const _=l.flatState.map(z=>z.node),y=[],v=[];_.forEach(z=>{z.fields.forEach(V=>{const j={fieldId:V.fieldId,field:V.field,title:V.title,dataType:V.dataType,type:V.type,nodeType:"attribute",tableId:z.id};V._checked&&(V.type==="D"?y.push(j):v.push(j))})}),W({dimension:{title:"\u7EF4\u5EA6",nodeType:"root",children:y},measure:{title:"\u5EA6\u91CF",nodeType:"root",children:v}})},W=_=>{const{dimension:y,measure:v}=_||{};l.dimensionTree=y||{title:"\u7EF4\u5EA6",nodeType:"root",children:[]},l.measureTree=v||{title:"\u5EA6\u91CF",nodeType:"root",children:[]},l.dimensionTreeFlats=be(l.dimensionTree),l.measureTreeFlats=be(l.measureTree),l.dimensionFields=l.dimensionTreeFlats.filter(T=>T.node.nodeType==="attribute"),l.measureFields=l.measureTreeFlats.filter(T=>T.node.nodeType==="attribute")};function M(_,y,v){return y.nodeType==="attribute"?v!=="inner":y.nodeType!=="root"}function G(_){return _.nodeType==="attribute"}function ne(_,y,v,T){W({dimension:l.dimensionTree,measure:l.measureTree})}return(async()=>{l.loading=!0;try{const{physicalSchema:_,cubeSchema:y}=await He(e);l.stateTree=_,x(),W(y)}catch(_){Te("cube-table-list/initTable",_)}l.loading=!1})(),J(O(O({nodeEditRef:n,linkEditRef:a,tableList:t},ee(l)),ee(c)),{currentNodeKey:h,currentParentNodeKey:r,allowDrop:M,allowDrag:G,handleDrop:ne,handleNodeClick:f,handleNodeRemove:I,handleNodeDrop:$,handleLinkClick:k,handleEmptyDrop:F,saveSelectedFields:s,saveJoinKeys:g,renderContent:A,handleDmCommand:E,saveField:L})}const it={name:"page-cube-wrapper",props:{leftDefaultWidth:{type:String,default:"240px"},leftExpandText:{type:String,default:"\u5C55\u5F00"},leftCollapseText:{type:String,default:"\u6536\u8D77"},defaultHeight:{type:Number,default:280},defaultMinHeight:{type:Number,default:12},draggableMinHeight:{type:Number,default:48}},setup(e,{slots:n}){const a=Y(null),t=X({active:!1,hasMoved:!1,height:e.defaultHeight,wrapHeight:0}),l=Y(!0),h=U(()=>l.value?e.leftDefaultWidth:"12px"),r=U(()=>n.left&&l.value?`calc(100% - ${e.leftDefaultWidth})`:"100%"),c=()=>{l.value=!l.value},f=k=>{if(k==="default")t.height=e.defaultHeight;else if(k==="maximum")t.height=e.defaultMinHeight;else{if(!a.value)return;t.height=a.value.clientHeight-e.draggableMinHeight}},d=()=>{!n.draggable||(t.active=!0,t.hasMoved=!1)},s=()=>{!n.draggable||(t.active=!1)},g=k=>{if(!!n.draggable&&((k.buttons===0||k.which===0)&&(t.active=!1),t.active)){let I=0,$=k.currentTarget;for(t.wrapHeight=$.clientHeight;$;)I+=$.offsetTop,$=$.offsetParent;const A=k.pageY-I;A>e.defaultMinHeight&&A<t.wrapHeight-e.draggableMinHeight&&(t.height=A),t.hasMoved=!0}};return J(O({cubeRef:a},ee(t)),{leftExpand:l,leftWidth:h,rightWidth:r,toggleLeft:c,changeDragStatus:f,onResizeMouseDown:d,onResizeMouseUp:s,onResizeMouseMove:g})}},dt={class:"page-cube-wrapper",ref:"cubeRef"},rt={class:"page-cube"},ct=["title"],ut={class:"cube-left-content"},pt={class:"toggle"};function ft(e,n,a,t,l,h){const r=p("b-icon");return u(),b("div",dt,[o("div",rt,[e.$slots.left?(u(),b("div",{key:0,class:"page-cube-left",style:H({width:t.leftWidth})},[o("div",{class:"toggle",style:H({left:t.leftWidth,opacity:t.leftExpand?null:1}),title:t.leftExpand?a.leftCollapseText:a.leftExpandText,onClick:n[0]||(n[0]=(...c)=>t.toggleLeft&&t.toggleLeft(...c))},[i(r,{name:t.leftExpand?"caret-left":"caret-right"},null,8,["name"])],12,ct),fe(o("div",ut,[_e(e.$slots,"left",{},void 0,!0)],512),[[Be,t.leftExpand]])],4)):D("",!0),o("div",{class:"page-cube-content",onMouseup:n[5]||(n[5]=(...c)=>t.onResizeMouseUp&&t.onResizeMouseUp(...c)),onMousemove:n[6]||(n[6]=(...c)=>t.onResizeMouseMove&&t.onResizeMouseMove(...c)),style:H({width:t.rightWidth,cursor:e.active?"col-resize":"",userSelect:e.active?"none":""})},[e.$slots.default?(u(),b("div",{key:0,style:H({height:e.$slots.draggable?e.height+"px":"100%"})},[_e(e.$slots,"default",{},void 0,!0)],4)):D("",!0),e.$slots.draggable?(u(),b("div",{key:1,class:"draggable-content",style:H({height:`calc(100% - ${e.height}px)`})},[o("div",pt,[o("i",{class:"b-iconfont b-icon-caret-up",title:"\u5C55\u5F00",onClick:n[1]||(n[1]=c=>t.changeDragStatus("maximum"))}),o("i",{class:"b-iconfont b-icon-caret-down",title:"\u6536\u8D77",onClick:n[2]||(n[2]=c=>t.changeDragStatus("minimum"))}),o("i",{class:"b-iconfont b-icon-creditcard-fill",title:"\u9ED8\u8BA4\u9AD8\u5EA6",onClick:n[3]||(n[3]=c=>t.changeDragStatus("default"))})]),o("div",{class:"drag-handler",draggable:"true",onMousedown:n[4]||(n[4]=(...c)=>t.onResizeMouseDown&&t.onResizeMouseDown(...c))},null,32),_e(e.$slots,"draggable",{},void 0,!0)],4)):D("",!0)],36)])],512)}var _t=R(it,[["render",ft],["__scopeId","data-v-cef1aa30"]]);const mt={name:"link-node",props:{data:{type:Object,default:()=>({})},defaultIcon:{type:String,default:"table"}},setup(e){const n=me("LinkNodeInstance",{}),a=U(()=>[n.states.flatState,n.states.flatState.find(s=>s.nodeIndex===e.data.nodeIndex)]);function t(s){s==="selected"?l():s==="remove"&&h()}function l(){e.data.isEmpty||n.handleNodeClick(e.data.nodeIndex)}function h(){e.data.isEmpty||Ye.confirm({type:"warning",title:`\u786E\u5B9A\u8981\u5220\u9664 [ ${e.data.title} ] \u5417\uFF1F`,message:"\u5220\u9664\u540E\uFF0C\u5C06\u6E05\u9664\u6B64\u8868\u76F8\u5173\u914D\u7F6E\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\u3002"}).then(()=>{n.handleNodeRemove(e.data.nodeIndex)}).catch(()=>{})}let r=null;function c(s){r=s.target,n.onNodeDragenter(e.data.nodeIndex)}function f(s){r===s.target&&n.onNodeDragleave(e.data.nodeIndex)}function d(s){n.onNodeDrop(e.data.nodeIndex,s.dataTransfer.getData("id"))}return{node:a,activeCommand:t,nodeClick:l,onDragEnter:c,onDragLeave:f,onDrop:d}}},Ae=e=>(oe("data-v-519a72c3"),e=e(),ae(),e),bt={class:"link-node-title",style:{height:"28px",padding:"5px 8px"}},ht={class:"link-node-name"},vt={class:"link-node-handle"},yt=Ae(()=>o("span",null,"\u5B57\u6BB5\u9009\u62E9",-1)),gt=Ae(()=>o("span",null,"\u5220\u9664",-1));function wt(e,n,a,t,l,h){const r=p("b-icon"),c=p("b-dropdown-item"),f=p("b-dropdown-menu"),d=p("b-dropdown");return u(),b("div",{class:se(["link-node-info",{"is-empty":a.data.isEmpty}]),onClick:n[1]||(n[1]=(...s)=>t.nodeClick&&t.nodeClick(...s)),onDrop:n[2]||(n[2]=s=>t.onDrop(s)),onDragover:n[3]||(n[3]=s=>s.preventDefault()),onDragenter:n[4]||(n[4]=s=>t.onDragEnter(s)),onDragleave:n[5]||(n[5]=s=>t.onDragLeave(s))},[o("div",bt,[a.data.isEmpty?D("",!0):(u(),b("i",{key:0,class:se(["link-node-icon",`b-iconfont b-icon-${a.data.icon||a.defaultIcon}`])},null,2)),o("div",ht,C(a.data.title),1),o("div",vt,[a.data.isEmpty?D("",!0):(u(),Q(d,{key:0,placement:"bottom-end",onCommand:t.activeCommand,"append-to-body":""},{dropdown:m(()=>[i(f,{style:{width:"180px"}},{default:m(()=>[i(c,{name:"selected"},{default:m(()=>[i(r,{name:"code"}),yt]),_:1}),a.data.isLeaf?(u(),Q(c,{key:0,name:"remove",style:{color:"#ed4014"}},{default:m(()=>[i(r,{name:"delete"}),gt]),_:1})):D("",!0)]),_:1})]),default:m(()=>[o("i",{class:"b-iconfont b-icon-ellipsis",onClick:n[0]||(n[0]=Ue(()=>{},["stop","prevent"]))})]),_:1},8,["onCommand"]))])])],34)}var kt=R(mt,[["render",wt],["__scopeId","data-v-519a72c3"]]);const It={name:"join-type",props:{type:{type:String,default:""},size:{type:Number,default:8}},computed:{showJoin(){return!Z(Ce[this.type])},svgType(){return{LEFT_OUTER_JOIN:[.5,0,.5],INNER_JOIN:[0,0,.5],FULL_OUTER_JOIN:[.5,.5,.5]}[this.type]},svgSize(){return{width:`${this.size*3}px`,height:`${this.size*2}px`}}}},xe=e=>(oe("data-v-1722403c"),e=e(),ae(),e),St={key:0,class:"svg-icon-wrapper"},Tt=["fill-opacity"],Ct=["fill-opacity"],Nt=["fill-opacity"],At=xe(()=>o("path",{d:"M512 0c282.7776 0 512 229.2224 512 512s-229.2224 512-512 512S0 794.7776 0 512 229.2224 0 512 0z m0 51.2a460.8 460.8 0 1 0 0 921.6 460.8 460.8 0 0 0 0-921.6z",fill:"#2153D4"},null,-1)),xt=xe(()=>o("path",{d:"M1024 0c282.7776 0 512 229.2224 512 512s-229.2224 512-512 512-512-229.2224-512-512S741.2224 0 1024 0z m0 51.2a460.8 460.8 0 1 0 0 921.6 460.8 460.8 0 0 0 0-921.6z",fill:"#2153D4"},null,-1));function $t(e,n,a,t,l,h){return h.showJoin?(u(),b("i",St,[(u(),b("svg",{class:"svg-icon",style:H(h.svgSize),viewBox:"0 0 1536 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[o("path",{d:"M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z",fill:"#2153D4","fill-opacity":h.svgType[0]},null,8,Tt),o("path",{d:"M1024 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z",fill:"#2153D4","fill-opacity":h.svgType[1]},null,8,Ct),o("path",{d:"M768.0512 68.5056A511.7952 511.7952 0 0 1 1024 512a511.7952 511.7952 0 0 1-255.9488 443.4944A511.6416 511.6416 0 0 1 512 512a511.744 511.744 0 0 1 249.7536-439.808z",fill:"#2153D4","fill-opacity":h.svgType[2]},null,8,Nt),At,xt],4))])):D("",!0)}var $e=R(It,[["render",$t],["__scopeId","data-v-1722403c"]]);const Lt={name:"node-tip",components:{JoinType:$e},props:{data:{type:Object,default:()=>({})}},setup(e){const n=me("LinkNodeInstance",{}),a=U(()=>[n.states.flatState,n.states.flatState.find(r=>r.nodeIndex===e.data.nodeIndex)]),t=U(()=>e.data.isKnee),l=U(()=>{const[r,c]=a.value,{row:f,isKnee:d}=c.node,s=r[c.parent],g=s?s.node.row:0;return qe(f,d,g)});function h(){e.data.isEmpty||n.handleLinkClick(e.data.nodeIndex)}return{node:a,isKnee:t,lineStyle:l,linkClick:h}}},Dt={key:0,class:"node-icon-wrapper"};function Ft(e,n,a,t,l,h){const r=p("join-type");return u(),b("div",{class:se(["node-tip",{"is-empty":a.data.isEmpty}]),onClick:n[0]||(n[0]=(...c)=>t.linkClick&&t.linkClick(...c))},[a.data.isEmpty?D("",!0):(u(),b("div",Dt,[i(r,{type:a.data.joinType},null,8,["type"])])),o("div",{class:"node-line horizontal",style:H(t.lineStyle[0])},null,4),o("div",{class:"node-line vertical",style:H(t.lineStyle[1])},null,4)],2)}var Mt=R(Lt,[["render",Ft],["__scopeId","data-v-1c66abe1"]]),zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAA8CAYAAACZ1L+0AAADo0lEQVR4Ae3Bz09TBwAA4I/X51KgTl0VXCjRoYu/IiYkW4hZjFtMPO2yw/6A/Xk77DaHC8l28MeUw3AHdUPBBZmAaJxRbIG2O/RACC3QYt97Ze/7pFKpVCqVSqVSqf+dLsnSjcvI4S2eYQ7PUbUHdUmeEF/huHXL+AMPsGoPyUieCqYR4qiafSjgLFawZI/ISK45lDFgXYhjOISnKOtwGck2jx4csdEhfIJprOlgGcn3FMfQY6MsCniMsg6VkXxVLOI0umzUg35M6VAZneEd9uOwzfajhEUdKNA57mnsM/TqQBmdo4hB9Nosg2480WFCyRGgX30lvMQc+tR3ArdRxAfIa2wBFQkQSo5hfK6+OfyIBY0FOIV7yONrjd3FpAQIJUMOI2pmbbakZtnWTuMeSphV3yBG8AhvxCyUDKMIcR83NFa0tQPI4SV+Ut8XOItRjItZIH4FDKGICVsLbK/f1iZQxBAKYhaIV4CLau6gZGvdttdnayXcVXMRgRiF4jWMg1jEX9YdwFGb5W1vEC9tNo9/1fyJ0+jDMCbFpEt8cvgWIX7AknUBruC49+MJxlGx7jC+wRq+xxsxyIjPJeRxHw9tVMUM8jhod/7GOCo2WkY3+tGLaTEIxKOAIRQxob4KxjGrdbMYR0V9EyhiCAUxyIhegKvI4iYWNFbFDPrwoeY8xc8oa6yMEo7hCB6gKkIZ0buAE1jELdurYgb92G9n/sF1lG3vBQaRxxrmRSgQrRxG1NxA1c6sYQzPbO8ZxrBmZ6q4oWYEORHKiNYl5HEfDzWnghl8jJz65jGGNc1ZRjf60YtpEQlEp4AhFDGhNasYw6LNFjGGVa2ZQBFDKIhIRjQCXEUWt7CgdWVMYwC9ap7jGla0rowSjuEIHqCqzTKicQEnsIibdq+MGRSwjGtYsXsvMIg81jCvzTLaL4crCHAdy96PMqYxhZL3Zwln0I8prGijUPuNIkQRw5rzG5Y1VrK9HoxqThFZjGJcG4Xab0hNFic15x1u250LOKk1Q9osFI1V/GLnQlzGGUzindZ04wwq+BVrdu5L7NNmoWiU8URzBnAKw7ijNcMI8RCPNKeMfdoskFy/o4pzyGpeFudQxaSECiTXa0whxHnNG0aIKbyWUKFkm8SnOI8BzfkIVUxKsFCyvcJjnESf5j3CKwkWSr6bmNSatxIulHwllOxRgVSsAqlYBVKxCqRiFYpGFt/pLKEIhKITSqVSqVQqlUqlUqmU/wBjNtrujueJ3QAAAABJRU5ErkJggg==",Et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAAB4CAYAAACkRf0fAAABs0lEQVR4Ae3BQWolSQwFwJfCdxX/REanzd4WBm+6YJpBEREAAAAAAAAAAAAAAAAAAAAAAAAAAOCfODNzs1h3nyw2MzeLVWCxCixWgcUqsFgFFqvAYhVYrAKLVWCxCixWgcUqsFgFFqvAYhVY7Cs/dPfJCzNz89DdJy/MzM1Dd5+8MDM3/Kq7T16YmZuH7j55YWZuHrr75IWZuXmowGIVWKwCi1VgsQosVoHFKrBYBRarwGIVWKwCi52ZuVmsu08Wm5mbxSqw2Fd45fv7++Yf+nw+J/y1Ciz2lR+6++SFmbl56O6TF2bm5qG7T16YmRt+1d0nL8zMzUN3n7wwMzcP3X3ywszcPFRgsa/wyufzOeF/qwKLVWCxCixWgcUqsFgFFqvAYhVYrAKLnZm5Way7TxabmZvFKrBYBRarwGJf+aG7T16YmZuH7j55YWZuHrr75IWZueFX3X3ywszcPHT3yQszc/PQ3ScvzMzNQwUWq8BiFVisAotVYLEKLFaBxSqwWAUWq8BiFVjszMzNYt19stjM3CxWgcUqsFgFAAAAAAAAAAAAAAAAAAAAAAAAAAAA/mN/AMETaOvxWxpaAAAAAElFTkSuQmCC";const Vt={name:"link-node-wrapper",components:{NodeTip:Mt,LinkNode:kt},props:{data:{type:Object,default:()=>({})},defaultIcon:{type:String,default:"table"},emptyText:{type:String,default:"\u8BF7\u4ECE\u5DE6\u4FA7\u62D6\u62FD\u6570\u636E\u8868\u5F00\u59CB\u521B\u5EFA"},emptyNodeText:{type:String,default:"\u62D6\u62FD\u5DE6\u4FA7\u8868\u81F3\u6B64\u6DFB\u52A0\u5173\u8054\u8868"},helpText:{type:String,default:"\u7EE7\u7EED\u4ECE\u5DE6\u4FA7\u62D6\u62FD\u6570\u636E\u8868\u8FDB\u884C\u8868\u5173\u8054"},dragging:{type:Boolean,default:!1},dev:{type:Boolean,default:!1}},emits:["node-click","node-remove","link-click","node-drop","empty-drop"],setup(e,{emit:n}){const a=X({stateTree:{},flatState:[],renderList:[],maxLevel:0,maxRow:0,dragoverNodeIndex:-1}),t=Y(!1),l=U(()=>Z(a.stateTree)),h=U(()=>a.stateTree.isLeaf),r=U(()=>{const S=e.dev&&t.value?{background:"red",width:"100px"}:{},{maxLevel:N,maxRow:x}=a;return Je(N,x,S)});function c(){let S=0,N=0,x=0,w="children";const W=(M,G=0)=>{if(!Z(M))if(M.nodeKey=N++,M.nodeIndex=S++,M.level=G,M.row=x,M.isEmpty=!1,Z(M[w]))M.isLeaf=!0,M[w]=[{title:e.emptyNodeText,level:G+1,row:x,isEmpty:!0,isKnee:!1,nodeIndex:S++}];else{M.isLeaf=!1;const ne=G+1;M[w].forEach((le,_)=>{_===0?(le.row=x,le.isKnee=!1):(le.row=++x,le.isKnee=!0),W(le,ne)}),M[w].push({title:e.emptyNodeText,level:G+1,nodeIndex:S++,row:++x,isEmpty:!0,isKnee:!0})}};W(a.stateTree)}function f(){let S="children";const N=[],x=(w,W,M)=>{if(Z(w))return;N[w.nodeIndex]={node:w,nodeIndex:w.nodeIndex},typeof W!="undefined"&&(N[w.nodeIndex].parent=W.nodeIndex,N[W.nodeIndex][S].push(w.nodeIndex));let G=M?M.split(",").map(ne=>+ne):[];typeof M!="undefined"&&(G.push(W.nodeIndex),N[w.nodeIndex].parents=G),w[S]&&(N[w.nodeIndex][S]=[],w[S].forEach(ne=>x(ne,w,G.join(","))))};x(a.stateTree),a.flatState=N}function d(){a.renderList=s(),a.maxLevel=Math.max.apply(Math,a.flatState.map(S=>S.node.level)),a.maxRow=Math.max.apply(Math,a.flatState.map(S=>S.node.row))}function s(){const S=[];return a.flatState.forEach(N=>{const{row:x,level:w}=N.node,{nodeStyle:W,tipStyle:M}=Qe(x,w),G=N.node.isEmpty?e.dragging:!0;S.push(J(O({},N),{visible:G,nodeStyle:W,tipStyle:M}))}),S}function g(){a.stateTree=K(e.data),c(),f(),d()}function k(S){const N=a.flatState[S].node;n("node-click",N.nodeKey)}function I(S){const N=a.flatState[S],x=N.node,w=x.nodeKey===0?{}:a.flatState[N.parent].node;n("node-remove",x.nodeKey,w.nodeKey)}function $(S){const N=a.flatState[S],x=N.node,w=a.flatState[N.parent].node;n("link-click",x.nodeKey,w.nodeKey)}function F(S){a.dragoverNodeIndex=S}function A(){a.dragoverNodeIndex=-1}function E(S,N){const x=a.flatState[S],w=a.flatState[x.parent].node;n("node-drop",w.nodeKey,N)}function L(S){n("empty-drop",S.dataTransfer.getData("id"))}return Ie("LinkNodeInstance",{states:a,handleNodeClick:k,handleNodeRemove:I,handleLinkClick:$,onNodeDragenter:F,onNodeDragleave:A,onNodeDrop:E}),re(()=>e.data,()=>{g()},{deep:!0,immediate:!0}),re(()=>e.dragging,()=>{d()},{immediate:!0}),J(O({},ee(a)),{debugVisible:t,dataEmpty:l,linkMargin:r,onlyRoot:h,onEmptyDrop:L})}},Le=e=>(oe("data-v-0889f0f8"),e=e(),ae(),e),Kt={class:"link-node-wrapper"},jt=Le(()=>o("img",{src:zt,alt:"empty"},null,-1)),Rt={key:2,class:"help-wrapper"},Bt=Le(()=>o("img",{src:Et,alt:"empty"},null,-1)),Ut={key:3,class:"dev"},Wt={flex:"box:mean"};function Ot(e,n,a,t,l,h){const r=p("node-tip"),c=p("link-node"),f=p("b-button"),d=p("b-ace-editor"),s=p("b-modal");return u(),b("div",Kt,[t.dataEmpty?(u(),b("div",{key:1,class:se({"empty-tips":!0,dragging:a.dragging}),onDrop:n[0]||(n[0]=g=>t.onEmptyDrop(g)),onDragover:n[1]||(n[1]=g=>g.preventDefault())},[jt,o("p",null,C(a.emptyText),1)],34)):(u(),b(q,{key:0},[(u(!0),b(q,null,P(e.renderList,(g,k)=>(u(),b("div",{class:se(["link-wrapper",{"empty-highlight":g.node.isEmpty&&g.nodeIndex!==e.dragoverNodeIndex}]),key:k},[g.visible&&g.node.level>0?(u(),Q(r,{key:0,data:g.node,style:H(g.tipStyle)},null,8,["data","style"])):D("",!0),g.visible?(u(),Q(c,{key:1,data:g.node,style:H(g.nodeStyle)},null,8,["data","style"])):D("",!0)],2))),128)),o("div",{class:"link-margin",style:H(t.linkMargin[0])},null,4),o("div",{class:"link-margin",style:H(t.linkMargin[1])},null,4)],64)),t.onlyRoot?(u(),b("div",Rt,[Bt,o("p",null,C(a.helpText),1)])):D("",!0),a.dev?(u(),b("div",Ut,[i(f,{type:"danger",size:"mini",icon:"bug",onClick:n[2]||(n[2]=g=>t.debugVisible=!0)}),i(s,{title:"Debug Data",width:"800",modelValue:t.debugVisible,"onUpdate:modelValue":n[3]||(n[3]=g=>t.debugVisible=g),"destroy-on-close":""},{default:m(()=>[o("div",Wt,[i(d,{"model-value":JSON.stringify({sourceData:a.data},null,2)},null,8,["model-value"]),i(d,{"model-value":JSON.stringify({stateTree:e.stateTree,flatState:e.flatState},null,2)},null,8,["model-value"])])]),_:1},8,["modelValue"])])):D("",!0)])}var Yt=R(Vt,[["render",Ot],["__scopeId","data-v-0889f0f8"]]);const Ht={name:"cube-svg"},Gt={class:"iconfont svg-icon-wrapper"},qt=o("svg",{class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[o("path",{d:"M93.090909 814.545455L456.145455 930.909091v-451.490909L93.090909 358.4zM512 93.090909L93.090909 232.727273l418.909091 144.290909L930.909091 232.727273zM567.854545 926.254545l363.054546-116.363636V358.4l-363.054546 116.363636z"})],-1),Jt=[qt];function Qt(e,n,a,t,l,h){return u(),b("i",Gt,Jt)}var Pt=R(Ht,[["render",Qt]]);const Zt={name:"cube-header",components:{CubeSvg:Pt},emits:["update:modelValue","save","back"],props:{modelValue:{type:String,default:""},backUrl:{type:String},pageStatus:{type:Object,default:()=>({})}},setup(e,{emit:n}){const a=Y(""),t=we(),l=()=>{n("back",e.backUrl)},h=()=>{n("save")},r=f=>{n("update:modelValue",f.target.value.trim())},c=()=>{const{id:f,workspaceId:d}=e.pageStatus;let s=t.resolve({path:"/schema/screen",query:{workspaceId:d,sourceId:f,sourceType:"cube"}});window.open(s.href,"_blank")};return re(()=>e.modelValue,f=>{a.value=f},{immediate:!0}),{name:a,handleSave:h,handleInputChange:r,handleBack:l,handleCreatePc:c}}},Xt={class:"action-panel"},en={class:"header-container"},tn={class:"simple-header-left"},nn={class:"simple-cube-icon"},on={class:"simple-header-right"},an={class:"cube-btn",flex:"cross:center"},ln=B(" \u5F00\u59CB\u5206\u6790 ");function sn(e,n,a,t,l,h){const r=p("b-icon"),c=p("b-tooltip"),f=p("cube-svg"),d=p("b-space");return u(),b("div",Xt,[o("div",en,[o("div",tn,[i(c,{content:"\u8FD4\u56DE"},{default:m(()=>[o("div",{class:"simple-header-icon",onClick:n[0]||(n[0]=(...s)=>t.handleBack&&t.handleBack(...s))},[i(r,{name:"left",size:"24"})])]),_:1}),o("div",nn,[i(f)]),fe(o("input",{class:"simple-header-input",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",maxlength:"50",type:"text","onUpdate:modelValue":n[1]||(n[1]=s=>t.name=s),onInput:n[2]||(n[2]=(...s)=>t.handleInputChange&&t.handleInputChange(...s))},null,544),[[We,t.name]])]),o("div",on,[o("div",an,[i(d,{size:"large"},{default:m(()=>[i(c,{content:"\u53E6\u5B58\u4E3A"},{default:m(()=>[i(r,{name:"file-copy",size:"18",type:"button"})]),_:1}),i(c,{content:"\u5E2E\u52A9"},{default:m(()=>[i(r,{name:"question-circle",size:"18",type:"button"})]),_:1}),o("span",{class:"primary-btn",onClick:n[3]||(n[3]=(...s)=>t.handleSave&&t.handleSave(...s))},"\u4FDD\u5B58")]),_:1})]),o("div",{class:"cube-navigator",onClick:n[4]||(n[4]=(...s)=>t.handleCreatePc&&t.handleCreatePc(...s))},[i(r,{name:"barchart",size:"16"}),ln])])])])}var dn=R(Zt,[["render",sn],["__scopeId","data-v-1614ec89"]]);const rn={name:"node-list",components:{FieldTypeIcon:ie},props:{data:{type:Array,default:()=>[]},allNodeTitle:{type:Array,default:()=>[]},rootNode:{type:Object,default:()=>({})},loading:{type:Boolean}},emits:["start","end"],setup(e,{emit:n}){const a=X({visible:!1,current:{}});function t(r,c){if(e.rootNode.title===c.title){te.warning("\u5F53\u524D\u6570\u636E\u8868\u5DF2\u7ECF\u5B58\u5728\uFF0C\u8BF7\u4E0D\u8981\u91CD\u590D\u5173\u8054\uFF01");return}r.dataTransfer.setData("id",c.id),n("start")}function l(){n("end")}function h(r){Z(r.fields)||(a.visible=!0,a.current=K(r))}return J(O({},ee(a)),{onDrag:t,onDragEnd:l,handleClick:h})}},cn={class:"datasource-content-list",id:"table-drag"},un=["onDragstart"],pn={class:"title"},fn={class:"table-info"},_n={class:"table-info-header"},mn={class:"table-info-title"},bn={class:"fields-number"},hn={class:"table-info-fields"},vn={class:"table-field-icon"},yn={class:"table-field-name"},gn={class:"table-field-title"};function wn(e,n,a,t,l,h){const r=p("b-icon"),c=p("b-divider"),f=p("field-type-icon"),d=p("b-modal"),s=Se("loading"),g=Se("no-data");return fe((u(),b("div",cn,[(u(!0),b(q,null,P(a.data,k=>(u(),b("div",{key:k.id,class:se(["datasource-content-item",{"has-used":a.allNodeTitle.includes(k.title)}]),draggable:"true",onDragstart:I=>t.onDrag(I,k),onDragend:n[0]||(n[0]=(...I)=>t.onDragEnd&&t.onDragEnd(...I))},[i(r,{name:"file-text",size:"16"}),o("span",pn,C(k.title),1),i(r,{name:"info-circle",type:"button",onClick:I=>t.handleClick(k)},null,8,["onClick"])],42,un))),128)),i(d,{modelValue:e.visible,"onUpdate:modelValue":n[1]||(n[1]=k=>e.visible=k)},{default:m(()=>[o("div",fn,[o("div",_n,C(e.current.tableName),1),o("div",mn,C(e.current.title),1),o("div",bn,"\u5305\u542B\u5B57\u6BB5"+C(e.current.fields.length),1),i(c,{style:{margin:"4px 0 16px"}}),o("div",hn,[(u(!0),b(q,null,P(e.current.fields,k=>(u(),b("div",{class:"table-info-field-line",key:k.field},[o("div",vn,[i(f,{type:k.dataType},null,8,["type"])]),o("div",yn,[o("span",null,C(k.field),1)]),o("div",gn,[o("span",null,C(k.title),1)])]))),128))])])]),_:1},8,["modelValue"])],512)),[[s,a.loading],[g,a.data.length===0]])}var kn=R(rn,[["render",wn],["__scopeId","data-v-6cb408b0"]]);const In={name:"cube-table-list",components:{NodeList:kn},setup(){const e=Y(!1),n=me("BiCube",{}),a=U(()=>n.schemaStatus.flatState.value.map(f=>f.node.title)),t=U(()=>n.schemaStatus.stateTree.value),l=U(()=>n.schemaStatus.tableList.value),h=()=>{n.schemaStatus.dragging.value=!0},r=()=>{n.schemaStatus.dragging.value=!1};return(async()=>{e.value=!0;try{n.schemaStatus.tableList.value=await Ge(n.pageStatus.dataset.workspaceId)}catch(f){Te("cube-table-list/initTable")}e.value=!1})(),{tableList:l,tableListLoading:e,allNodeTitle:a,stateTree:t,handleDragStart:h,handleDragEnd:r}}},De=e=>(oe("data-v-3fe773ca"),e=e(),ae(),e),Sn={class:"datasource-wrapper"},Tn={class:"datasource-switcher-wrapper"},Cn=De(()=>o("div",{class:"datasource-label"},"\u9009\u62E9\u6570\u636E\u6E90",-1)),Nn={class:"datasource-table-search"},An=De(()=>o("input",{placeholder:"\u641C\u7D22\u6570\u636E\u8868/\u6587\u4EF6",type:"text",value:""},null,-1));function xn(e,n,a,t,l,h){const r=p("b-option"),c=p("b-select"),f=p("b-icon"),d=p("node-list");return u(),b("div",Sn,[o("div",Tn,[Cn,i(c,{"model-value":"test_datasource",size:"mini"},{default:m(()=>[i(r,{value:"test_datasource",label:"\u63A2\u7D22\u7A7A\u95F4"})]),_:1})]),o("div",Nn,[i(f,{name:"search",type:"button"}),An,i(f,{name:"redo",type:"button"})]),i(d,{data:t.tableList,"all-node-title":t.allNodeTitle,"root-node":t.stateTree,loading:t.tableListLoading,onStart:t.handleDragStart,onEnd:t.handleDragEnd},null,8,["data","all-node-title","root-node","loading","onStart","onEnd"])])}var $n=R(In,[["render",xn],["__scopeId","data-v-3fe773ca"]]);const Ln={name:"cube-node-edit",components:{FieldTypeIcon:ie},emits:["save"],setup(e,{emit:n}){const a=Y(!1),t=X({dataset:{},tableInfo:{},selections:[]}),l=U(()=>{const d=t.tableInfo.fields||[];return Z(d)?"":`\u5B57\u6BB5\u9009\u62E9(${t.selections.length}/${d.length})`}),h=(d,s)=>{c(d,s),f(),a.value=!0},r=()=>{const d=t.selections;if(d.length===0){te.error({message:"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6709\u6548\u5B57\u6BB5\uFF01",zIndex:2500});return}n("save",d.map(s=>s.field)),a.value=!1},c=(d,s)=>{t.dataset=K(d),t.tableInfo=K(s)},f=d=>{if(d)t.selections=K(d);else{const s=t.tableInfo.fields||[];t.selections=K(s.filter(g=>g._checked))}};return J(O({visible:a,tableLabel:l},ee(t)),{columns:[{type:"selection",width:40,align:"center"},{title:"\u7269\u7406\u5B57\u6BB5\u540D",slot:"field",tooltip:!0},{title:"\u5907\u6CE8",key:"title",tooltip:!0}],setSelections:f,open:h,handleSave:r})}},Dn={class:"node-header"},Fn={class:"table-info-name t-ellipsis"},Mn={class:"table-info-ds t-ellipsis"},zn={class:"node-table-info"},En={key:0,class:"table-search-label mb-8"},Vn={class:"field-label",flex:"cross:center"},Kn=B("\u53D6\u6D88"),jn=B("\u786E\u5B9A");function Rn(e,n,a,t,l,h){const r=p("field-type-icon"),c=p("b-table"),f=p("b-button"),d=p("b-drawer");return u(),Q(d,{modelValue:t.visible,"onUpdate:modelValue":n[1]||(n[1]=s=>t.visible=s),inner:"","z-index":10,width:400,styles:{padding:0}},{footer:m(()=>[i(f,{type:"primary",size:"small",transparent:"",style:{width:"120px"},onClick:n[0]||(n[0]=s=>t.visible=!1)},{default:m(()=>[Kn]),_:1}),i(f,{type:"primary",size:"small",style:{width:"120px"},onClick:t.handleSave},{default:m(()=>[jn]),_:1},8,["onClick"])]),default:m(()=>[o("div",Dn,[o("div",Fn,C(e.tableInfo.tableName),1),o("div",Mn,"\u6570\u636E\u6E90\uFF1A"+C(e.dataset.datasourceName),1)]),o("div",zn,[t.tableLabel?(u(),b("div",En,C(t.tableLabel),1)):D("",!0),i(c,{size:"small",columns:t.columns,data:e.tableInfo.fields,"max-height":400,onSelectionChange:t.setSelections},{field:m(({row:s})=>[o("div",Vn,[i(r,{type:s.dataType},null,8,["type"]),o("span",null,C(s.field),1)])]),_:1},8,["columns","data","onSelectionChange"])])]),_:1},8,["modelValue"])}var Bn=R(Ln,[["render",Rn],["__scopeId","data-v-255800a4"]]);const Un={name:"join-link"},Wn={class:"svg-icon-wrapper icon-bi-engine-ziduanguanlian"},On=o("svg",{class:"svg-icon",viewBox:"0 0 3686 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[o("path",{d:"M409.6 0a512 512 0 1 1 0 1024H0V867.9424h409.6c169.6768 0 344.064-186.368 344.064-355.9424 0-169.6768-174.3872-354.6112-344.064-354.6112H0V0h409.6z m3276.8 0v157.3888h-409.6c-169.6768 0-347.8528 185.6512-347.8528 355.328 0 169.5744 178.176 355.2256 347.8528 355.2256h409.6V1024h-409.6a512 512 0 1 1 0-1024h409.6zM1638.4 0h409.6a512 512 0 1 1 0 1024h-409.6a512 512 0 1 1 0-1024z m0 157.3888c-169.6768 0-348.3648 185.6512-348.3648 355.328 0 169.5744 178.688 355.2256 348.3648 355.2256h409.6c169.6768 0 349.4912-185.6512 349.4912-355.328 0-169.5744-179.8144-355.2256-349.4912-355.2256h-409.6zM409.6 579.584v-153.6h1228.8v153.6H409.6z m1638.4 0v-153.6h1228.8v153.6H2048z",fill:"#000000","fill-opacity":".4"})],-1),Yn=[On];function Hn(e,n,a,t,l,h){return u(),b("i",Wn,Yn)}var Gn=R(Un,[["render",Hn]]);const qn={name:"cube-link-edit",components:{JoinLink:Gn,JoinType:$e,FieldTypeIcon:ie},emits:["save"],setup(e,{emit:n}){const a=Y(!1),t=X({dataset:{},tableInfo:{},selections:[],parentTableInfo:{},parentSelections:[]}),l=U(()=>{const I=t.tableInfo.fields||[];return Z(I)?"":`\u5B57\u6BB5\u9009\u62E9(${t.selections.length}/${I.length})`}),h=U(()=>{const I=t.parentTableInfo.fields||[];return Z(I)?"":`\u5B57\u6BB5\u9009\u62E9(${t.parentSelections.length}/${I.length})`}),r=(I,$,F)=>{f(I,$,F),d(),s(),a.value=!0},c=()=>{const I=t.parentSelections;if(I.length===0){te.error(`${t.parentTableInfo.tableName} \u81F3\u5C11\u9700\u8981\u9009\u62E9\u4E00\u4E2A\u6709\u6548\u5B57\u6BB5\uFF01`);return}const $=t.selections;if($.length===0){te.error(`${t.tableInfo.tableName} \u81F3\u5C11\u9700\u8981\u9009\u62E9\u4E00\u4E2A\u6709\u6548\u5B57\u6BB5\uFF01`);return}if(t.tableInfo.joinKeys.length===0){te.error("\u81F3\u5C11\u9700\u8981\u4E00\u4E2A\u5173\u8054\u5173\u7CFB\uFF01");return}if(t.tableInfo.joinKeys.length&&t.tableInfo.joinKeys.find(A=>Z(A.sourceKey)||Z(A.targetKey))){te.error("\u5173\u8054\u7684\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A\uFF01");return}n("save",I.map(F=>F.field),$.map(F=>F.field),t.tableInfo),a.value=!1},f=(I,$,F)=>{t.dataset=K(I),t.tableInfo=K($),t.parentTableInfo=K(F)},d=I=>{if(I)t.selections=K(I);else{const $=t.tableInfo.fields||[];t.selections=K($.filter(F=>F._checked))}},s=I=>{if(I)t.parentSelections=K(I);else{const $=t.parentTableInfo.fields||[];t.parentSelections=K($.filter(F=>F._checked))}},g=()=>{t.tableInfo.joinKeys.push({sourceKey:"",targetKey:""})},k=I=>{t.tableInfo.joinKeys.splice(I,1)};return J(O({JOIN_TYPE:Ce,visible:a,tableLabel:l,parentTableLabel:h},ee(t)),{columns:[{type:"selection",width:40,align:"center"},{title:"\u7269\u7406\u5B57\u6BB5\u540D",slot:"field",tooltip:!0},{title:"\u5907\u6CE8",key:"title",tooltip:!0}],setSelections:d,setParentSelections:s,open:r,handleSave:c,addJoinKey:g,removeKey:k})}},Fe=e=>(oe("data-v-6f2f036b"),e=e(),ae(),e),Jn={flex:"box:mean",class:"table-config-wrap"},Qn={class:"node-table-info"},Pn={key:0,class:"table-search-label mb-5"},Zn={key:1,class:"table-search-label mb-8"},Xn={class:"field-label",flex:"cross:center"},eo={class:"node-table-info"},to={key:0,class:"table-search-label mb-5"},no={key:1,class:"table-search-label mb-8"},oo={class:"field-label",flex:"cross:center"},ao={class:"table-join-keys"},lo={class:"join-keys-header"},so=Fe(()=>o("div",null,"\u6570\u636E\u5173\u8054",-1)),io={class:"right"},ro=B("\u6DFB\u52A0\u5173\u8054\u5B57\u6BB5 "),co={class:"table-name-wrapper"},uo=["title"],po=["title"],fo=Fe(()=>o("div",{class:"link-operation"},"\u64CD\u4F5C",-1)),_o={class:"fields-key-wrapper"},mo={style:{float:"right",color:"#ccc"}},bo={style:{float:"right",color:"#ccc"}},ho={class:"field-delete"},vo=B("\u53D6\u6D88"),yo=B("\u786E\u5B9A");function go(e,n,a,t,l,h){const r=p("field-type-icon"),c=p("b-table"),f=p("join-type"),d=p("b-space"),s=p("b-option"),g=p("b-select"),k=p("b-button"),I=p("join-link"),$=p("b-icon"),F=p("b-drawer");return u(),Q(F,{modelValue:t.visible,"onUpdate:modelValue":n[2]||(n[2]=A=>t.visible=A),title:"\u7F16\u8F91\u5173\u8054\u5173\u7CFB",inner:"",width:800,styles:{padding:0}},{footer:m(()=>[i(k,{type:"primary",size:"small",transparent:"",style:{width:"120px"},onClick:n[1]||(n[1]=A=>t.visible=!1)},{default:m(()=>[vo]),_:1}),i(k,{type:"primary",size:"small",style:{width:"120px"},onClick:t.handleSave},{default:m(()=>[yo]),_:1},8,["onClick"])]),default:m(()=>[o("div",Jn,[o("div",Qn,[t.tableLabel?(u(),b("div",Pn,C(e.parentTableInfo.tableName),1)):D("",!0),t.parentTableLabel?(u(),b("div",Zn,C(t.parentTableLabel),1)):D("",!0),i(c,{size:"small",columns:t.columns,data:e.parentTableInfo.fields,"max-height":240,onSelectionChange:t.setParentSelections},{field:m(({row:A})=>[o("div",Xn,[i(r,{type:A.dataType},null,8,["type"]),o("span",null,C(A.field),1)])]),_:1},8,["columns","data","onSelectionChange"])]),o("div",eo,[t.tableLabel?(u(),b("div",to,C(e.tableInfo.tableName),1)):D("",!0),t.tableLabel?(u(),b("div",no,C(t.tableLabel),1)):D("",!0),i(c,{size:"small",columns:t.columns,data:e.tableInfo.fields,"max-height":240,onSelectionChange:t.setSelections},{field:m(({row:A})=>[o("div",oo,[i(r,{type:A.dataType},null,8,["type"]),o("span",null,C(A.field),1)])]),_:1},8,["columns","data","onSelectionChange"])])]),o("div",ao,[o("div",lo,[so,o("div",io,[i(d,null,{default:m(()=>[i(g,{modelValue:e.tableInfo.joinType,"onUpdate:modelValue":n[0]||(n[0]=A=>e.tableInfo.joinType=A),size:"mini",style:{width:"110px"}},{prefix:m(()=>[i(f,{size:6,type:e.tableInfo.joinType,style:{position:"relative",top:"-2px",left:"4px","background-color":"transparent"}},null,8,["type"])]),default:m(()=>[(u(!0),b(q,null,P(t.JOIN_TYPE,(A,E)=>(u(),Q(s,{key:E,value:E,label:A.label},{default:m(()=>[i(d,null,{default:m(()=>[i(f,{size:6,type:E,style:{"background-color":"transparent"}},null,8,["type"]),o("span",null,C(A.label),1)]),_:2},1024)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"]),i(k,{type:"primary",transparent:"",size:"mini",icon:"plus",onClick:t.addJoinKey},{default:m(()=>[ro]),_:1},8,["onClick"])]),_:1})])]),o("div",co,[o("div",{class:"table-name",title:e.parentTableInfo.tableName},C(e.parentTableInfo.tableName),9,uo),o("div",{class:"table-name",title:e.tableInfo.tableName},C(e.tableInfo.tableName),9,po),fo]),o("div",_o,[(u(!0),b(q,null,P(e.tableInfo.joinKeys,(A,E)=>(u(),b("div",{class:"fields-key-line",key:E},[i(g,{modelValue:e.tableInfo.joinKeys[E].sourceKey,"onUpdate:modelValue":L=>e.tableInfo.joinKeys[E].sourceKey=L,size:"small",style:{width:"300px"}},{default:m(()=>[(u(!0),b(q,null,P(e.parentTableInfo.fields,L=>(u(),Q(s,{key:L.field,value:L.field,label:L.field+"("+L.title+")"},{default:m(()=>[o("span",null,C(L.field),1),o("span",mo,C(L.title),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),i(I,{style:{width:"36px",height:"48px","font-size":"36px"}}),i(g,{modelValue:e.tableInfo.joinKeys[E].targetKey,"onUpdate:modelValue":L=>e.tableInfo.joinKeys[E].targetKey=L,size:"small",style:{width:"300px"}},{default:m(()=>[(u(!0),b(q,null,P(e.tableInfo.fields,L=>(u(),Q(s,{key:L.field,value:L.field,label:L.field+"("+L.title+")"},{default:m(()=>[o("span",null,C(L.field),1),o("span",bo,C(L.title),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),o("div",ho,[i(k,{type:"text","text-color":"info",disabled:e.tableInfo.joinKeys.length<=1,onClick:L=>t.removeKey(E)},{default:m(()=>[i($,{name:"delete",size:"18"})]),_:2},1032,["disabled","onClick"])])]))),128))])])]),_:1},8,["modelValue"])}var wo=R(qn,[["render",go],["__scopeId","data-v-6f2f036b"]]);const ko={name:"cube-field-table",components:{SettingDropdown:Ne,FieldTypeIcon:ie},props:{dimensionFields:{type:Array,default:()=>[]},measureFields:{type:Array,default:()=>[]}},emits:["command"],setup(e,{emit:n}){const a=Y(null),t=X({tableWrapStyle:{},topHeaderStyle:{}});function l(f){f.target.classList.add("is-hover")}function h(f){f.target.classList.remove("is-hover")}function r(){if(!a.value)return;const f=a.value.clientWidth,d=91,s=120,g=(e.dimensionFields.length+e.measureFields.length)*s,k=g<f?d:d+6;t.tableWrapStyle={width:`${f}px`,height:`${k}px`},t.topHeaderStyle={width:`${g}px`,height:`${d}px`}}function c({name:f,node:d}){n("command",{name:f,node:d})}return ke(()=>{Pe(a.value,r)}),Oe(()=>{Ze(a.value,r)}),J(O({containerRef:a},ee(t)),{onMouseEnter:l,onMouseLeave:h,handleCommand:c})}},de=e=>(oe("data-v-4ca58d95"),e=e(),ae(),e),Io={class:"cube-table-container",ref:"containerRef"},So={class:"table-container"},To={class:"top-header-container-box"},Co={class:"row"},No=["title"],Ao={class:"content"},xo={class:"cube-table-tip-cell"},$o={key:0,class:"svg-icon-wrapper"},Lo=de(()=>o("svg",{class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[o("path",{d:"M512 42.666667L316.330667 289.450667H425.813333v287.829333L172.544 722.261333l-54.698667-93.866666L0 919.637333l313.429333 44.544-54.613333-93.866666L512 725.333333 765.269333 870.4l-54.698666 93.866667L1024 919.808l-117.76-291.413333-54.784 93.866666-253.184-144.896V289.450667h109.312z"})],-1)),Do=[Lo],Fo=de(()=>o("div",{class:"tip-background dimension"},null,-1)),Mo={key:1},zo=["title"],Eo={class:"content"},Vo={class:"cube-table-tip-cell"},Ko={key:0,class:"svg-icon-wrapper"},jo=de(()=>o("svg",{class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[o("path",{d:"M782.677333 550.144L1024 791.296 791.296 1024l-55.04-55.04 80.469333-80.384-46.592-46.592-80.469333 80.469333-46.506667-46.592 80.469334-80.384-46.592-46.506666-80.384 80.384-46.592-46.592 232.618666-232.618667z m12.8-537.429333l215.808 215.808-685.397333 685.482666-260.266667 44.373334 44.373334-260.266667L795.477333 12.8z m0 156.842666L213.333333 751.616l-12.117333 71.082667 71.082667-12.117334 582.058666-582.144-58.88-58.88zM232.704 0l241.152 241.237333-232.618667 232.618667-42.325333-42.24 80.384-80.469333-46.592-46.506667-80.384 80.469333-46.592-46.592 80.469333-80.469333-46.592-46.421333-80.384 80.384L0 232.704 232.704 0z"})],-1)),Ro=[jo],Bo=de(()=>o("div",{class:"tip-background measure"},null,-1)),Uo={key:1},Wo={class:"row"},Oo=["title"],Yo={class:"content"},Ho={class:"cube-table-header-cell"},Go={class:"cube-table-header-cell-top"},qo={class:"cube-table-header-cell-bottom dimension"},Jo=["title"],Qo={class:"content"},Po={class:"cube-table-header-cell"},Zo={class:"cube-table-header-cell-top"},Xo={class:"cube-table-header-cell-bottom measure"},ea={class:"preview-data-refresh-tips"},ta={class:"preview-data-refresh-tips-icon-line"},na=B(" \u60A8\u53EF\u4EE5\u70B9\u51FB\u53F3\u4FA7\u7684 "),oa=B("\u5237\u65B0\u6570\u636E"),aa=B(" \u6309\u94AE "),la=de(()=>o("div",null,"\u6765\u9884\u89C8\u5E76\u914D\u7F6E\u6570\u636E",-1));function sa(e,n,a,t,l,h){const r=p("field-type-icon"),c=p("setting-dropdown"),f=p("b-button");return u(),b("div",Io,[o("div",{class:"bi-awesome-matrix-table",style:H(e.tableWrapStyle),onMouseenter:n[0]||(n[0]=(...d)=>t.onMouseEnter&&t.onMouseEnter(...d)),onMouseleave:n[1]||(n[1]=(...d)=>t.onMouseLeave&&t.onMouseLeave(...d))},[o("div",So,[o("div",To,[o("div",{class:"top-header",style:H(e.topHeaderStyle)},[o("div",Co,[(u(!0),b(q,null,P(a.dimensionFields,(d,s)=>(u(),b("div",{class:"table-cell",key:s,style:{width:"120px",height:"32px","border-right-width":"1px"},title:s===0?"\u7EF4\u5EA6":""},[o("div",Ao,[o("div",xo,[s===0?(u(),b("i",$o,Do)):D("",!0),Fo,s===0?(u(),b("span",Mo,"\u7EF4\u5EA6")):D("",!0)])])],8,No))),128)),(u(!0),b(q,null,P(a.measureFields,(d,s)=>(u(),b("div",{class:"table-cell",key:s,style:{width:"120px",height:"32px","border-right-width":"1px"},title:s===0?"\u5EA6\u91CF":""},[o("div",Eo,[o("div",Vo,[s===0?(u(),b("i",Ko,Ro)):D("",!0),Bo,s===0?(u(),b("span",Uo,"\u5EA6\u91CF")):D("",!0)])])],8,zo))),128))]),o("div",Wo,[(u(!0),b(q,null,P(a.dimensionFields,(d,s)=>(u(),b("div",{class:"table-cell",key:s,style:{width:"120px",height:"59px","border-right-width":"1px"},title:d.node.title},[o("div",Yo,[o("div",Ho,[o("div",Go,C(d.node.title),1),o("div",qo,[i(r,{type:d.node.dataType},null,8,["type"]),i(c,{data:d.node,onCommand:t.handleCommand},null,8,["data","onCommand"])])])])],8,Oo))),128)),(u(!0),b(q,null,P(a.measureFields,(d,s)=>(u(),b("div",{class:"table-cell",key:s,style:{width:"120px",height:"59px","border-right-width":"1px"},title:d.node.title},[o("div",Qo,[o("div",Po,[o("div",Zo,C(d.node.title),1),o("div",Xo,[i(r,{type:d.node.dataType},null,8,["type"]),i(c,{data:d.node,onCommand:t.handleCommand},null,8,["data","onCommand"])])])])],8,Jo))),128))])],4)])])],36),o("div",ea,[o("div",ta,[na,i(f,{type:"text",icon:"reload"},{default:m(()=>[oa]),_:1}),aa]),la])],512)}var ia=R(ko,[["render",sa],["__scopeId","data-v-4ca58d95"]]);const da={name:"Cube",components:{CubeFieldTable:ia,CubeLinkEdit:wo,CubeNodeEdit:Bn,SvgLoading:Xe,LinkNodeWrapper:Yt,CubeTableList:$n,PageCubeWrapper:_t,CubeHeader:dn},setup(){const e=et(),n=st(e.dataset);return Ie("BiCube",{schemaStatus:n,pageStatus:e}),O(O({dev:!0,debugVisible:Y(!1)},e),n)}},ra=e=>(oe("data-v-5f5bed8a"),e=e(),ae(),e),ca={class:"bi-cube-container"},ua={class:"bi-cube-wrapper"},pa={key:0,flex:"main:center cross:center",class:"full-wrapper"},fa={class:"default-wrapper"},_a={class:"table-header"},ma=ra(()=>o("div",{class:"header-tabs"},[o("span",{class:"tab active"},"\u6570\u636E\u9884\u89C8")],-1)),ba={class:"right-col"},ha={key:0,class:"mr-8"},va={flex:"box:mean"},ya=B("\u5237\u65B0\u9884\u89C8"),ga={class:"preview-data-content"},wa={class:"preview-data-scroll"},ka={class:"preview-data-left"},Ia={class:"cube-field-panel"},Sa={class:"cube-tree"},Ta={class:"cube-tree"},Ca={class:"preview-data-right"},Na=B("\u53D6 \u6D88"),Aa=B("\u786E \u5B9A");function xa(e,n,a,t,l,h){const r=p("cube-header"),c=p("svg-loading"),f=p("cube-table-list"),d=p("link-node-wrapper"),s=p("b-button"),g=p("b-ace-editor"),k=p("b-modal"),I=p("b-tree"),$=p("b-scrollbar"),F=p("cube-field-table"),A=p("page-cube-wrapper"),E=p("cube-node-edit"),L=p("cube-link-edit"),S=p("b-form-item"),N=p("b-input"),x=p("b-form");return u(),b("div",ca,[i(r,{modelValue:e.dataset.datasetName,"onUpdate:modelValue":n[0]||(n[0]=w=>e.dataset.datasetName=w),"page-status":e.dataset,"back-url":"/datasetDemo",onSave:e.handleSave,onBack:e.handleBack},null,8,["modelValue","page-status","onSave","onBack"]),o("div",ua,[e.loading?(u(),b("div",pa,[i(c,{name:"loading02"})])):(u(),Q(A,{key:1,class:"full-wrapper"},{left:m(()=>[i(f)]),default:m(()=>[o("div",fa,[i(d,{dragging:e.dragging,data:e.stateTree,onNodeClick:e.handleNodeClick,onNodeRemove:e.handleNodeRemove,onNodeDrop:e.handleNodeDrop,onLinkClick:e.handleLinkClick,onEmptyDrop:e.handleEmptyDrop,dev:t.dev},null,8,["dragging","data","onNodeClick","onNodeRemove","onNodeDrop","onLinkClick","onEmptyDrop","dev"])])]),draggable:m(()=>[o("div",_a,[ma,o("div",ba,[t.dev?(u(),b("span",ha,[i(s,{type:"danger",size:"mini",icon:"bug",onClick:n[1]||(n[1]=w=>t.debugVisible=!0)}),i(k,{title:"Debug Data",width:"800",modelValue:t.debugVisible,"onUpdate:modelValue":n[2]||(n[2]=w=>t.debugVisible=w),"destroy-on-close":""},{default:m(()=>[o("div",va,[i(g,{"model-value":JSON.stringify({dimensionTree:e.dimensionTree,measureTree:e.measureTree},null,2)},null,8,["model-value"]),i(g,{"model-value":JSON.stringify({dimensionFields:e.dimensionFields,measureFields:e.measureFields},null,2)},null,8,["model-value"])])]),_:1},8,["modelValue"])])):D("",!0),i(s,{type:"primary",size:"mini",icon:"reload"},{default:m(()=>[ya]),_:1})])]),o("div",ga,[o("div",wa,[o("div",ka,[o("div",Ia,[i($,null,{default:m(()=>[o("div",Sa,[i(I,{"default-expand":"","lock-select":"",draggable:"","allow-drop":e.allowDrop,"allow-drag":e.allowDrag,data:[e.dimensionTree],render:e.renderContent,onNodeDrop:e.handleDrop},null,8,["allow-drop","allow-drag","data","render","onNodeDrop"])]),o("div",Ta,[i(I,{"default-expand":"",draggable:"","lock-select":"","allow-drop":e.allowDrop,"allow-drag":e.allowDrag,data:[e.measureTree],render:e.renderContent,onNodeDrop:e.handleDrop},null,8,["allow-drop","allow-drag","data","render","onNodeDrop"])])]),_:1})])]),o("div",Ca,[i(F,{"dimension-fields":e.dimensionFields,"measure-fields":e.measureFields,onCommand:e.handleDmCommand},null,8,["dimension-fields","measure-fields","onCommand"])])])])]),_:1})),i(E,{ref:"nodeEditRef",onSave:e.saveSelectedFields},null,8,["onSave"]),i(L,{ref:"linkEditRef",onSave:e.saveJoinKeys},null,8,["onSave"]),i(k,{modelValue:e.fieldModal,"onUpdate:modelValue":n[5]||(n[5]=w=>e.fieldModal=w),title:"\u7F16\u8F91\u5B57\u6BB5"},{footer:m(()=>[i(s,{onClick:n[4]||(n[4]=w=>e.fieldModal=!1)},{default:m(()=>[Na]),_:1}),i(s,{type:"primary",onClick:e.saveField},{default:m(()=>[Aa]),_:1},8,["onClick"])]),default:m(()=>[i(x,{model:e.filedNode,"label-width":"90px"},{default:m(()=>[i(S,{label:"\u5B57\u6BB5\u540D",required:""},{default:m(()=>[o("label",null,C(e.filedNode.field),1)]),_:1}),i(S,{prop:"title",label:"\u5B57\u6BB5\u6807\u9898",required:""},{default:m(()=>[i(N,{modelValue:e.filedNode.title,"onUpdate:modelValue":n[3]||(n[3]=w=>e.filedNode.title=w)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])])}var Va=R(da,[["render",xa],["__scopeId","data-v-5f5bed8a"]]);export{Va as default};
