import{ax as q,l as I,o as h,a as $,g as E,a5 as $e,aM as it,m as T,G as ve,n as ge,H as k,f as z,w as x,c as u,F as J,e as N,j as P,b as a,t as Q,A as be,a1 as v,O as fe,h as F,k as le,Y as rt,M as ye,S as Vt,a3 as dt,aO as Mt,P as ae,ac as Dt,z as It,I as Tt,s as oe,d as Ee,v as Oe,az as Ve,$ as Rt,E as Ce,V as Bt,aI as xe,aJ as we,D as Me,C as Lt,N as ut,a0 as Nt,aP as zt,aQ as Et,a6 as Ot,T as Ut,u as qe}from"./vendor-0c23bfd6.js";import{e as Y,z as De,A as Ue,s as At,t as Ae,v as Gt,j as Pt,B as Ge,q as me,D as ee,E as te,M as re,F as K,u as Yt,b as Ie,f as Pe,G as mt,H as Ze,J as Qe,K as jt,L as et,N as tt,O as de,a as Kt,P as Xt,w as Jt,k as Ht,Q as Wt,R as Ft,T as qt,U as Zt,n as Qt}from"./index-dc442332.js";import{M as W,a as pe,s as eo,b as to}from"./chunk-bin-ui-next-be5ed89c.js";import{a as oo,g as pt,b as ao}from"./database.api-ea69c06a.js";import{d as no,a as so}from"./file-helper-e95db66d.js";import{s as lo,l as co}from"./template.api-8052707b.js";import{d as Ye,a as io,u as ro,r as uo,g as mo,m as po,b as vo,c as fo}from"./images.api-8ccca273.js";import{p as _o,m as ho}from"./select-options-04fab100.js";import"./chunk-brace-b1f520b9.js";const go={name:"HeadLoading",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{toolbar:n}=t(o);return{loading:I(()=>n.value.loading)}}};function bo(o,t,n,e,l,s){return h(),$("div",{class:E(["loading-indicator",{loading:e.loading}])},null,2)}var yo=q(go,[["render",bo],["__scopeId","data-v-5475ad30"]]);function je(){const o=$e(),{schemaStore:t,storeToRefs:n}=Y(),{pageInfo:e,pageConfig:l,comps:s}=n(t);async function i(d="edit"){const c={id:e.value.id||o.query.id,name:e.value.name,pid:e.value.pid,status:d,layout:JSON.stringify(l.value),components:s.value.map(m=>De(m.apiData)?{name:m.alias,componentType:m.componentType,componentContent:JSON.stringify(m),componentDataType:Ue.static,modelId:"",x:[],y:[],drill:[],filters:[]}:{name:m.alias,componentType:m.componentType,componentDataType:m.apiData.type,modelId:m.apiData.config.modelId,componentContent:JSON.stringify(m),x:m.apiData.config.x,y:m.apiData.config.y,drill:[],filters:[]})};try{return await At(c)}catch(m){Ae("userSchemaStore/saveScreenData",m)}return""}async function r(){let d={};try{t.setGlobalLoading(!0);const c={pageInfo:{id:e.value.id,name:e.value.name||"\u770B\u677F\u9884\u89C8",pid:e.value.pid||"1"},pageConfig:l.value,comps:s.value};d=await oo(c)}catch{d={}}return t.setGlobalLoading(!1),d}return{saveScreenData:i,previewScreen:r}}function H(o){const{schemaStore:t}=Y();o?t.setGlobalLoading(o):setTimeout(()=>t.setGlobalLoading(o),300)}const Co={name:"save-screen",props:{modelValue:{type:Boolean},status:{type:String,default:"edit",validator:o=>["edit","audited"].includes(o)}},emits:["update:modelValue"],setup(o,t){const n=I({get:()=>o.modelValue,set:_=>t.emit("update:modelValue",_)}),{schemaStore:e,storeToRefs:l}=Y(),{pageInfo:s}=l(e),{saveScreenData:i}=je(),r=it(),d=$e(),c=T([]),m=T(null),g=T(!1),p=I(()=>window.location.origin+Gt(`/#/screen/${d.query.id}`));Pt().then(_=>{c.value=_.data?[_.data]:[]});const f=I(()=>o.status==="edit"?"\u4FDD\u5B58\u770B\u677F":"\u53D1\u5E03\u770B\u677F"),y=()=>{m.value.validate(async _=>{if(_){let S="";try{H(!0),g.value=!0,S=await i(o.status)}catch(w){Ae("save-screes/saveKanban",w)}H(!1),s.value.id=S,g.value=!1,n.value=!1,W.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0});let C=r.resolve({path:"/schema/screen",query:{id:S}});window.location.replace(C.href)}})},b=()=>{ge(()=>{Ge(p.value)&&W.success("\u590D\u5236\u53D1\u5E03\u5730\u5740\u6210\u529F!")})};return ve(()=>o.modelValue,_=>{_&&ge(()=>{m.value&&m.value.resetFields()})}),{formRef:m,pageInfo:s,dirTree:c,loading:g,visible:n,saveKanban:y,btnText:f,shareUrl:p,copyUrl:b}}},xo={class:"t-center"};function wo(o,t,n,e,l,s){const i=k("b-input"),r=k("b-form-item"),d=k("g-input"),c=k("b-button"),m=k("b-form"),g=k("b-modal");return h(),z(g,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=p=>e.visible=p),"append-to-body":"",title:e.btnText,top:"200px","custom-class":"schema-modal",onClose:t[3]||(t[3]=p=>e.visible=!1)},{default:x(()=>[u(m,{"label-width":"80px",ref:"formRef",model:e.pageInfo,"label-suffix":":"},{default:x(()=>[u(r,{label:"\u770B\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u770B\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:x(()=>[u(i,{modelValue:e.pageInfo.name,"onUpdate:modelValue":t[0]||(t[0]=p=>e.pageInfo.name=p)},null,8,["modelValue"])]),_:1}),n.status==="audited"&&o.$route.query.id?(h(),$(J,{key:0},[u(r,{label:"\u9884\u89C8\u5730\u5740"},{default:x(()=>[u(d,{modelValue:e.shareUrl,"onUpdate:modelValue":t[1]||(t[1]=p=>e.shareUrl=p),readonly:"",type:"textarea",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),u(r,null,{default:x(()=>[u(c,{type:"text",onClick:e.copyUrl},{default:x(()=>[N("\u590D\u5236\u9884\u89C8\u5730\u5740")]),_:1},8,["onClick"])]),_:1})],64)):P("",!0)]),_:1},8,["model"]),a("div",xo,[u(c,{type:"primary",onClick:e.saveKanban,loading:e.loading,style:{width:"200px"}},{default:x(()=>[N(Q(e.btnText),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["modelValue","title"])}var ko=q(Co,[["render",wo]]);const So={name:"save-template",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,t){const{schemaStore:n,storeToRefs:e}=Y(),{pageConfig:l,comps:s}=e(n),i=T(null),r=be({loading:!1,id:`temp_${me()}`,name:""}),d=I({get:()=>o.modelValue,set:p=>t.emit("update:modelValue",p)}),c=I(()=>({template:{id:r.id,name:r.name},pageConfig:l.value,comps:s.value})),m=()=>{i.value&&i.value.validate(async p=>{if(p){const f=c.value,y=JSON.stringify(f);no(y,`${f.template.id}.json`),W.success({message:"\u6A21\u677F\u6587\u4EF6\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})},g=async()=>{i.value&&i.value.validate(async p=>{if(p){try{H(!0),r.loading=!0;const f=c.value,y=f.template.name,b=JSON.stringify(f);await lo({name:y,content:b})}catch(f){Ae("save-template/saveAsTemplate",f)}H(!1),r.loading=!1,d.value=!1,W.success({message:"\u6A21\u677F\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})};return ve(()=>o.modelValue,p=>{p&&(i.value&&i.value.resetFields(),r.id=`temp_${me()}`)}),{formRef:i,formStatus:r,visible:d,downloadCfg:m,saveAsTemplate:g}}},$o={class:"t-center"};function Vo(o,t,n,e,l,s){const i=k("b-input"),r=k("b-form-item"),d=k("b-form"),c=k("b-button"),m=k("b-modal");return h(),z(m,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=g=>e.visible=g),"append-to-body":"",title:"\u4FDD\u5B58\u4E3A\u6A21\u677F",top:"200px","custom-class":"schema-modal",onClose:t[2]||(t[2]=g=>e.visible=!1)},{default:x(()=>[u(d,{"label-width":"80px",ref:"formRef",model:e.formStatus,"label-suffix":":"},{default:x(()=>[u(r,{label:"\u6A21\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:x(()=>[u(i,{modelValue:e.formStatus.name,"onUpdate:modelValue":t[0]||(t[0]=g=>e.formStatus.name=g)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a("div",$o,[u(c,{type:"primary",icon:"vertical-align-botto",transparent:"",style:{width:"120px"},onClick:e.downloadCfg},{default:x(()=>[N(" \u914D\u7F6E\u6587\u4EF6 ")]),_:1},8,["onClick"]),u(c,{type:"primary",icon:"save",style:{width:"120px"},loading:e.formStatus.loading,onClick:e.saveAsTemplate},{default:x(()=>[N(" \u4FDD\u5B58\u6A21\u677F ")]),_:1},8,["loading","onClick"])])]),_:1},8,["modelValue"])}var Mo=q(So,[["render",Vo]]);const Do={class:"header-container"},Io={class:"left-actions"},To={class:"screen-info"},Ro=a("span",null,"\u5206\u6790\u770B\u677F",-1),Bo=a("span",{style:{padding:"0 8px"}},"-",-1),Lo={class:"global-actions"},No={class:"head-btn"},zo={__name:"index",props:{backUrl:{type:String},backTarget:{type:String,default:"_self",validator:o=>["_self","_blank"].includes(o)},pageStatus:{type:Object,default:()=>({})}},setup(o,{expose:t}){const n=o,e=it(),{schemaStore:l,storeToRefs:s}=Y(),{pageInfo:i,toolbar:r}=s(l),{previewScreen:d}=je(),c=T(!1),m=T("edit"),g=T(!1),p=()=>{const S=n.backUrl||"/";if(n.backTarget==="_blank"){const C=e.resolve(S);window.open(C.href,n.backTarget)}else pe.confirm({type:"warning",title:"\u786E\u5B9A\u8FD4\u56DE\u5217\u8868\u5417\uFF1F"}).then(()=>{e.push(S),l.clearStore()}).catch(()=>{})},f=S=>S.type!=="application/json"?(W.warning("\u8BF7\u9009\u62E9\u6B63\u786E\u7684json\u914D\u7F6E\u6587\u4EF6"),!1):(so(S).then(C=>{try{const w=JSON.parse(C),{comps:V,pageConfig:O}=w;l.loadScreenData({comps:V,pageConfig:O})}catch{console.warn("The imported file could not be converted to the correct JSON!")}}),!1),y=()=>{m.value="edit",c.value=!0},b=()=>{m.value="audited",c.value=!0},_=async()=>{const S=await d();let C=e.resolve({path:`/screen/preview/${S.pageInfo.id}`});window.open(C.href,"_blank")};return t({handleSaveScreen:y,handlePublish:b,handPreview:_}),(S,C)=>{const w=k("b-icon"),V=k("b-tooltip"),O=k("b-space"),L=k("b-upload");return h(),$(J,null,[a("div",Do,[a("div",Io,[u(O,{size:"mini"},{default:x(()=>[u(V,{content:"\u7EC4\u4EF6","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:v(r).components}]),onClick:C[0]||(C[0]=U=>v(l).toggleCompsPanel())},[u(w,{name:"hourglass",class:E(["com-list-icon",{"is-rotate":!v(r).components}])},null,8,["class"])],2)]),_:1}),u(V,{content:"\u56FE\u5C42","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:v(r).layer}]),onClick:C[1]||(C[1]=U=>v(l).toggleLayerPanel())},[u(w,{name:"container"})],2)]),_:1}),u(V,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:v(r).config}]),onClick:C[2]||(C[2]=U=>v(l).toggleConfigPanel())},[u(w,{name:"control"})],2)]),_:1}),u(V,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:x(()=>[a("div",{class:E(["head-btn",{active:v(r).toolbox}]),onClick:C[3]||(C[3]=U=>v(l).toggleToolbox())},[u(w,{name:"shopping"})],2)]),_:1})]),_:1})]),a("div",To,[u(V,{content:"\u8FD4\u56DE","open-delay":500},{default:x(()=>[u(w,{name:"laptop",type:"button",onClick:p})]),_:1}),Ro,Bo,a("span",null,Q(v(i).name),1)]),a("div",Lo,[u(O,{size:"mini"},{default:x(()=>[u(V,{content:"\u5BFC\u5165json (\u4F1A\u8986\u76D6\u6240\u6709\u5185\u5BB9\uFF01)","open-delay":500},{default:x(()=>[u(L,{action:"/","show-upload-list":!1,"before-upload":f},{default:x(()=>[a("div",No,[u(w,{name:"Import"})])]),_:1})]),_:1}),u(V,{content:"\u4FDD\u5B58\u6A21\u677F","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:C[4]||(C[4]=U=>g.value=!0)},[u(w,{name:"Storedprocedure"})])]),_:1}),u(V,{content:"\u4FDD\u5B58","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:y},[u(w,{name:"save"})])]),_:1}),u(V,{content:"\u53D1\u5E03","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:b},[u(w,{name:"send"})])]),_:1}),u(V,{content:"\u9884\u89C8","open-delay":500},{default:x(()=>[a("div",{class:"head-btn",onClick:_},[u(w,{name:"View"})])]),_:1})]),_:1})])]),u(yo),u(ko,{modelValue:c.value,"onUpdate:modelValue":C[5]||(C[5]=U=>c.value=U),status:m.value},null,8,["modelValue","status"]),u(Mo,{modelValue:g.value,"onUpdate:modelValue":C[6]||(C[6]=U=>g.value=U)},null,8,["modelValue"])],64)}}},he=be({x:0,y:0});function Ke(o={}){const{schemaStore:t,storeToRefs:n}=Y(),{contextMenu:e,selectedCom:l}=n(t),s=I(()=>{var m;return(m=l.value)==null?void 0:m.locked}),i=I(()=>{var m;return(m=l.value)==null?void 0:m.hided}),r=I(()=>({display:e.value.show?"block":"none",left:`${he.x+10}px`,top:`${he.y+10}px`,transform:document.documentElement.clientHeight-he.y<250?"translate(0px, -100%)":""})),d=m=>{m.preventDefault(),l.value&&(he.x=m.clientX,he.y=m.clientY,e.value.show=!0,ee(document,"click",c))},c=()=>{te(document,"click",c),o&&o.beforeClose&&o.beforeClose(),e.value.show=!1};return{showMenu:d,isLocked:s,isHided:i,contextMenu:e,contextMenuStyle:r}}const Eo={class:"layer-panel"},Oo={class:"layer-top"},Uo=a("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),Ao=a("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),Go=[Ao],Po={class:"layer-toolbar layer-toolbar-top"},Yo={class:"layer-manager-wrap"},jo=["title","onMousedown","onMouseenter","onDblclick"],Ko=["onUpdate:modelValue"],Xo={key:1,class:"layer-item-span"},Jo={class:"layer-item-text"},Ho=["title","onClick"],Wo=["title","onClick"],Fo={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{comps:e,toolbar:l,hoveredComId:s,selectedCom:i,renamingComId:r,isMultiSelect:d,selectedComs:c}=n(t),{showMenu:m}=Ke(),g=I(()=>!!i.value),p=I(()=>({opacity:i.value?1:.3}));function f(j){return d.value?c.value.map(D=>D.id).includes(j.id):!De(i.value)&&i.value.id===j.id}const y=I({get:()=>[...e.value].reverse(),set:j=>e.value=j.reverse()}),b=j=>{i.value&&t.moveCom({id:i.value.id,moveType:j})},_=()=>b(re.up),S=()=>b(re.down),C=()=>b(re.top),w=()=>b(re.bottom),V=j=>t.hoverCom(j),O=()=>t.hoverCom(""),L=j=>{const D=e.value.find(A=>A.id===j);D&&t.selectCom(D)},U=()=>t.selectCom();return(j,D)=>{const A=k("b-icon"),R=fe("focus");return h(),$("div",{class:E(["layer-panel-wp",{"is-hide":!v(l).layer}])},[a("div",Eo,[a("div",Oo,[Uo,a("div",{class:"layer-action",onClick:D[0]||(D[0]=M=>v(t).toggleLayerPanel(!1))},Go)]),a("div",Po,[a("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:E(["b-iconfont b-icon-arrowup toolbar-icon standard",v(g)]),style:F(v(p)),onClick:_},null,6),a("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:E(["b-iconfont b-icon-arrowdown toolbar-icon standard",v(g)]),style:F(v(p)),onClick:S},null,6),a("i",{title:"\u7F6E\u9876",class:E(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",v(g)]),style:F({transform:"rotate(180deg)",...v(p)}),onClick:C},null,6),a("i",{title:"\u7F6E\u5E95",class:E(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",v(g)]),style:F(v(p)),onClick:w},null,6)]),a("div",Yo,[u(v(Mt),Vt({modelValue:v(y),"onUpdate:modelValue":D[4]||(D[4]=M=>dt(y)?y.value=M:null),class:"drag-area","item-key":"id"},{animation:200}),{item:x(({element:M})=>[a("div",{title:M.alias,class:E(["layer-manager-item",[{hided:M.hided,locked:M.locked,hovered:M.id===v(s),selected:f(M)}]]),onMousedown:B=>L(M.id),onMouseenter:B=>V(M.id),onMouseleave:O,onDblclick:B=>v(t).renamingCom(M.id),onContextmenu:D[3]||(D[3]=B=>v(m)(B))},[u(A,{name:M.icon,size:"18"},null,8,["name"]),M.id===v(r)?le((h(),$("input",{key:0,"onUpdate:modelValue":B=>M.alias=B,class:"layer-item-input",onBlur:D[1]||(D[1]=B=>v(t).renamingCom("")),onKeydown:D[2]||(D[2]=ye(B=>v(t).renamingCom(""),["enter"]))},null,40,Ko)),[[rt,M.alias,void 0,{trim:!0}],[R]]):(h(),$("span",Xo,[a("span",Jo,Q(M.alias),1)])),a("i",{class:E(["b-iconfont",`b-icon-${M.hided?"eye-close":"eye"}`,"show-toggle-btn"]),title:M.hided?"\u663E\u793A":"\u9690\u85CF",onClick:B=>M.hided=!M.hided},null,10,Ho),a("i",{class:E(["b-iconfont",`b-icon-${M.locked?"lock":"unlock"}`,"show-toggle-btn"]),title:M.locked?"\u89E3\u9501":"\u9501\u5B9A",onClick:B=>M.locked=!M.locked},null,10,Wo)],42,jo)]),_:1},16,["modelValue"]),a("div",{class:"last-flex-item",onClick:U})])])],2)}}},qo={name:"VBasicBar",alias:"\u67F1\u56FE",img:K("basic-bar.svg")},Zo={name:"VHorizontalBar",alias:"\u6761\u5F62\u56FE",img:K("hori-basic-bar.svg")},Qo={name:"VCapsuleBar",alias:"\u80F6\u56CA\u67F1\u56FE",img:K("capsule-bar.svg")},ea={name:"VBasicLine",alias:"\u6298\u7EBF\u56FE",img:K("basic-line.svg")},ta={name:"VBasicArea",alias:"\u533A\u57DF\u56FE",img:K("basic-area.svg")},oa={name:"VBasicPie",alias:"\u997C\u56FE",img:K("basic-pie.svg")},aa={name:"VBasicRing",alias:"\u73AF\u56FE",img:K("basic-ring.svg")},na={name:"VBasicRadar",alias:"\u96F7\u8FBE\u56FE",img:K("basic-radar.svg")},sa={name:"VBasicMap",alias:"\u4E2D\u56FD\u5730\u56FE",img:K("2d-china.svg")},la={name:"VBasicMapEvo",alias:"\u6CB3\u5317\u7701\u5730\u56FE",img:K("basic-map-evo.svg")},ca={name:"VBasicScatter",alias:"\u6563\u70B9\u56FE",img:K("basic-scatter.svg")},ia={name:"VLineBasicScatter",alias:"\u6563\u70B9\u7EBF\u56FE",img:K("line-basic-scatter.svg")},ra={name:"VBasicBoxplot",alias:"\u76D2\u987B\u56FE",img:K("basic-boxplot.svg")},da={name:"VBasicFunnel",alias:"\u68AF\u5EA6\u56FE",img:K("basic-funnel.svg")},ua={name:"VBasicWordCloud",alias:"\u8BCD\u4E91\u56FE",img:K("basic-wordcloud.svg")},ma={name:"VBasicGauge",alias:"\u4EEA\u8868\u76D8",img:K("basic-gauge.svg")},pa={name:"VProgressCircle",alias:"\u8FDB\u5EA6\u73AF",img:K("pie-one-value.svg")},va={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:K("number-title-flop.svg")},fa={name:"VTimer",alias:"\u65F6\u95F4\u5668",img:K("timer.svg")},_a={name:"VSelect",alias:"\u4E0B\u62C9\u63A7\u4EF6",img:K("select.svg")},ha={name:"VMainTitle",alias:"\u6807\u9898",img:K("main-title.svg")},ga={name:"VBgBox",alias:"\u80CC\u666F\u5757",img:K("bg-box.svg")},ba={name:"VBorderBox",alias:"\u8FB9\u6846",img:K("border-box.svg")},ya={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:K("img.svg")},Ca={name:"VIcon",alias:"\u56FE\u6807",img:K("icon.svg")},xa={name:"VScrollTable",alias:"\u6EDA\u52A8\u8868\u683C",img:K("scroll-table.svg")},Se=[{type:"basic",name:"\u57FA\u7840",icon:"block",group:[],comps:[ha,ga,ya,ba,Ca]},{type:"analysis",name:"\u5206\u6790",icon:"barchart",group:[{name:"\u6307\u6807",comps:[va,pa]},{name:"\u67F1\u56FE",comps:[qo,Zo,Qo]},{name:"\u7EBF\u56FE",comps:[ea,ta]},{name:"\u997C\u56FE",comps:[oa,aa]},{name:"\u6563\u70B9\u56FE",comps:[ca,ia]},{name:"\u96F7\u8FBE\u56FE",comps:[na]},{name:"\u5730\u56FE",comps:[sa,la]},{name:"\u5176\u4ED6\u56FE\u8868",comps:[ra,da,ua,ma]}],comps:[]},{type:"control",name:"\u63A7\u4EF6",icon:"edit-square",group:[],comps:[_a,fa]},{type:"table",name:"\u8868\u683C",icon:"table",group:[],comps:[xa]},{type:"images",name:"\u56FE\u7247",icon:"image",group:[],comps:[]},{type:"comps",name:"\u7EC4\u4EF6",icon:"CodeSandbox",group:[],comps:[]}];function wa(o){const t=[];return Se.forEach(n=>{t.push(...n.comps),n.group.forEach(e=>{t.push(...e.comps)})}),t.find(n=>n.name===o)}const ka={key:0,class:"comp-wrap"},Sa=["title"],$a={class:"inner"},Va=["onDragstart","onClick"],Ma=["src"],Da={class:"comp-item-text"},Ia={__name:"comps",props:{comps:{type:Array,default:()=>[]}},emits:["dragstart","click"],setup(o,{emit:t}){const n=(l,s)=>t("dragstart",l,s),e=l=>t("click",l);return(l,s)=>o.comps.length>0?(h(),$("div",ka,[(h(!0),$(J,null,ae(o.comps,(i,r)=>(h(),$("div",{class:"comp-item",key:r,title:i.alias},[a("div",$a,[a("div",{class:"comp-item-img",draggable:!0,onDragstart:d=>n(d,i.name),onClick:d=>e(i.name)},[a("img",{src:i.img},null,8,Ma)],40,Va),a("div",Da,Q(i.alias),1)])],8,Sa))),128))])):P("",!0)}};var ot=q(Ia,[["__scopeId","data-v-23a6401e"]]);function Xe(){const o=Dt(),t=T("");function n(e){t.value===e?t.value="":t.value=e}o.on("item-click",n),It("collapse",{activeGroupKey:t,collapseMitt:o})}function Ta(o){const t=Tt("collapse"),n=t==null?void 0:t.collapseMitt,e=I(()=>(t==null?void 0:t.activeGroupKey.value)===o.name);function l(s){n==null||n.emit("item-click",s)}return{isActive:e,triggerClick:l}}const Ra={class:"collapse-group"},Ba={class:"name"},La={class:"wrap-label"},Na={key:1},za={key:0,class:"wrap-edit"},Ea=["onClick"],Oa=["onClick"],Ua={class:"content"},Aa={__name:"collapse",props:{title:{type:String,required:!0},name:{type:[String,Number,Object],required:!0},canEdit:{type:Boolean,default:!1}},emits:["edit","remove"],setup(o,{emit:t}){const n=o,{isActive:e,triggerClick:l}=Ta(n),s=T(!1),i=T("");let r="";function d(){l(n.name)}function c(){s.value=!0,i.value=n.title,r=n.title}function m(y){const b=(y.target.value||"").trim();(!b||b===r)&&(s.value=!1)}function g(y){(y.target.value||"").trim()?p():s.value=!1}function p(){s.value=!1,t("edit",i.value)}const f=()=>t("remove");return(y,b)=>{const _=k("b-input"),S=k("b-icon"),C=k("b-collapse-transition"),w=fe("focus");return h(),$("div",Ra,[a("div",{class:E(["header",[{active:v(e)}]]),flex:"cross:center",onClick:d},[a("div",Ba,[a("div",La,[s.value?(h(),$("div",{key:0,class:"create-box",onClick:b[1]||(b[1]=oe(()=>{},["stop"]))},[le(u(_,{modelValue:i.value,"onUpdate:modelValue":b[0]||(b[0]=V=>i.value=V),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"mini",style:{width:"150px",top:"-2px"},onBlur:m,onKeyup:ye(g,["enter"])},null,8,["modelValue","onKeyup"]),[[w]])])):(h(),$("div",Na,Q(o.title),1))]),o.canEdit&&!s.value?(h(),$("span",za,[a("i",{class:"b-iconfont b-icon-edit",onClick:oe(c,["stop"])},null,8,Ea),a("i",{class:"b-iconfont b-icon-delete",onClick:oe(f,["stop"])},null,8,Oa)])):P("",!0),a("span",{class:E(["wrap-arrow",[{active:v(e)}]])},[u(S,{name:"right",size:"12"})],2)])],2),u(C,null,{default:x(()=>[le(a("div",Ua,[Ee(y.$slots,"default",{},void 0,!0)],512),[[Oe,v(e)]])]),_:3})])}}};var Je=q(Aa,[["__scopeId","data-v-ead41a62"]]);const Ga={class:"group-comps"},Pa={class:"comp-wrap"},Ya={key:0,class:"comp-item img-add"},ja={class:"inner"},Ka={class:"comp-item-img"},Xa={class:"inner"},Ja=["onDragstart","onClick"],Ha={key:0,class:"hover-layer"},Wa=["onClick"],Fa=["title"],qa={__name:"images-item",props:{groupId:{type:String,required:!0}},emits:["dragstart","click"],setup(o,{emit:t}){const n=o,e=T([]),l=I(()=>!Ye.includes(n.groupId)),s=()=>io(n.groupId).then(m=>e.value=m);s();async function i(m){try{H(!0);const g=m.map(p=>({group:n.groupId,name:p.name,attr:{w:p.width,h:p.height},src:p.image}));await ro(g),s()}catch(g){console.log(g)}H(!1)}async function r({group:m,id:g}){try{H(!0),await uo(m,g),s()}catch(p){console.log(p)}H(!1)}const d=(m,g)=>t("dragstart",m,g),c=m=>t("click",m);return(m,g)=>{const p=k("g-upload"),f=fe("lazy");return h(),$("div",Ga,[a("div",Pa,[v(l)?(h(),$("div",Ya,[a("div",ja,[a("div",Ka,[u(p,{onUpload:i,multiple:""})])])])):P("",!0),(h(!0),$(J,null,ae(e.value,(y,b)=>(h(),$("div",{class:"comp-item",key:b},[a("div",Xa,[a("div",{class:E(["comp-item-img",{"can-edit":v(l)}]),draggable:!0,onDragstart:_=>d(_,y),onClick:_=>c(y)},[le(a("img",null,null,512),[[f,y.src]]),v(l)?(h(),$("div",Ha,[a("i",{class:"b-iconfont b-icon-delete-fill",title:"\u5220\u9664\u56FE\u7247",onClick:oe(_=>r(y),["stop"])},null,8,Wa)])):P("",!0)],42,Ja),a("div",{class:"comp-item-text",title:JSON.stringify(y,null,2)},Q(y.name),9,Fa)])]))),128))])])}}};var Za=q(qa,[["__scopeId","data-v-bc0f8576"]]);const Qa={class:"group-wrap"},en={class:"group-list"},tn={key:0,class:"create-box"},on={class:"create-group"},an={__name:"images-list",emits:["dragstart","click"],setup(o,{emit:t}){const n=T([]);Xe();const e=T({key:"",value:""}),l=be({create:!1,edit:!1}),s=()=>mo().then(f=>n.value=f);s();function i(){e.value={key:`group_images_${me()}`,value:""},l.create=!0}function r(f){if(!l.create)return;(f.target.value||"").trim()?m():l.create=!1}async function d(f,y){try{H(!0);const b={key:f.key,value:y};await po(b),s(),W.success("\u4FEE\u6539\u6210\u529F")}catch(b){console.log(b)}H(!1)}async function c(f){try{await pe.confirm({type:"error",title:"\u786E\u5B9A\u79FB\u9664\u5F53\u524D\u56FE\u7247\u5206\u7EC4\u5417\uFF1F"}),H(!0),await vo(f.key),s(),W.success("\u5220\u9664\u6210\u529F\uFF01")}catch(y){console.log(y)}H(!1)}async function m(){try{H(!0),await fo(e.value),s(),l.create=!1,W.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(f){console.log(f)}H(!1)}const g=(f,y)=>t("dragstart",f,y),p=f=>t("click",f);return(f,y)=>{const b=k("b-input"),_=k("b-scrollbar"),S=k("b-button"),C=fe("focus");return h(),$("div",Qa,[a("div",en,[u(_,{native:""},{default:x(()=>[(h(!0),$(J,null,ae(n.value,w=>(h(),z(Je,{key:w.key,name:w.key,title:w.value,"can-edit":!v(Ye).includes(w.key),onEdit:V=>d(w,V),onRemove:V=>c(w)},{default:x(()=>[u(Za,{"group-id":w.key,onDragstart:g,onClick:p},null,8,["group-id"])]),_:2},1032,["name","title","can-edit","onEdit","onRemove"]))),128)),l.create?(h(),$("div",tn,[le(u(b,{modelValue:e.value.value,"onUpdate:modelValue":y[0]||(y[0]=w=>e.value.value=w),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"small",onBlur:r,onKeyup:ye(r,["enter"])},null,8,["modelValue","onKeyup"]),[[C]])])):P("",!0)]),_:1})]),a("div",on,[u(S,{type:"primary",transparent:"",onClick:i},{default:x(()=>[N("\u521B\u5EFA\u56FE\u7247\u5206\u7EC4")]),_:1})])])}}};var nn=q(an,[["__scopeId","data-v-74e445e6"]]);const vt=[];vt.map(o=>o.key);const ft="COMPS_GROUP",_t="COMPS_LIB",Te=async()=>Ve.getItem(ft),Re=async o=>Ve.setItem(ft,Ie(o)),He=async()=>Ve.getItem(_t),Ne=async o=>Ve.setItem(_t,Ie(o));async function ht(){try{const o=await Te();if(o)return o;const t=Ie(vt);return await Re(t),t}catch{return[]}}async function sn(o){try{const t=await Te();return t?(t.push(o),await Re(t),!0):!1}catch{return!1}}async function ln(o){try{const t=await Te();if(t){const n=Pe(t,o.key,"key");return t[n].value=o.value,await Re(t),o.key}return!1}catch{return!1}}async function cn(o){try{const t=await Te();if(t){const n=Pe(t,o,"key");return t.splice(n,1),await Re(t),!0}return!1}catch{return!1}}async function rn(o,t,n){try{const e={id:Yt(),group:o,comp:t,src:n},l=await He();return l?(l.push(e),await Ne(l),!0):(await Ne([e]),!1)}catch{return!1}}async function dn(o){try{const t=await He();return t?t.filter(n=>n.group===o):[]}catch{return[]}}async function un(o,t){try{const n=await He();if(n){const e=n.filter(s=>s.group===o),l=Pe(e,t);return e.splice(l,1),await Ne(e),!0}return!1}catch{return!1}}const mn={class:"group-comps"},pn={key:1,class:"comp-wrap"},vn={class:"inner"},fn=["onDragstart","onClick"],_n={class:"hover-layer"},hn=["onClick"],gn={class:"comp-item-text"},bn={__name:"comp-item",props:{groupId:{type:String,required:!0}},emits:["dragstart","click"],setup(o,{emit:t}){const n=o,e=T([]),l=()=>dn(n.groupId).then(d=>e.value=d);l();async function s({group:d,id:c}){try{H(!0),await un(d,c),l()}catch(m){console.log(m)}H(!1)}const i=(d,c)=>t("dragstart",d,c),r=d=>t("click",d);return(d,c)=>{const m=k("b-empty"),g=fe("lazy");return h(),$("div",mn,[e.value.length===0?(h(),z(m,{key:0},{default:x(()=>[N("\u6682\u65E0\u7EC4\u4EF6")]),_:1})):(h(),$("div",pn,[(h(!0),$(J,null,ae(e.value,(p,f)=>(h(),$("div",{class:"comp-item",key:f},[a("div",vn,[a("div",{class:"comp-item-img",draggable:!0,onDragstart:y=>i(y,p.comp),onClick:y=>r(p.comp)},[le(a("img",null,null,512),[[g,p.src]]),a("div",_n,[a("i",{class:"b-iconfont b-icon-delete-fill",title:"\u5220\u9664\u56FE\u7247",onClick:oe(y=>s(p),["stop"])},null,8,hn)])],40,fn),a("div",gn,Q(p.comp.alias),1)])]))),128))]))])}}};var yn=q(bn,[["__scopeId","data-v-c2ee8224"]]);const Cn={class:"group-wrap"},xn={class:"group-list"},wn={key:1,class:"create-box"},kn={class:"create-group"},Sn={__name:"comp-list",emits:["dragstart","click"],setup(o,{emit:t}){const n=T([]);Xe();const e=T({key:"",value:""}),l=be({create:!1,edit:!1}),s=()=>ht().then(f=>n.value=f);s();function i(){e.value={key:`group_comp_${me()}`,value:""},l.create=!0}function r(f){if(!l.create)return;(f.target.value||"").trim()?m():l.create=!1}async function d(f,y){try{H(!0);const b={key:f.key,value:y};await ln(b),s(),W.success("\u4FEE\u6539\u6210\u529F")}catch(b){console.log(b)}H(!1)}async function c(f){try{H(!0),await pe.confirm({type:"error",title:"\u786E\u5B9A\u79FB\u9664\u5F53\u524D\u7EC4\u4EF6\u5E93\u5417\uFF1F"}),await cn(f.key),s(),W.success("\u5220\u9664\u6210\u529F\uFF01")}catch(y){console.log(y)}H(!1)}async function m(){try{H(!0),await sn(e.value),s(),l.create=!1,W.success("\u65B0\u589E\u6210\u529F\uFF01")}catch(f){console.log(f)}H(!1)}const g=(f,y)=>t("dragstart",f,y),p=f=>t("click",f);return(f,y)=>{const b=k("b-empty"),_=k("b-input"),S=k("b-scrollbar"),C=k("b-button"),w=fe("focus");return h(),$("div",Cn,[a("div",xn,[u(S,{native:""},{default:x(()=>[n.value.length===0?(h(),z(b,{key:0},{default:x(()=>[N("\u6682\u65E0\u7EC4\u4EF6\u5E93")]),_:1})):P("",!0),(h(!0),$(J,null,ae(n.value,V=>(h(),z(Je,{key:V.key,name:V.key,title:V.value,"can-edit":!v(Ye).includes(V.key),onEdit:O=>d(V,O),onRemove:O=>c(V)},{default:x(()=>[u(yn,{"group-id":V.key,onDragstart:g,onClick:p},null,8,["group-id"])]),_:2},1032,["name","title","can-edit","onEdit","onRemove"]))),128)),l.create?(h(),$("div",wn,[le(u(_,{modelValue:e.value.value,"onUpdate:modelValue":y[0]||(y[0]=V=>e.value.value=V),placeholder:"\u8F93\u5165\u540D\u79F0\uFF0C\u56DE\u8F66\u521B\u5EFA",size:"small",onBlur:r,onKeyup:ye(r,["enter"])},null,8,["modelValue","onKeyup"]),[[w]])])):P("",!0)]),_:1})]),a("div",kn,[u(C,{type:"primary",transparent:"",onClick:i},{default:x(()=>[N("\u521B\u5EFA\u7EC4\u4EF6\u5E93")]),_:1})])])}}};var $n=q(Sn,[["__scopeId","data-v-47c3cece"]]);const Vn={class:"components-panel-wp"},Mn={class:"components-panel"},Dn=a("div",{class:"panel-title"},[a("span",{class:"panel-text"},"\u7EC4\u4EF6")],-1),In={class:"components-type"},Tn=["onClick"],Rn={class:"com-tab-title"},Bn=a("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),Ln=[Bn],Nn={class:"components-list-content"},zn={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,toolbar:l,selectedCom:s}=n(t),i=T(-1);Xe();const r=I(()=>i.value===-1?[]:Se[i.value].group),d=I(()=>i.value===-1?[]:Se[i.value].comps);function c(C){t.toggleCompsPanel(!0),i.value=C}function m(C,w){C.dataTransfer.setData("normal-comp",w)}async function g(C){try{const w=mt(C);if(w.attr.x=Math.floor((e.value.width-w.attr.w)/2),w.attr.y=Math.floor((e.value.height-w.attr.h)/2),t.addCom({component:w}),t.selectCom(w),w.apiData&&w.apiData.type===Ue.static&&w.apiData.staticPath){const{data:V}=await pt(w.id,w.apiData.staticPath);s.value.apiData.config.data=JSON.stringify(V)}}catch(w){console.log(w)}}function p(C,w){C.dataTransfer.setData("image-comp",JSON.stringify(Ze(w)))}function f(C){const w=Ze(C);w.attr.x=Math.floor((e.value.width-w.attr.w)/2),w.attr.y=Math.floor((e.value.height-w.attr.h)/2),t.addCom({component:w}),t.selectCom(w)}function y(C,w){C.dataTransfer.setData("custom-comp",JSON.stringify(Qe(w)))}function b(C){const w=Qe(C);t.addCom({component:w}),t.selectCom(w)}function _(C){C.preventDefault(),C.stopPropagation(),C.dataTransfer.dropEffect="none"}function S(){l.value.components&&(t.toggleCompsPanel(!1),i.value=-1)}return(C,w)=>{const V=k("b-icon"),O=k("b-scrollbar");return h(),$("div",Vn,[a("div",Mn,[Dn,a("div",{class:"components-panel-content",onDragover:_},[a("div",In,[u(O,{native:""},{default:x(()=>[(h(!0),$(J,null,ae(v(Se),(L,U)=>(h(),$("div",{class:E(["components-item",{active:i.value===U}]),key:U,onClick:j=>c(U)},[u(V,{class:"com-tab-icon",name:L.icon},null,8,["name"]),a("span",Rn,Q(L.name),1)],10,Tn))),128))]),_:1})])],32),a("div",{class:E(["components-list",{"is-hide":!v(l).components}])},[a("div",{class:"components-list-top"},[a("div",{class:"action",onClick:S},Ln)]),a("div",Nn,[u(O,{native:""},{default:x(()=>[(h(!0),$(J,null,ae(v(r),(L,U)=>(h(),z(Je,{key:U,name:U,title:L.name},{default:x(()=>[u(ot,{comps:L.comps,onDragstart:m,onClick:g},null,8,["comps"])]),_:2},1032,["name","title"]))),128)),u(ot,{comps:v(d),onDragstart:m,onClick:g},null,8,["comps"]),i.value===4?(h(),z(nn,{key:0,onDragstart:p,onClick:f})):P("",!0),i.value===5?(h(),z($n,{key:1,onDragstart:y,onClick:b})):P("",!0)]),_:1})])],2)])])}}},at=o=>`${o}px`,nt=(o,t,n,e)=>{const l=o!=null?o:document.createElement("canvas");l.width=t*e,l.height=n*e,l.style.width=at(t),l.style.height=at(n);const s=l.getContext("2d");return s&&s.setTransform(e,0,0,e,0,0),l};class st{constructor(t,n){this.el=t,this.options={direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2,...n},this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:n}=this,{direction:e,width:l,height:s,ratio:i}=n,r=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,l),d=s;this.ruler.width=r,this.ruler.height=d;const c=nt(null,r,d,i);jt(c,"canvas-ruler"),t.appendChild(c),this.canvas=c,this.ctx=c.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:n,ruler:e}=this,{width:l,height:s}=e;t.beginPath(),t.fillStyle=n.bgColor,t.fillRect(0,0,l,s),t.closePath(),t.beginPath(),t.font=`${n.fontSize} ${n.fontFamily}`,t.textAlign="left",t.fillStyle=n.fontColor,t.strokeStyle=n.strokeStyle,t.lineWidth=n.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:n,ruler:e}=this,{width:l,height:s}=e,{offset:i,scale:r}=n,d=0,c=s/1.5,m=s/1.2;for(let g=0;g<=l;g+=1){const p=g-i;if(p<0)continue;let f=-1,y=-1;p%50===0?(f=Math.floor(p/r),y=d):p%25===0?y=c:p%5===0&&(y=m),y>=0&&(t.moveTo(g+.5,s+.5),t.lineTo(g+.5,y),f>-1&&t.fillText(`${f}`,g+2.5,s/1.5))}}setSize(t,n,e){const{el:l,options:s}=this;s.width=t,s.height=n,s.scale=e;const{direction:i,width:r,height:d,ratio:c}=s,m=Math.max(i==="TB"?l.offsetWidth:l.offsetHeight,r),g=d;this.ruler.width=m,this.ruler.height=g,nt(this.canvas,m,g,c),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const En={name:"ruler",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{canvas:n}=t(o),e=T(null),l=T(null),s=T(null),i=T(null),r=T(!0),d=T(0),c=T(0),m=document.documentElement.clientWidth;Rt(()=>{if(e.value&&l.value){const p=Math.max(n.value.width,m);s.value?s.value.setSize(p,18,n.value.scale):s.value=new st(e.value,{direction:"TB",width:p,scale:n.value.scale}),i.value?i.value.setSize(n.value.height,18,n.value.scale):i.value=new st(l.value,{direction:"LR",width:n.value.height,scale:n.value.scale})}});const g=p=>{const f=p.target;d.value=f.scrollLeft,c.value=f.scrollTop};return Ce(()=>{const p=document.getElementById("canvas-wp");p==null||p.addEventListener("scroll",g)}),Bt(()=>{const p=document.getElementById("canvas-wp");p==null||p.removeEventListener("scroll",g)}),{visible:r,hRulerWpRef:e,vRulerWpRef:l,vScroll:c,hScroll:d}}},On=o=>(xe("data-v-5f454e16"),o=o(),we(),o),Un={class:"canvas-ruler-wp"},An=On(()=>a("div",{class:"ruler-corner"},null,-1));function Gn(o,t,n,e,l,s){return h(),$("div",Un,[a("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:F(`transform: translateX(-${e.hScroll}px);`)},null,4),a("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:F(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),An])}var Pn=q(En,[["render",Gn],["__scopeId","data-v-5f454e16"]]);function lt(o){if(o={...o},o.rotate!==0){const t=o.width*et(o.rotate)+o.height*tt(o.rotate),n=(o.width-t)/2;o.left+=n,o.right=o.left+t;const e=o.height*et(o.rotate)+o.width*tt(o.rotate),l=(e-o.height)/2;o.top-=l,o.bottom=o.top+e,o.width=t,o.height=e}else o.bottom=o.top+o.height,o.right=o.left+o.width;return o}const Yn=5,jn={name:"mark-line",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{comps:n,selectedCom:e,canvas:l,toolbox:s}=t(o),i=T([]),r=T(["xt","xc","xb","yl","yc","yr"]),d=T({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),c=()=>{Object.keys(d.value).forEach(_=>{d.value[_]=!1})};function m({key:_,value:S}){const C={left:"x",top:"y"};o.setShapeSingleStyle({key:C[_],value:S})}const g=(_,S)=>{const C=i.value,w=e.value,V=n.value.filter(D=>!D.hided),O=l.value.scale,L=lt(y(w.attr)),U=L.width/2,j=L.height/2;c(),V.forEach(D=>{if(D.id===w.id||D.locked||D.hided)return;const{top:A,left:R,bottom:M,right:B,width:G,height:X}=lt(y(D.attr)),se=G/2,ie=X/2,ne={top:[{isNearly:b(L.top,A),lineNode:C.xt,line:"xt",dragShift:A,lineShift:A},{isNearly:b(L.bottom,A),lineNode:C.xt,line:"xt",dragShift:A-L.height,lineShift:A},{isNearly:b(L.top+j,A+ie),lineNode:C.xc,line:"xc",dragShift:A+ie-j,lineShift:A+ie},{isNearly:b(L.top,M),lineNode:C.xb,line:"xb",dragShift:M,lineShift:M},{isNearly:b(L.bottom,M),lineNode:C.xb,line:"xb",dragShift:M-L.height,lineShift:M}],left:[{isNearly:b(L.left,R),lineNode:C.yl,line:"yl",dragShift:R,lineShift:R},{isNearly:b(L.right,R),lineNode:C.yl,line:"yl",dragShift:R-L.width,lineShift:R},{isNearly:b(L.left+U,R+se),lineNode:C.yc,line:"yc",dragShift:R+se-U,lineShift:R+se},{isNearly:b(L.left,B),lineNode:C.yr,line:"yr",dragShift:B,lineShift:B},{isNearly:b(L.right,B),lineNode:C.yr,line:"yr",dragShift:B-L.width,lineShift:B}]},_e=[],{rotate:Le}=L;Object.keys(ne).forEach(ue=>{ne[ue].forEach(ce=>{if(!ce.isNearly)return;const ke=Le!==0?p(ue,ce,L):ce.dragShift;m({key:ue,value:ke}),ce.lineNode.style[ue]=`${ce.lineShift*O+60}px`,_e.push(ce.line)})}),_e.length&&f(_e,_,S)})},p=(_,S,C)=>{const{w,h:V}=e.value.attr;return Math.round(_==="top"?S.dragShift-(V-C.height)/2:S.dragShift-(w-C.width)/2)},f=(_,S,C)=>{C?_.includes("yr")?d.value.yr=!0:_.includes("yc")?d.value.yc=!0:_.includes("yl")&&(d.value.yl=!0):_.includes("yl")?d.value.yl=!0:_.includes("yc")?d.value.yc=!0:_.includes("yr")&&(d.value.yr=!0),S?_.includes("xb")?d.value.xb=!0:_.includes("xc")?d.value.xc=!0:_.includes("xt")&&(d.value.xt=!0):_.includes("xt")?d.value.xt=!0:_.includes("xc")?d.value.xc=!0:_.includes("xb")&&(d.value.xb=!0)},y=_=>({left:_.x,top:_.y,width:_.w,height:_.h,rotate:_.rotate}),b=(_,S)=>Math.abs(_-S)<=Yn;return Ce(()=>{de.on("move",({isDownward:_,isRightward:S})=>{s.value.markLine&&g(_,S)}),de.on("unmove",()=>{c()})}),Me(()=>{de.off("move"),de.off("unmove")}),{lineRefs:i,lines:r,lineStatus:d}}},Kn={class:"mark-line"};function Xn(o,t,n,e,l,s){return h(),$("div",Kn,[(h(!0),$(J,null,ae(e.lines,i=>le((h(),$("div",{key:i,class:E(["line",[i.includes("x")?"xline":"yline",i]]),ref_for:!0,ref:r=>{e.lineRefs[i]=r}},null,2)),[[Oe,e.lineStatus[i]||!1]])),128))])}var Jn=q(jn,[["render",Xn],["__scopeId","data-v-00d4450a"]]);const{schemaStore:gt}=Y(),Hn=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],ct=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],Wn=o=>{const t=(o+360)%360,n={};let e=-1;return Hn.forEach(l=>{const s=(l.angle+t)%360,i=ct.length,r=0;for(;r<i;){e=(e+1)%i;const d=ct[e];if(s<23||s>=338){n[l.direction]="nwse-resize";break}if(d.start<=s&&s<d.end){n[l.direction]=d.cursor;break}}}),n};function Fn(o,t,n,e,l,s,i){o==="t"?(s.h=Math.round(t.h+(n.y-e.y)/l),s.y=Math.round(t.y+(e.y-n.y)/l),s.h=Math.max(s.h,20),t.lockedRatio&&(s.w=s.h*i)):o==="rt"?(s.h=Math.round(t.h+(n.y-e.y)/l),s.w=Math.round(t.w+(e.x-n.x)/l),s.y=Math.round(t.y+(e.y-n.y)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20),t.lockedRatio&&(s.w=s.h*i)):o==="r"?(s.w=Math.round(t.w+(e.x-n.x)/l),s.w=Math.max(s.w,20),t.lockedRatio&&(s.h=s.w/i)):o==="rb"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.w=Math.round(t.w+(e.x-n.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20),t.lockedRatio&&(s.h=s.w/i)):o==="b"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.h=Math.max(s.h,20),t.lockedRatio&&(s.w=s.h*i)):o==="lb"?(s.h=Math.round(t.h+(e.y-n.y)/l),s.w=Math.round(t.w+(n.x-e.x)/l),s.x=Math.round(t.x+(e.x-n.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20),t.lockedRatio&&(s.h=s.w/i)):o==="l"?(s.w=Math.round(t.w+(n.x-e.x)/l),s.x=Math.round(t.x+(e.x-n.x)/l),s.w=Math.max(s.w,20),t.lockedRatio&&(s.h=s.w/i)):o==="lt"&&(s.h=Math.round(t.h+(n.y-e.y)/l),s.w=Math.round(t.w+(n.x-e.x)/l),s.w=Math.max(s.w,20),s.h=Math.max(s.h,20),s.x=Math.round(t.x+(e.x-n.x)/l),s.y=Math.round(t.y+(e.y-n.y)/l),t.lockedRatio&&(s.h=s.w/i,s.y=Math.round(t.y+(e.x-n.x)/l)))}const bt=(o,t,n,e,l)=>{const s={...n.attr},i=s.w/s.h,r=Object.create(null),d=o.clientX,c=o.clientY;let m=!1;const g=f=>{const y=f.clientX,b=f.clientY,_=Math.round((y-d)/e/l)*l,S=Math.round((b-c)/e/l)*l;m=Math.abs(_)>=1||Math.abs(S)>=1,t?Fn(t,s,{x:d,y:c},{x:y,y:b},e,r,i):(r.x=s.x+_,r.y=s.y+S),n.attr={...n.attr,...r},ge().then(()=>{de.emit("move",{isDownward:b-c>0,isRightward:y-d>0})})},p=()=>{de.emit("unmove"),m&&gt.recordSnapshot(),te(document,"mousemove",g),te(document,"mouseup",p)};ee(document,"mousemove",g),ee(document,"mouseup",p)},qn=(o,t,n,e)=>{bt(o,null,t,n,e)},Zn=(o,t,n,e,l)=>{bt(o,t,n,e,l)},Qn=(o,t,n)=>{const e=t.getBoundingClientRect(),l=e.left+e.width/2,s=e.top+e.height/2,i=Math.atan2(s-o.clientY,l-o.clientX)*180/Math.PI-n.attr.rotate;let r=!1;const d=m=>{r=!0;const g=Math.atan2(s-m.clientY,l-m.clientX)*180/Math.PI-i,p=Math.round(g%360);n.attr.rotate=p<0?p+360:p},c=()=>{r&&gt.recordSnapshot(),te(document,"mousemove",d),te(document,"mouseup",c)};ee(document,"mousemove",d),ee(document,"mouseup",c)},es={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(o){const t=I(()=>({height:`${o.attr.y+60/o.scale}px`,borderLeftWidth:`${.9/o.scale}px`})),n=I(()=>({width:`${o.attr.x+60/o.scale}px`,borderTopWidth:`${.9/o.scale}px`})),e=I(()=>({fontSize:`${12/o.scale}px`,top:`-${6/o.scale}px`,left:`-${6/o.scale}px`}));return{topLineStyle:t,leftLineStyle:n,accountStyle:e}}},ts={class:"nav-line"};function os(o,t,n,e,l,s){return h(),$("div",ts,[a("div",{class:"nav-line-top",style:F(e.topLineStyle)},null,4),a("div",{class:"nav-line-left",style:F(e.leftLineStyle)},null,4),a("div",{class:"nav-line-account",style:F(e.accountStyle)},Q(n.attr.x)+", "+Q(n.attr.y),5)])}var as=q(es,[["render",os]]);const ns={name:"dv-transform",components:{ReferLine:as},props:{data:{type:Object,required:!0}},setup(o){const t=Lt(),{showMenu:n}=Ke(),{schemaStore:e,storeToRefs:l}=Y(),{canvas:s,comps:i,pageConfig:r,selectedCom:d,hoveredComId:c,toolbox:m,spaceDown:g,isMultiSelect:p}=l(e),f=I(()=>c.value===o.data.id),y=I(()=>p.value?!1:!De(d.value)&&d.value.id===o.data.id),b=I(()=>({locked:o.data.locked,selected:y.value})),_=I(()=>({top:0,left:0,width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`,transform:`translate(${o.data.attr.x}px, ${o.data.attr.y}px)`})),S=I(()=>({"is-hide":!y.value||o.data.locked})),C=I(()=>({transform:`rotate(${o.data.attr.rotate}deg)`})),w=I(()=>({width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`})),V=I(()=>({display:o.data.hided?"none":"block"})),O=I(()=>Wn(o.data.attr.rotate)),L=I(()=>s.value.scale),U=I(()=>{const G=`scale(${1/L.value}, ${1/L.value})`;return{t:{name:"top",style:{cursor:O.value.t,transform:G}},rt:{name:"top-right",style:{cursor:O.value.rt,transform:G}},r:{name:"right",style:{cursor:O.value.r,transform:G}},rb:{name:"bottom-right",style:{cursor:O.value.rb,transform:G}},b:{name:"bottom",style:{cursor:O.value.b,transform:G}},lb:{name:"bottom-left",style:{cursor:O.value.lb,transform:G}},l:{name:"left",style:{cursor:O.value.l,transform:G}},lt:{name:"top-left",style:{cursor:O.value.lt,transform:G}}}}),j=()=>e.hoverCom(o.data.id),D=()=>e.hoverCom(""),A=()=>{e.selectCom(o.data)};return{comps:i,selectedCom:d,hoveredComId:c,toolbox:m,isHovered:f,isSelected:y,hideStyle:V,transformClass:b,transformStyle:_,handlerClass:S,handlerStyle:C,wrapperStyle:w,onEnter:j,onLeave:D,onMove:G=>{g.value||(G.stopPropagation(),G.preventDefault(),A(),!o.data.locked&&qn(G,o.data,L.value,r.value.grid))},onZoom:(G,X)=>{A(),Zn(G,X,o.data,L.value,r.value.grid)},onRotate:G=>{Qn(G,t.vnode.el,o.data)},points:U,scale:L,showMenu:n}}},ss={class:"dv-com"},ls=["onMousedown"],cs=["onMousedown"],is=a("div",{class:"transform-bg"},null,-1),rs={key:1,class:"b-iconfont b-icon-lock",title:"\u89E3\u9501"};function ds(o,t,n,e,l,s){const i=k("refer-line");return h(),$("div",{class:E(["dv-transform",e.transformClass]),style:F(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(h(),z(i,{key:0,attr:n.data.attr,scale:e.scale},null,8,["attr","scale"])):P("",!0),a("div",{class:E(["dv-scale",{hovered:e.isHovered}]),style:F(e.hideStyle),onMouseenter:t[2]||(t[2]=(...r)=>e.onEnter&&e.onEnter(...r)),onMouseleave:t[3]||(t[3]=(...r)=>e.onLeave&&e.onLeave(...r)),onMousedown:t[4]||(t[4]=(...r)=>e.onMove&&e.onMove(...r))},[a("div",{class:E(["transform-handler",e.handlerClass]),style:F(e.handlerStyle)},[a("div",ss,[Ee(o.$slots,"default"),a("div",{class:"dv-event-disable",style:F(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...r)=>e.showMenu&&e.showMenu(...r))},null,36)]),(h(!0),$(J,null,ae(e.points,(r,d)=>(h(),$(J,{key:d},[r.rotateStyle?(h(),$("i",{key:0,class:E(`${r.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"rotate-handler",style:F(r.rotateStyle),onMousedown:t[1]||(t[1]=oe((...c)=>e.onRotate&&e.onRotate(...c),["prevent","stop"]))},[a("span",{class:"control-point",style:F(r.style),onMousedown:oe(c=>e.onZoom(c,d),["prevent","stop"])},null,44,ls)],36)],2)):(h(),$("i",{key:1,class:E(`${r.name}-handler`),"data-html2canvas-ignore":""},[a("span",{class:"control-point",style:F(r.style),onMousedown:oe(c=>e.onZoom(c,d),["prevent","stop"])},null,44,cs)],2))],64))),128)),is],6)],38),n.data.locked?(h(),$("i",rs)):P("",!0)],6)}var us=q(ns,[["render",ds]]);const ms=["onClick"],ps=["onClick"],vs={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{undoDisable:e,redoDisable:l}=n(t),s=I(()=>t.toolbar.config?{right:"330px"}:{right:0}),i=()=>t.undo(),r=()=>t.redo();return(d,c)=>(h(),$("div",{class:"action-bar-wrap",style:F(v(s))},[a("i",{class:"action-btn b-iconfont b-icon-aim",title:"\u6700\u4F73\u753B\u5E03\u6BD4\u4F8B",onClick:c[0]||(c[0]=oe(m=>v(t).autoCanvasScale(),["stop"]))}),a("i",{class:"action-btn b-iconfont b-icon-icon-test",title:"1:1\u753B\u5E03\u5927\u5C0F",onClick:c[1]||(c[1]=oe(m=>v(t).setCanvasScale(100),["stop"]))}),a("i",{class:E(["action-btn b-iconfont b-icon-rollback",{disabled:v(e)}]),title:"\u64A4\u9500",onClick:oe(i,["stop"])},null,10,ms),a("i",{class:E(["action-btn b-iconfont b-icon-rollback",{disabled:v(l)}]),title:"\u91CD\u505A",onClick:oe(r,["stop"]),style:{transform:"rotateY(180deg)"}},null,10,ps)],4))}};var fs=q(vs,[["__scopeId","data-v-293a1cf3"]]);const _s=["onMousedown"],hs={__name:"index",props:{x:Number,y:Number,width:Number,height:Number,showArea:Boolean},setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,canvas:l,selectedComs:s,areaData:i}=n(t);function r(d){let c=!1;const m={x:i.value.x,y:i.value.y},g=s.value.map(V=>V.attr),p=Object.create(null),f=[],y=d.clientX,b=d.clientY,_=l.value.scale,S=e.value.grid,C=V=>{const O=V.clientX,L=V.clientY,U=Math.round((O-y)/_/S)*S,j=Math.round((L-b)/_/S)*S;c=Math.abs(U)>=1||Math.abs(j)>=1,p.x=m.x+U,p.y=m.y+j,i.value={...i.value,...p},s.value.forEach((D,A)=>{f[A]={x:g[A].x+U,y:g[A].y+j},D.attr={...D.attr,...f[A]}})},w=()=>{c&&t.recordSnapshot(),te(document,"mousemove",C),te(document,"mouseup",w)};ee(document,"mousemove",C),ee(document,"mouseup",w)}return(d,c)=>le((h(),$("div",{style:F({left:o.x+"px",top:o.y+"px",width:o.width+"px",height:o.height+"px"}),class:"select-area",onMousedown:oe(r,["stop"])},null,44,_s)),[[Oe,o.showArea]])}};var gs=q(hs,[["__scopeId","data-v-8dc9f1ea"]]);const bs={class:"canvas-main"},ys=["onMousedown"],Cs={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{pageConfig:e,spaceDown:l,canvas:s,selectedCom:i,comps:r,toolbox:d,getPanelOffsetLeft:c,getPanelOffsetTop:m,editorEL:g,areaData:p}=n(t),f=T(null),y=be({drag:!1,startX:0,startY:0});let b=0,_=0;const S=I(()=>({width:`${s.value.width}px`,height:`${s.value.height}px`})),C=I(()=>({position:"absolute",width:`${e.value.width}px`,height:`${e.value.height}px`,transform:`scale(${s.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${e.value.bgImage})`,backgroundColor:e.value.bgColor})),w=Kt(t.autoCanvasScale,50);async function V(R){R.preventDefault();try{const M=R.dataTransfer.getData("image-comp");if(M){const X=JSON.parse(M);O(R,X);return}const B=R.dataTransfer.getData("custom-comp");if(B){const X=JSON.parse(B);O(R,X);return}const G=R.dataTransfer.getData("normal-comp");if(G){const X=mt(G);if(O(R,X),X.apiData&&X.apiData.type===Ue.static&&X.apiData.staticPath){const{data:se}=await pt(X.id,X.apiData.staticPath);i.value.apiData.config.data=JSON.stringify(se)}}}catch(M){console.warn(M)}}function O(R,M){const{scale:B}=s.value,G=(R.clientX-c.value+f.value.scrollLeft)/B,X=(R.clientY-m.value+f.value.scrollTop)/B;M.attr.x=Math.round(G-M.attr.w/2),M.attr.y=Math.round(X-M.attr.h/2),t.addCom({component:M}),t.selectCom(M)}function L(R){R.preventDefault(),R.stopPropagation(),R.dataTransfer.dropEffect="copy"}function U(R){if(l.value){y.drag=!0;const M=R.clientX,B=R.clientY,G=s.value.scale,{scrollLeft:X,scrollTop:se,clientWidth:ie,scrollWidth:ne,clientHeight:_e,scrollHeight:Le}=f.value,ue=ie<ne||_e<Le,ce={left:X,top:se},ke=Fe=>{if(ue){const wt=Fe.clientX,kt=Fe.clientY,St=Math.round((wt-M)/G),$t=Math.round((kt-B)/G);f.value.scrollLeft=ce.left-St,f.value.scrollTop=ce.top-$t}},We=()=>{y.drag=!1,te(document,"mousemove",ke),te(document,"mouseup",We)};ee(document,"mousemove",ke),ee(document,"mouseup",We)}else t.selectCom()}function j(R){if(i.value||R.preventDefault(),l.value||R.target.className==="select-area")return;A();const M=g.value.getBoundingClientRect();b=M.x,_=M.y;const B=R.clientX,G=R.clientY;p.value.showArea=!0;const X=s.value.scale;p.value.x=(B-b)/X,p.value.y=(G-_)/X;const se=ne=>{p.value.width=Math.abs((ne.clientX-B)/X),p.value.height=Math.abs((ne.clientY-G)/X),ne.clientX<B&&(p.value.x=(ne.clientX-b)/X),ne.clientY<G&&(p.value.y=(ne.clientY-_)/X)},ie=ne=>{if(te(document,"mousemove",se),te(document,"mouseup",ie),ne.clientX===B&&ne.clientY===G){A();return}D()};ee(document,"mousemove",se),ee(document,"mouseup",ie)}function D(){const R=Xt(p.value,r.value);if(R.length===0){A();return}if(R.length===1){t.selectCom(R[0]),A();return}t.multiSelectComs(R)}function A(){p.value.showArea=!1,p.value.width=0,p.value.height=0}return Ce(()=>{ee(window,"resize",w),de.on("hideArea",A),t.getEditor(),w()}),Me(()=>{te(window,"resize",w)}),(R,M)=>(h(),$("div",bs,[a("div",{id:"canvas-wp",ref_key:"canvasWpRef",ref:f,class:"canvas-panel-wrap",onMousedown:oe(U,["stop"])},[a("div",{class:"screen-shot",style:F(v(S))},[v(d).markLine?(h(),z(Jn,{key:0,style:F(v(S))},null,8,["style"])):P("",!0),u(fs),u(Pn),a("div",{id:"canvas-components",class:"canvas-panel",style:F(v(C)),onDragover:L,onDrop:V,onMousedown:j},[(h(!0),$(J,null,ae(v(r),B=>(h(),z(us,{key:B.id,data:B},{default:x(()=>[(h(),z(ut(B.name),{data:B,style:F({width:B.attr.w+"px",height:B.attr.h+"px",opacity:B.attr.opacity,transform:"translateZ(0px)"}),id:`component_${B.id}`},null,8,["data","style","id"]))]),_:2},1032,["data"]))),128)),u(gs,Nt(zt(v(p))),null,16)],36)],4)],40,ys)]))}};async function ze(o){try{const t=o.clientWidth,n=o.clientHeight;return await Et(o,{quality:.7,width:t,height:n})}catch(t){return console.error(t),""}}const xs={name:"page-config",setup(){const{schemaStore:o,storeToRefs:t}=Y(),{pageConfig:n}=t(o),e=T(""),l=T(!1),s=()=>{n.value.bgColor="#0d2a42",n.value.bgImage=""},i=()=>o.autoCanvasScale(),r=c=>{if(c!=="custom"){const m=c.split("x"),g=+m[0],p=+m[1];o.setScreenSize({width:g,height:p})}};async function d(){H(!0),W.warning("\u6B63\u5728\u622A\u53D6\u753B\u5E03\u7F29\u7565\u56FE\uFF0C\u8BF7\u52FF\u8FDB\u884C\u5176\u4ED6\u64CD\u4F5C\uFF01"),l.value=!0;const c=document.getElementById("canvas-components");c.style.top=0,c.style.left=0,o.setCanvasScale(100),setTimeout(async()=>{try{const m=await ze(c);n.value.thumbnail=m,W.success("\u622A\u53D6\u7F29\u7565\u56FE\u6210\u529F\uFF01")}catch(m){console.log(m)}c.style.top="60px",c.style.left="60px",o.autoCanvasScale(),l.value=!1,H(!1)},300)}return ve([()=>n.value.width,()=>n.value.height],()=>{const{width:c,height:m}=n.value;c===1920&&m===1080||c===2560&&m===1080||c===3440&&m===1080||c===3440&&m===1440||c===414&&m===736||c===375&&m===667||c===375&&m===812?e.value=`${c}x${m}`:e.value="custom"},{immediate:!0}),{screenLabel:e,onSizeChange:i,resetBGImage:s,pageConfig:n,pageMap:[{group:"web\u7AEF",data:Jt.map(c=>({value:`${c.width}x${c.height}`,label:c.label}))},{group:"\u79FB\u52A8\u8BBE\u5907",data:Ht.map(c=>({value:`${c.width}x${c.height}`,label:c.label}))},{group:"\u5176\u4ED6",data:[{value:"custom",label:"\u81EA\u5B9A\u4E49"}]}],sizeChange:r,createPreviewThumb:ze,createThumb:d,thumbLoading:l}}},yt=o=>(xe("data-v-644ec27b"),o=o(),we(),o),ws={class:"page-config-panel"},ks=yt(()=>a("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),Ss={class:"page-config-content"},$s={class:"page-config-wp"},Vs={class:"page-config-wp"},Ms={class:"page-config-wp"},Ds={class:"image-thumb-wrap"},Is=["src"],Ts={key:1,class:"tip",flex:"dir:top main:center cross:center"},Rs=yt(()=>a("p",null,"\u6682\u672A\u622A\u53D6\u7F29\u7565\u56FE",-1)),Bs={class:"pt-5"};function Ls(o,t,n,e,l,s){const i=k("g-group-select"),r=k("g-field"),d=k("g-input-number"),c=k("g-color-picker"),m=k("g-image"),g=k("b-icon"),p=k("b-button"),f=k("b-scrollbar");return h(),$("div",ws,[ks,a("div",Ss,[u(f,null,{default:x(()=>[a("div",$s,[u(r,{label:"\u5C4F\u5E55\u8BBE\u7F6E"},{default:x(()=>[u(i,{modelValue:e.screenLabel,"onUpdate:modelValue":t[0]||(t[0]=y=>e.screenLabel=y),data:e.pageMap,onChange:e.sizeChange},null,8,["modelValue","data","onChange"])]),_:1}),u(r,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:x(()=>[u(d,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[1]||(t[1]=y=>e.pageConfig.width=y),label:"\u5BBD\u5EA6",min:375,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),u(d,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[2]||(t[2]=y=>e.pageConfig.height=y),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),u(r,{label:"\u80CC\u666F\u989C\u8272"},{default:x(()=>[u(c,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[3]||(t[3]=y=>e.pageConfig.bgColor=y)},null,8,["modelValue"])]),_:1}),u(r,{label:"\u80CC\u666F\u9884\u8BBE",tooltip:"\u53EF\u4EE5\u52A0\u8F7D\u5BF9\u5E94\u9884\u8BBE\u7684\u56FE\u7247\u80CC\u666F"},{default:x(()=>[u(m,{"ignore-group-keys":["header","box","decoration","widget"],"show-resize":!1,"show-clear":"",onClear:e.resetBGImage,modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[4]||(t[4]=y=>e.pageConfig.bgImage=y)},null,8,["onClear","modelValue"])]),_:1})]),a("div",Vs,[u(r,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:x(()=>[u(d,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[5]||(t[5]=y=>e.pageConfig.grid=y),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})]),a("div",Ms,[u(r,{label:"\u7F29\u7565\u56FE",tooltip:"\u622A\u53D6\u5F53\u524D\u753B\u5E03\u5B58\u4E3A\u7F29\u7565\u56FE"},{default:x(()=>[a("div",Ds,[e.pageConfig.thumbnail?(h(),$("img",{key:0,src:e.pageConfig.thumbnail,alt:""},null,8,Is)):(h(),$("div",Ts,[u(g,{name:"image",size:"52"}),Rs]))]),a("div",Bs,[u(p,{type:"primary",size:"small",loading:e.thumbLoading,onClick:e.createThumb},{default:x(()=>[N(" \u622A\u53D6 ")]),_:1},8,["loading","onClick"]),u(p,{size:"small",loading:e.thumbLoading,onClick:t[6]||(t[6]=y=>e.pageConfig.thumbnail="")},{default:x(()=>[N(" \u6E05\u9664 ")]),_:1},8,["loading"])])]),_:1})])]),_:1})])])}var Ns=q(xs,[["render",Ls],["__scopeId","data-v-644ec27b"]]);const{schemaStore:Ct,storeToRefs:zs}=Y(),{selectedCom:Es}=zs(Ct),Os={name:"config-title",props:{comName:{type:String},comAlias:{type:String},com:{type:Object,default:()=>({})},showCfg:{type:Boolean,default:!1}},emits:["update:com"],setup(o){const t=T(!1),n=T(""),e=I(()=>{const d=wa(o.comName);return d?d.name:o.comName}),l=()=>{t.value=!0,n.value=JSON.stringify(o.com,null,2)},s=()=>{Ge(JSON.stringify(o.com)),W.success("\u5DF2\u590D\u5236\u914D\u7F6E\u9879\u81F3\u526A\u5207\u677F"),t.value=!1},i=()=>{try{const d=JSON.parse(n.value);n.value=JSON.stringify(d,null,2),r(d),W.success("\u56FE\u8868\u5E94\u7528\u6210\u529F\uFF01"),t.value=!1}catch{W.error("\u914D\u7F6E\u9879\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u68C0\u67E5\u540E\u518D\u5E94\u7528\u914D\u7F6E\uFF01")}};function r(d){const c=Es.value.id;Ct.replaceCom(c,d)}return{openDetail:l,compJson:n,comTitle:e,copyCom:s,putJson:i,detailVisible:t}}},Us=o=>(xe("data-v-133b1084"),o=o(),we(),o),As={class:"com-title-wp"},Gs={class:"com-title"},Ps={class:"title-name"},Ys={class:"alias-name"},js={class:"version-tag"},Ks=Us(()=>a("span",null,"\u914D\u7F6E\u9879",-1)),Xs={class:"data-editor",style:{margin:"0"}},Js={class:"t-right pt-8"};function Hs(o,t,n,e,l,s){const i=k("b-icon"),r=k("b-ace-editor"),d=k("b-button"),c=k("b-modal");return h(),$("div",As,[a("div",Gs,[a("div",Ps,[a("span",Ys,Q(n.comAlias),1)]),a("div",js,[a("span",null,Q(e.comTitle),1)])]),Ee(o.$slots,"default",{},()=>[n.showCfg?(h(),$("div",{key:0,class:"search-config",onClick:t[0]||(t[0]=(...m)=>e.openDetail&&e.openDetail(...m)),title:"\u67E5\u770B\u914D\u7F6E\u9879"},[u(i,{name:"filesearch",size:"14"}),Ks])):P("",!0)],!0),u(c,{modelValue:e.detailVisible,"onUpdate:modelValue":t[2]||(t[2]=m=>e.detailVisible=m),title:`[${n.comAlias}] \u914D\u7F6E\u9879 `,"append-to-body":"",top:"60px","custom-class":"schema-modal"},{default:x(()=>[a("div",Xs,[u(r,{modelValue:e.compJson,"onUpdate:modelValue":t[1]||(t[1]=m=>e.compJson=m),theme:"tomorrow_night",wrap:"",styles:{border:"none"}},null,8,["modelValue"])]),a("div",Js,[u(d,{size:"small",type:"primary",icon:"snippets",onClick:e.putJson},{default:x(()=>[N("\u5E94\u7528\u914D\u7F6E\u9879")]),_:1},8,["onClick"]),u(d,{size:"small",type:"primary",icon:"file-copy",onClick:e.copyCom},{default:x(()=>[N(" \u590D\u5236\u914D\u7F6E\u9879 ")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"])])}var Be=q(Os,[["render",Hs],["__scopeId","data-v-133b1084"]]);const Ws={name:"data-center-panel",components:{ConfigTitle:Be,SourcePanel:Wt(()=>Ot(()=>import("./source-panel-1a869253.js"),["static/js/source-panel-1a869253.js","static/css/source-panel-9456a5cd.css","static/js/vendor-0c23bfd6.js","static/css/vendor-2b79d43b.css","static/js/chunk-brace-b1f520b9.js","static/js/index-dc442332.js","static/css/index-1c17caf9.css","static/js/chunk-bin-ui-next-be5ed89c.js","static/css/chunk-bin-ui-next-233b4550.css"]))},setup(){const{schemaStore:o,storeToRefs:t}=Y(),{selectedCom:n}=t(o),e=I(()=>Object.keys(n.value.apiData));return{selectedCom:n,dataKeys:e}}},Fs={class:"data-center-panel"},qs={class:"scroll-container"},Zs={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"};function Qs(o,t,n,e,l,s){const i=k("config-title"),r=k("source-panel"),d=k("b-empty"),c=k("b-scrollbar");return h(),$("div",Fs,[u(i,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),a("div",qs,[u(c,{native:""},{default:x(()=>[e.dataKeys.length>0?(h(),z(r,{key:0})):(h(),$("div",Zs,[u(d,null,{default:x(()=>[N("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E")]),_:1})]))]),_:1})])])}var el=q(Ws,[["render",Qs]]);const tl={class:"basic-setting-wp"},ol={flex:"cross:center"},al=a("span",{class:"pr-5"},"\u56FE\u8868\u5C3A\u5BF8",-1),xt={__name:"basic-setting",props:{attr:{type:Object,required:!0},readonly:{type:Boolean,default:!1}},emits:["update:attr"],setup(o,{emit:t}){const n=o,e=I({get:()=>n.attr,set:d=>t("update:attr",d)}),{schemaStore:l,storeToRefs:s}=Y(),{curComIsGroup:i,isMultiSelect:r}=s(l);return(d,c)=>{const m=k("b-icon"),g=k("g-input-number"),p=k("g-field"),f=k("g-slider"),y=k("b-button"),b=k("b-button-group");return h(),$("div",tl,[u(p,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{label:x(()=>[a("div",ol,[al,u(m,{name:v(e).lockedRatio?"link":"disconnect",color:v(e).lockedRatio?"#1089ff":"#ccc",title:v(e).lockedRatio?"\u89E3\u9664\u9501\u5B9A\u5BBD\u9AD8\u5173\u8054":"\u9501\u5B9A\u5BBD\u9AD8\u5173\u8054",type:"button",onClick:c[0]||(c[0]=_=>v(e).lockedRatio=!v(e).lockedRatio)},null,8,["name","color","title"])])]),default:x(()=>[u(g,{modelValue:v(e).w,"onUpdate:modelValue":c[1]||(c[1]=_=>v(e).w=_),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(g,{modelValue:v(e).h,"onUpdate:modelValue":c[2]||(c[2]=_=>v(e).h=_),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),u(p,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:x(()=>[u(g,{modelValue:v(e).x,"onUpdate:modelValue":c[3]||(c[3]=_=>v(e).x=_),label:"X",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(g,{modelValue:v(e).y,"onUpdate:modelValue":c[4]||(c[4]=_=>v(e).y=_),label:"Y",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),v(r)?P("",!0):(h(),z(p,{key:0,label:"\u65CB\u8F6C\u89D2\u5EA6"},{default:x(()=>[u(f,{modelValue:v(e).rotate,"onUpdate:modelValue":c[5]||(c[5]=_=>v(e).rotate=_),min:0,max:360,step:1},null,8,["modelValue"])]),_:1})),v(r)||v(i)?P("",!0):(h(),z(p,{key:1,label:"\u900F\u660E\u5EA6"},{default:x(()=>[u(f,{modelValue:v(e).opacity,"onUpdate:modelValue":c[6]||(c[6]=_=>v(e).opacity=_),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})),v(r)?P("",!0):(h(),z(p,{key:2,label:"\u4F4D\u7F6E"},{default:x(()=>[u(b,null,{default:x(()=>[(h(!0),$(J,null,ae(v(_o),_=>(h(),z(y,{key:_.value,size:"mini",title:_.label,onClick:S=>v(l).doAdsorption(_.value)},{default:x(()=>[a("i",{class:E(`iconfont-align b-icon-${_.value}-vs`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})),v(r)?(h(),z(p,{key:3,label:"\u5BF9\u9F50"},{default:x(()=>[u(b,null,{default:x(()=>[(h(!0),$(J,null,ae(v(ho),_=>(h(),z(y,{key:_.value,size:"mini",title:_.label,onClick:S=>v(l).doAlign(_.value)},{default:x(()=>[a("i",{class:E(`iconfont-align b-icon-${_.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})):P("",!0),v(r)||v(i)?(h(),z(p,{key:4,label:"\u7EC4\u5408\u62C6\u5206"},{default:x(()=>[u(b,null,{default:x(()=>[u(y,{size:"mini",icon:"group",disabled:!v(r),onClick:c[7]||(c[7]=_=>v(l).group())},{default:x(()=>[N(" \u7EC4\u5408 ")]),_:1},8,["disabled"]),u(y,{size:"mini",icon:"ungroup",disabled:!v(i),onClick:c[8]||(c[8]=_=>v(l).ungroup())},{default:x(()=>[N(" \u62C6\u5206 ")]),_:1},8,["disabled"])]),_:1})]),_:1})):P("",!0)])}}},nl={class:"setting-panel"},sl={class:"setting-panel-content"},ll={class:"scroll-container"},cl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{selectedCom:e}=n(t);return(l,s)=>{const i=k("b-scrollbar");return h(),$("div",nl,[u(Be,{"com-name":v(e).name,"com-alias":v(e).alias,com:v(e),"show-cfg":""},null,8,["com-name","com-alias","com"]),a("div",sl,[a("div",ll,[u(i,null,{default:x(()=>[(h(),z(xt,{key:`${v(e).id}'_basic-setting`,attr:v(e).attr},null,8,["attr"])),(h(),z(ut(v(e).name+"Config"),{key:v(e).id,data:v(e)},null,8,["data"]))]),_:1})])])])}}},il={class:"setting-panel"},rl={class:"setting-panel-content"},dl={class:"scroll-container"},ul={__name:"multi-setting",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{areaData:e}=n(t),l=I(()=>e.value.showArea),s=I(()=>({x:e.value.x,y:e.value.y,w:e.value.width,h:e.value.height}));return(i,r)=>{const d=k("b-scrollbar");return h(),$("div",il,[u(Be,{"com-alias":"\u591A\u9009\u533A\u57DF"}),a("div",rl,[a("div",dl,[u(d,null,{default:x(()=>[u(xt,{attr:v(s),readonly:v(l)},null,8,["attr","readonly"])]),_:1})])])])}}},ml={style:{margin:"-16px",padding:"10px"}},pl={__name:"EventParamsModal",props:{modelValue:{type:Boolean,default:!1},params:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{emit:t}){const n=o,e=I({get:()=>n.modelValue,set:s=>t("update:modelValue",s)}),l=[{title:"\u53C2\u6570\u540D",key:"desc"},{title:"\u53C2\u6570Key",key:"name"},{title:"\u53C2\u6570\u7C7B\u578B",key:"type"}];return(s,i)=>{const r=k("b-table"),d=k("b-modal");return h(),z(d,{modelValue:v(e),"onUpdate:modelValue":i[0]||(i[0]=c=>dt(e)?e.value=c:null),title:"\u53C2\u6570\u4FE1\u606F",width:"750px","append-to-body":"","custom-class":"schema-modal"},{default:x(()=>[a("div",ml,[u(r,{columns:l,data:o.params,size:"small",border:""},null,8,["data"])])]),_:1},8,["modelValue"])}}},vl={flex:"main:justify cross:center"},fl={__name:"trigger-config",props:{eventList:{type:Array,default:()=>Ft},events:{type:Object,default:()=>({})}},setup(o){const t=o,n=I(()=>t.events),e=I(()=>{let r=!1;return t.eventList.forEach(d=>{if(!De(n.value[d])){r=!0;return}}),r}),l=T([]),s=T(!1);function i(r){l.value=r,s.value=!0}return(r,d)=>{const c=k("b-checkbox"),m=k("b-button"),g=k("g-field"),p=k("g-field-collapse");return v(e)?(h(),z(p,{key:0,label:"\u89E6\u53D1\u4E8B\u4EF6","default-open":""},{default:x(()=>[(h(!0),$(J,null,ae(o.eventList,f=>(h(),$(J,{key:f},[v(n)[f]?(h(),z(g,{key:0,label:v(n)[f].name},{default:x(()=>[a("div",vl,[u(c,{modelValue:v(n)[f].enable,"onUpdate:modelValue":y=>v(n)[f].enable=y},null,8,["modelValue","onUpdate:modelValue"]),u(m,{type:"text",title:"\u67E5\u770B\u4E8B\u4EF6\u53C2\u6570",onClick:y=>i(v(n)[f].params)},{default:x(()=>[N(" \u67E5\u770B ")]),_:2},1032,["onClick"])])]),_:2},1032,["label"])):P("",!0)],64))),128)),u(pl,{modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=f=>s.value=f),params:l.value},null,8,["modelValue","params"])]),_:1})):P("",!0)}}},_l={class:"series-title",style:{top:"-8px"}},hl={style:{width:"50%","padding-right":"8px"}},gl={style:{width:"50%","padding-right":"8px"}},bl={key:0,style:{"min-height":"80px"},flex:"main:center cross:center"},yl={__name:"response-config",props:{compId:{type:String,default:""},events:{type:Object,default:()=>({})}},setup(o){const t=o,n=I(()=>t.events),e=I(()=>Object.keys(n.value).includes("onEvents")),l=I(()=>qt.value.filter(g=>g.compId!==t.compId).map(g=>({value:g.compId,label:g.compName}))),s=I(()=>{const g=n.value.actions;return Object.keys(g).map(p=>({value:p,label:g[p].title}))});function i(g){return Zt.value.filter(p=>p.eventName.includes(g)).map(p=>({value:p.eventName,label:p.title}))}function r(){n.value.onEvents.push({eventSource:"",eventName:"",actionName:"",actionParams:[],register:!1})}function d(g){if(g.eventSource===""){W.warning("\u8BF7\u9009\u62E9\u4E8B\u4EF6\u6E90\uFF01");return}if(g.eventName===""){W.warning("\u8BF7\u7ED1\u5B9A\u4E8B\u4EF6\uFF01");return}if(g.actionName===""){W.warning("\u8BF7\u7ED1\u5B9A\u52A8\u4F5C\uFF01");return}g.register=!0}function c(g,p){p.register?p.register=!1:n.value.onEvents.splice(g,1)}function m(g,p){const f=n.value.actions[g];f&&(p.actionParams=Ie(f.params))}return(g,p)=>{const f=k("b-icon"),y=k("b-button"),b=k("g-select"),_=k("g-field"),S=k("g-field-collapse");return v(e)?(h(),z(S,{key:0,label:"\u54CD\u5E94\u4E8B\u4EF6","default-open":""},{add:x(()=>[u(y,{type:"text",title:"\u65B0\u589E\u4E00\u4E2A\u54CD\u5E94\u4E8B\u4EF6",onClick:r},{default:x(()=>[u(f,{name:"plus",size:"16"})]),_:1})]),default:x(()=>[(h(!0),$(J,null,ae(v(n).onEvents,(C,w)=>(h(),z(_,{key:w,label:"\u4E8B\u4EF6","label-width":"85px",flat:""},{label:x(()=>[a("div",_l,[a("span",null,"\u4E8B\u4EF6"+Q(w+1),1)])]),default:x(()=>[u(b,{modelValue:C.eventSource,"onUpdate:modelValue":V=>C.eventSource=V,data:v(l),disabled:C.register,label:"\u4E8B\u4EF6\u6E90"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),C.eventSource!==""?(h(),$(J,{key:0},[u(b,{modelValue:C.eventName,"onUpdate:modelValue":V=>C.eventName=V,data:i(C.eventSource),disabled:C.register,inline:"",label:"\u7ED1\u5B9A\u4E8B\u4EF6"},null,8,["modelValue","onUpdate:modelValue","data","disabled"]),u(b,{modelValue:C.actionName,"onUpdate:modelValue":V=>C.actionName=V,data:v(s),disabled:C.register,inline:"",label:"\u7ED1\u5B9A\u52A8\u4F5C",onChange:V=>m(C.actionName,C)},null,8,["modelValue","onUpdate:modelValue","data","disabled","onChange"])],64)):P("",!0),a("span",hl,[u(y,{size:"small",style:{width:"100%"},type:"primary",disabled:C.register,onClick:V=>d(C)},{default:x(()=>[N(" \u6CE8\u518C\u4E8B\u4EF6 ")]),_:2},1032,["disabled","onClick"])]),a("span",gl,[u(y,{size:"small",style:{width:"100%"},onClick:V=>c(w,C)},{default:x(()=>[N(Q(C.register?"\u53D6\u6D88":"\u5220\u9664"),1)]),_:2},1032,["onClick"])])]),_:2},1024))),128)),v(n).onEvents.length===0?(h(),$("div",bl," \u6682\u65E0\u54CD\u5E94\u4E8B\u4EF6 ")):P("",!0)]),_:1})):P("",!0)}}},Cl={class:"events-panel"},xl={class:"events-panel-content"},wl=a("div",{class:"data-result-title"},"\u4E8B\u4EF6\u914D\u7F6E",-1),kl={class:"scroll-container"},Sl={class:"setting-panel-gui"},$l={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{selectedCom:e}=n(t),l=I(()=>e.value.events);return(s,i)=>{const r=k("b-scrollbar");return h(),$("div",Cl,[u(Be,{"com-name":v(e).name,"com-alias":v(e).alias,com:v(e)},null,8,["com-name","com-alias","com"]),a("div",xl,[wl,a("div",kl,[u(r,null,{default:x(()=>[a("div",Sl,[u(fl,{events:v(l)},null,8,["events"]),u(yl,{events:v(l),"comp-id":v(e).id},null,8,["events","comp-id"])])]),_:1})])])])}}},Vl={class:"config-panel"},Ml={key:0,class:"page-config-panel"},Dl={class:"page-config-top"},Il={class:"tabs-wrapper"},Tl={key:0,class:"page-config-content"},Rl={key:1,class:"page-config-content"},Bl={style:{height:"100%"}},Ll={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{toolbar:e,selectedCom:l,isMultiSelect:s}=n(t),i=T(0),r=d=>{s.value&&d>0||i.value!==d&&(i.value=d)};return ve(()=>l.value,()=>{i.value=0}),(d,c)=>{const m=k("b-icon"),g=k("b-tooltip");return h(),$("div",{class:E(["config-panel-wp",{"is-hide":!v(e).config}])},[a("div",Vl,[v(l)||v(s)?(h(),$("div",Ml,[a("div",Dl,[a("div",Il,[a("div",{class:E(["tab-item",{active:i.value===0}]),onClick:c[0]||(c[0]=p=>r(0))},[u(g,{content:"\u914D\u7F6E"},{default:x(()=>[u(m,{name:"control",size:"20"})]),_:1})],2),a("div",{class:E(["tab-item",{active:i.value===1}]),onClick:c[1]||(c[1]=p=>r(1))},[u(g,{content:"\u6570\u636E"},{default:x(()=>[u(m,{name:"cloud-server",size:"22"})]),_:1})],2),a("div",{class:E(["tab-item",{active:i.value===2}]),onClick:c[2]||(c[2]=p=>r(2))},[u(g,{content:"\u4E8B\u4EF6"},{default:x(()=>[u(m,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),v(s)?(h(),$("div",Tl,[u(ul)])):(h(),$("div",Rl,[a("div",Bl,[i.value===0?(h(),z(cl,{key:v(l).id})):P("",!0),i.value===1?(h(),z(el,{key:v(l).id})):P("",!0),i.value===2?(h(),z($l,{key:v(l).id})):P("",!0)])]))])):(h(),z(Ns,{key:1}))])],2)}}};const Nl={class:"toolbox-panel",flex:"main:justify"},zl={style:{width:"500px"},flex:""},El=a("i",{class:"action-btn b-iconfont b-icon-rollback"},null,-1),Ol=a("i",{class:"action-btn b-iconfont b-icon-rollback",style:{transform:"rotateY(180deg)"}},null,-1),Ul=a("div",null,null,-1),Al={class:"btn-box"},Gl={class:"btn-box"},Pl={class:"ctrl-box",flex:"cross:center"},Yl={__name:"index",setup(o){const{schemaStore:t,storeToRefs:n}=Y(),{toolbar:e,toolbox:l,undoDisable:s,redoDisable:i}=n(t),r=T(!1),d=T(null),c=()=>{pe.confirm({type:"error",title:"\u786E\u8BA4\u6E05\u7A7A\u753B\u5E03\u5417\uFF1F\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"}).then(()=>{t.clearScreen()}).catch(()=>{})},m=()=>t.undo(),g=()=>t.redo();function p(){r.value=!0,ge(()=>{d.value&&d.value.addEventListener("paste",f),d.value.focus(),d.value.placeholder="\u7C98\u8D34\u56FE\u8868\u914D\u7F6E"})}function f(y){const b=y.clipboardData.getData("Text");try{const _=JSON.parse(b);((_==null?void 0:_.type)==="com"||(_==null?void 0:_.type)==="group")&&(_.id=`${_.name}_${me()}`,_.name==="Group"&&_.components.forEach(S=>{S.id=`${S.name}_${me()}`}),t.addCom({component:_}),W.success("\u7C98\u8D34\u56FE\u8868\u6210\u529F\uFF01"))}catch(_){console.log(_),W.error("\u7C98\u8D34\u7684\u5185\u5BB9\u4E0D\u662F\u56FE\u8868\u7EC4\u4EF6\uFF01")}setTimeout(()=>{d.value.value="",r.value=!1,d.value.removeEventListener("paste",f)},100)}return(y,b)=>{const _=k("b-button"),S=k("b-switch");return h(),$("div",{class:E(["toolbox-panel-wp",{"is-hide":!v(e).toolbox}])},[a("div",Nl,[a("div",zl,[u(_,{size:"mini",disabled:v(s),onClick:m},{default:x(()=>[El,N(" \u64A4\u9500 ")]),_:1},8,["disabled"]),u(_,{size:"mini",disabled:v(i),onClick:g},{default:x(()=>[Ol,N(" \u91CD\u505A ")]),_:1},8,["disabled"]),Ul,a("div",Al,[N(" \u53C2\u8003\u7EBF\xA0\xA0 "),u(S,{modelValue:v(l).referLine,"onUpdate:modelValue":b[0]||(b[0]=C=>v(l).referLine=C),size:"small"},null,8,["modelValue"])]),a("div",Gl,[N(" \u5BF9\u9F50\u7EBF\xA0\xA0 "),u(S,{modelValue:v(l).markLine,"onUpdate:modelValue":b[1]||(b[1]=C=>v(l).markLine=C),size:"small"},null,8,["modelValue"])])]),a("div",Pl,[N(" \xA0\xA0 "),r.value?(h(),$("textarea",{key:0,class:"paste-inner",ref_key:"textpasteRef",ref:d},null,512)):(h(),z(_,{key:1,size:"mini",icon:"diff",onClick:p},{default:x(()=>[N("\u7C98\u8D34\u56FE\u8868")]),_:1})),u(_,{size:"mini",icon:"clear",onClick:c},{default:x(()=>[N("\u6E05\u7A7A\u753B\u5E03")]),_:1})])])],2)}}};const jl={name:"shortcut",props:{modelValue:{type:Boolean}},emits:["update:modelValue"]},Kl=o=>(xe("data-v-7e8e628e"),o=o(),we(),o),Xl=Kl(()=>a("div",{class:"shortcut-wp"},[a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u57FA\u7840\u5FEB\u6377\u952E"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2190")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u914D\u7F6E\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u7EC4\u4EF6\u9762\u677F"),a("div",{class:"shortcut-value"},"Ctrl + \u2191")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5F00\u5173\u5DE5\u5177\u680F"),a("div",{class:"shortcut-value"},"Ctrl + \u2193")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u590D\u5236\u9009\u4E2D\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Ctrl + C")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7C98\u8D34\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Ctrl + V")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u64A4\u9500\u64CD\u4F5C"),a("div",{class:"shortcut-value"},"Ctrl + Z")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4FDD\u5B58\u770B\u677F"),a("div",{class:"shortcut-value"},"Ctrl + S")])])]),a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u753B\u5E03\u64CD\u4F5C"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u6700\u4F73\u6BD4\u4F8B"),a("div",{class:"shortcut-value"},"Ctrl + A")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A1\uFF1A1"),a("div",{class:"shortcut-value"},"Ctrl + D")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u81EA\u7531\u7F29\u653E"),a("div",{class:"shortcut-value"},"Ctrl + \u9F20\u6807\u6EDA\u8F6E/\u6EDA\u52A8")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u753B\u5E03"),a("div",{class:"shortcut-value"},"Space + \u9F20\u6807\u5DE6\u952E/\u62D6\u52A8")])])]),a("div",{class:"shortcut-box"},[a("div",{class:"key-title"},"\u7EC4\u4EF6\u64CD\u4F5C"),a("div",{class:"key-wrap"},[a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u9876"),a("div",{class:"shortcut-value"},"Alt + Home")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u5E95"),a("div",{class:"shortcut-value"},"Alt + End")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4E0A\u79FB\u4E00\u5C42"),a("div",{class:"shortcut-value"},"Alt + \u2191")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u4E0B\u79FB\u4E00\u5C42"),a("div",{class:"shortcut-value"},"Alt + \u2193")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF61\u50CF\u7D20"),a("div",{class:"shortcut-value"},"\u2191 \u2193 \u2190 \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF610\u50CF\u7D20"),a("div",{class:"shortcut-value"},"Shift + \u2191 \u2193 \u2190 \u2192")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u91CD\u547D\u540D"),a("div",{class:"shortcut-value"},"F2/\u53CC\u51FB\u56FE\u5C42")]),a("div",{class:"shortcut-item"},[a("div",{class:"shortcut-title"},"\u5220\u9664\u9009\u4E2D\u7EC4\u4EF6"),a("div",{class:"shortcut-value"},"Delete")])])])],-1));function Jl(o,t,n,e,l,s){const i=k("b-modal");return h(),z(i,{title:"\u5FEB\u6377\u952E\u6307\u5357","model-value":n.modelValue,"append-to-body":"","custom-class":"schema-modal",onClose:t[0]||(t[0]=r=>o.$emit("update:modelValue",!1))},{default:x(()=>[Xl]),_:1},8,["model-value"])}var Hl=q(jl,[["render",Jl],["__scopeId","data-v-7e8e628e"]]);const Wl={name:"footer-panel",components:{Shortcut:Hl},setup(){const{schemaStore:o,storeToRefs:t}=Y(),{pageConfig:n,canvas:e}=t(o),l=T([200,150,100,50]),s=T(20),i=T(20),r=T(!1),d=async c=>{c===-1?o.autoCanvasScale():o.setCanvasScale(c===0?s.value:c)};return ve(()=>e.value.scale,c=>{const m=parseInt((c*100).toFixed(2));i.value=m,s.value=m}),{pageConfig:n,scaleList:l,inputScale:s,scale:i,submitScale:d,keycodeVisible:r}}},Fl={class:"footer-panel"},ql={class:"screen-info",flex:"cross:center"},Zl={class:"ml-8",style:{transform:"scale(0.9)"}},Ql={flex:"cross:center"},ec={class:"scale-input-wp"},tc=a("span",{class:"percent"},"%",-1),oc=a("i",{class:"b-iconfont b-icon-down"},null,-1),ac={class:"scale-slider-wp"};function nc(o,t,n,e,l,s){const i=k("b-icon"),r=k("b-tooltip"),d=k("b-dropdown-item"),c=k("b-dropdown-menu"),m=k("b-dropdown"),g=k("b-slider"),p=k("shortcut");return h(),$(J,null,[a("div",Fl,[a("div",ql,[u(r,{content:"\u5FEB\u6377\u952E\u63D0\u793A","open-delay":500},{default:x(()=>[u(i,{name:"read",size:"16",type:"button",onClick:t[0]||(t[0]=f=>e.keycodeVisible=!0)})]),_:1}),a("span",Zl,Q(e.pageConfig.width)+" \u50CF\u7D20 * "+Q(e.pageConfig.height)+" \u50CF\u7D20",1)]),a("div",Ql,[u(m,{trigger:"click",onCommand:e.submitScale},{dropdown:x(()=>[u(c,null,{default:x(()=>[(h(!0),$(J,null,ae(e.scaleList,f=>(h(),z(d,{key:f,name:f},{default:x(()=>[N(Q(`${f}%`),1)]),_:2},1032,["name"]))),128)),u(d,{name:-1},{default:x(()=>[N("\u81EA\u9002\u5E94")]),_:1})]),_:1})]),default:x(()=>[a("div",ec,[le(a("input",{"onUpdate:modelValue":t[1]||(t[1]=f=>e.inputScale=f),type:"number",class:"scale-input",onKeydown:t[2]||(t[2]=ye(f=>e.submitScale(0),["enter"]))},null,544),[[rt,e.inputScale]]),tc,oc])]),_:1},8,["onCommand"]),a("div",ac,[u(g,{modelValue:e.scale,"onUpdate:modelValue":t[3]||(t[3]=f=>e.scale=f),min:10,max:200,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])]),u(p,{modelValue:e.keycodeVisible,"onUpdate:modelValue":t[4]||(t[4]=f=>e.keycodeVisible=f)},null,8,["modelValue"])],64)}var sc=q(Wl,[["render",nc]]);const Z=o=>(xe("data-v-00b8514a"),o=o(),we(),o),lc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),cc=Z(()=>a("span",{class:"key-code"},"Alt + Home",-1)),ic=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),rc=Z(()=>a("span",{class:"key-code"},"Alt + End",-1)),dc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),uc=Z(()=>a("span",{class:"key-code"},"Alt + \u2191",-1)),mc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),pc=Z(()=>a("span",{class:"key-code"},"Alt + \u2193",-1)),vc=Z(()=>a("div",{class:"context-menu-divider"},null,-1)),fc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),_c=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),hc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),gc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),bc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-save"},null,-1)),yc=Z(()=>a("div",{class:"context-menu-divider"},null,-1)),Cc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),xc=Z(()=>a("span",{class:"key-code"},"F2",-1)),wc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),kc=Z(()=>a("span",{class:"key-code"},"Ctrl + C,V",-1)),Sc=Z(()=>a("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),$c=Z(()=>a("span",{class:"key-code"},"Delete",-1)),Vc={__name:"index",setup(o,{expose:t}){const n=T([]),e=T({}),l=()=>ht().then(D=>n.value=D),{schemaStore:s,storeToRefs:i}=Y(),{selectedCom:r,selectedComs:d}=i(s),{isLocked:c,isHided:m,contextMenu:g,contextMenuStyle:p}=Ke(),f=D=>{r.value&&s.moveCom({id:r.value.id,moveType:D})},y=()=>f(re.up),b=()=>f(re.down),_=()=>f(re.top),S=()=>f(re.bottom),C=()=>{r.value&&(r.value.locked=!r.value.locked)},w=()=>{r.value&&(r.value.hided=!r.value.hided)},V=async()=>{e.value=n.value[0].key,pe({title:"\u6307\u5B9A\u7EC4\u4EF6\u5E93",message:qe(to,{modelValue:e.value,onChange:D=>e.value=D},()=>n.value.map(D=>qe(eo,{label:D.value,value:D.key}))),showCancelButton:!0,confirmText:"\u4FDD\u5B58",cancelText:"\u53D6\u6D88",beforeClose:async(D,A,R)=>{if(D==="confirm"){try{const M=document.getElementById(`component_${r.value.id}`),B=await ze(M);await rn(e.value,r.value,B),A.confirmButtonLoading=!0}catch(M){console.log(M)}A.confirmButtonLoading=!1,R()}else R()}}).then(()=>W.success("\u4FDD\u5B58\u6210\u529F!")).catch(()=>{})},O=()=>{const D=r.value;D&&pe.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{s.deleteCom(D.id)}).catch(()=>{})},L=()=>{const D=r.value;D&&s.renamingCom(D.id)},U=()=>{s.copyComs(d.value)},j=D=>{D.preventDefault(),l()};return Ce(()=>{ee(document,"contextmenu",j)}),Me(()=>{te(document,"contextmenu",j)}),t({moveUp:y,moveBottom:S,moveDown:b,moveTop:_,lockCom:C,hideCom:w,toDeleteCom:O,renameCom:L,toCopyCom:U}),(D,A)=>(h(),z(Ut,{name:"zoom-in-top"},{default:x(()=>[v(g).show?(h(),$("div",{key:0,class:"context-menu-wrap",style:F(v(p))},[a("div",{class:"context-menu-item",onClick:_},[lc,N(" \u7F6E\u9876 "),cc]),a("div",{class:"context-menu-item",onClick:S},[ic,N(" \u7F6E\u5E95 "),rc]),a("div",{class:"context-menu-item",onClick:y},[dc,N(" \u4E0A\u79FB\u4E00\u5C42 "),uc]),a("div",{class:"context-menu-item",onClick:b},[mc,N(" \u4E0B\u79FB\u4E00\u5C42 "),pc]),vc,a("div",{class:"context-menu-item",onClick:C},[v(c)?(h(),$(J,{key:0},[fc,N(" \u89E3\u9501 ")],64)):(h(),$(J,{key:1},[_c,N(" \u9501\u5B9A ")],64))]),a("div",{class:"context-menu-item",onClick:w},[v(m)?(h(),$(J,{key:0},[hc,N(" \u663E\u793A ")],64)):(h(),$(J,{key:1},[gc,N(" \u9690\u85CF ")],64))]),n.value.length?(h(),$("div",{key:0,class:"context-menu-item",onClick:V},[bc,N(" \u4FDD\u5B58 ")])):P("",!0),yc,a("div",{class:"context-menu-item",onClick:L},[Cc,N(" \u91CD\u547D\u540D "),xc]),a("div",{class:"context-menu-item",onClick:U},[wc,N(" \u590D\u5236 "),kc]),a("div",{class:"context-menu-item",onClick:O},[Sc,N(" \u5220\u9664 "),$c])],4)):P("",!0)]),_:1}))}};var Mc=q(Vc,[["__scopeId","data-v-00b8514a"]]);function Dc(){const o=$e(),{schemaStore:t}=Y(),n=T(!1),e=async s=>{try{n.value=!0;const i=await Qt(s);if(i){const{id:r,name:d,pid:c,layout:m,components:g}=i,p={pageInfo:{id:r,name:d,pid:c},pageConfig:JSON.parse(m),comps:g.map(f=>JSON.parse(f.componentContent))};t.loadScreenData(p),await ge(),document.title=d}}catch(i){console.log(i)}n.value=!1},l=async()=>{try{n.value=!0;const s=await ao();if(s.tpl.length>0){const i=await co(s.tpl);if(i){const r=JSON.parse(i.content),{comps:d,pageConfig:c}=r;t.loadScreenData({comps:d,pageConfig:c})}}else t.setScreenSize(s)}catch(s){console.log(s)}n.value=!1};return ve(()=>o.path,async()=>{const{id:s}=o.query;s?await e(s):await l()},{immediate:!0}),{loading:n}}function Ic(){const o=T(null),t=T(null),{saveScreenData:n}=je(),{schemaStore:e,storeToRefs:l}=Y(),{pageInfo:s,canvas:i,selectedCom:r,selectedComs:d}=l(e),c=$e();let m=null;const g=b=>{const _=b.target;if(!["input","textarea"].includes(_.tagName.toLowerCase())){const S=b.key.toLowerCase();S==="delete"?(t.value&&t.value.toDeleteCom(),b.preventDefault()):S==="f2"&&(t.value&&t.value.renameCom(),b.preventDefault());const C=r.value;b.altKey&&(p("altKey"),S==="arrowup"?t.value&&t.value.moveUp():S==="arrowdown"?t.value&&t.value.moveDown():S==="home"?t.value&&t.value.moveTop():S==="end"&&t.value&&t.value.moveBottom(),b.preventDefault()),b.ctrlKey&&(p("ctrlKey"),S==="arrowup"?(e.toggleCompsPanel(),b.preventDefault()):S==="arrowdown"?(e.toggleToolbox(),b.preventDefault()):S==="arrowleft"?(e.toggleLayerPanel(),b.preventDefault()):S==="arrowright"?(e.toggleConfigPanel(),b.preventDefault()):S==="a"?(e.autoCanvasScale(),b.preventDefault()):S==="d"?(e.setCanvasScale(100),b.preventDefault()):S==="c"?(m=d.value,console.log(m),Ge(JSON.stringify(m)),b.preventDefault()):S==="v"?(m&&e.copyComs(m),b.preventDefault()):S==="s"?(s.value.id||c.query.id?(W("\u6B63\u5728\u4FDD\u5B58..."),n("edit").then(()=>W.success("\u4FDD\u5B58\u6210\u529F\uFF01"))):o.value&&o.value.handleSaveScreen(),b.preventDefault()):S==="z"&&(e.undo(),b.preventDefault())),b.shiftKey&&p("shiftKey"),b.keyCode===32&&(p("spaceKey"),b.preventDefault());const w=b.shiftKey?10:1;C&&!b.altKey&&(S==="arrowleft"?(C.attr.x-=w,e.recordSnapshot(),b.preventDefault()):S==="arrowright"?(C.attr.x+=w,e.recordSnapshot(),b.preventDefault()):S==="arrowup"?(C.attr.y-=w,e.recordSnapshot(),b.preventDefault()):S==="arrowdown"&&(C.attr.y+=w,e.recordSnapshot(),b.preventDefault()))}},p=b=>{e.toggleKey({key:b,status:!0})},f=()=>{e.resetKeyCode()},y=b=>{const _=parseInt((i.value.scale*100).toFixed(2)),S=(b.wheelDelta>0?1:-1)*5,C=Math.min(Math.max(_+S,20),200);e.setCanvasScale(C)};return Ce(()=>{ee(document,"keydown",g),ee(document,"keyup",f)}),Me(()=>{te(document,"keydown",g),te(document,"keyup",f)}),{headerRef:o,contextMenuRef:t,ctrlMouseWheel:y}}const Tc={name:"ScreenEditor",components:{ContextMenu:Mc,FooterPanel:sc,ToolboxPanel:Yl,CanvasMain:Cs,ConfigPanel:Ll,ComponentsPanel:zn,LayerPanel:Fo,HeaderBar:zo},setup(){return{...Dc(),...Ic()}}},Rc={key:0,flex:"main:center cross:center",class:"full-wrapper"},Bc={key:1,class:"editor-main-wrapper"},Lc={class:"edit-main-wp"};function Nc(o,t,n,e,l,s){const i=k("header-bar"),r=k("svg-loading"),d=k("components-panel"),c=k("layer-panel"),m=k("toolbox-panel"),g=k("canvas-main"),p=k("footer-panel"),f=k("config-panel"),y=k("context-menu");return h(),$("div",{class:"schema-screen-container",onWheel:t[0]||(t[0]=oe((...b)=>o.ctrlMouseWheel&&o.ctrlMouseWheel(...b),["ctrl","prevent"]))},[u(i,{ref:"headerRef","back-url":"/dashboard"},null,512),o.loading?(h(),$("div",Rc,[u(r,{name:"loading02"})])):(h(),$("div",Bc,[u(d),u(c),a("div",Lc,[u(m),u(g),u(p)]),u(f)])),u(y,{ref:"contextMenuRef"},null,512)],32)}var Kc=q(Tc,[["render",Nc]]);export{Kc as default};
