import{aw as j,k as V,o as _,a as w,f as T,a5 as xe,aL as je,l as D,A as re,n as ve,G as x,e as U,w as y,c as u,F as Y,j as q,b as n,m as L,t as Z,B as Se,g as de,Y as ke,h as A,O as ee,L as He,N as Ye,$ as nt,C as fe,U as at,aH as pe,aI as he,D as Ce,v as Xe,d as We,q as ne,X as lt,a1 as C,M as Ke,a0 as st,aN as it,a6 as ct,T as rt}from"./vendor-b7d265ee.js";import{u as N,z as Ve,A as $e,s as dt,t as Me,i as ut,B as De,o as be,C as F,D as J,M as le,E as I,F as Pe,G as mt,H as Ie,I as Ne,J as ie,f as vt,K as ft,w as pt,j as ht,L as _t,l as gt}from"./index-f0c9e2c9.js";import{M as Q,a as Fe}from"./chunk-bin-ui-next-925ea2c7.js";import{a as bt,g as Je,b as yt}from"./database.api-1a283e75.js";import{d as xt,a as Ct}from"./file-helper-94af9014.js";import{s as wt,l as St}from"./template.api-694d5cf4.js";import{r as kt,p as Vt,m as $t}from"./select-options-cf7d80b0.js";import"./chunk-brace-b4ee70be.js";const Mt={name:"HeadLoading",setup(){const{schemaStore:o,storeToRefs:t}=N(),{toolbar:l}=t(o);return{loading:V(()=>l.value.loading)}}};function Dt(o,t,l,e,d,a){return _(),w("div",{class:T(["loading-indicator",{loading:e.loading}])},null,2)}var Tt=j(Mt,[["render",Dt],["__scopeId","data-v-5475ad30"]]);function Te(){const o=xe(),{schemaStore:t,storeToRefs:l}=N(),{pageInfo:e,pageConfig:d,comps:a}=l(t);async function c(s="edit"){const r={id:e.value.id||o.query.id,name:e.value.name,pid:e.value.pid,status:s,layout:JSON.stringify(d.value),components:a.value.map(f=>Ve(f.apiData)?{name:f.alias,componentType:f.componentType,componentContent:JSON.stringify(f),componentDataType:$e.static,modelId:"",x:[],y:[],drill:[],filters:[]}:{name:f.alias,componentType:f.componentType,componentDataType:f.apiData.type,modelId:f.apiData.config.modelId,componentContent:JSON.stringify(f),x:f.apiData.config.x,y:f.apiData.config.y,drill:[],filters:[]})};try{return await dt(r)}catch(f){Me("userSchemaStore/saveScreenData",f)}return""}async function i(){let s={};try{t.setGlobalLoading(!0);const r={pageInfo:{id:e.value.id,name:e.value.name||"\u770B\u677F\u9884\u89C8",pid:e.value.pid||"1"},pageConfig:d.value,comps:a.value};s=await bt(r)}catch{s={}}return t.setGlobalLoading(!1),s}return{saveScreenData:c,previewScreen:i}}const Bt={name:"save-screen",props:{modelValue:{type:Boolean},status:{type:String,default:"edit",validator:o=>["edit","audited"].includes(o)}},emits:["update:modelValue"],setup(o,t){const l=V({get:()=>o.modelValue,set:h=>t.emit("update:modelValue",h)}),{schemaStore:e,storeToRefs:d}=N(),{pageInfo:a}=d(e),{saveScreenData:c}=Te(),i=je(),s=xe(),r=D([]),f=D(null),b=D(!1),m=V(()=>`${window.location.origin}/#/screen/${s.query.id}`);ut().then(h=>{r.value=h.data?[h.data]:[]});const v=V(()=>o.status==="edit"?"\u4FDD\u5B58\u770B\u677F":"\u53D1\u5E03\u770B\u677F"),p=()=>{f.value&&f.value.validate(async h=>{if(h){let M="";try{b.value=!0,M=await c(o.status)}catch(S){Me("save-screes/saveKanban",S)}b.value=!1,l.value=!1,Q.success({message:"\u4FDD\u5B58\u6210\u529F\uFF01",showClose:!0}),setTimeout(()=>{if(M&&!a.value.id){let W=i.resolve({path:"/schema/screen",query:{id:M}});window.location.replace(W.href)}},300)}})},g=()=>{ve(()=>{De(m.value)&&Q.success("\u590D\u5236\u53D1\u5E03\u5730\u5740\u6210\u529F!")})};return re(()=>o.modelValue,h=>{h&&ve(()=>{f.value&&f.value.resetFields()})}),{formRef:f,pageInfo:a,dirTree:r,loading:b,visible:l,saveKanban:p,btnText:v,shareUrl:m,copyUrl:g}}},Rt=L("\u590D\u5236\u9884\u89C8\u5730\u5740"),Lt={class:"t-center"};function It(o,t,l,e,d,a){const c=x("b-input"),i=x("b-form-item"),s=x("g-input"),r=x("b-button"),f=x("b-form"),b=x("b-modal");return _(),U(b,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=m=>e.visible=m),"append-to-body":"",title:e.btnText,top:"200px","custom-class":"schema-modal",onClose:t[3]||(t[3]=m=>e.visible=!1)},{default:y(()=>[u(f,{"label-width":"80px",ref:"formRef",model:e.pageInfo,"label-suffix":":"},{default:y(()=>[u(i,{label:"\u770B\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u770B\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:y(()=>[u(c,{modelValue:e.pageInfo.name,"onUpdate:modelValue":t[0]||(t[0]=m=>e.pageInfo.name=m)},null,8,["modelValue"])]),_:1}),l.status==="audited"&&o.$route.query.id?(_(),w(Y,{key:0},[u(i,{label:"\u9884\u89C8\u5730\u5740"},{default:y(()=>[u(s,{modelValue:e.shareUrl,"onUpdate:modelValue":t[1]||(t[1]=m=>e.shareUrl=m),readonly:"",type:"textarea",autosize:{minRows:3}},null,8,["modelValue"])]),_:1}),u(i,null,{default:y(()=>[u(r,{type:"text",onClick:e.copyUrl},{default:y(()=>[Rt]),_:1},8,["onClick"])]),_:1})],64)):q("",!0)]),_:1},8,["model"]),n("div",Lt,[u(r,{type:"primary",onClick:e.saveKanban,loading:e.loading,style:{width:"200px"}},{default:y(()=>[L(Z(e.btnText),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["modelValue","title"])}var Nt=j(Bt,[["render",It]]);const zt={name:"save-template",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,t){const{schemaStore:l,storeToRefs:e}=N(),{pageConfig:d,comps:a}=e(l),c=D(null),i=Se({loading:!1,id:`temp_${be()}`,name:""}),s=V({get:()=>o.modelValue,set:m=>t.emit("update:modelValue",m)}),r=V(()=>({template:{id:i.id,name:i.name},pageConfig:d.value,comps:a.value})),f=()=>{c.value&&c.value.validate(async m=>{if(m){const v=r.value,p=JSON.stringify(v);xt(p,`${v.template.id}.json`),Q.success({message:"\u6A21\u677F\u6587\u4EF6\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})},b=async()=>{c.value&&c.value.validate(async m=>{if(m){try{i.loading=!0;const v=r.value,p=v.template.name,g=JSON.stringify(v);await wt({name:p,content:g})}catch(v){Me("save-template/saveAsTemplate",v)}i.loading=!1,s.value=!1,Q.success({message:"\u6A21\u677F\u5DF2\u4FDD\u5B58\uFF01",showClose:!0})}})};return re(()=>o.modelValue,m=>{m&&(c.value&&c.value.resetFields(),i.id=`temp_${be()}`)}),{formRef:c,formStatus:i,visible:s,downloadCfg:f,saveAsTemplate:b}}},Ut={class:"t-center"},At=L(" \u914D\u7F6E\u6587\u4EF6 "),Et=L(" \u4FDD\u5B58\u6A21\u677F ");function Ot(o,t,l,e,d,a){const c=x("b-input"),i=x("b-form-item"),s=x("b-form"),r=x("b-button"),f=x("b-modal");return _(),U(f,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=b=>e.visible=b),"append-to-body":"",title:"\u4FDD\u5B58\u4E3A\u6A21\u677F",top:"200px","custom-class":"schema-modal",onClose:t[2]||(t[2]=b=>e.visible=!1)},{default:y(()=>[u(s,{"label-width":"80px",ref:"formRef",model:e.formStatus,"label-suffix":":"},{default:y(()=>[u(i,{label:"\u6A21\u677F\u540D\u79F0",prop:"name",rules:{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:y(()=>[u(c,{modelValue:e.formStatus.name,"onUpdate:modelValue":t[0]||(t[0]=b=>e.formStatus.name=b)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),n("div",Ut,[u(r,{type:"primary",icon:"vertical-align-botto",transparent:"",style:{width:"120px"},onClick:e.downloadCfg},{default:y(()=>[At]),_:1},8,["onClick"]),u(r,{type:"primary",icon:"save",style:{width:"120px"},loading:e.formStatus.loading,onClick:e.saveAsTemplate},{default:y(()=>[Et]),_:1},8,["loading","onClick"])])]),_:1},8,["modelValue"])}var jt=j(zt,[["render",Ot]]);const Ht={name:"header-bar",components:{SaveTemplate:jt,SaveScreen:Nt,HeadLoading:Tt},props:{backUrl:{type:String},backTarget:{type:String,default:"_blank",validator:o=>["_self","_blank"].includes(o)},pageStatus:{type:Object,default:()=>({})}},setup(o){const t=je(),{schemaStore:l,storeToRefs:e}=N(),{pageInfo:d,toolbar:a}=e(l),{previewScreen:c}=Te(),i=D(!1),s=D("edit"),r=D(!1);return{schemaStore:l,pageInfo:d,toolbar:a,saveVisible:i,saveStatus:s,tempVisible:r,handleBack:()=>{const g=o.backUrl||"/";if(o.backTarget==="_blank"){const h=t.resolve(g);window.open(h.href,o.backTarget)}else t.push(g)},handleSaveScreen:()=>{s.value="edit",i.value=!0},handPreview:async()=>{const g=await c();let h=t.resolve({path:`/screen/preview/${g.pageInfo.id}`});window.open(h.href,"_blank")},handlePublish:()=>{s.value="audited",i.value=!0},handleUpload:g=>g.type!=="application/json"?(Q.warning("\u8BF7\u9009\u62E9\u6B63\u786E\u7684json\u914D\u7F6E\u6587\u4EF6"),!1):(Ct(g).then(h=>{try{const M=JSON.parse(h),{comps:S,pageConfig:W}=M;l.loadScreenData({comps:S,pageConfig:W})}catch{console.warn("The imported file could not be converted to the correct JSON!")}}),!1)}}},Yt={class:"header-container"},Xt={class:"left-actions"},Wt={class:"screen-info"},Kt=n("span",null,"\u5206\u6790\u770B\u677F",-1),Pt=n("span",{style:{padding:"0 6px 0 12px"}},"-",-1),Ft={class:"global-actions"},Jt={class:"head-btn"};function qt(o,t,l,e,d,a){const c=x("b-icon"),i=x("b-tooltip"),s=x("b-space"),r=x("b-upload"),f=x("head-loading"),b=x("save-screen"),m=x("save-template");return _(),w(Y,null,[n("div",Yt,[n("div",Xt,[u(s,{size:"mini"},{default:y(()=>[u(i,{content:"\u7EC4\u4EF6","open-delay":500},{default:y(()=>[n("div",{class:T(["head-btn",{active:e.toolbar.components}]),onClick:t[0]||(t[0]=v=>e.schemaStore.toggleCompsPanel())},[u(c,{name:"hourglass",class:T(["com-list-icon",{"is-rotate":!e.toolbar.components}])},null,8,["class"])],2)]),_:1}),u(i,{content:"\u56FE\u5C42","open-delay":500},{default:y(()=>[n("div",{class:T(["head-btn",{active:e.toolbar.layer}]),onClick:t[1]||(t[1]=v=>e.schemaStore.toggleLayerPanel())},[u(c,{name:"container"})],2)]),_:1}),u(i,{content:"\u53F3\u4FA7\u9762\u677F","open-delay":500},{default:y(()=>[n("div",{class:T(["head-btn",{active:e.toolbar.config}]),onClick:t[2]||(t[2]=v=>e.schemaStore.toggleConfigPanel())},[u(c,{name:"control"})],2)]),_:1}),u(i,{content:"\u5DE5\u5177\u7BB1","open-delay":500},{default:y(()=>[n("div",{class:T(["head-btn",{active:e.toolbar.toolbox}]),onClick:t[3]||(t[3]=v=>e.schemaStore.toggleToolbox())},[u(c,{name:"shopping"})],2)]),_:1})]),_:1})]),n("div",Wt,[u(i,{content:"\u8FD4\u56DE","open-delay":500},{default:y(()=>[u(c,{name:"laptop",type:"button",onClick:e.handleBack},null,8,["onClick"])]),_:1}),Kt,Pt,de(n("input",{class:"header-input",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",maxlength:"50",type:"text","onUpdate:modelValue":t[4]||(t[4]=v=>e.pageInfo.name=v)},null,512),[[ke,e.pageInfo.name]])]),n("div",Ft,[u(s,{size:"mini"},{default:y(()=>[u(i,{content:"\u5BFC\u5165json (\u4F1A\u8986\u76D6\u6240\u6709\u5185\u5BB9\uFF01)","open-delay":500},{default:y(()=>[u(r,{action:"/","show-upload-list":!1,"before-upload":e.handleUpload},{default:y(()=>[n("div",Jt,[u(c,{name:"Import"})])]),_:1},8,["before-upload"])]),_:1}),u(i,{content:"\u4FDD\u5B58\u6A21\u677F","open-delay":500},{default:y(()=>[n("div",{class:"head-btn",onClick:t[5]||(t[5]=v=>e.tempVisible=!0)},[u(c,{name:"Storedprocedure"})])]),_:1}),u(i,{content:"\u4FDD\u5B58","open-delay":500},{default:y(()=>[n("div",{class:"head-btn",onClick:t[6]||(t[6]=(...v)=>e.handleSaveScreen&&e.handleSaveScreen(...v))},[u(c,{name:"save"})])]),_:1}),u(i,{content:"\u53D1\u5E03","open-delay":500},{default:y(()=>[n("div",{class:"head-btn",onClick:t[7]||(t[7]=(...v)=>e.handlePublish&&e.handlePublish(...v))},[u(c,{name:"send"})])]),_:1}),u(i,{content:"\u9884\u89C8","open-delay":500},{default:y(()=>[n("div",{class:"head-btn",onClick:t[8]||(t[8]=(...v)=>e.handPreview&&e.handPreview(...v))},[u(c,{name:"View"})])]),_:1})]),_:1})])]),u(f),u(b,{modelValue:e.saveVisible,"onUpdate:modelValue":t[9]||(t[9]=v=>e.saveVisible=v),status:e.saveStatus},null,8,["modelValue","status"]),u(m,{modelValue:e.tempVisible,"onUpdate:modelValue":t[10]||(t[10]=v=>e.tempVisible=v)},null,8,["modelValue"])],64)}var Gt=j(Ht,[["render",qt]]);const me=Se({x:0,y:0});function Be(o={}){const{schemaStore:t,storeToRefs:l}=N(),{contextMenu:e,selectedCom:d}=l(t),a=V(()=>{var f;return(f=d.value)==null?void 0:f.locked}),c=V(()=>{var f;return(f=d.value)==null?void 0:f.hided}),i=V(()=>({display:e.value.show?"block":"none",left:`${me.x+10}px`,top:`${me.y+10}px`,transform:document.documentElement.clientHeight-me.y<250?"translate(0px, -100%)":""})),s=f=>{f.preventDefault(),d.value&&(me.x=f.clientX,me.y=f.clientY,e.value.show=!0,F(document,"click",r))},r=()=>{J(document,"click",r),o&&o.beforeClose&&o.beforeClose(),e.value.show=!1};return{showMenu:s,isLocked:a,isHided:c,contextMenu:e,contextMenuStyle:i}}const Zt={name:"layer-panel",setup(){const{schemaStore:o,storeToRefs:t}=N(),{comps:l,toolbar:e,hoveredComId:d,selectedCom:a,renamingComId:c,multiSelect:i,multipleComs:s}=t(o),{showMenu:r}=Be(),f=V(()=>!!a.value),b=V(()=>({opacity:a.value?1:.3})),m=V(()=>{var B;return{enable:!!a.value,checked:(B=a.value)==null?void 0:B.locked}}),v=V(()=>{var B;return{enable:!!a.value,checked:(B=a.value)==null?void 0:B.hided}});function p(B){return i.value?s.value.map(k=>k.id).includes(B.id):!Ve(a.value)&&a.value.id===B.id}const g=V(()=>[...l.value].reverse()),h=B=>{a.value&&o.moveCom({id:a.value.id,moveType:B})};return{schemaStore:o,comps:l,toolbar:e,enableBtnClass:f,enableBtnStyle:b,moveUp:()=>h(le.up),moveDown:()=>h(le.down),moveTop:()=>h(le.top),moveBottom:()=>h(le.bottom),descComs:g,enableLockBtnClass:m,enableHideBtnClass:v,onEnter:B=>o.hoverCom(B),onLeave:()=>o.hoverCom(""),selectCom:B=>{const k=l.value.find(z=>z.id===B);k&&o.selectCom(k)},hoveredComId:d,selectedCom:a,renamingComId:c,showMenu:r,cancelSelectCom:()=>o.selectCom(),isSelected:p}}},Qt={class:"layer-panel"},eo={class:"layer-top"},to=n("div",{class:"layer-num pl-10"},"\u56FE\u5C42",-1),oo=n("i",{class:"b-iconfont b-icon-left",title:"\u6536\u8D77"},null,-1),no=[oo],ao={class:"layer-toolbar layer-toolbar-top"},lo={class:"layer-manager-wrap"},so=["title","onMousedown","onMouseenter","onDblclick"],io=["onUpdate:modelValue"],co={key:1,class:"layer-item-span"},ro={class:"layer-item-text"},uo=["title","onClick"],mo=["title","onClick"];function vo(o,t,l,e,d,a){const c=x("b-icon"),i=Ye("focus");return _(),w("div",{class:T(["layer-panel-wp",{"is-hide":!e.toolbar.layer}])},[n("div",Qt,[n("div",eo,[to,n("div",{class:"layer-action",onClick:t[0]||(t[0]=s=>e.schemaStore.toggleLayerPanel(!1))},no)]),n("div",ao,[n("i",{title:"\u4E0A\u79FB\u4E00\u5C42",class:T(["b-iconfont b-icon-arrowup toolbar-icon standard",e.enableBtnClass]),style:A(e.enableBtnStyle),onClick:t[1]||(t[1]=(...s)=>e.moveUp&&e.moveUp(...s))},null,6),n("i",{title:"\u4E0B\u79FB\u4E00\u5C42",class:T(["b-iconfont b-icon-arrowdown toolbar-icon standard",e.enableBtnClass]),style:A(e.enableBtnStyle),onClick:t[2]||(t[2]=(...s)=>e.moveDown&&e.moveDown(...s))},null,6),n("i",{title:"\u7F6E\u9876",class:T(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:A({transform:"rotate(180deg)",...e.enableBtnStyle}),onClick:t[3]||(t[3]=(...s)=>e.moveTop&&e.moveTop(...s))},null,6),n("i",{title:"\u7F6E\u5E95",class:T(["b-iconfont b-icon-vertical-align-botto toolbar-icon standard",e.enableBtnClass]),style:A(e.enableBtnStyle),onClick:t[4]||(t[4]=(...s)=>e.moveBottom&&e.moveBottom(...s))},null,6)]),n("div",lo,[(_(!0),w(Y,null,ee(e.descComs,s=>(_(),w("div",{key:s.id,title:s.alias,class:T(["layer-manager-item",[{hided:s.hided,locked:s.locked,hovered:s.id===e.hoveredComId,selected:e.isSelected(s)}]]),onMousedown:r=>e.selectCom(s.id),onMouseenter:r=>e.onEnter(s.id),onMouseleave:t[7]||(t[7]=(...r)=>e.onLeave&&e.onLeave(...r)),onDblclick:r=>e.schemaStore.renamingCom(s.id),onContextmenu:t[8]||(t[8]=r=>e.showMenu(r))},[u(c,{name:s.icon,size:"18"},null,8,["name"]),s.id===e.renamingComId?de((_(),w("input",{key:0,"onUpdate:modelValue":r=>s.alias=r,class:"layer-item-input",onBlur:t[5]||(t[5]=r=>e.schemaStore.renamingCom("")),onKeydown:t[6]||(t[6]=He(r=>e.schemaStore.renamingCom(""),["enter"]))},null,40,io)),[[ke,s.alias,void 0,{trim:!0}],[i]]):(_(),w("span",co,[n("span",ro,Z(s.alias),1)])),n("i",{class:T(["b-iconfont",`b-icon-${s.hided?"eye-close":"eye"}`,"show-toggle-btn"]),title:s.hided?"\u663E\u793A":"\u9690\u85CF",onClick:r=>s.hided=!s.hided},null,10,uo),n("i",{class:T(["b-iconfont",`b-icon-${s.locked?"lock":"unlock"}`,"show-toggle-btn"]),title:s.locked?"\u89E3\u9501":"\u9501\u5B9A",onClick:r=>s.locked=!s.locked},null,10,mo)],42,so))),128)),n("div",{class:"last-flex-item",onClick:t[9]||(t[9]=(...s)=>e.cancelSelectCom&&e.cancelSelectCom(...s))})])])],2)}var fo=j(Zt,[["render",vo]]);const po={name:"VBasicBar",alias:"\u57FA\u672C\u67F1\u56FE",img:I("basic-bar.jpg"),type:"bar",used:!0},ho={name:"VHorizontalBar",alias:"\u57FA\u672C\u6761\u5F62\u56FE",img:I("hori-basic-bar.jpg"),type:"bar",used:!0},_o={name:"VCapsuleBar",alias:"\u80F6\u56CA\u67F1\u56FE",img:I("capsule-bar.png"),type:"bar",used:!0},go={name:"VBasicLine",alias:"\u57FA\u672C\u6298\u7EBF\u56FE",img:I("basic-line.jpg"),type:"line",used:!0},bo={name:"VBasicArea",alias:"\u57FA\u672C\u533A\u57DF\u56FE",img:I("basic-area.jpg"),type:"line",used:!0},yo={name:"VBasicPie",alias:"\u57FA\u672C\u997C\u56FE",img:I("basic-pie.jpg"),type:"pie",used:!0},xo={name:"VBasicRing",alias:"\u57FA\u672C\u73AF\u56FE",img:I("basic-ring.jpg"),type:"pie",used:!0},Co={name:"VBasicRadar",alias:"\u57FA\u672C\u96F7\u8FBE\u56FE",img:I("basic-radar.jpg"),type:"radar",used:!0},wo={name:"VBasicMap",alias:"\u57FA\u672C\u5730\u56FE",img:I("2d-china.png"),type:"map",used:!0},So={name:"VBasicMapEvo",alias:"\u7701\u4EFD\u5730\u56FE",img:I("basic-map-evo.png"),type:"map",used:!0},ko={name:"VBasicScatter",alias:"\u57FA\u672C\u6563\u70B9\u56FE",img:I("basic-scatter.png"),type:"scatter",used:!0},Vo={name:"VLineBasicScatter",alias:"\u6563\u70B9\u7EBF\u56FE",img:I("line-basic-scatter.png"),type:"scatter",used:!0},$o={name:"VBasicBoxplot",alias:"\u76D2\u987B\u56FE",img:I("basic-boxplot.png"),type:"boxplot",used:!0},Mo={name:"VBasicFunnel",alias:"\u57FA\u672C\u68AF\u5EA6\u56FE",img:I("basic-funnel.jpg"),type:"funnel",used:!0},Do={name:"VBasicWordCloud",alias:"\u57FA\u672C\u8BCD\u4E91\u56FE",img:I("basic-wordcloud.jpg"),type:"wordcloud",used:!0},To={name:"VBasicGauge",alias:"\u57FA\u672C\u4EEA\u8868\u76D8",img:I("basic-gauge.png"),type:"gauge",used:!0},Bo={name:"VProgressCircle",alias:"\u8FDB\u5EA6\u73AF",img:I("pie-one-value.png"),type:"circle",used:!0},Ro={name:"VMainTitle",alias:"\u901A\u7528\u6807\u9898",img:I("main-title.png"),type:"info",used:!0},Lo={name:"VNumberTitleFlop",alias:"\u6570\u5B57\u6307\u6807",img:I("number-title-flop.png"),type:"info",used:!0},Io={name:"VTimer",alias:"\u65F6\u95F4\u5668",img:I("timer.png"),type:"info",used:!0},No={name:"VSelect",alias:"\u4E0B\u62C9\u63A7\u4EF6",img:I("select.png"),type:"control",used:!0},zo={name:"VBgBox",alias:"\u80CC\u666F\u5757",img:I("bg-box.png"),type:"media",used:!0},Uo={name:"VBorderBox",alias:"\u8FB9\u6846",img:I("border-box.png"),type:"media",used:!0},Ao={name:"VDecoration",alias:"\u88C5\u9970\u5668",img:I("decoration.png"),type:"media",used:!0},Eo={name:"VMainImg",alias:"\u5355\u5F20\u56FE\u7247",img:I("img.png"),type:"media",used:!0},Oo={name:"VScrollTable",alias:"\u57FA\u7840\u8868\u683C",img:I("scroll-table.jpg"),type:"table",used:!0},ye=[{type:"bar",name:"\u67F1\u56FE",icon:"barchart",data:[po,ho,_o]},{type:"line",name:"\u7EBF\u56FE",icon:"linechart",data:[go,bo]},{type:"pie",name:"\u997C\u56FE",icon:"piechart",data:[yo,xo]},{type:"radar",name:"\u96F7\u8FBE\u56FE",icon:"radarchart",data:[Co]},{type:"scatter",name:"\u6563\u70B9\u56FE",icon:"pointmap",data:[ko,Vo]},{type:"map",name:"\u5730\u56FE",icon:"location",data:[wo,So]},{type:"other",name:"\u5176\u4ED6\u56FE\u8868",icon:"ungroup",data:[$o,Mo,Do,To,Bo]},{type:"table",name:"\u8868\u683C",icon:"table",data:[Oo]},{type:"info",name:"\u4FE1\u606F",icon:"info-circle",data:[Ro,Lo,Io,No]},{type:"media",name:"\u5A92\u4F53",icon:"Youtube",data:[zo,Uo,Ao,Eo]}];function jo(o){for(let t=0;t<ye.length;t++){const l=ye[t];for(let e=0;e<l.data.length;e++){const d=l.data[e];if(d.name===o)return{classification:l,com:d}}}return null}const Ho={name:"components-panel",setup(){const{schemaStore:o,storeToRefs:t}=N(),{pageConfig:l,toolbar:e,selectedCom:d}=t(o),a=D(0),c=V(()=>ye[a.value].data);return{toolbar:e,activeIndex:a,componentsList:ye,comps:c,changeComp:m=>{o.toggleCompsPanel(!0),a.value=m},dragStart:(m,v)=>{m.dataTransfer.setData("text",v)},toAddCom:async(m,v)=>{if(v){const p=Pe(m);if(p.attr.x=Math.floor((l.value.width-p.attr.w)/2),p.attr.y=Math.floor((l.value.height-p.attr.h)/2),o.addCom({component:p}),o.selectCom(p),p.apiData&&p.apiData.type===$e.static&&p.apiData.staticPath){const{data:g}=await Je(p.id,p.apiData.staticPath);d.value.apiData.config.data=JSON.stringify(g)}}else console.log("\u6B63\u5728\u5F00\u53D1\u4E2D\u3002\u3002\u3002")},dragOver:m=>{m.preventDefault(),m.stopPropagation(),m.dataTransfer.dropEffect="none"},closePanel:()=>{e.value.components&&o.toggleCompsPanel(!1)}}}},Yo={class:"components-panel-wp"},Xo={class:"components-panel"},Wo=n("div",{class:"panel-title"},[n("span",{class:"panel-text"},"\u7EC4\u4EF6")],-1),Ko={class:"components-type"},Po=["onClick"],Fo={class:"com-tab-title"},Jo={class:"p10"},qo=["title","draggable","onDragstart","onClick"],Go={class:"comp-item-text"};function Zo(o,t,l,e,d,a){const c=x("b-icon"),i=x("b-scrollbar"),s=Ye("click-outside");return _(),w("div",Yo,[n("div",Xo,[Wo,n("div",{class:"components-panel-content",onDragover:t[0]||(t[0]=(...r)=>e.dragOver&&e.dragOver(...r))},[n("div",Ko,[u(i,{native:""},{default:y(()=>[(_(!0),w(Y,null,ee(e.componentsList,(r,f)=>(_(),w("div",{class:T(["components-item",{active:e.activeIndex===f}]),key:f,onClick:b=>e.changeComp(f)},[u(c,{class:"com-tab-icon",name:r.icon},null,8,["name"]),n("span",Fo,Z(r.name),1)],10,Po))),128))]),_:1})]),de((_(),w("div",{class:T(["components-list",{"is-hide":!e.toolbar.components}])},[u(i,{native:""},{default:y(()=>[n("div",Jo,[(_(!0),w(Y,null,ee(e.comps,(r,f)=>(_(),w("div",{class:"comp-item",key:f,title:r.alias,draggable:r.used,onDragstart:b=>e.dragStart(b,r.name),onClick:b=>e.toAddCom(r.name,r.used)},[n("div",Go,Z(r.alias),1),n("div",{class:"comp-item-img",style:A(`background-image: url(${r.img});`)},null,4)],40,qo))),128))])]),_:1})],2)),[[s,e.closePanel]])],32)])])}var Qo=j(Ho,[["render",Zo]]);const ze=o=>`${o}px`,Ue=(o,t,l,e)=>{const d=o!=null?o:document.createElement("canvas");d.width=t*e,d.height=l*e,d.style.width=ze(t),d.style.height=ze(l);const a=d.getContext("2d");return a&&a.setTransform(e,0,0,e,0,0),d};class Ae{constructor(t,l){this.el=t,this.options={direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2,...l},this.canvas=null,this.ctx=null,this.ruler={width:0,height:0},this.constructRuler()}constructRuler(){const{el:t,options:l}=this,{direction:e,width:d,height:a,ratio:c}=l,i=Math.max(e==="TB"?t.offsetWidth:t.offsetHeight,d),s=a;this.ruler.width=i,this.ruler.height=s;const r=Ue(null,i,s,c);mt(r,"canvas-ruler"),t.appendChild(r),this.canvas=r,this.ctx=r.getContext("2d"),this.drawRuler()}drawRuler(){const{ctx:t,options:l,ruler:e}=this,{width:d,height:a}=e;t.beginPath(),t.fillStyle=l.bgColor,t.fillRect(0,0,d,a),t.closePath(),t.beginPath(),t.font=`${l.fontSize} ${l.fontFamily}`,t.textAlign="left",t.fillStyle=l.fontColor,t.strokeStyle=l.strokeStyle,t.lineWidth=l.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:l,ruler:e}=this,{width:d,height:a}=e,{offset:c,scale:i}=l,s=0,r=a/1.5,f=a/1.2;for(let b=0;b<=d;b+=1){const m=b-c;if(m<0)continue;let v=-1,p=-1;m%50===0?(v=Math.floor(m/i),p=s):m%25===0?p=r:m%5===0&&(p=f),p>=0&&(t.moveTo(b+.5,a+.5),t.lineTo(b+.5,p),v>-1&&t.fillText(`${v}`,b+2.5,a/1.5))}}setSize(t,l,e){const{el:d,options:a}=this;a.width=t,a.height=l,a.scale=e;const{direction:c,width:i,height:s,ratio:r}=a,f=Math.max(c==="TB"?d.offsetWidth:d.offsetHeight,i),b=s;this.ruler.width=f,this.ruler.height=b,Ue(this.canvas,f,b,r),this.drawRuler()}destroy(){const{el:t}=this;t.remove()}}const en={name:"ruler",setup(){const{schemaStore:o,storeToRefs:t}=N(),{canvas:l}=t(o),e=D(null),d=D(null),a=D(null),c=D(null),i=D(!0),s=D(0),r=D(0),f=document.documentElement.clientWidth;nt(()=>{if(e.value&&d.value){const m=Math.max(l.value.width,f);a.value?a.value.setSize(m,18,l.value.scale):a.value=new Ae(e.value,{direction:"TB",width:m,scale:l.value.scale}),c.value?c.value.setSize(l.value.height,18,l.value.scale):c.value=new Ae(d.value,{direction:"LR",width:l.value.height,scale:l.value.scale})}});const b=m=>{const v=m.target;s.value=v.scrollLeft,r.value=v.scrollTop};return fe(()=>{const m=document.getElementById("canvas-wp");m==null||m.addEventListener("scroll",b)}),at(()=>{const m=document.getElementById("canvas-wp");m==null||m.removeEventListener("scroll",b)}),{visible:i,hRulerWpRef:e,vRulerWpRef:d,vScroll:r,hScroll:s}}},tn=o=>(pe("data-v-5f454e16"),o=o(),he(),o),on={class:"canvas-ruler-wp"},nn=tn(()=>n("div",{class:"ruler-corner"},null,-1));function an(o,t,l,e,d,a){return _(),w("div",on,[n("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:A(`transform: translateX(-${e.hScroll}px);`)},null,4),n("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:A(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),nn])}var ln=j(en,[["render",an],["__scopeId","data-v-5f454e16"]]);function Ee(o){if(o={...o},o.rotate!==0){const t=o.width*Ie(o.rotate)+o.height*Ne(o.rotate),l=(o.width-t)/2;o.left+=l,o.right=o.left+t;const e=o.height*Ie(o.rotate)+o.width*Ne(o.rotate),d=(e-o.height)/2;o.top-=d,o.bottom=o.top+e,o.width=t,o.height=e}else o.bottom=o.top+o.height,o.right=o.left+o.width;return o}const sn=5,cn={name:"mark-line",setup(){const{schemaStore:o,storeToRefs:t}=N(),{comps:l,selectedCom:e,canvas:d,toolbox:a}=t(o),c=D([]),i=D(["xt","xc","xb","yl","yc","yr"]),s=D({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),r=()=>{Object.keys(s.value).forEach(h=>{s.value[h]=!1})};function f({key:h,value:M}){const S={left:"x",top:"y"};o.setShapeSingleStyle({key:S[h],value:M})}const b=(h,M)=>{const S=c.value,W=e.value,ae=l.value.filter(B=>!B.hided),ce=d.value.scale,E=Ee(p(W.attr)),K=E.width/2,G=E.height/2;r(),ae.forEach(B=>{if(B.id===W.id||B.locked||B.hided)return;const{top:k,left:z,bottom:$,right:H,width:P,height:te}=Ee(p(B.attr)),R=P/2,X=te/2,_e={top:[{isNearly:g(E.top,k),lineNode:S.xt,line:"xt",dragShift:k,lineShift:k},{isNearly:g(E.bottom,k),lineNode:S.xt,line:"xt",dragShift:k-E.height,lineShift:k},{isNearly:g(E.top+G,k+X),lineNode:S.xc,line:"xc",dragShift:k+X-G,lineShift:k+X},{isNearly:g(E.top,$),lineNode:S.xb,line:"xb",dragShift:$,lineShift:$},{isNearly:g(E.bottom,$),lineNode:S.xb,line:"xb",dragShift:$-E.height,lineShift:$}],left:[{isNearly:g(E.left,z),lineNode:S.yl,line:"yl",dragShift:z,lineShift:z},{isNearly:g(E.right,z),lineNode:S.yl,line:"yl",dragShift:z-E.width,lineShift:z},{isNearly:g(E.left+K,z+R),lineNode:S.yc,line:"yc",dragShift:z+R-K,lineShift:z+R},{isNearly:g(E.left,H),lineNode:S.yr,line:"yr",dragShift:H,lineShift:H},{isNearly:g(E.right,H),lineNode:S.yr,line:"yr",dragShift:H-E.width,lineShift:H}]},ue=[],{rotate:we}=E;Object.keys(_e).forEach(se=>{_e[se].forEach(oe=>{if(!oe.isNearly)return;const ge=we!==0?m(se,oe,E):oe.dragShift;f({key:se,value:ge}),oe.lineNode.style[se]=`${oe.lineShift*ce+60}px`,ue.push(oe.line)})}),ue.length&&v(ue,h,M)})},m=(h,M,S)=>{const{w:W,h:ae}=e.value.attr;return Math.round(h==="top"?M.dragShift-(ae-S.height)/2:M.dragShift-(W-S.width)/2)},v=(h,M,S)=>{S?h.includes("yr")?s.value.yr=!0:h.includes("yc")?s.value.yc=!0:h.includes("yl")&&(s.value.yl=!0):h.includes("yl")?s.value.yl=!0:h.includes("yc")?s.value.yc=!0:h.includes("yr")&&(s.value.yr=!0),M?h.includes("xb")?s.value.xb=!0:h.includes("xc")?s.value.xc=!0:h.includes("xt")&&(s.value.xt=!0):h.includes("xt")?s.value.xt=!0:h.includes("xc")?s.value.xc=!0:h.includes("xb")&&(s.value.xb=!0)},p=h=>({left:h.x,top:h.y,width:h.w,height:h.h,rotate:h.rotate}),g=(h,M)=>Math.abs(h-M)<=sn;return fe(()=>{ie.on("move",({isDownward:h,isRightward:M})=>{a.value.markLine&&b(h,M)}),ie.on("unmove",()=>{r()})}),Ce(()=>{ie.off("move"),ie.off("unmove")}),{lineRefs:c,lines:i,lineStatus:s}}},rn={class:"mark-line"};function dn(o,t,l,e,d,a){return _(),w("div",rn,[(_(!0),w(Y,null,ee(e.lines,c=>de((_(),w("div",{key:c,class:T(["line",[c.includes("x")?"xline":"yline",c]]),ref_for:!0,ref:i=>{e.lineRefs[c]=i}},null,2)),[[Xe,e.lineStatus[c]||!1]])),128))])}var un=j(cn,[["render",dn],["__scopeId","data-v-00d4450a"]]);const{schemaStore:qe}=N(),mn=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],Oe=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],vn=o=>{const t=(o+360)%360,l={};let e=-1;return mn.forEach(d=>{const a=(d.angle+t)%360,c=Oe.length,i=0;for(;i<c;){e=(e+1)%c;const s=Oe[e];if(a<23||a>=338){l[d.direction]="nwse-resize";break}if(s.start<=a&&a<s.end){l[d.direction]=s.cursor;break}}}),l};function fn(o,t,l,e,d,a){o==="t"?(a.h=Math.round(t.h+(l.y-e.y)/d),a.y=Math.round(t.y+(e.y-l.y)/d),a.h=Math.max(a.h,20)):o==="rt"?(a.h=Math.round(t.h+(l.y-e.y)/d),a.w=Math.round(t.w+(e.x-l.x)/d),a.y=Math.round(t.y+(e.y-l.y)/d),a.w=Math.max(a.w,20),a.h=Math.max(a.h,20)):o==="r"?(a.w=Math.round(t.w+(e.x-l.x)/d),a.w=Math.max(a.w,20)):o==="rb"?(a.h=Math.round(t.h+(e.y-l.y)/d),a.w=Math.round(t.w+(e.x-l.x)/d),a.w=Math.max(a.w,20),a.h=Math.max(a.h,20)):o==="b"?(a.h=Math.round(t.h+(e.y-l.y)/d),a.h=Math.max(a.h,20)):o==="lb"?(a.h=Math.round(t.h+(e.y-l.y)/d),a.w=Math.round(t.w+(l.x-e.x)/d),a.x=Math.round(t.x+(e.x-l.x)/d),a.w=Math.max(a.w,20),a.h=Math.max(a.h,20)):o==="l"?(a.w=Math.round(t.w+(l.x-e.x)/d),a.x=Math.round(t.x+(e.x-l.x)/d),a.w=Math.max(a.w,20)):o==="lt"&&(a.h=Math.round(t.h+(l.y-e.y)/d),a.w=Math.round(t.w+(l.x-e.x)/d),a.x=Math.round(t.x+(e.x-l.x)/d),a.y=Math.round(t.y+(e.y-l.y)/d),a.w=Math.max(a.w,20),a.h=Math.max(a.h,20))}const Ge=(o,t,l,e,d)=>{const a={...l.attr},c=Object.create(null),i=o.clientX,s=o.clientY;let r=!1;const f=m=>{r=!0;const v=m.clientX,p=m.clientY;t?fn(t,a,{x:i,y:s},{x:v,y:p},e,c):(c.x=a.x+Math.round((v-i)/e/d)*d,c.y=a.y+Math.round((p-s)/e/d)*d),l.attr={...l.attr,...c},ve().then(()=>{ie.emit("move",{isDownward:p-s>0,isRightward:v-i>0})})},b=()=>{ie.emit("unmove"),r&&qe.recordSnapshot(),J(document,"mousemove",f),J(document,"mouseup",b)};F(document,"mousemove",f),F(document,"mouseup",b)},pn=(o,t,l,e)=>{Ge(o,null,t,l,e)},hn=(o,t,l,e)=>{Ge(o,t,l,e)},_n=(o,t,l)=>{const e=t.getBoundingClientRect(),d=e.left+e.width/2,a=e.top+e.height/2,c=Math.atan2(a-o.clientY,d-o.clientX)*180/Math.PI-l.attr.rotate;let i=!1;const s=f=>{i=!0;const b=Math.atan2(a-f.clientY,d-f.clientX)*180/Math.PI-c,m=Math.round(b%360);l.attr.rotate=m<0?m+360:m},r=()=>{i&&qe.recordSnapshot(),J(document,"mousemove",s),J(document,"mouseup",r)};F(document,"mousemove",s),F(document,"mouseup",r)},gn={name:"refer-line",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(o){const t=V(()=>({height:`${o.attr.y+60/o.scale}px`,borderLeftWidth:`${.9/o.scale}px`})),l=V(()=>({width:`${o.attr.x+60/o.scale}px`,borderTopWidth:`${.9/o.scale}px`})),e=V(()=>({fontSize:`${12/o.scale}px`,top:`-${6/o.scale}px`,left:`-${6/o.scale}px`}));return{topLineStyle:t,leftLineStyle:l,accountStyle:e}}},bn={class:"nav-line"};function yn(o,t,l,e,d,a){return _(),w("div",bn,[n("div",{class:"nav-line-top",style:A(e.topLineStyle)},null,4),n("div",{class:"nav-line-left",style:A(e.leftLineStyle)},null,4),n("div",{class:"nav-line-account",style:A(e.accountStyle)},Z(l.attr.x)+", "+Z(l.attr.y),5)])}var xn=j(gn,[["render",yn]]);const Cn={name:"dv-transform",components:{ReferLine:xn},props:{data:{type:Object,required:!0}},setup(o){const t=lt(),{showMenu:l}=Be(),{schemaStore:e,storeToRefs:d}=N(),{canvas:a,comps:c,pageConfig:i,selectedCom:s,hoveredComId:r,toolbox:f,spaceDown:b,multiSelect:m,multipleComs:v}=d(e),p=V(()=>r.value===o.data.id),g=V(()=>m.value?!1:!Ve(s.value)&&s.value.id===o.data.id),h=V(()=>m.value?v.value.map(R=>R.id).includes(o.data.id):!1),M=V(()=>({locked:o.data.locked,selected:g.value})),S=V(()=>({top:0,left:0,width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`,transform:`translate(${o.data.attr.x}px, ${o.data.attr.y}px)`})),W=V(()=>({"is-hide":!g.value||o.data.locked})),ae=V(()=>({cursor:"move",transform:`rotate(${o.data.attr.rotate}deg)`})),ce=V(()=>({width:`${o.data.attr.w}px`,height:`${o.data.attr.h}px`})),E=V(()=>({display:o.data.hided?"none":"block"})),K=V(()=>vn(o.data.attr.rotate)),G=V(()=>a.value.scale),B=V(()=>{const R=`scale(${1/G.value}, ${1/G.value})`;return{t:{name:"top",style:{cursor:K.value.t,transform:R}},rt:{name:"top-right",style:{cursor:K.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:R}},r:{name:"right",style:{cursor:K.value.r,transform:R}},rb:{name:"bottom-right",style:{cursor:K.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:R}},b:{name:"bottom",style:{cursor:K.value.b,transform:R}},lb:{name:"bottom-left",style:{cursor:K.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:R}},l:{name:"left",style:{cursor:K.value.l,transform:R}},lt:{name:"top-left",style:{cursor:K.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:R}}}}),k=()=>e.hoverCom(o.data.id),z=()=>e.hoverCom(""),$=()=>{e.selectCom(o.data)};return{comps:c,selectedCom:s,hoveredComId:r,toolbox:f,isHovered:p,isSelected:g,isMultiSelted:h,hideStyle:E,transformClass:M,transformStyle:S,handlerClass:W,handlerStyle:ae,wrapperStyle:ce,onEnter:k,onLeave:z,onMove:R=>{b.value||(R.stopPropagation(),R.preventDefault(),$(),!o.data.locked&&pn(R,o.data,G.value,i.value.grid))},onZoom:(R,X)=>{$(),hn(R,X,o.data,G.value)},onRotate:R=>{_n(R,t.vnode.el,o.data)},points:B,scale:G,showMenu:l}}},wn={class:"dv-com"},Sn=["onMousedown"],kn=["onMousedown"],Vn=n("div",{class:"transform-bg"},null,-1),$n={key:1,class:"b-iconfont b-icon-lock",title:"\u89E3\u9501"};function Mn(o,t,l,e,d,a){const c=x("refer-line");return _(),w("div",{class:T(["dv-transform",e.transformClass]),style:A(e.transformStyle)},[e.toolbox.referLine&&e.isSelected?(_(),U(c,{key:0,attr:l.data.attr,scale:e.scale},null,8,["attr","scale"])):q("",!0),n("div",{class:T(["dv-scale",{hovered:e.isHovered}]),style:A(e.hideStyle),onMouseenter:t[2]||(t[2]=(...i)=>e.onEnter&&e.onEnter(...i)),onMouseleave:t[3]||(t[3]=(...i)=>e.onLeave&&e.onLeave(...i)),onMousedown:t[4]||(t[4]=(...i)=>e.onMove&&e.onMove(...i))},[n("div",{class:T(["transform-handler",e.handlerClass]),style:A(e.handlerStyle)},[n("div",wn,[We(o.$slots,"default"),n("div",{class:"dv-event-disable",style:A(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...i)=>e.showMenu&&e.showMenu(...i))},null,36)]),(_(!0),w(Y,null,ee(e.points,(i,s)=>(_(),w(Y,{key:s},[i.rotateStyle?(_(),w("i",{key:0,class:T(`${i.name}-handler`),"data-html2canvas-ignore":""},[n("span",{class:"rotate-handler",style:A(i.rotateStyle),onMousedown:t[1]||(t[1]=ne((...r)=>e.onRotate&&e.onRotate(...r),["prevent","stop"]))},[n("span",{class:"control-point",style:A(i.style),onMousedown:ne(r=>e.onZoom(r,s),["prevent","stop"])},null,44,Sn)],36)],2)):(_(),w("i",{key:1,class:T(`${i.name}-handler`),"data-html2canvas-ignore":""},[n("span",{class:"control-point",style:A(i.style),onMousedown:ne(r=>e.onZoom(r,s),["prevent","stop"])},null,44,kn)],2))],64))),128)),Vn],6)],38),l.data.locked?(_(),w("i",$n)):q("",!0)],6)}var Dn=j(Cn,[["render",Mn]]);const Tn=["onClick"],Bn=["onClick"],Rn={__name:"index",setup(o){const{schemaStore:t}=N(),l=V(()=>t.toolbar.config?{right:"332px"}:{right:0}),e=()=>t.undo(),d=()=>t.redo();return(a,c)=>(_(),w("div",{class:"action-bar-wrap",style:A(C(l))},[n("i",{class:"action-btn b-iconfont b-icon-aim",title:"\u6700\u4F73\u753B\u5E03\u6BD4\u4F8B",onClick:c[0]||(c[0]=ne(i=>C(t).autoCanvasScale(),["stop"]))}),n("i",{class:"action-btn b-iconfont b-icon-icon-test",title:"1:1\u753B\u5E03\u5927\u5C0F",onClick:c[1]||(c[1]=ne(i=>C(t).setCanvasScale(100),["stop"]))}),n("i",{class:"action-btn b-iconfont b-icon-rollback",title:"\u64A4\u9500",onClick:ne(e,["stop"])},null,8,Tn),n("i",{class:"action-btn b-iconfont b-icon-rollback",title:"\u91CD\u505A",onClick:ne(d,["stop"]),style:{transform:"rotateY(180deg)"}},null,8,Bn)],4))}};var Ln=j(Rn,[["__scopeId","data-v-1c712a36"]]);const In={__name:"index",props:{x:Number,y:Number,width:Number,height:Number,showArea:Boolean},setup(o){return(t,l)=>de((_(),w("div",{style:A({left:o.x+"px",top:o.y+"px",width:o.width+"px",height:o.height+"px"}),class:"area"},null,4)),[[Xe,o.showArea]])}};var Nn=j(In,[["__scopeId","data-v-0a9d9fbb"]]);const zn={class:"canvas-main"},Un=["onMousedown"],An={__name:"index",setup(o){const{schemaStore:t,storeToRefs:l}=N(),{pageConfig:e,spaceDown:d,canvas:a,selectedCom:c,comps:i,toolbox:s,getPanelOffsetLeft:r,getPanelOffsetTop:f,editorEL:b,areaData:m}=l(t),v=D(null),p=Se({drag:!1,startX:0,startY:0});let g=0,h=0;const M=V(()=>({width:`${a.value.width}px`,height:`${a.value.height}px`})),S=V(()=>({position:"absolute",width:`${e.value.width}px`,height:`${e.value.height}px`,transform:`scale(${a.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${e.value.bgImage})`,backgroundColor:e.value.bgColor})),W=vt(t.autoCanvasScale,50),ae=async k=>{k.preventDefault();try{const z=k.dataTransfer.getData("text");if(z){const $=Pe(z),{scale:H}=a.value,P=(k.clientX-r.value+v.value.scrollLeft)/H,te=(k.clientY-f.value+v.value.scrollTop)/H;if($.attr.x=Math.round(P-$.attr.w/2),$.attr.y=Math.round(te-$.attr.h/2),t.addCom({component:$}),t.selectCom($),$.apiData&&$.apiData.type===$e.static&&$.apiData.staticPath){const{data:R}=await Je($.id,$.apiData.staticPath);c.value.apiData.config.data=JSON.stringify(R)}}}catch(z){console.warn(z)}},ce=k=>{k.preventDefault(),k.stopPropagation(),k.dataTransfer.dropEffect="copy"};function E(k){d.value||t.selectCom(),p.drag=!0;const z=k.clientX,$=k.clientY,H=a.value.scale,{scrollLeft:P,scrollTop:te,clientWidth:R,scrollWidth:X,clientHeight:_e,scrollHeight:ue}=v.value,we=R<X||_e<ue,se={left:P,top:te},oe=Le=>{if(!d.value||!p.drag||!we)return;const Qe=Le.clientX,et=Le.clientY,tt=Math.round((Qe-z)/H),ot=Math.round((et-$)/H);v.value.scrollLeft=se.left-tt,v.value.scrollTop=se.top-ot},ge=()=>{p.drag=!1,J(document,"mousemove",oe),J(document,"mouseup",ge)};F(document,"mousemove",oe),F(document,"mouseup",ge)}function K(k){if(c.value||k.preventDefault(),B(),d.value)return;const z=b.value.getBoundingClientRect();g=z.x,h=z.y;const $=k.clientX,H=k.clientY;m.value.showArea=!0;const P=a.value.scale;m.value.x=($-g)/P,m.value.y=(H-h)/P;const te=X=>{m.value.width=Math.abs((X.clientX-$)/P),m.value.height=Math.abs((X.clientY-H)/P),X.clientX<$&&(m.value.x=(X.clientX-g)/P),X.clientY<H&&(m.value.y=(X.clientY-h)/P)},R=X=>{if(J(document,"mousemove",te),J(document,"mouseup",R),X.clientX===$&&X.clientY===H){B();return}G()};F(document,"mousemove",te),F(document,"mouseup",R)}function G(){const k=ft(m.value,i.value);if(k.length===0){B();return}if(k.length===1){t.selectCom(k[0]),B();return}t.multiSelectComs(k)}function B(){m.value.showArea=!1,m.value.width=0,m.value.height=0}return fe(()=>{F(window,"resize",W),ie.on("hideArea",B),t.getEditor(),W()}),Ce(()=>{J(window,"resize",W)}),(k,z)=>(_(),w("div",zn,[n("div",{id:"canvas-wp",ref_key:"canvasWpRef",ref:v,class:"canvas-panel-wrap",onMousedown:ne(E,["stop"])},[n("div",{class:"screen-shot",style:A(C(M))},[C(s).markLine?(_(),U(un,{key:0,style:A(C(M))},null,8,["style"])):q("",!0),u(Ln),u(ln),n("div",{id:"canvas-components",class:"canvas-panel",style:A(C(S)),onDragover:ce,onDrop:ae,onMousedown:K},[(_(!0),w(Y,null,ee(C(i),$=>(_(),U(Dn,{key:$.id,data:$},{default:y(()=>[(_(),U(Ke($.name),{data:$,style:A({width:$.attr.w+"px",height:$.attr.h+"px",opacity:$.attr.opacity,transform:"translateZ(0px)"}),id:`component_${$.id}`},null,8,["data","style","id"]))]),_:2},1032,["data"]))),128)),u(Nn,st(it(C(m))),null,16)],36)],4)],40,Un)]))}};const En={name:"page-config",setup(){const{schemaStore:o,storeToRefs:t}=N(),{pageConfig:l}=t(o),e=D(""),d=()=>{l.value.bgColor="#0d2a42",l.value.bgImage=""},a=()=>o.autoCanvasScale(),c=i=>{if(i!=="custom"){const s=i.split("x"),r=+s[0],f=+s[1];o.setScreenSize({width:r,height:f})}};return re([()=>l.value.width,()=>l.value.height],()=>{const{width:i,height:s}=l.value;i===1920&&s===1080||i===2560&&s===1080||i===3440&&s===1080||i===3440&&s===1440||i===414&&s===736||i===375&&s===667||i===375&&s===812?e.value=`${i}x${s}`:e.value="custom"},{immediate:!0}),{screenLabel:e,onSizeChange:a,resetBGImage:d,pageConfig:l,pageMap:[{group:"web\u7AEF",data:pt.map(i=>({value:`${i.width}x${i.height}`,label:i.label}))},{group:"\u79FB\u52A8\u8BBE\u5907",data:ht.map(i=>({value:`${i.width}x${i.height}`,label:i.label}))},{group:"\u5176\u4ED6",data:[{value:"custom",label:"\u81EA\u5B9A\u4E49"}]}],sizeChange:c}}},On=o=>(pe("data-v-75712752"),o=o(),he(),o),jn={class:"page-config-panel"},Hn=On(()=>n("div",{class:"page-config-top"},"\u9875\u9762\u8BBE\u7F6E",-1)),Yn={class:"page-config-content"},Xn={class:"page-config-wp"},Wn=L("\u6062\u590D\u9ED8\u8BA4\u80CC\u666F"),Kn={class:"page-config-wp"};function Pn(o,t,l,e,d,a){const c=x("g-group-select"),i=x("g-field"),s=x("g-input-number"),r=x("g-color-picker"),f=x("g-upload-img"),b=x("g-images-select"),m=x("b-button");return _(),w("div",jn,[Hn,n("div",Yn,[n("div",Xn,[u(i,{label:"\u5C4F\u5E55\u8BBE\u7F6E",flat:""},{default:y(()=>[u(c,{modelValue:e.screenLabel,"onUpdate:modelValue":t[0]||(t[0]=v=>e.screenLabel=v),data:e.pageMap,onChange:e.sizeChange},null,8,["modelValue","data","onChange"])]),_:1}),u(i,{label:"\u5C4F\u5E55\u5927\u5C0F",flat:""},{default:y(()=>[u(s,{modelValue:e.pageConfig.width,"onUpdate:modelValue":t[1]||(t[1]=v=>e.pageConfig.width=v),label:"\u5BBD\u5EA6",min:375,max:3840,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"]),u(s,{modelValue:e.pageConfig.height,"onUpdate:modelValue":t[2]||(t[2]=v=>e.pageConfig.height=v),label:"\u9AD8\u5EA6",min:600,max:2160,inline:"",suffix:"px",onChange:e.onSizeChange},null,8,["modelValue","onChange"])]),_:1}),u(i,{label:"\u80CC\u666F\u989C\u8272"},{default:y(()=>[u(r,{modelValue:e.pageConfig.bgColor,"onUpdate:modelValue":t[3]||(t[3]=v=>e.pageConfig.bgColor=v)},null,8,["modelValue"])]),_:1}),u(i,{label:"\u80CC\u666F\u56FE",tooltip:"\u652F\u6301\u56FE\u7247\u5730\u5740\u3001\u9759\u6001\u8DEF\u5F84\u3001base64\u5B58\u50A8"},{default:y(()=>[u(f,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[4]||(t[4]=v=>e.pageConfig.bgImage=v)},null,8,["modelValue"])]),_:1}),u(i,{label:"\u80CC\u666F\u9884\u8BBE",tooltip:"\u53EF\u4EE5\u52A0\u8F7D\u5BF9\u5E94\u9884\u8BBE\u7684\u56FE\u7247\u80CC\u666F"},{default:y(()=>[u(b,{modelValue:e.pageConfig.bgImage,"onUpdate:modelValue":t[5]||(t[5]=v=>e.pageConfig.bgImage=v),images:["bg"],"value-key":"src"},null,8,["modelValue"])]),_:1}),u(i,{label:"\u91CD\u7F6E"},{default:y(()=>[u(m,{type:"primary",size:"small",onClick:e.resetBGImage},{default:y(()=>[Wn]),_:1},8,["onClick"])]),_:1})]),n("div",Kn,[u(i,{label:"\u6805\u683C\u95F4\u8DDD",tooltip:"\u6BCF\u6B21\u79FB\u52A8\u7684\u8DDD\u79BB\uFF0C\u5355\u4F4Dpx"},{default:y(()=>[u(s,{modelValue:e.pageConfig.grid,"onUpdate:modelValue":t[6]||(t[6]=v=>e.pageConfig.grid=v),min:1,max:20,suffix:"px"},null,8,["modelValue"])]),_:1})])])])}var Fn=j(En,[["render",Pn],["__scopeId","data-v-75712752"]]);const Jn={name:"config-title",props:{comName:{type:String},comAlias:{type:String},com:{type:Object,default:()=>({})}},setup(o){const t=D(!1),l=V(()=>{const a=jo(o.comName);return a?a.com.name:o.comName});return{openDetail:()=>{t.value=!0},comTitle:l,copyCom:()=>{De(JSON.stringify(o.com)),Q.success("\u5DF2\u590D\u5236\u914D\u7F6E\u9879\u81F3\u526A\u5207\u677F")},detailVisible:t}}},qn=o=>(pe("data-v-3284dfac"),o=o(),he(),o),Gn={class:"com-title-wp"},Zn={class:"com-title"},Qn={class:"title-name"},ea={class:"alias-name"},ta={class:"version-tag"},oa=qn(()=>n("span",null,"\u914D\u7F6E\u9879",-1)),na={class:"data-editor",style:{margin:"0"}},aa={class:"t-right pt-8"},la=L(" \u590D\u5236\u914D\u7F6E\u9879 ");function sa(o,t,l,e,d,a){const c=x("b-icon"),i=x("b-ace-editor"),s=x("b-button"),r=x("b-modal");return _(),w("div",Gn,[n("div",Zn,[n("div",Qn,[n("span",ea,Z(l.comAlias),1)]),n("div",ta,[n("span",null,Z(e.comTitle),1)])]),We(o.$slots,"default",{},()=>[n("div",{class:"search-config",onClick:t[0]||(t[0]=(...f)=>e.openDetail&&e.openDetail(...f)),title:"\u67E5\u770B\u914D\u7F6E\u9879"},[u(c,{name:"filesearch",size:"14"}),oa])],!0),u(r,{modelValue:e.detailVisible,"onUpdate:modelValue":t[1]||(t[1]=f=>e.detailVisible=f),title:`[${l.comAlias}] \u914D\u7F6E\u9879 `,"append-to-body":"","custom-class":"schema-modal"},{default:y(()=>[n("div",na,[u(i,{"model-value":JSON.stringify(l.com,null,2),readonly:"",theme:"tomorrow_night",wrap:"",styles:{border:"none"},height:"500"},null,8,["model-value"])]),n("div",aa,[u(s,{size:"small",type:"primary",icon:"file-copy",onClick:e.copyCom},{default:y(()=>[la]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"])])}var Re=j(Jn,[["render",sa],["__scopeId","data-v-3284dfac"]]);const ia={name:"data-center-panel",components:{ConfigTitle:Re,SourcePanel:_t(()=>ct(()=>import("./source-panel-ea086241.js"),["static/js/source-panel-ea086241.js","static/css/source-panel-9456a5cd.css","static/js/vendor-b7d265ee.js","static/css/vendor-2b79d43b.css","static/js/chunk-brace-b4ee70be.js","static/js/index-f0c9e2c9.js","static/css/index-5c408e93.css","static/js/chunk-bin-ui-next-925ea2c7.js","static/css/chunk-bin-ui-next-233b4550.css"]))},setup(){const{schemaStore:o,storeToRefs:t}=N(),{selectedCom:l}=t(o),e=V(()=>Object.keys(l.value.apiData));return{selectedCom:l,dataKeys:e}}},ca={class:"data-center-panel"},ra={class:"scroll-container"},da={key:1,style:{"min-height":"300px"},flex:"main:center cross:center"},ua=L("\u8BE5\u7EC4\u4EF6\u4E0D\u9700\u8981\u914D\u7F6E\u6570\u636E");function ma(o,t,l,e,d,a){const c=x("config-title"),i=x("source-panel"),s=x("b-empty"),r=x("b-scrollbar");return _(),w("div",ca,[u(c,{"com-name":e.selectedCom.name,"com-alias":e.selectedCom.alias},null,8,["com-name","com-alias"]),n("div",ra,[u(r,{native:""},{default:y(()=>[e.dataKeys.length>0?(_(),U(i,{key:0})):(_(),w("div",da,[u(s,null,{default:y(()=>[ua]),_:1})]))]),_:1})])])}var va=j(ia,[["render",ma]]);const fa={class:"basic-setting-wp"},pa={style:{width:"50%"}},ha=L(" \u7EC4\u5408 "),_a=L(" \u62C6\u5206 "),Ze={__name:"basic-setting",props:{attr:{type:Object,required:!0},readonly:{type:Boolean,default:!1}},emits:["update:attr"],setup(o,{emit:t}){const l=o,e=V({get:()=>l.attr,set:s=>t("update:attr",s)}),{schemaStore:d,storeToRefs:a}=N(),{curComIsGroup:c,multiSelect:i}=a(d);return(s,r)=>{const f=x("g-input-number"),b=x("g-field"),m=x("b-button"),v=x("b-button-group"),p=x("g-slider");return _(),w("div",fa,[u(b,{label:"\u56FE\u8868\u5C3A\u5BF8",flat:""},{default:y(()=>[u(f,{modelValue:C(e).w,"onUpdate:modelValue":r[0]||(r[0]=g=>C(e).w=g),label:"\u5BBD\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(f,{modelValue:C(e).h,"onUpdate:modelValue":r[1]||(r[1]=g=>C(e).h=g),label:"\u9AD8\u5EA6",min:10,max:4e3,inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),u(b,{label:"\u56FE\u8868\u4F4D\u7F6E",flat:""},{default:y(()=>[u(f,{modelValue:C(e).x,"onUpdate:modelValue":r[2]||(r[2]=g=>C(e).x=g),label:"X",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"]),u(f,{modelValue:C(e).y,"onUpdate:modelValue":r[3]||(r[3]=g=>C(e).y=g),label:"Y",inline:"",suffix:"px",disabled:o.readonly},null,8,["modelValue","disabled"])]),_:1}),C(i)?q("",!0):(_(),U(b,{key:0,label:"\u65CB\u8F6C\u89D2\u5EA6",flat:""},{default:y(()=>[u(f,{modelValue:C(e).rotate,"onUpdate:modelValue":r[4]||(r[4]=g=>C(e).rotate=g),min:0,max:360,step:1,inline:""},null,8,["modelValue"]),n("div",pa,[u(v,null,{default:y(()=>[(_(!0),w(Y,null,ee(C(kt),g=>(_(),U(m,{key:g.value,size:"mini",title:g.label,onClick:h=>C(d).doRotate(g.value)},{default:y(()=>[n("i",{class:T(`b-iconfont b-icon-${g.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})])]),_:1})),C(i)||C(c)?q("",!0):(_(),U(b,{key:1,label:"\u900F\u660E\u5EA6"},{default:y(()=>[u(p,{modelValue:C(e).opacity,"onUpdate:modelValue":r[5]||(r[5]=g=>C(e).opacity=g),min:0,max:1,step:.05},null,8,["modelValue","step"])]),_:1})),C(i)?q("",!0):(_(),U(b,{key:2,label:"\u4F4D\u7F6E"},{default:y(()=>[u(v,null,{default:y(()=>[(_(!0),w(Y,null,ee(C(Vt),g=>(_(),U(m,{key:g.value,size:"mini",title:g.label,onClick:h=>C(d).doAdsorption(g.value)},{default:y(()=>[n("i",{class:T(`iconfont-align b-icon-${g.value}-vs`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})),C(i)?(_(),U(b,{key:3,label:"\u5BF9\u9F50"},{default:y(()=>[u(v,null,{default:y(()=>[(_(!0),w(Y,null,ee(C($t),g=>(_(),U(m,{key:g.value,size:"mini",title:g.label,onClick:h=>C(d).doAlign(g.value)},{default:y(()=>[n("i",{class:T(`iconfont-align b-icon-${g.value}`)},null,2)]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})):q("",!0),C(i)||C(c)?(_(),U(b,{key:4,label:"\u7EC4\u5408\u62C6\u5206"},{default:y(()=>[u(v,null,{default:y(()=>[u(m,{size:"mini",icon:"group",disabled:!C(i),onClick:r[6]||(r[6]=g=>C(d).group())},{default:y(()=>[ha]),_:1},8,["disabled"]),u(m,{size:"mini",icon:"ungroup",disabled:!C(c),onClick:r[7]||(r[7]=g=>C(d).ungroup())},{default:y(()=>[_a]),_:1},8,["disabled"])]),_:1})]),_:1})):q("",!0)])}}},ga={class:"setting-panel"},ba={class:"setting-panel-content"},ya={class:"scroll-container"},xa={__name:"index",setup(o){const{schemaStore:t,storeToRefs:l}=N(),{selectedCom:e}=l(t);return(d,a)=>{const c=x("b-scrollbar");return _(),w("div",ga,[u(Re,{"com-name":C(e).name,"com-alias":C(e).alias,com:C(e)},null,8,["com-name","com-alias","com"]),n("div",ba,[n("div",ya,[u(c,null,{default:y(()=>[(_(),U(Ze,{key:`${C(e).id}'_basic-setting`,attr:C(e).attr},null,8,["attr"])),(_(),U(Ke(C(e).name+"Config"),{key:C(e).id,data:C(e)},null,8,["data"]))]),_:1})])])])}}},Ca={class:"setting-panel"},wa=n("span",null,null,-1),Sa={class:"setting-panel-content"},ka={class:"scroll-container"},Va={__name:"multi-setting",setup(o){const{schemaStore:t,storeToRefs:l}=N(),{areaData:e}=l(t),d=V(()=>e.value.showArea),a=V(()=>({x:e.value.x,y:e.value.y,w:e.value.width,h:e.value.height}));return(c,i)=>{const s=x("b-scrollbar");return _(),w("div",Ca,[u(Re,{"com-alias":"\u591A\u9009\u533A\u57DF"},{default:y(()=>[wa]),_:1}),n("div",Sa,[n("div",ka,[u(s,null,{default:y(()=>[u(Ze,{attr:C(a),readonly:C(d)},null,8,["attr","readonly"])]),_:1})])])])}}},$a={class:"config-panel"},Ma={key:0,class:"page-config-panel"},Da={class:"page-config-top"},Ta={class:"tabs-wrapper"},Ba={key:0,class:"page-config-content"},Ra={key:1,class:"page-config-content"},La={key:0,style:{height:"100%"}},Ia={key:1,style:{height:"100%"}},Na={__name:"index",setup(o){const{schemaStore:t,storeToRefs:l}=N(),{toolbar:e,selectedCom:d,multiSelect:a}=l(t),c=D(0),i=s=>{if(!(a.value&&s>0)){if(s===2){Q.warning("\u6682\u672A\u5F00\u653E!");return}c.value!==s&&(c.value=s)}};return re(()=>d.value,()=>{c.value=0}),(s,r)=>{const f=x("b-icon"),b=x("b-tooltip");return _(),w("div",{class:T(["config-panel-wp",{"is-hide":!C(e).config}])},[n("div",$a,[C(d)||C(a)?(_(),w("div",Ma,[n("div",Da,[n("div",Ta,[n("div",{class:T(["tab-item",{active:c.value===0}]),onClick:r[0]||(r[0]=m=>i(0))},[u(b,{content:"\u914D\u7F6E"},{default:y(()=>[u(f,{name:"control",size:"20"})]),_:1})],2),n("div",{class:T(["tab-item",{active:c.value===1}]),onClick:r[1]||(r[1]=m=>i(1))},[u(b,{content:"\u6570\u636E"},{default:y(()=>[u(f,{name:"cloud-server",size:"22"})]),_:1})],2),n("div",{class:T(["tab-item",{active:c.value===2}]),onClick:r[2]||(r[2]=m=>i(2))},[u(b,{content:"\u4E8B\u4EF6"},{default:y(()=>[u(f,{name:"deploymentunit",size:"18"})]),_:1})],2)])]),C(a)?(_(),w("div",Ba,[u(Va)])):(_(),w("div",Ra,[c.value===0?(_(),w("div",La,[(_(),U(xa,{key:C(d).id}))])):q("",!0),c.value===1?(_(),w("div",Ia,[(_(),U(va,{key:C(d).id}))])):q("",!0)]))])):(_(),U(Fn,{key:1}))])],2)}}};const za={class:"toolbox-panel",flex:"main:justify"},Ua={style:{width:"500px"},flex:""},Aa=n("i",{class:"action-btn b-iconfont b-icon-rollback"},null,-1),Ea=L(" \u64A4\u9500 "),Oa=n("i",{class:"action-btn b-iconfont b-icon-rollback",style:{transform:"rotateY(180deg)"}},null,-1),ja=L(" \u91CD\u505A "),Ha=n("div",null,null,-1),Ya={class:"btn-box"},Xa=L(" \u53C2\u8003\u7EBF\xA0\xA0 "),Wa={class:"btn-box"},Ka=L(" \u5BF9\u9F50\u7EBF\xA0\xA0 "),Pa={class:"ctrl-box",flex:"cross:center"},Fa=L(" \xA0\xA0 "),Ja=L("\u7C98\u8D34\u56FE\u8868"),qa=L("\u6E05\u7A7A\u753B\u5E03"),Ga={__name:"index",setup(o){const{schemaStore:t,storeToRefs:l}=N(),{toolbar:e,toolbox:d}=l(t),a=D(!1),c=D(null),i=()=>{Fe.confirm({type:"error",title:"\u786E\u8BA4\u6E05\u7A7A\u753B\u5E03\u5417\uFF1F\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"}).then(()=>{t.clearScreen()}).catch(()=>{})},s=()=>t.undo(),r=()=>t.redo();function f(){a.value=!0,ve(()=>{c.value&&c.value.addEventListener("paste",b),c.value.focus(),c.value.placeholder="\u7C98\u8D34\u56FE\u8868\u914D\u7F6E"})}function b(m){const v=m.clipboardData.getData("Text");try{const p=JSON.parse(v);((p==null?void 0:p.type)==="com"||(p==null?void 0:p.type)==="group")&&(p.id=`${p.name}_${be()}`,p.name==="Group"&&p.components.forEach(g=>{g.id=`${g.name}_${be()}`}),t.addCom({component:p}),Q.success("\u7C98\u8D34\u56FE\u8868\u6210\u529F\uFF01"))}catch(p){console.log(p),Q.error("\u7C98\u8D34\u7684\u5185\u5BB9\u4E0D\u662F\u56FE\u8868\u7EC4\u4EF6\uFF01")}setTimeout(()=>{c.value.value="",a.value=!1,c.value.removeEventListener("paste",b)},100)}return(m,v)=>{const p=x("b-button"),g=x("b-switch");return _(),w("div",{class:T(["toolbox-panel-wp",{"is-hide":!C(e).toolbox}])},[n("div",za,[n("div",Ua,[u(p,{size:"mini",onClick:s},{default:y(()=>[Aa,Ea]),_:1}),u(p,{size:"mini",onClick:r},{default:y(()=>[Oa,ja]),_:1}),Ha,n("div",Ya,[Xa,u(g,{modelValue:C(d).referLine,"onUpdate:modelValue":v[0]||(v[0]=h=>C(d).referLine=h),size:"small"},null,8,["modelValue"])]),n("div",Wa,[Ka,u(g,{modelValue:C(d).markLine,"onUpdate:modelValue":v[1]||(v[1]=h=>C(d).markLine=h),size:"small"},null,8,["modelValue"])])]),n("div",Pa,[Fa,a.value?(_(),w("textarea",{key:0,class:"paste-inner",ref_key:"textpasteRef",ref:c},null,512)):(_(),U(p,{key:1,size:"mini",icon:"diff",onClick:f},{default:y(()=>[Ja]),_:1})),u(p,{size:"mini",icon:"clear",onClick:i},{default:y(()=>[qa]),_:1})])])],2)}}};const Za={name:"shortcut",props:{modelValue:{type:Boolean}},emits:["update:modelValue"]},Qa=o=>(pe("data-v-7e8e628e"),o=o(),he(),o),el=Qa(()=>n("div",{class:"shortcut-wp"},[n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u57FA\u7840\u5FEB\u6377\u952E"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u56FE\u5C42\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2190")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u914D\u7F6E\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u7EC4\u4EF6\u9762\u677F"),n("div",{class:"shortcut-value"},"Ctrl + \u2191")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5F00\u5173\u5DE5\u5177\u680F"),n("div",{class:"shortcut-value"},"Ctrl + \u2193")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u590D\u5236\u9009\u4E2D\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Ctrl + C")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7C98\u8D34\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Ctrl + V")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u64A4\u9500\u64CD\u4F5C"),n("div",{class:"shortcut-value"},"Ctrl + Z")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4FDD\u5B58\u770B\u677F"),n("div",{class:"shortcut-value"},"Ctrl + S")])])]),n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u753B\u5E03\u64CD\u4F5C"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u6700\u4F73\u6BD4\u4F8B"),n("div",{class:"shortcut-value"},"Ctrl + A")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u753B\u5E03\u7F29\u653E\u4E3A1\uFF1A1"),n("div",{class:"shortcut-value"},"Ctrl + D")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u81EA\u7531\u7F29\u653E"),n("div",{class:"shortcut-value"},"Ctrl + \u9F20\u6807\u6EDA\u8F6E/\u6EDA\u52A8")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u753B\u5E03"),n("div",{class:"shortcut-value"},"Space + \u9F20\u6807\u5DE6\u952E/\u62D6\u52A8")])])]),n("div",{class:"shortcut-box"},[n("div",{class:"key-title"},"\u7EC4\u4EF6\u64CD\u4F5C"),n("div",{class:"key-wrap"},[n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u9876"),n("div",{class:"shortcut-value"},"Alt + Home")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u7EC4\u4EF6\u7F6E\u5E95"),n("div",{class:"shortcut-value"},"Alt + End")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4E0A\u79FB\u4E00\u5C42"),n("div",{class:"shortcut-value"},"Alt + \u2191")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u4E0B\u79FB\u4E00\u5C42"),n("div",{class:"shortcut-value"},"Alt + \u2193")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF61\u50CF\u7D20"),n("div",{class:"shortcut-value"},"\u2191 \u2193 \u2190 \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u79FB\u52A8\u7EC4\u4EF610\u50CF\u7D20"),n("div",{class:"shortcut-value"},"Shift + \u2191 \u2193 \u2190 \u2192")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u91CD\u547D\u540D"),n("div",{class:"shortcut-value"},"F2/\u53CC\u51FB\u56FE\u5C42")]),n("div",{class:"shortcut-item"},[n("div",{class:"shortcut-title"},"\u5220\u9664\u9009\u4E2D\u7EC4\u4EF6"),n("div",{class:"shortcut-value"},"Delete")])])])],-1));function tl(o,t,l,e,d,a){const c=x("b-modal");return _(),U(c,{title:"\u5FEB\u6377\u952E\u6307\u5357","model-value":l.modelValue,"append-to-body":"","custom-class":"schema-modal",onClose:t[0]||(t[0]=i=>o.$emit("update:modelValue",!1))},{default:y(()=>[el]),_:1},8,["model-value"])}var ol=j(Za,[["render",tl],["__scopeId","data-v-7e8e628e"]]);const nl={name:"footer-panel",components:{Shortcut:ol},setup(){const{schemaStore:o,storeToRefs:t}=N(),{pageConfig:l,canvas:e}=t(o),d=D([200,150,100,50]),a=D(20),c=D(20),i=D(!1),s=async r=>{r===-1?o.autoCanvasScale():o.setCanvasScale(r===0?a.value:r)};return re(()=>e.value.scale,r=>{const f=parseInt((r*100).toFixed(2));c.value=f,a.value=f}),{pageConfig:l,scaleList:d,inputScale:a,scale:c,submitScale:s,keycodeVisible:i}}},al={class:"footer-panel"},ll={class:"screen-info",flex:"cross:center"},sl={class:"ml-8",style:{transform:"scale(0.9)"}},il={flex:"cross:center"},cl={class:"scale-input-wp"},rl=n("span",{class:"percent"},"%",-1),dl=n("i",{class:"b-iconfont b-icon-down"},null,-1),ul=L("\u81EA\u9002\u5E94"),ml={class:"scale-slider-wp"};function vl(o,t,l,e,d,a){const c=x("b-icon"),i=x("b-tooltip"),s=x("b-dropdown-item"),r=x("b-dropdown-menu"),f=x("b-dropdown"),b=x("b-slider"),m=x("shortcut");return _(),w(Y,null,[n("div",al,[n("div",ll,[u(i,{content:"\u5FEB\u6377\u952E\u63D0\u793A","open-delay":500},{default:y(()=>[u(c,{name:"read",size:"16",type:"button",onClick:t[0]||(t[0]=v=>e.keycodeVisible=!0)})]),_:1}),n("span",sl,Z(e.pageConfig.width)+" \u50CF\u7D20 * "+Z(e.pageConfig.height)+" \u50CF\u7D20",1)]),n("div",il,[u(f,{trigger:"click",onCommand:e.submitScale},{dropdown:y(()=>[u(r,null,{default:y(()=>[(_(!0),w(Y,null,ee(e.scaleList,v=>(_(),U(s,{key:v,name:v},{default:y(()=>[L(Z(`${v}%`),1)]),_:2},1032,["name"]))),128)),u(s,{name:-1},{default:y(()=>[ul]),_:1})]),_:1})]),default:y(()=>[n("div",cl,[de(n("input",{"onUpdate:modelValue":t[1]||(t[1]=v=>e.inputScale=v),type:"number",class:"scale-input",onKeydown:t[2]||(t[2]=He(v=>e.submitScale(0),["enter"]))},null,544),[[ke,e.inputScale]]),rl,dl])]),_:1},8,["onCommand"]),n("div",ml,[u(b,{modelValue:e.scale,"onUpdate:modelValue":t[3]||(t[3]=v=>e.scale=v),min:10,max:200,step:5,"show-tooltip":!1,onChange:e.submitScale},null,8,["modelValue","onChange"])])])]),u(m,{modelValue:e.keycodeVisible,"onUpdate:modelValue":t[4]||(t[4]=v=>e.keycodeVisible=v)},null,8,["modelValue"])],64)}var fl=j(nl,[["render",vl]]);const pl={name:"context-menu",setup(){const{schemaStore:o,storeToRefs:t}=N(),{selectedCom:l}=t(o),{isLocked:e,isHided:d,contextMenu:a,contextMenuStyle:c}=Be(),i=S=>{l.value&&o.moveCom({id:l.value.id,moveType:S})},s=()=>i(le.up),r=()=>i(le.down),f=()=>i(le.top),b=()=>i(le.bottom),m=()=>{l.value&&(l.value.locked=!l.value.locked)},v=()=>{l.value&&(l.value.hided=!l.value.hided)},p=()=>{const S=l.value;S&&Fe.confirm({type:"error",title:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u76841\u4E2A\u7EC4\u4EF6"}).then(()=>{o.deleteCom(S.id)}).catch(()=>{})},g=()=>{const S=l.value;S&&o.renamingCom(S.id)},h=()=>{const S=l.value;S&&o.copyCom(S.id)},M=S=>S.preventDefault();return fe(()=>{F(document,"contextmenu",M)}),Ce(()=>{J(document,"contextmenu",M)}),{contextMenu:a,contextMenuStyle:c,isLocked:e,isHided:d,moveUp:s,moveDown:r,moveTop:f,moveBottom:b,toDeleteCom:p,renameCom:g,toCopyCom:h,lockCom:m,hideCom:v}}},O=o=>(pe("data-v-68b5ef35"),o=o(),he(),o),hl=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto",style:{transform:"rotate(180deg)"}},null,-1)),_l=L(" \u7F6E\u9876 "),gl=O(()=>n("span",{class:"key-code"},"Alt + Home",-1)),bl=[hl,_l,gl],yl=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-vertical-align-botto"},null,-1)),xl=L(" \u7F6E\u5E95 "),Cl=O(()=>n("span",{class:"key-code"},"Alt + End",-1)),wl=[yl,xl,Cl],Sl=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-arrowup"},null,-1)),kl=L(" \u4E0A\u79FB\u4E00\u5C42 "),Vl=O(()=>n("span",{class:"key-code"},"Alt + \u2191",-1)),$l=[Sl,kl,Vl],Ml=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-arrowdown"},null,-1)),Dl=L(" \u4E0B\u79FB\u4E00\u5C42 "),Tl=O(()=>n("span",{class:"key-code"},"Alt + \u2193",-1)),Bl=[Ml,Dl,Tl],Rl=O(()=>n("div",{class:"context-menu-divider"},null,-1)),Ll=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-unlock"},null,-1)),Il=L(" \u89E3\u9501 "),Nl=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-lock"},null,-1)),zl=L(" \u9501\u5B9A "),Ul=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-eye"},null,-1)),Al=L(" \u663E\u793A "),El=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-eye-close"},null,-1)),Ol=L(" \u9690\u85CF "),jl=O(()=>n("div",{class:"context-menu-divider"},null,-1)),Hl=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-edit"},null,-1)),Yl=L(" \u91CD\u547D\u540D "),Xl=O(()=>n("span",{class:"key-code"},"F2",-1)),Wl=[Hl,Yl,Xl],Kl=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-file-copy"},null,-1)),Pl=L(" \u590D\u5236 "),Fl=O(()=>n("span",{class:"key-code"},"Ctrl + C,V",-1)),Jl=[Kl,Pl,Fl],ql=O(()=>n("i",{class:"menu-icon b-iconfont b-icon-delete"},null,-1)),Gl=L(" \u5220\u9664 "),Zl=O(()=>n("span",{class:"key-code"},"Delete",-1)),Ql=[ql,Gl,Zl];function es(o,t,l,e,d,a){return _(),U(rt,{name:"zoom-in-top"},{default:y(()=>[e.contextMenu.show?(_(),w("div",{key:0,class:"context-menu-wrap",style:A(e.contextMenuStyle)},[n("div",{class:"context-menu-item",onClick:t[0]||(t[0]=(...c)=>e.moveTop&&e.moveTop(...c))},bl),n("div",{class:"context-menu-item",onClick:t[1]||(t[1]=(...c)=>e.moveBottom&&e.moveBottom(...c))},wl),n("div",{class:"context-menu-item",onClick:t[2]||(t[2]=(...c)=>e.moveUp&&e.moveUp(...c))},$l),n("div",{class:"context-menu-item",onClick:t[3]||(t[3]=(...c)=>e.moveDown&&e.moveDown(...c))},Bl),Rl,n("div",{class:"context-menu-item",onClick:t[4]||(t[4]=(...c)=>e.lockCom&&e.lockCom(...c))},[e.isLocked?(_(),w(Y,{key:0},[Ll,Il],64)):(_(),w(Y,{key:1},[Nl,zl],64))]),n("div",{class:"context-menu-item",onClick:t[5]||(t[5]=(...c)=>e.hideCom&&e.hideCom(...c))},[e.isHided?(_(),w(Y,{key:0},[Ul,Al],64)):(_(),w(Y,{key:1},[El,Ol],64))]),jl,n("div",{class:"context-menu-item",onClick:t[6]||(t[6]=(...c)=>e.renameCom&&e.renameCom(...c))},Wl),n("div",{class:"context-menu-item",onClick:t[7]||(t[7]=(...c)=>e.toCopyCom&&e.toCopyCom(...c))},Jl),n("div",{class:"context-menu-item",onClick:t[8]||(t[8]=(...c)=>e.toDeleteCom&&e.toDeleteCom(...c))},Ql)],4)):q("",!0)]),_:1})}var ts=j(pl,[["render",es],["__scopeId","data-v-68b5ef35"]]);function os(){const o=xe(),{schemaStore:t}=N(),l=D(!1),e=async a=>{try{l.value=!0;const c=await gt(a);if(c){const{id:i,name:s,pid:r,layout:f,components:b}=c,m={pageInfo:{id:i,name:s,pid:r},pageConfig:JSON.parse(f),comps:b.map(v=>JSON.parse(v.componentContent))};t.loadScreenData(m),await ve(),document.title=s}}catch(c){console.log(c)}l.value=!1},d=async()=>{try{l.value=!0;const a=await yt();if(a.tpl.length>0){const c=await St(a.tpl);if(c){const i=JSON.parse(c.content),{comps:s,pageConfig:r}=i;t.loadScreenData({comps:s,pageConfig:r})}}else t.setScreenSize(a)}catch(a){console.log(a)}l.value=!1};return re(()=>o.path,async()=>{const{id:a}=o.query;a?await e(a):await d()},{immediate:!0}),{loading:l}}function ns(){const o=D(null),t=D(null),{saveScreenData:l}=Te(),{schemaStore:e,storeToRefs:d}=N(),{pageInfo:a,canvas:c,selectedCom:i}=d(e),s=xe();let r=null;const f=p=>{const g=p.target;if(!["input","textarea"].includes(g.tagName.toLowerCase())){const h=p.key.toLowerCase();h==="delete"?(t.value&&t.value.toDeleteCom(),p.preventDefault()):h==="f2"&&(t.value&&t.value.renameCom(),p.preventDefault());const M=i.value;p.altKey&&(b("altKey"),h==="arrowup"?t.value&&t.value.moveUp():h==="arrowdown"?t.value&&t.value.moveDown():h==="home"?t.value&&t.value.moveTop():h==="end"&&t.value&&t.value.moveBottom(),p.preventDefault()),p.ctrlKey&&(b("ctrlKey"),h==="arrowup"?(e.toggleCompsPanel(),p.preventDefault()):h==="arrowdown"?(e.toggleToolbox(),p.preventDefault()):h==="arrowleft"?(e.toggleLayerPanel(),p.preventDefault()):h==="arrowright"?(e.toggleConfigPanel(),p.preventDefault()):h==="a"?(e.autoCanvasScale(),p.preventDefault()):h==="d"?(e.setCanvasScale(100),p.preventDefault()):h==="c"?(r=i.value,De(JSON.stringify(r)),p.preventDefault()):h==="v"?(r&&e.copyCom(r.id),p.preventDefault()):h==="s"?(a.value.id||s.query.id?(Q("\u6B63\u5728\u4FDD\u5B58..."),l("edit").then(()=>Q.success("\u4FDD\u5B58\u6210\u529F\uFF01"))):o.value&&o.value.handleSaveScreen(),p.preventDefault()):h==="z"&&(e.undo(),p.preventDefault())),p.shiftKey&&b("shiftKey"),p.keyCode===32&&(b("spaceKey"),p.preventDefault());const S=p.shiftKey?10:1;M&&!p.altKey&&(h==="arrowleft"?(M.attr.x-=S,p.preventDefault()):h==="arrowright"?(M.attr.x+=S,p.preventDefault()):h==="arrowup"?(M.attr.y-=S,p.preventDefault()):h==="arrowdown"&&(M.attr.y+=S,p.preventDefault()))}},b=p=>{e.toggleKey({key:p,status:!0})},m=()=>{e.resetKeyCode()},v=p=>{const g=parseInt((c.value.scale*100).toFixed(2)),h=(p.wheelDelta>0?1:-1)*5,M=Math.min(Math.max(g+h,20),200);e.setCanvasScale(M)};return fe(()=>{F(document,"keydown",f),F(document,"keyup",m)}),Ce(()=>{J(document,"keydown",f),J(document,"keyup",m)}),{headerRef:o,contextMenuRef:t,ctrlMouseWheel:v}}const as={name:"ScreenEditor",components:{ContextMenu:ts,FooterPanel:fl,ToolboxPanel:Ga,CanvasMain:An,ConfigPanel:Na,ComponentsPanel:Qo,LayerPanel:fo,HeaderBar:Gt},setup(){return{...os(),...ns()}}},ls={key:0,flex:"main:center cross:center",class:"full-wrapper"},ss={key:1,class:"editor-main-wrapper"},is={class:"edit-main-wp"};function cs(o,t,l,e,d,a){const c=x("header-bar"),i=x("svg-loading"),s=x("components-panel"),r=x("layer-panel"),f=x("toolbox-panel"),b=x("canvas-main"),m=x("footer-panel"),v=x("config-panel"),p=x("context-menu");return _(),w("div",{class:"schema-screen-container",onWheel:t[0]||(t[0]=ne((...g)=>o.ctrlMouseWheel&&o.ctrlMouseWheel(...g),["ctrl","prevent"]))},[u(c,{ref:"headerRef","back-url":"/dashboard"},null,512),o.loading?(_(),w("div",ls,[u(i,{name:"loading02"})])):(_(),w("div",ss,[u(s),u(r),n("div",is,[u(f),u(b),u(m)]),u(v)])),u(p,{ref:"contextMenuRef"},null,512)],32)}var _s=j(as,[["render",cs]]);export{_s as default};
